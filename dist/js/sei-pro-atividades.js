// ADICIONA ACOMPANHAMENTO DE ATIVIDADES
var debugScreen = false;
var perfilLoginAtiv = false;
var urlServerAtiv = false;
var userHashAtiv = false;
var delayServerAtiv = 0;
var arrayConfigAtividades = (!getOptionsPro('panelLocalStorePro') && hybridStorageRestorePro('configDataAtividadesPadraoPro') !== null) ? restoreLocalDataConfigArray() : [];
var arrayConfigAtivUnidade = (!getOptionsPro('panelLocalStorePro') && hybridStorageRestorePro('configDataAtivUnidadePro') !== null) ? hybridStorageRestorePro('configDataAtivUnidadePro') : [];
var ganttAtividades = false;
var ganttAfastamentos = false;
var ganttRecorrencias = false;
var kanbanAtividades = false;
var kanbanAtividadesMoving = false;
// var googleOneTap = false;
var tableConfigEditor = {};
var tableConfigList = {};
var arrayAtividadesPro = (!getOptionsPro('panelLocalStorePro') && hybridStorageRestorePro('configDataAtividadesPro') !== null) ? hybridStorageRestorePro('configDataAtividadesPro') : [];
var arrayAtividadesProcPro = !getOptionsPro('panelLocalStorePro') && (hybridStorageRestorePro('configDataAtividadesProcPro') !== null) ? hybridStorageRestorePro('configDataAtividadesProcPro') : [];
var arrayPrescricoesProcPro = !getOptionsPro('panelLocalStorePro') && (hybridStorageRestorePro('configDataPrescricoesProcPro') !== null) ? hybridStorageRestorePro('configDataPrescricoesProcPro') : [];
var checkLoadAtividadesProcPro = false;
var checkLoadFavoritesProcPro = false;
var arrayAtividades = ($('#ifrArvore').length > 0) ? arrayAtividadesProcPro : arrayAtividadesPro;
var perfilAtividadesSelected = getOptionsPro('panelAtividadesViewSyncUnidade')
                            ? $('#selInfraUnidades option:selected').text().trim()
                            : (getOptionsPro('perfilAtividadesSelected')) ? getOptionsPro('perfilAtividadesSelected') : '';
var arrayProcessosUnidade = getProcessoUnidadePro();
var arrayNomenclaturas = [];
var timeRestoreAtividades = (getOptionEntidade('cache_demandas_value') && getOptionEntidade('cache_demandas_time')) ? {time: getOptionEntidade('cache_demandas_time'), value: getOptionEntidade('cache_demandas_value')} : {time: 'day', value: 1};
var lastUpdateAtividades = (!getOptionsPro('panelLocalStorePro') && localStorageRestorePro('lastUpdateAtividades') !== null) 
                            ? localStorageRestorePro('lastRestoreAtividades') !== null && moment(localStorageRestorePro('lastRestoreAtividades'),'YYYY-MM-DD HH:mm:ss').add(timeRestoreAtividades.value,timeRestoreAtividades.time) < moment() ? false : localStorageRestorePro('lastUpdateAtividades')
                            : false;
var dly;
var loadRowsPanelAtiv = false;
var indexReportUpdate = 0;
var listReportsUpdate = ['atividades', 'programas', 'planos'];
var nameReportsUpdate = ['Atividades', 'Programas de Gest\u00E3o', 'Planos de Trabalho'];
var listLabelsTiposMetadados = [
    {label: 'N\u00FAmero', value: 'number'},
    {label: 'Texto', value: 'text'},
    {label: 'CPF', value: 'cpf'},
    {label: 'CNPJ', value: 'cnpj'},
    {label: 'Telefone', value: 'telefone'},
    {label: 'Processo', value: 'processo'},
    {label: 'Sim/N\u00E3o', value: 'boolean'},
    {label: 'Mapa', value: 'latlong'},
    {label: 'Data', value: 'date'},
    {label: 'Data/Hora', value: 'datetime'}
];
var chartColors = {
                    blue:"rgb(54, 162, 235)", 
                    dark_blue:"rgb(4 110 188)", 
                    green:"rgb(75, 192, 192)", 
                    red:"rgb(255, 99, 132)", 
                    magenta:"rgb(218,112,214)",
                    orange:"rgb(255, 159, 64)", 
                    purple:"rgb(153, 102, 255)", 
                    cyan:"rgb(0,206,209)",
                    grey:"rgb(201, 203, 207)",
                    yellow:"rgb(255, 205, 86)", 
                    maroon:"rgb(128,0,0)",
                    olive:"rgb(85,107,47)",
                    teal:"rgb(0,128,128)",
                    navy:"rgb(65,105,225)",
                    silver:"rgb(192,192,192)",
                    salmon:"rgb(250,128,114)",
                    steel:"rgb(70,130,180)",
                    violet:"rgb(238,130,238)",
                    pink:"rgb(255,192,203)",
                    chocolate:"rgb(210,105,30)",
                    light_grey:"rgb(220,220,220)",
                    dark_grey:"rgb(102 102 102)",
                    silver_blue:"rgb(236 240 242)"
                }
    if (typeof Chart !== 'undefined') Chart.defaults.global.defaultFontColor = (localStorage.getItem('darkModePro') ? chartColors.light_grey : chartColors.dark_grey);
    
function getName(ref_nomenclatura, name_default, singular = true, with_article = false, capitalize = false) {
    if (typeof arrayNomenclaturas !== 'undefined' && arrayNomenclaturas.length > 0) {
        var name = jmespath.search(arrayNomenclaturas, "[?ref_nomenclatura=='"+ref_nomenclatura+"'] | [0]");
            name = (name !== null) ? name : false;
        var article = (name) 
            ? name.config.masculino 
                ? (singular ? 'o' : 'os')
                : (singular ? 'a' : 'as')
            : '';
        var nomenclatura = name ? (singular ? name.config.singular : name.config.plural) : name_default;
            nomenclatura = (capitalize) ? capitalizeFirstLetter(nomenclatura) : nomenclatura;
        var preposicao = (name && typeof name.config.preposicao !== 'undefined' && name.config.preposicao) 
            ? name.config.masculino 
                ? (singular ? 'do ' : 'dos ')
                : (singular ? 'da ' : 'das ')
            : '';
        var phase = (with_article) ? article+' '+nomenclatura : preposicao+nomenclatura;
        return phase;
    } else {
        return name_default;
    }
}
function getNameGenre(ref_nomenclatura, string_male, string_female) {
    var masc = jmespath.search(arrayNomenclaturas, "[?ref_nomenclatura=='"+ref_nomenclatura+"'] | [0].config.masculino");
        masc = (masc !== null) ? masc : false;
    return (masc ? string_male : string_female);
}
function getServerAtividades(param, mode) {
    // if (    urlServerAtiv && (getTokenGoogle() || userHashAtiv != '') &&
    if (    urlServerAtiv && userHashAtiv != '' &&
            (
                mode == 'panel' || 
                mode == 'config_resend_keys' || 
                (mode == 'chart_demandas' && checkCapacidade(mode)) || 
                (mode == 'chart_produtividade_mensal' && checkCapacidade(mode)) || 
                (mode.indexOf('config_') !== -1 && checkCapacidade(mode)) || 
                (mode.indexOf('_favoritos') !== -1 && checkCapacidade(mode)) || 
                (mode == 'update_checklist' && checkCapacidade(mode)) || 
                (mode == 'update_projeto_etapa' && checkCapacidade(mode)) || 
                (mode.indexOf('report_') !== -1 && checkCapacidade(mode)) || 
                (delayServerAtiv == 0 && !checkLoadingButtonConfirm() && checkCapacidade(mode)) 
            )
        ) {
        param.hash = userHashAtiv;
        param.version = VERSION_SPRO;
        param.perfil = (getOptionsPro('perfilAtividadesSelected')) ? getOptionsPro('perfilAtividadesSelected') : '';
        param.last_update = (!getOptionsPro('panelLocalStorePro') && lastUpdateAtividades && mode == 'panel') ? lastUpdateAtividades : false;
        param.last_update = (typeof param.offset !== 'undefined') ? false : param.last_update;
        param.id_programa = (typeof param.id_programa !== 'undefined') ? param.id_programa : getOptionsPro('programaAtividadesSelected');
        param.id_programa = (typeof param.id_programa !== 'undefined' && param.id_programa !== null) ? param.id_programa : false;
        param.projetos = verifyConfigValue('gerenciarprojetos') ? JSON.stringify({vigentes: !getOptionsPro('stateArquivadosGantt')}) : false;
        param.prescricoes = checkConfigValue('gerenciarprescricoes') ? JSON.stringify({vigentes: true}) : false;

        delayServerAtiv = 1; setTimeout(function(){ delayServerAtiv = 0; }, 1000);
        if (typeof loadingButtonConfirm !== 'undefined' && mode.indexOf('_favoritos') === -1 ) { loadingButtonConfirm(true); }
        var authToken = undefined;
        /* var authToken = (getTokenGoogle() && userHashAtiv == '') 
            ? function (xhr) {
                xhr.setRequestHeader('Authorization', 'Bearer '+getTokenGoogle());
                xhr.withCredentials = true;
            }
            : undefined; */

        $.ajax({
            type: "POST",
            beforeSend: authToken,
            url: urlServerAtiv,
            dataType: "json",
            data: param,
            success: function(ativData){
                if (  ativData.status == 0 || ativData.length == 0 ) {
                    loadingButtonConfirm(false);

                    if (typeof ativData.replace_server !== 'undefined' && ativData.replace_server != '') {
                        var urlReplace = url_host.replace('controlador.php','')+'?#&acao_pro=change_database&base=atividades&url='+ativData.replace_server;
                        window.location.href = urlReplace;
                    }
                    if (mode.indexOf('config_update_') !== -1 || mode.indexOf('config_new_') !== -1) { 
                        updateServerTabConfig(ativData, param);
                    } else if (mode != 'panel') { 
                        alertaBoxPro('Error', 'exclamation-triangle', (typeof ativData.status_txt != 'undefined' ? ativData.status_txt : 'Erro ao enviar sua informa\u00E7\u00F5es.'));
                        if (mode == 'update_prioridades') {
                            updatePriorityKanbanItens(ativData['board'], 'error');
                        }
                    } else if (typeof ativData.status_acess !== 'undefined' && ativData.status_acess == 0) {
                        alertaBoxPro('Error', 'exclamation-triangle', (typeof ativData.status_txt != 'undefined' ? ativData.status_txt : 'Erro ao acessar o sistema. Acesso Negado.'));
                        if (typeof perfilLoginAtiv.CLIENT_ID !== 'undefined' && perfilLoginAtiv.CLIENT_ID != '') {
                            signOutProfile();
                        } else {
                            cleanAtivParams();
                        }
                    } else {
                        initPanelAtividades(arrayAtividadesPro);
                    }

                } else {

                    if (typeof ativData.padrao !== 'undefined' && typeof ativData.padrao.perfil !== 'undefined' && ativData.padrao.perfil.login.toLowerCase() != userSEI.toLowerCase()) {
                        confirmaBoxPro('A chave de acesso ao sistema de '+__.atividades+' ('+ativData.padrao.perfil.login+') \u00E9 diferente do login do SEI ('+userSEI+'). <br><br>Deseja solicitar o envio de nova chave de acesso?', function() { configResendKey(userSEI) }, 'Solicitar chave de acesso...');
                        if (typeof perfilLoginAtiv.CLIENT_ID !== 'undefined' && perfilLoginAtiv.CLIENT_ID != '') {
                            signOutProfile();
                        } else {
                            cleanAtivParams();
                        }
                    } else {
                        if (mode == 'panel' && param.action == 'demandas' && param.perfil == '' && ativData.demandas.length == 0 && ativData.padrao.perfil.unidade != '') {
                            setOptionsPro('perfilAtividadesSelected', ativData.padrao.perfil.unidade);
                            getServerAtividades(param, mode);
                        } else if (mode.indexOf('chart_') !== -1) {
                            if (mode == 'chart_produtividade_mensal') {
                                getChartProdutividadeMes(param.id_plano, 'set', ativData);
                            } else {
                                setChartAtividades(ativData['chart'], mode);
                            }
                        } else if (mode == 'check_favoritos') {
                            checkFileRemoteFav('set',ativData);
                            checkLoadFavoritesProcPro = true;
                        } else if (mode == 'get_favoritos') {
                            restoreFavServer(ativData['config']);
                        } else if (mode == 'set_favoritos') {
                            loadingButtonConfirm(false);
                        } else if (mode == 'view_documento') {
                            loadingButtonConfirm(false);
                            if (param.reference == 'modelo') {
                                openModelConfigItem(ativData, param);
                            }
                        } else if (mode == 'edit_tempos') {
                            updateServerTemposDemanda('reset', param.mode, false, ativData, param);
                            $('.update_tempos_demanda').removeClass('fa-spin');
                        } else if (mode == 'edit_documento') {
                            loadingButtonConfirm(false);
                            if (param.reference == 'modelo') {
                                resetDialogBoxPro('editorBoxPro');
                                alertaBoxPro('Sucess', 'check-circle', param.title+' salvo com sucesso!');
                            }
                        } else if (mode == 'restory_atividade') {
                            $('#tableRelatorio_demandas_excluidas').find('tr[data-id="'+param.id_demanda+'"]').remove();
                            updateAtividade_(false);
                        } else if (mode == 'report_errors') {
                            loadingButtonConfirm(false);
                            $('.panelHome').find('.iconAtividade_update i').removeClass('fa-spin');
                            $('.alertaErrorPro .sendReport').find('i').attr('class','fas fa-thumbs-up azulColor').end().find('.labelLink').text('Notifica\u00E7\u00E3o enviada!');
                            alertaBoxPro('Sucess', 'check-circle', 'Notifica\u00E7\u00E3o enviada com sucesso!');
                        } else if (mode.indexOf('report_') !== -1) {
                            updateServerTabReport(ativData, param);
                        } else if (mode == 'config_update_user_personal') {
                            $('#tabs-configpessoal').find('tr td:first-child').removeClass('editCellLoading');
                        } else if (mode.indexOf('config_update_') !== -1 || (mode.indexOf('config_new_') !== -1 && mode != 'config_new_users')) {
                            updateServerTabConfig(ativData, param);
                            if (mode == 'config_update_planos' && param.mode == 'homologacao') {
                                loadingButtonConfirm(false);
                                resetDialogBoxPro('dialogBoxPro');
                                updateAtividade();
                                alertaBoxPro('Sucess', 'check-circle', 'Justificativa cadastrada com sucesso!');
                            } else if (mode == 'config_new_planos' && param.mode == 'new') {
                                resetDialogBoxPro('dialogBoxPro');
                                alertaBoxPro('Sucess', 'check-circle', 'Plano de trabalho cadastrado com sucesso!');
                            } else if (mode == 'config_update_tipos_capacidades' && param.mode == 'update') {
                                updateConfigPerfilCapacidade(param, ativData);
                            }
                        } else if (mode == 'view_contato') {
                            setTableContatoPanel(ativData['result']);
                            sessionStorageStorePro('configDataContatosArray',ativData['result']);
                        } else if (mode == 'history_atividade') {
                            historyAtividade(false, 'set', ativData['result']);
                        } else if (mode == 'update_checklist') {
                            checklistUpdate(false, 'update', ativData, param);
                        } else if (mode.indexOf('_prescricao') !== -1) {
                            if (mode == 'update_prescricao' || mode == 'delete_prescricao') {
                                var txtAlert = (mode == 'update_prescricao' && param.id_prescricao > 0) ? 'editada' : 'inserida';
                                    txtAlert = (mode == 'delete_prescricao') ? 'deletada' : txtAlert;
                                    loadingButtonConfirm(false);
                                    resetDialogBoxPro('dialogBoxPro');
                                    alertaBoxPro('Sucess', 'check-circle', __.Prescricao+' '+txtAlert+' com sucesso!');
                                    if (typeof ativData.return_row !== 'undefined' && ativData.return_row.length) {
                                        arrayPrescricoesProcPro = ativData['return_row'];
                                        initPanelPrescricaoProc();
                                    }
                            }
                        } else if (mode.indexOf('_projeto') !== -1) {
                            if (mode == 'delete_projeto' && typeof ativData.return_row !== 'undefined' && ativData.return_row.length) {
                                arrayConfigAtividades.projetos = ativData.return_row;
                                var txtAlert = (mode == 'delete_projeto') ? 'Projeto deletado' : txtAlert;
                            } else if ((mode == 'save_projeto' || mode == 'clone_projeto') && typeof ativData.return_row !== 'undefined' && ativData.return_row.length) {
                                arrayConfigAtividades.projetos.push(ativData.return_row[0]);
                                var txtAlert = (mode == 'save_projeto') ? 'Projeto adicionado' : '';
                                    txtAlert = (mode == 'clone_projeto') ? 'Projeto duplicado' : txtAlert;
                                    txtAlert = (mode == 'delete_projeto') ? 'Projeto deletado' : txtAlert;
                            } else if ((mode == 'edit_projeto' || mode == 'save_projeto_etapa' || mode == 'edit_projeto_etapa' || mode == 'delete_projeto_etapa' || mode == 'update_projeto_etapa' || mode == 'archive_projeto' || mode == 'share_projeto') && typeof ativData.return_row !== 'undefined' && ativData.return_row.length) {
                                objIndexAtiv = (typeof arrayConfigAtividades.projetos === 'undefined' || arrayConfigAtividades.projetos == 0 || arrayConfigAtividades.projetos.length == 0) ? -1 : arrayConfigAtividades.projetos.findIndex((obj => obj.id_projeto == ativData.id_projeto));
                                if (objIndexAtiv !== -1) {
                                    arrayConfigAtividades.projetos[objIndexAtiv] = ativData.return_row[0];
                                }
                                if (mode == 'share_projeto' && (param.mode == 'insert_usuario' || param.mode == 'insert_unidade' || param.mode == 'change_edicao' || param.mode == 'remove_share')) {
                                    var table = $('#shareBox_'+param.key);
                                    var tr = table.find('tr[data-value="'+(param.key == 'usuario' ? param.id_user : param.id_unidade)+'"]');
                                        tr.attr('data-id',ativData.id_projeto_compartilhado).data('id',ativData.id_projeto_compartilhado);
                                        tr.find('td').eq(0).removeClass('editCellLoading');
                                        if (param.mode == 'remove_share') {
                                            if (table.find('tbody tr:visible').length == 1) {
                                                table.find('.addConfigItem').trigger('click');
                                                table.find('tbody tr:last-child').data('id','new').attr('data-id','new').find('td:first-child').addClass('editCellSelect').removeClass('editCellLoading');
                                            }
                                            tr.hide('fast', function() { setTimeout(() => { $(this).remove() }, 1000) });
                                        }
                                }
                                var txtAlert = (mode == 'edit_projeto') ? 'Projeto editado' : '';
                                    txtAlert = (mode == 'edit_projeto_etapa' || mode == 'update_projeto_etapa') ? 'Etapa editada' : txtAlert;
                                    txtAlert = (mode == 'update_projeto_etapa' && param.mode == 'complete_execucao') ? 'Etapa conclu\u00EDda' : txtAlert;
                                    txtAlert = (mode == 'delete_projeto_etapa') ? 'Etapa deletada' : txtAlert;
                                    txtAlert = (mode == 'archive_projeto' && param.mode == 'Arquivar') ? 'Projeto arquivado' : txtAlert;
                                    txtAlert = (mode == 'archive_projeto' && param.mode == 'Reativar') ? 'Projeto reativado' : txtAlert;
                                    txtAlert = (mode == 'save_projeto_etapa') ? 'Etapa adicionada' : txtAlert;
                            } else if (mode == 'share_projeto' && param.mode == 'list_select' && typeof ativData['padrao'] !== 'undefined' && ativData['padrao'] !== null) {
                                if (typeof ativData['padrao']['unidades_all'] !== 'undefined') arrayConfigAtividades['unidades_all'] = ativData['padrao']['unidades_all'];
                                if (typeof ativData['padrao']['usuarios_all'] !== 'undefined') arrayConfigAtividades['usuarios_all'] = ativData['padrao']['usuarios_all'];
                            }
                            if ((mode == 'save_projeto' || mode == 'edit_projeto') && typeof ativData['padrao'] !== 'undefined' && ativData['padrao'] !== null) arrayConfigAtividades['tipos_projetos'] = ativData['padrao']['tipos_projetos'];

                            storeLocalDataConfigArray(arrayConfigAtividades);
                            if (ativData.refresh_page) {
                                var mode_update = (
                                        mode == 'save_projeto_etapa' ||
                                        mode == 'delete_projeto_etapa' ||
                                        mode == 'update_projeto_etapa' ||
                                        mode == 'edit_projeto_etapa'
                                        )
                                    ? 'update' 
                                    : 'insert';
                                setProjetos(mode_update, arrayConfigAtividades.projetos, ativData.id_projeto);
                                loadingButtonConfirm(false);
                                resetDialogBoxPro('dialogBoxPro');
                                alertaBoxPro('Sucess', 'check-circle', txtAlert+' com sucesso!');
                            }
                            if (mode == 'save_projeto' || mode == 'clone_projeto') setTimeout(() => { $('#projetosGanttTabs li[aria-controls="svgtab_'+ativData.id_projeto+'"] a').trigger('click'); }, 800);

                        } else if (mode.indexOf('config_') !== -1) {
                            loadingButtonConfirm(false);

                            if (typeof ativData['padrao'] !== 'undefined' && ativData['padrao'] !== null && (mode == 'config_users' || mode == 'config_unidades' || mode == 'config_tipos_modalidades' || mode == 'config_tipos_capacidades' || mode == 'config_perfis' || mode == 'config_tipos_prescricoes' || mode == 'config_entidades')) {
                                if (typeof ativData['padrao']['unidades_all'] !== 'undefined' && ativData['padrao']['unidades_all'].length) arrayConfigAtividades['unidades_all'] = ativData['padrao']['unidades_all'];
                                if (typeof ativData['padrao']['perfis'] !== 'undefined' && ativData['padrao']['perfis'].length) arrayConfigAtividades['perfis'] = ativData['padrao']['perfis'];
                                if (typeof ativData['padrao']['tipos_capacidades'] !== 'undefined' && ativData['padrao']['tipos_capacidades'].length) arrayConfigAtividades['tipos_capacidades'] = ativData['padrao']['tipos_capacidades'];
                                if (typeof ativData['padrao']['tipos_metadados'] !== 'undefined' && ativData['padrao']['tipos_metadados'].length) arrayConfigAtividades['tipos_metadados'] = ativData['padrao']['tipos_metadados'];
                            }
                            if (typeof ativData['padrao'] !== 'undefined' && ativData['padrao'] !== null && (mode == 'config_planos')) {
                                arrayConfigAtividades['tipos_modalidades'] = ativData['padrao']['tipos_modalidades'];

                                var updatePlano = jmespath.search(ativData.config,"[?last_update=='0000-00-00 00:00:00'] | [?id_user==`"+arrayConfigAtividades.perfil.id_user+"`]");
                                var checkUpdatePlano = updatePlano !== null && updatePlano.length > 0 ? true : false;
                                if (checkUpdatePlano) {
                                    setTimeout(function(){ 
                                        updateConfigTempoPactuadoById(updatePlano[0].id_plano);
                                    }, 2000);
                                }

                            }
                            if (typeof ativData['config'] !== 'undefined' && ativData['config'] !== null && (mode == 'config_tipos_prescricoes')) {
                                arrayConfigAtividades['tipos_prescricoes'] = ativData['config'];
                            }
                            if (typeof ativData['config'] !== 'undefined' && ativData['config'] !== null && (mode == 'config_cadeia_valor')) {
                                arrayConfigAtividades['cadeia_valor'] = ativData['config'];
                            }
                            if (typeof ativData['padrao'] !== 'undefined' && ativData['padrao'] !== null && (mode == 'config_atividades')) {
                                arrayConfigAtividades['cadeia_valor'] = ativData['padrao']['cadeia_valor'];
                            }

                            if (mode == 'config_new_users') {
                                loadingButtonConfirm(false);
                                if (param.mode == 'check' && ativData.check_lotacao && ativData.id_user != 0 && ativData.id_unidade != 0) {
                                    alertaBoxPro('Error', 'exclamation-triangle', 'Usu\u00E1rio j\u00E1 cadastrado no sistema. <br><br>Lota\u00E7\u00E3o atual: '+ativData.nome_unidade+' ('+ativData.sigla_unidade+')<br><br>Solicite a desvincula\u00E7\u00E3o ao gestor da unidade ou a altera\u00E7\u00E3o de lota\u00E7\u00E3o ao administrador do sistema');
                                } else if (param.mode == 'check' && ativData.check_lotacao == false && ativData.id_user != 0) {
                                    confirmaFraseBoxPro('Usu\u00E1rio j\u00E1 cadastrado no sistema, mas sem lota\u00E7\u00E3o definida. Deseja lotar em sua unidade?', 'SIM', 
                                        function(){
                                            moveUserCapacity(ativData.id_user);
                                        }
                                    );
                                } else if (param.mode == 'move') {
                                    resetDialogBoxPro('dialogBoxPro');
                                    updateAtividade();
                                }
                            }

                            if (typeof param.mode === 'undefined' || param.mode != 'check') {
                                var mode_config = mode.replace('config_','').replace('self_','');
                                getTabConfig(mode_config, 'set', ativData, 0, param);
                            }
                        } else if (mode == 'panel') {

                            $('#tabs-configpessoal').find('tr > td:nth-child(2)').removeClass('editCellLoading');
                            var isInitOffset = (typeof ativData.offset === 'undefined' || ativData.offset == 0) ? true : false;

                            if (
                                typeof ativData.padrao === 'object' && ativData.padrao !== null && 
                                typeof ativData.padrao.perfil !== 'undefined' && ativData.padrao.perfil !== null && 
                                typeof ativData.padrao.perfil.nivel !== 'undefined' && ativData.padrao.perfil.nivel !== null &&
                                typeof arrayConfigAtividades === 'object' && arrayConfigAtividades !== null && 
                                typeof arrayConfigAtividades.perfil !== 'undefined' && arrayConfigAtividades.perfil !== null && 
                                typeof arrayConfigAtividades.perfil.nivel !== 'undefined' && arrayConfigAtividades.perfil.nivel !== null &&
                                ativData.padrao.perfil.nivel !== arrayConfigAtividades.perfil.nivel
                            ) {
                                if (isInitOffset) removeLocalDataAtiv(true);
                                getAtividades();
                                return false;
                            }

                            if (typeof ativData['padrao'] === 'object' && ativData['padrao'] !== null) {
                                if (param.last_update) {
                                    appendDataConfigOnLocalArray(ativData['padrao']);
                                } else if (isInitOffset) {
                                    removeLocalDataAtiv(true);
                                    arrayConfigAtividades = ativData['padrao'];
                                }
                                
                                if (
                                        typeof arrayConfigAtividades !== 'undefined' && arrayConfigAtividades !== null && 
                                        typeof arrayConfigAtividades.etiquetas !== 'undefined' && arrayConfigAtividades.etiquetas !== null &&
                                        typeof arrayConfigAtividades.etiquetas.list !== 'undefined' && arrayConfigAtividades.etiquetas.list !== null
                                    ) {
                                    arrayConfigAtividades['etiquetas']['list'] = $.map(arrayConfigAtividades['etiquetas']['list'], function (i) { return i }) 
                                }
                            }

                            var arrayConfigUnidadeSeleted = (typeof ativData['padrao'] === 'object' && ativData['padrao'] !== null && ativData['padrao']['unidades'].length > 0) 
                                                        ? jmespath.search(ativData['padrao']['unidades'], "[?selected==`true`] | [0]")
                                                        : jmespath.search(arrayConfigAtividades['unidades'], "[?selected==`true`] | [0]");
                            arrayConfigAtivUnidade = (arrayConfigUnidadeSeleted !== null) ? arrayConfigUnidadeSeleted : arrayConfigAtivUnidade;

                            arrayNomenclaturas = arrayConfigAtividades['nomenclaturas'];
                            initNameConst('set');

                            var arrayUsuarios = [];
                            if (typeof arrayConfigAtividades.unidades !== 'undefined') {
                                $.each(jmespath.search(arrayConfigAtividades.unidades,"[*].usuarios"), function(index, value){
                                    $.each(value, function(i, v){
                                        if (jmespath.search(arrayUsuarios,"[?id_user==`"+v.id_user+"`]").length == 0) { 
                                            arrayUsuarios.push(v);
                                        }
                                    });
                                });
                                arrayConfigAtividades.usuarios = arrayUsuarios;
                            }
                            
                            if (typeof ativData['demandas'] !== 'undefined' && ativData['demandas'] !== null) {
                                if (param.last_update || !isInitOffset) {
                                    appendDataDemandaOnLocalArray(ativData['demandas'], 'demandas');
                                } else {
                                    arrayAtividadesPro = ativData['demandas'];
                                    localStorageStorePro('lastRestoreAtividades', moment().format('YYYY-MM-DD HH:mm:ss'));
                                }
                            }
                            if (typeof ativData['demandas_processo'] !== 'undefined' && ativData['demandas_processo'] !== null && isInitOffset) {
                                arrayAtividadesProcPro = ativData['demandas_processo'];
                            }
                            if (typeof ativData['prescricoes_processo'] !== 'undefined' && ativData['prescricoes_processo'] !== null && isInitOffset) {
                                arrayPrescricoesProcPro = ativData['prescricoes_processo'];
                                initPanelPrescricaoProc();
                            }
                            if (typeof ativData['demandas_excluidas'] !== 'undefined' && ativData['demandas_excluidas'] !== null && ativData['demandas_excluidas'].length > 0 && isInitOffset) {
                                $.each(ativData['demandas_excluidas'], function(i, v){
                                    removeRowsPanelAtividades(v.id_demanda);
                                });
                            }

                                checkLoadAtividadesProcPro = true;
                            var arrayAtividades = ($('#ifrArvore').length > 0) ? arrayAtividadesProcPro : arrayAtividadesPro;
                            
                            hybridStorageStorePro('configDataAtividadesPro', arrayAtividadesPro);
                            hybridStorageStorePro('configDataAtividadesProcPro', arrayAtividadesProcPro);
                            hybridStorageStorePro('configDataAtivUnidadePro', arrayConfigAtivUnidade);
                            storeLocalDataConfigArray(arrayConfigAtividades);

                            lastUpdateAtividades = (!getOptionsPro('panelLocalStorePro') && typeof ativData['last_update'] !== 'undefined' && ativData['last_update']) ? ativData['last_update'] : lastUpdateAtividades;
                            localStorageStorePro('lastUpdateAtividades', lastUpdateAtividades);

                            var ativDataPanel = false;
                            var _caption = $('#tabelaAtivPanel table caption.infraCaption');
                            var _lastCount = (_caption.length > 0) ? _caption.find('span.count') : false;
                            if (typeof ativData === 'object' && ativData !== null) {
                                if (param.last_update) {
                                    $('.panelHome').find('.iconAtividade_update i').removeClass('fa-spin');
                                    if (typeof ativData['demandas_processo'] !== 'undefined' && ativData['demandas_processo'] !== null && ativData['demandas_processo'].length > 0) {
                                        ativDataPanel = {
                                            demandas: arrayAtividadesPro, 
                                            demandas_processo: arrayAtividadesProcPro, 
                                            padrao: arrayConfigAtividades,
                                            last_update: lastUpdateAtividades,
                                            status: 1
                                        };
                                        initPanelAtividades(ativDataPanel);
                                    }
                                    if (typeof ativData['demandas'] !== 'undefined' && ativData['demandas'] !== null && ativData['demandas'].length > 0) {
                                        getRowsPanelAtividades(ativData['demandas'], $('#tabelaAtivPanel table tbody'));
                                    }
                                    setAtividadesUser();
                                } else {
                                    if (isInitOffset) {
                                        arrayConfigAtividades = ativData['padrao'];
                                        ativDataPanel = ativData;
                                        initPanelAtividades(ativDataPanel);
                                    } else {
                                        getRowsPanelAtividades(ativData['demandas'], $('#tabelaAtivPanel table tbody'));
                                        getHtmlTableAtiv();
                                    }
                                    var countDemandas = (typeof ativData['demandas'] !== 'undefined' && ativData['demandas'] !== null && ativData['demandas'].length > 0) ? ativData['demandas'].length : 0;
                                    if (countDemandas > 0 && typeof ativData.offset !== 'undefined' && getOptionEntidade('limit_paginacao') != 0) {
                                        var new_param = param;
                                            new_param.offset = ativData.next_offset;
                                        getServerAtividades(new_param, 'panel');
                                        if (_caption.find('span.progress').length == 0) _caption.append('<span class="progress" style="color: #777;font-size: 0.9em !important;padding: 5px;margin: 5px;"><i class="fas fa-sync fa-spin cinzaColor"></i> carregando dados...</span>');
                                    } else {
                                        _caption.find('span.progress').remove();
                                    }
                                }
                                if (_lastCount) _lastCount.text(arrayAtividadesPro.length);
                            }

                            getInsertIconAtividade();  
                            // getProfileAtiv();
                            resetDialogBoxPro('configBoxPro');
                            repairPerfilSelectUnidade();
                            setResizeAreaTelaD();
                            setProgressBarOnProcesso();
                            if (getOptionsPro('panelAtividadesView') == 'Quadro') getKanbanAtividades();

                            // console.log('initPanelAtividades', ativDataPanel);

                            if (typeof param.callback !== 'undefined' && param.callback) {
                                if (param.callback.action == 'rate_atividade') {
                                    setTimeout(function(){ 
                                        rateAtividade(param.callback.id, false);
                                    }, 1500);
                                }
                            }
                            if (verifyConfigValue('gerenciarprojetos') && checkCapacidade('view_projetos') && isInitOffset) {
                                setProjetos($('#projetosGanttDiv').is(':visible') ? 'refresh' : 'insert');
                            }
                                                    
                        } else if (mode == 'pause_atividade_lista') {
                            loadingButtonConfirm(false);
                            getPausasAtividadeCalc(ativData['pause_lista']);
                            var objIndexAtiv = (typeof arrayAtividadesPro === 'undefined' || arrayAtividadesPro == 0 || arrayAtividadesPro.length == 0) ? -1 : arrayAtividadesPro.findIndex((obj => obj.id_demanda == ativData.id_demanda));
                            if (objIndexAtiv !== -1) {
                                arrayAtividadesPro[objIndexAtiv].pausa_lista = ativData['pause_lista'];
                                $('#ativ_data_entrega').trigger('change');
                            }
                        } else if (mode == 'update_planos') {
                            loadingButtonConfirm(false);
                            updateArrayPlanos(ativData['update_planos']);
                        } else if (mode == 'update_prioridades') {
                            updatePriorityKanbanItens(ativData['board'], 'update');
                            var resultAtivData = ativData['demandas'];
                                arrayAtividadesPro = resultAtivData;
                                hybridStorageStorePro('configDataAtividadesPro', resultAtivData);
                        } else if (
                            mode == 'sign_documento' || 
                            mode == 'sign_cancel_documento' || 
                            mode == 'save_atividade' || 
                            mode == 'save_atividade_rapida' || 
                            mode == 'edit_atividade' || 
                            mode == 'delete_atividade' || 
                            mode == 'delete_atividade_all' || 
                            mode == 'start_atividade' || 
                            mode == 'extend_atividade' || 
                            mode == 'variation_atividade' || 
                            mode == 'type_atividade' || 
                            mode == 'pause_atividade' || 
                            mode == 'pause_atividade_remove' || 
                            mode == 'start_cancel_atividade' || 
                            mode == 'start_cancel_atividades' || 
                            mode == 'complete_atividade' ||
                            mode == 'complete_atividade_parcial' ||
                            mode == 'complete_edit_atividade' ||
                            mode == 'complete_cancel_atividade' ||
                            mode == 'complete_cancel_atividades' ||
                            mode == 'rate_atividade' ||
                            mode == 'rate_atividades' ||
                            mode == 'rate_edit_atividade' ||
                            mode == 'rate_cancel_atividade' ||
                            mode == 'rate_cancel_atividades' ||
                            mode == 'send_atividade' ||
                            mode == 'send_cancel_atividade' ||
                            mode == 'notify_send' ||
                            mode == 'save_afastamento' || 
                            mode == 'edit_afastamento' || 
                            mode == 'delete_afastamento' 
                            ) {
                                var value = (typeof param.id_demanda !== 'undefined') ? jmespath.search(arrayAtividadesPro, "[?id_demanda==`"+param.id_demanda+"`] | [0]") : false;
                                var demandaID = (value) ? '[{"ID":'+value.id_demanda+'}]' : value;
                                    demandaID = (!value && typeof param.id_demandas != 'undefined' && param.id_demandas.length > 0) 
                                                ? JSON.stringify($.map(param.id_demandas, function(sub, i){ return {ID: sub} }))
                                                : demandaID;
                                var requisicao = (value) 
                                                    ? (typeof value.requisicao_sei !== 'undefined' && value.requisicao_sei !== null && parseInt(value.requisicao_sei) != 0) 
                                                        ? value.nome_requisicao+' ('+value.requisicao_sei+') ' 
                                                        : value.nome_requisicao
                                                    : '';
                                var txtAlert = (mode == 'save_atividade') ? __.Demanda+' '+getNameGenre('demanda', 'cadastrado', 'cadastrada') : '';
                                    txtAlert = (mode == 'save_atividade_rapida') ? __.Demanda+' r\u00E1pida '+getNameGenre('demanda', 'cadastrado', 'cadastrada') : txtAlert;
                                    txtAlert = (mode == 'sign_documento') ? 'Documento assinado' : txtAlert;
                                    txtAlert = (mode == 'sign_cancel_documento') ? 'Assinatura do documento cancelada' : txtAlert;
                                    txtAlert = (mode == 'edit_atividade') ? __.Demanda+' '+getNameGenre('demanda', 'editado', 'editada') : txtAlert;
                                    txtAlert = (mode == 'delete_atividade' || mode == 'delete_atividade_all') ? (typeof ativData['delete_demandas'] !== 'undefined' && ativData['delete_demandas'].length > 1 ? __.Demandas+' '+getNameGenre('demanda', 'deletados', 'deletadas') : __.Demanda+' '+getNameGenre('demanda', 'deletado', 'deletada')) : txtAlert;
                                    txtAlert = (mode == 'start_atividade') ? __.Demanda+' '+getNameGenre('demanda', 'iniciado', 'iniciada') : txtAlert;
                                    txtAlert = (mode == 'extend_atividade') ? __.Demanda+' '+getNameGenre('demanda', 'prorrogado', 'prorrogada') : txtAlert;
                                    txtAlert = (mode == 'variation_atividade') ? __.Complexidade+' '+getNameGenre('complexidade', 'alterado', 'alterada') : txtAlert;
                                    txtAlert = (mode == 'type_atividade') ? __.Atividade+' '+getNameGenre('atividade', 'atribu\u00EDdo', 'atribu\u00EDda') : txtAlert;
                                    txtAlert = (mode == 'pause_atividade') ? __.Demanda+' '+(ativData['check_ispaused'] == false ? __.paralisada : __.retomada) : txtAlert;
                                    txtAlert = (mode == 'pause_atividade_remove') ? __.Paralisacao+' '+getNameGenre('paralisacao', 'removido', 'removida') : txtAlert;
                                    txtAlert = (mode == 'complete_atividade') ? __.Demanda+' '+getNameGenre('demanda', 'conclu\u00EDdo', 'conclu\u00EDda') : txtAlert;
                                    txtAlert = (mode == 'complete_atividade_parcial') ? __.Demanda+' residual '+getNameGenre('demanda', 'cadastrado', 'cadastrada') : txtAlert;
                                    txtAlert = (mode == 'complete_edit_atividade') ? __.Demanda+' '+getNameGenre('demanda', 'editado', 'editada') : txtAlert;
                                    txtAlert = (mode == 'start_cancel_atividade') ? 'In\u00EDcio de '+__.demanda+' cancelado' : txtAlert;
                                    txtAlert = (mode == 'start_cancel_atividades') ? 'In\u00EDcio de '+__.demandas+' cancelado' : txtAlert;
                                    txtAlert = (mode == 'complete_cancel_atividade') ? 'Conclus\u00E3o de '+__.demanda+' cancelada' : txtAlert;
                                    txtAlert = (mode == 'complete_cancel_atividades') ? 'Conclus\u00E3o de '+__.demandas+' cancelada' : txtAlert;
                                    txtAlert = (mode == 'rate_atividade') ? 'Avalia\u00E7\u00E3o cadastrada' : txtAlert;
                                    txtAlert = (mode == 'rate_atividades') ? 'Avalia\u00E7\u00F5es cadastradas' : txtAlert;
                                    txtAlert = (mode == 'rate_edit_atividade') ? 'Avalia\u00E7\u00E3o editada' : txtAlert;
                                    txtAlert = (mode == 'rate_cancel_atividade') ? 'Avalia\u00E7\u00E3o cancelada' : txtAlert;
                                    txtAlert = (mode == 'rate_cancel_atividades') ? 'Avalia\u00E7\u00F5es canceladas' : txtAlert;
                                    txtAlert = (mode == 'send_atividade') ? (ativData['update_demandas'].length == 1 ? __.Demanda+' '+__.arquivada : __.Demandas+' '+__.arquivadas) : txtAlert;
                                    txtAlert = (mode == 'send_cancel_atividade') ? __.Arquivamento+' de '+__.demanda+' '+getNameGenre('arquivamento', 'cancelado', 'cancelado') : txtAlert;
                                    txtAlert = (mode == 'save_afastamento') ? 'Afastamento salvo' : txtAlert;
                                    txtAlert = (mode == 'edit_afastamento') ? 'Afastamento editado' : txtAlert;
                                    txtAlert = (mode == 'delete_afastamento') ? (typeof ativData['id_afastamentos'] !== 'undefined' && ativData['id_afastamentos'].length > 1 ? 'Afastamentos deletados' : 'Afastamento deletado') : txtAlert;
                                    txtAlert = (mode == 'notify_send') ? 'Notifica\u00E7\u00E3o enviada ' : txtAlert;
                                
                                loadingButtonConfirm(false);

                                if (param.action == 'sign_documento' || param.action == 'sign_cancel_documento') {
                                    resetDialogBoxPro('editorBoxPro');
                                    
                                    if (typeof ativData.refresh_page !== 'undefined' && ativData.refresh_page && $('#tableConfiguracoesPanel_'+param.type).is(':visible')) {
                                        getTabConfig(param.type, 'get');
                                    }
                                }
                                if (mode != 'pause_atividade_remove') {
                                    resetDialogBoxPro('dialogBoxPro');
                                } else {
                                    setTimeout(function(){ 
                                        getPausasAtividade(ativData['id_demanda']);
                                    }, 1500);
                                }

                                var callback = (mode == 'type_atividade' && param.before_rate) ? {action: 'rate_atividade', id: param.id_demanda} : false;
                                getAtividades(callback);

                                alertaBoxPro('Sucess', 'check-circle', txtAlert+' com sucesso!');
                                
                                if (value && value.id_procedimento !== null && jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config.gravar_historico_processo")) {
                                    updateDadosArvore('Atualizar Andamento', 'txaDescricao', '_'+txtAlert+': '+requisicao+(demandaID ? demandaID : ''), value.id_procedimento);
                                }
                                if ((mode == 'save_atividade' || mode == 'complete_atividade') && ativData['anotacoes_processo']) {
                                    updateAnotacaoProcesso(ativData['anotacoes_processo']);
                                }
                                if ((mode == 'save_atividade' || mode == 'edit_atividade') && param.lista_marcador && param.marcador == 'on') {
                                    var dateSubmit = 'Ate '+moment(param.prazo_entrega, 'YYYY-MM-DD HH:mm').format('DD/MM/YYYY HH:mm');
                                    var valuesIframe = [
                                        {element: 'txaTexto', value: dateSubmit},
                                        {element: 'hdnIdMarcador', value: param.lista_marcador.id_marcador}
                                    ];
                                    updateDadosArvoreMult('Gerenciar Marcador', valuesIframe, param.id_procedimento, function(){ 
                                        var listMarcadores = sessionStorageRestorePro('dadosMarcadoresProcessoPro');
                                        var objIndexDoc = (!listMarcadores) ? -1 : listMarcadores.findIndex((obj => obj.id_procedimento == String(param.id_procedimento)));
                                        if (objIndexDoc !== -1) {
                                            listMarcadores[objIndexDoc] = {
                                                id_procedimento: listMarcadores[objIndexDoc].id_procedimento,
                                                icon: param.lista_marcador.icon,
                                                tag: param.lista_marcador.tag,
                                                name: dateSubmit
                                            }
                                            sessionStorageStorePro('dadosMarcadoresProcessoPro',listMarcadores);
                                        }
                                    });
                                }
                                if (mode == 'save_afastamento' || mode == 'edit_afastamento' || mode == 'delete_afastamento') {
                                    setTimeout(function(){ 
                                        if (mode == 'edit_afastamento' || mode == 'delete_afastamento') {
                                            objIndexAtiv = (typeof arrayConfigAtividades.afastamentos === 'undefined' || arrayConfigAtividades.afastamentos == 0 || arrayConfigAtividades.afastamentos.length == 0 || typeof arrayConfigAtividades.afastamentos.lista === 'undefined' || arrayConfigAtividades.afastamentos.lista == 0 || arrayConfigAtividades.afastamentos.lista.length == 0) ? -1 : arrayConfigAtividades.afastamentos.lista.findIndex((obj => obj.id_afastamento == param.id_afastamento));
                                            if (objIndexAtiv !== -1) {
                                                if (mode == 'edit_afastamento') {
                                                    arrayConfigAtividades.afastamentos.lista[objIndexAtiv] = ativData['result'][0];
                                                } else if (mode == 'delete_afastamento') {
                                                    arrayConfigAtividades.afastamentos.lista.splice(objIndexAtiv, 1);
                                                }
                                            }
                                        } else if (mode == 'save_afastamento' && typeof ativData['result'] !== 'undefined' && ativData['result'] !== null && ativData['result'].length > 0) {
                                            arrayConfigAtividades.afastamentos.lista.push(ativData['result'][0]);
                                        }
                                        setTimeout(function(){ 
                                            updateTempoProporcionalPlanos();
                                        }, 1000);
                                        initPanelAtividadesView();
                                    }, 1500);
                                }
                                if (mode == 'save_atividade' || mode == 'save_atividade_rapida' || mode == 'edit_atividade' || mode == 'extend_atividade' || mode == 'variation_atividade' || mode == 'type_atividade' || mode == 'complete_atividade' || mode == 'complete_edit_atividade' || mode == 'complete_atividade_parcial') {
                                    if (mode == 'complete_atividade' && ativData['checklist_tempo_proporcional']) {
                                        alertBoxPro.dialog('option', 'buttons', [{
                                            text: 'Gerar Notifica\u00E7\u00E3o',
                                            icon: "ui-icon-mail-closed",
                                            click: function() {
                                                $(this).dialog('close');
                                                notifyAtividade(param.id_demanda == '0' ? ativData['id_demanda'] : param.id_demanda, event);
                                            }
                                        },{
                                            text: 'Gerar Demanda Residual',
                                            icon: "ui-icon-mail-scissors",
                                            class: 'ui-state-active',
                                            click: function(event) { 
                                                $(this).dialog('close');
                                                var return_tempo_parcial = ativData['return_tempo_parcial'];
                                                var action = 'complete_atividade_parcial';
                                                var param = {
                                                    action: action,
                                                    id_demanda: return_tempo_parcial.id_demanda,
                                                    tempo_pactuado: return_tempo_parcial.tempo_pactuado,
                                                    tempo_pactuado_original: return_tempo_parcial.tempo_pactuado_original
                                                };
                                                getServerAtividades(param, action);
                                            }
                                        }]);
                                        $('#alertaBoxPro').html('<strong class="alertaSucessPro dialogBoxDiv"><i class="fas fa-check-circle" style="margin-right: 5px;"></i> '+__.Demanda+' conclu\u00EDda com sucesso!<br><br>Deseja criar demanda residual a partir do tempo pactuado restante ('+decimalHourToMinute(ativData['return_tempo_parcial'].tempo_pactuado)+' horas)?</strong>');
                                    } else {
                                        alertBoxPro.dialog('option', 'buttons', [{
                                            text: "OK",
                                            click: function() {
                                                $(this).dialog('close');
                                            }
                                        },{
                                            text: 'Gerar Notifica\u00E7\u00E3o',
                                            icon: "ui-icon-mail-closed",
                                            class: 'ui-state-active',
                                            click: function(event) { 
                                                $(this).dialog('close');
                                                notifyAtividade(param.id_demanda == '0' ? ativData['id_demanda'] : param.id_demanda, event);
                                            }
                                        }]);
                                    }
                                }
                                if (mode == 'delete_atividade' || mode == 'delete_atividade_all') {
                                    removeRowsPanelAtividades(param.id_demanda);
                                }
                                if (
                                        mode == 'complete_atividade' || mode == 'complete_edit_atividade' || mode == 'complete_atividade_parcial' || mode == 'complete_cancel_atividade' || mode == 'complete_cancel_atividades' ||
                                        mode == 'save_atividade' || mode == 'save_atividade_rapida' || mode == 'edit_atividade' || mode == 'pause_atividade' ||
                                        mode == 'rate_atividade' || mode == 'rate_atividades' || mode == 'rate_cancel_atividade' || mode == 'rate_cancel_atividades' || mode == 'rate_default_atividade' || mode == 'rate_edit_atividade' ||
                                        mode == 'send_atividade' || mode == 'send_cancel_atividade' ||
                                        mode == 'start_atividade' || mode == 'start_cancel_atividade' || mode == 'start_cancel_atividades' ||
                                        mode == 'type_atividade' || mode == 'extend_atividade' || mode == 'variation_atividade' ||
                                        mode == 'delete_atividade'
                                    ) {
                                    awaitRowsPanelAtividades(param.id_demanda);
                                }
                        } else {
                            loadingButtonConfirm(false);
                        }
                        if (typeof arrayConfigAtividades !== 'undefined' && typeof arrayConfigAtividades.perfil !== 'undefined' &&typeof arrayConfigAtividades.perfil.nivel !== 'undefined' &&  arrayConfigAtividades.perfil.nivel == 1 && checkOptionEntidade('gerar_relatorios_gerenciais')) {
                            indexReportUpdate = 0;
                            checkUpdateReports();
                        }
                        if (typeof arrayConfigAtividades !== 'undefined' && typeof arrayConfigAtividades.perfil !== 'undefined' &&typeof arrayConfigAtividades.perfil.nivel !== 'undefined' &&  arrayConfigAtividades.perfil.nivel == 1 && checkOptionEntidade('sincronizar_dados_externos')) {
                            indexReportUpdate = 0;
                            checkSyncDadoExterno();
                        }
                    }
                }
            }
        }).fail(function(data, textStatus){
            if (typeof param.type !== 'undefined') { resetButtonTabConfig('.actionsConfig_'+param.type) }
            if (typeof data.refresh_page !== 'undefined' && data.refresh_page) cleanAtivParams();
            failureScreen(data, textStatus, param);
        });
    } else {
        $('#atividadesProActions').find('.iconAtividade_update i').removeClass('fa-spin');
        if (!checkCapacidade(mode)) {
            console.log('Acesso n\u00E3o permitido.');
        }
    }
}
function appendDataDemandaOnLocalArray(arrayServer, demandaType) {
    var arrayLocal = (demandaType == 'demandas_processo') ? arrayAtividadesProcPro : arrayAtividadesPro;
    if (arrayServer !== null && arrayServer.length > 0) {
            $.each(arrayServer, function (i, v) {
                var objIndexAtiv = (typeof arrayLocal === 'undefined' || arrayLocal == 0 || arrayLocal.length == 0) ? -1 : arrayLocal.findIndex((obj => obj.id_demanda == v.id_demanda));
                if (objIndexAtiv !== -1) {
                    arrayLocal[objIndexAtiv] = v;
                    // console.log(demandaType, 'UPDATE', v);
                } else if (typeof arrayLocal !== 'undefined' && arrayLocal != 0) {
                    arrayLocal.push(v);
                    // console.log(demandaType, 'PUSH', v);
                }          
                // console.log(demandaType, arrayLocal, v);
            });
    }
    if (demandaType == 'demandas_processo') {
        arrayAtividadesProcPro = arrayLocal;
    } else {
        arrayAtividadesPro = arrayLocal;
    }
}
function storeLocalDataConfigArray(arrayConfig) {
    if (typeof arrayConfig === 'object' && arrayConfig !== null) {
        var list = [];
        for (var propertyName in arrayConfig) {
            hybridStorageStorePro('configDataAtividadesPadraoPro_'+propertyName, arrayConfig[propertyName]);
            list.push(propertyName);
        }
        hybridStorageStorePro('configDataAtividadesPadraoPro', list);
    }
}
function restoreLocalDataConfigArray() {
    var arrayConfig = hybridStorageRestorePro('configDataAtividadesPadraoPro');
    if (arrayConfig !== null) {
        var arrayStore = [];
        $.each(arrayConfig, function (i, v) {
            var dataValue = hybridStorageRestorePro('configDataAtividadesPadraoPro_'+v);
            if (dataValue !== null) {
                arrayStore[v] = dataValue;
            }
        });
        return arrayStore;
    } else {
        return false;
    }
}
function removeLocalDataConfigArray() {
    var arrayConfig = hybridStorageRestorePro('configDataAtividadesPadraoPro');
    if (arrayConfig !== null) {
        var arrayStore = [];
        $.each(arrayConfig, function (i, v) {
            var dataValue = hybridStorageRemovePro('configDataAtividadesPadraoPro_'+v);
            if (dataValue !== null) {
                arrayStore[v] = dataValue;
            }
        });
        return arrayStore;
    } else {
        return false;
    }
}
function appendDataConfigOnLocalArray(arrayServer) {
    if (typeof arrayServer === 'object' && arrayServer !== null) {
        for (var propertyName in arrayServer) {
            if (arrayServer.hasOwnProperty(propertyName) && (arrayServer[propertyName].length > 0 || (arrayServer[propertyName].hasOwnProperty('lista') && arrayServer[propertyName]['lista'].length > 0) )) {
                var arrayLocal = arrayServer[propertyName]['lista'];
                if (propertyName == 'afastamentos') {
                    $.each(arrayLocal, function (i, v) {
                        var primarykey = v.primarykey;
                        var objIndexAtiv = (typeof arrayConfigAtividades[propertyName]['lista'] === 'undefined' || arrayConfigAtividades[propertyName]['lista'] == 0 || arrayConfigAtividades[propertyName]['lista'].length == 0) ? -1 : arrayConfigAtividades[propertyName]['lista'].findIndex((obj => obj[primarykey] == v[primarykey]));
                        if (objIndexAtiv !== -1) {
                            arrayConfigAtividades[propertyName]['lista'][objIndexAtiv] = v;
                        } else if (typeof arrayConfigAtividades[propertyName]['lista'] !== 'undefined' && arrayConfigAtividades[propertyName]['lista'] != 0) {
                            arrayConfigAtividades[propertyName]['lista'].push(v);
                        }    
                    });
                } else {
                    if (arrayServer[propertyName].length > 0) {
                        $.each(arrayServer[propertyName], function (i, v) {
                            var primarykey = v.primarykey;
                            var objIndexAtiv = (typeof arrayConfigAtividades[propertyName] === 'undefined' || arrayConfigAtividades[propertyName] == 0 || arrayConfigAtividades[propertyName].length == 0) ? -1 : arrayConfigAtividades[propertyName].findIndex((obj => obj[primarykey] == v[primarykey]));
                            if (objIndexAtiv !== -1) {
                                arrayConfigAtividades[propertyName][objIndexAtiv] = v;
                            } else if (typeof arrayConfigAtividades[propertyName] !== 'undefined' && arrayConfigAtividades[propertyName] != 0) {
                                arrayConfigAtividades[propertyName].push(v);
                            }          
                        });
                    }
                }
            }
        }
    }
}
function loopRepairKanbanPinMoveCard() {
    $('.kanban-board').each(function(){
        repairKanbanPinMoveCard($(this).data('id'));
    })
}
function repairKanbanPinMoveCard(board) {
    var pinboard = $('.kanban-board[data-id="'+board+'"] .kanban-item .kanban-pinboard .newLink_active');
    if (pinboard.length > 0) {
        $(pinboard.get().reverse()).each(function(){
            var _this = $(this);
            var _parent = _this.closest('.kanban-item');
            var data = _parent.data();
            var id = (typeof data.eid !== 'undefined') ? data.eid.replace('_id_','') : false;
            pinboard.removeClass('newLink_active');
            pinKanbanItens(this, id);
        });
    }
}
function repairPerfilSelectUnidade() {
    var sigla_unidade = arrayConfigAtivUnidade.sigla_unidade;
    var display_unidade = $('select[data-type="perfil"]').eq(0).val();
    if (sigla_unidade != display_unidade) {
        $('select[data-type="perfil"]').each(function(){ 
            $(this).val(sigla_unidade).chosen("destroy").chosen({
                        placeholder_text_single: ' ',
                        no_results_text: 'Nenhum resultado encontrado'
                    });
        
        });
        setOptionsPro('perfilAtividadesSelected', sigla_unidade);
    }
}
function failureScreen(data, textStatus, param = false) {
    loadingButtonConfirm(false);
    $.getScript(URL_SPRO+"js/lib/html2canvas.min.js");
    $('.panelHome').find('.iconAtividade_update i').removeClass('fa-spin');
    $('#tabsPanelConfig').find('.ui-tabs-anchor i').removeClass('fa-spin').removeClass('fa-spinner');
    $('.dataFallback').removeClass('dataLoading');

    if (param) delete param.hash;

    var dataResponse = $("<div/>").html(data.responseText).text();
        dataResponse = (dataResponse) ? dataResponse.trim() : '';
        dataResponse = (param) ? dataResponse+'\n\nParam:\n\n'+JSON.stringify(param, null, "\t") : dataResponse;

    var htmlReportError =   '<p style="margin: 10px 0;">'+
                            '   <span>'+
                            (textStatus != 'debug' ?
                            '       <a class="newLink" onclick="openErrorReport(this)" style="font-size: 9pt;cursor: pointer;">'+
                            '           <i class="fas fa-laptop-code" style="font-size: 100%;"></i> '+
                            '           Relat\u00F3rio de erros'+
                            '           <i class="fas fa-angle-double-right" style="font-size: 100%;"></i>'+
                            '       </a>'+
                            '' : '')+
                            (checkCapacidade('report_errors') && dataResponse != '' ?
                            '       <a class="newLink sendReport" onclick="sendErrorReport(this)" data-send="false" style="font-size: 9pt;cursor: pointer;float: right;">'+
                            '           <i class="fas fa-paper-plane" style="font-size: 100%;"></i> '+
                            '           <span class="labelLink">Notificar o Administrador</span>'+
                            '       </a>'+
                            '' : '')+
                            '   </span>'+
                            '   <div>'+
                            '       <div class="onoffswitch" style="transform: scale(0.5);display: inline-block;float: left;">'+
                            '           <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="screensave_error" tabindex="0" checked>'+
                            '           <label class="onoffswitch-label" for="screensave_error"></label>'+
                            '       </div>'+
                            '       <label style="font-size: 80%;padding-top: 5px;display: inline-block;" for="screensave_error">Enviar captura de tela</label>'+
                            '   </div>'+
                            '   <pre class="errorReport">'+
                            '       '+dataResponse+
                            '   </pre>'+
                            '</p>';
    var textError = (textStatus === 'timeout' || dataResponse == '') ? 'Erro ao receber sua informa\u00E7\u00F5es do servidor de dados. Tente novamente mais tarde. ('+textStatus+')' : 'Erro ao enviar sua informa\u00E7\u00F5es. Tente novamente mais tarde ou notifique o administrador.<br><br>'+htmlReportError;
        textError = (textStatus == 'debug') ? 'Uma ou mais funcionalidades apresentaram erros! <br><br>Clique em <u>Notificar</u> para enviar um relat\u00F3rio de erros ao administrador do sistema.<br><br>'+htmlReportError : textError;
    alertaBoxPro('Error', 'exclamation-triangle', textError);
    getInsertIconAtividade();
    if (textStatus == 'debug') $(".ui-dialog-buttonpane button:contains('OK')").button('disable');
}
function dialogDebugScreen() {
    failureScreen({responseText: 'debug'}, 'debug');
}
function captureScreen(this_, textError) {
    var _this = $(this_);
    var data = _this.data();
    $('.ui-dialog[aria-describedby="alertaBoxPro"]').hide();

    const canvas = document.createElement("canvas");
    // Request media
    navigator.mediaDevices.getDisplayMedia({ preferCurrentTab: true }).then(stream => {
        
        let track = stream.getVideoTracks()[0];
        let capture = new ImageCapture(track);
        
        capture.grabFrame().then(bitmap => {
            // Stop sharing
            track.stop();
            
            // Draw the bitmap to canvas
            canvas.width = bitmap.width;
            canvas.height = bitmap.height;
            canvas.getContext('2d').drawImage(bitmap, 0, 0);
            
            var frame = canvas.toDataURL("image/png");
            sendErrorReportServer(textError, frame);
            $('.ui-dialog[aria-describedby="alertaBoxPro"]').show();
        });
    }).catch(e => {
        console.error("Error: " + e);
        html2canvas(document.querySelector("body")).then(canvas => {
            var data = canvas.toDataURL();
            sendErrorReportServer(textError, data);
            $('.ui-dialog[aria-describedby="alertaBoxPro"]').show();
        });
    });
}
function sendErrorReport(this_) {
    var _this = $(this_);
    var data = _this.data();
    var boxError = $('.alertaErrorPro .errorReport');
    var textError = boxError.text().trim();
    if (data.send == false) {
        _this.data('send',true);
        _this.find('i').attr('class','fas fa-spinner fa-spin');
        if ($('#screensave_error').is(':checked')) {
            captureScreen(this_, textError);
        } else {
            sendErrorReportServer(textError);
        }
    }
}
function sendErrorReportServer(textError, dataImg = false) {
    var action = 'report_errors';
    var param = {
        action: action,
        user_agent: navigator.userAgent,
        user_sei: userSEI,
        version_seipro: VERSION_SPRO,
        screenshot: dataImg,
        logmessage: (typeof logMessages !== 'undefined') ? JSON.stringify(logMessages, null, "\t") : false,
        text_error: textError
    };
    getServerAtividades(param, action);
    if (textError == 'debug') $('.iconDebugScreen').remove();
    // console.log(dataImg);
}
function openErrorReport(this_) {
    $('.alertaErrorPro .errorReport').toggle();
}
function checkCapacidade(nome_capacidade) {
    var checkPerfil = (arrayConfigAtividades && typeof arrayConfigAtividades['perfil'] !== 'undefined' && typeof arrayConfigAtividades['perfil'].capacidades !== 'undefined')
                ? jmespath.search(arrayConfigAtividades['perfil'].capacidades, "[?nome_capacidade=='"+nome_capacidade+"'] | length(@)") 
                : 0;
    return (checkPerfil == 0) ? false : true;
}
function getChartDemandas(param) {
    var action = 'chart_demandas';
        param.action = action;
        param.id_user = (param.id_user) ? param.id_user : 0;
        getServerAtividades(param, action);
        $('.panelHomePro .iconAtividade_update i').addClass('fa-spin');
}
function changeChartAtiv(this_) {
    var _this = $(this_);
    var _parent = _this.closest('#chartAtivActions');
    var elem_user = _parent.find('#selectChartUserAtiv');
    var elem_programa = _parent.find('#selectChartProgramasAtiv');

    if (_this.attr('id') == 'selectChartProgramasAtiv') {
        elem_user.val('').chosen("destroy").chosen({
            placeholder_text_single: ' ',
            no_results_text: 'Nenhum resultado encontrado'
        });
        forcePlaceHoldChosen();
    }

    var id_user = elem_user.val();
        id_user = (id_user !== null) ? parseInt(id_user) : 0;

    var id_programa = elem_programa.val();
        id_programa = (typeof elem_programa !== 'undefined' && typeof id_programa !== 'undefined' && id_programa !== null) ? parseInt(id_programa) : 0;

    var id_unidade = elem_programa.find('option:selected').data('id_unidade');
        id_unidade = (typeof elem_programa !== 'undefined' && typeof id_unidade !== 'undefined' && id_unidade !== null) ? parseInt(id_unidade) : 0;

    var sigla_unidade = (typeof elem_programa !== 'undefined') ? elem_programa.find('option:selected').data('label') : arrayConfigAtivUnidade.sigla_unidade;

    var _param = {id_user: id_user, id_unidade: id_unidade, id_programa: id_programa, sigla_unidade: sigla_unidade};
        _parent.find('.loadChartUserAtiv').remove();
        _parent.append('<i class="fas fa-spinner fa-spin loadChartUserAtiv" style="float: right; font-size: 12pt; margin-top: 8px;"></i>');

    getChartDemandas(_param);
    setOptionsPro('selectChartAtiv', _param);
}
function setChartAtividades(data, mode) {
    $('.loadChartUserAtiv').remove();
    $('.panelHomePro .iconAtividade_update i').removeClass('fa-spin');
    if (mode == 'chart_demandas') {
        if (typeof data.demandasmes !== 'undefined' && data.demandasmes) { setChartDemandasAtiv(data.demandasmes); }
        if (typeof data.estoque !== 'undefined' && data.estoque) { setChartDemandasEstoqueAtiv(data.estoque); }
        if (typeof data.processuais !== 'undefined' && data.processuais) { setChartDemandasProcessuaisAtiv(data.processuais); }
        if (typeof data.mediatempo !== 'undefined' && data.mediatempo) { setChartDemandasMediaTempoAtiv(data.mediatempo); }
        if (typeof data.statusentregas !== 'undefined' && data.statusentregas) { setChartDemandasStatusEntregasAtiv(data.statusentregas); }
        if (typeof data.requisicoes !== 'undefined' && data.requisicoes) { setChartDemandasRequisicoesAtiv(data.requisicoes); }
        if (typeof data.documentos !== 'undefined' && data.documentos) { setChartDemandasDocumentosAtiv(data.documentos); }
        if (typeof data.produtividade !== 'undefined' && data.produtividade) { setChartDemandasProdutividadeAtiv(data.produtividade); }
        if (typeof data.produtividademes !== 'undefined' && data.produtividademes && !checkOptionEntidade('desativa_produtividade_geral')) { setChartDemandasProdutividadeMesAtiv(data.produtividademes); }
        
        if (typeof data.programas !== 'undefined' && data.programas) { 
            var id_programa_selected = (typeof data.programa !== 'undefined' && data.programa !== null && data.programa.hasOwnProperty('id_programa') && data.programa.id_programa != 0) ? data.programa.id_programa : false;
            setSelectProgramas(data.programas, 'selectChartProgramasAtiv', 'selectChartAtiv', id_programa_selected); 
            // console.log('id_programa_selected', id_programa_selected);
        }
        if (typeof data.planos !== 'undefined' && data.planos) { setChartUsuariosAtiv(data.planos); }
        getChartPlanosTrabalho(data.planos);
        initPanelResize('#chartSectionDistribuicao', 'chartDistribuicao');
        forcePlaceHoldChosen();
        window.chart_data_planos = data.planos;
    }
}
function setSelectProgramas(data, idElem = 'selectChartProgramasAtiv', optionStore = 'selectChartAtiv', id_selected = false) {
    var listUnidadesPrograma = jmespath.search(data,"[*].id_unidade");
        listUnidadesPrograma = (listUnidadesPrograma !== null) ? uniqPro(listUnidadesPrograma) : 0;

    var optionSelectPrograma =  '<option value="0" data-label="">&nbsp;</option>';
    if (listUnidadesPrograma.length > 1) {
        $.each(listUnidadesPrograma, function(index, value){
            var arrayProgramas = jmespath.search(data, "[?id_unidade==`"+value+"`]");
            optionSelectPrograma += '<optgroup label="'+arrayProgramas[0].sigla_unidade+' - '+arrayProgramas[0].nome_unidade+'">';
            optionSelectPrograma += $.map(arrayProgramas, function(v){ 
                // console.log(v.id_programa,id_selected);
                var selected = ((id_selected && v.id_programa == id_selected) || (getOptionsPro(optionStore) && getOptionsPro(optionStore).id_programa == v.id_programa)) ? 'selected' : '';
                return '<option value="'+v.id_programa+'" data-label="'+v.sigla_unidade+'" data-id_unidade="'+v.id_unidade+'" '+selected+'>'+moment(v.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(v.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</option>';
            }).join('');
            optionSelectPrograma += '</optgroup>';
        });
    } else {
        optionSelectPrograma += $.map(jmespath.search(data, "[]"), function(v){ 
            var selected = ((id_selected && v.id_programa == id_selected) || (getOptionsPro(optionStore) && getOptionsPro(optionStore).id_programa == v.id_programa)) ? 'selected' : '';
            return '<option value="'+v.id_programa+'"  data-label="'+v.sigla_unidade+'" '+selected+'>'+moment(v.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(v.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</option>';
        }).join('');
    }
    optionSelectPrograma += '<option value="-1" data-label="" '+(id_selected == '-1' || (getOptionsPro(optionStore) && getOptionsPro(optionStore).id_programa == '-1') ? 'selected' : '')+'>Todos os programas</option>';
    $('#'+idElem).html(optionSelectPrograma).chosen("destroy").chosen({
        placeholder_text_single: ' ',
        no_results_text: 'Nenhum resultado encontrado'
    });
    $('#'+idElem+'_chosen').addClass('chosen-min');
    forcePlaceHoldChosen();
}
function setChartUsuariosAtiv(data = false) {
    var arrayPlanos = (data) ? data : arrayConfigAtividades.planos;
    var unidadesPlanos = (typeof data !== 'undefined' && data != 0 && data.length > 0) 
                            ? uniqPro(jmespath.search(data, "[?sigla_unidade].sigla_unidade"))
                            : [];
    var optionSelectUser = '<option value="0" data-label="">&nbsp;</option>';
    if (unidadesPlanos.length > 1) {
        $.each(unidadesPlanos, function(index, sigla_unidade){
            var arrayResp = jmespath.search(arrayPlanos, "[?sigla_unidade=='"+sigla_unidade+"']");
            var uniqUser = [];
            optionSelectUser += '<optgroup label="'+sigla_unidade+'">';
            optionSelectUser += $.map(arrayResp, function(v){ 
                var selected = (getOptionsPro('selectChartAtiv') && getOptionsPro('selectChartAtiv').id_user == v.id_user) ? 'selected' : '';
                if (!uniqUser.includes(v.id_user)) {
                    uniqUser.push(v.id_user);
                    return '<option value="'+v.id_user+'"  data-label="'+sigla_unidade+'" '+selected+'>'+v.apelido+'</option>';
                }
        }).join('');
            optionSelectUser += '</optgroup>';
        });
    } else {
        var uniqUser = [];
        optionSelectUser += $.map(jmespath.search(arrayPlanos, "[]"), function(v){ 
            var selected = (getOptionsPro('selectChartAtiv') && getOptionsPro('selectChartAtiv').id_user == v.id_user) ? 'selected' : '';
            if (!uniqUser.includes(v.id_user)) {
                uniqUser.push(v.id_user);
                return '<option value="'+v.id_user+'"  data-label="'+unidadesPlanos+'" '+selected+'>'+v.apelido+'</option>';
            }
        }).join('');
    }
    $('#selectChartUserAtiv').html(optionSelectUser).chosen("destroy").chosen({
        placeholder_text_single: ' ',
        no_results_text: 'Nenhum resultado encontrado'
    });
    $('#selectChartUserAtiv_chosen').addClass('chosen-min');
}
function setChartDemandasAtiv(data) {
        var idElem = 'chartAtivPanelDemandas';
        var title = __.Demandas+' por m\u00EAs';
        var xTitle = 'M\u00EAs';
        var yTitle = __.Demandas+'';
        var chartData = {
                            labels: jmespath.search(data, "[*].label"),
                            datasets: [{
                                label: 'Distribu\u00EDdas',
                                lineTension: 0,
                                backgroundColor: chartColors.red,
                                borderColor: chartColors.red,
                                data: jmespath.search(data, "[*].demandas"),
                                fill: false,
                            }, {
                                label: 'Entregues',
                                lineTension: 0,
                                backgroundColor: chartColors.blue,
                                borderColor: chartColors.blue,
                                borderDash: [5, 5],
                                data: jmespath.search(data, "[*].entregas"),
                                fill: false
                            }]
                        };
        setChartLines(idElem, chartData, title, xTitle, yTitle);
}
function setChartDemandasProdutividadeMesAtiv(data) {
        var idElem = 'chartAtivPanelProdutividadeMes';
        var title = 'Produtividade por m\u00EAs';
        var xTitle = 'M\u00EAs';
        var yTitle = 'Produtividade';
        var datasets = [];
        var iColor = 0;
            $.each(data[0].produtividade, function(i, v){
                var colorSet = chartColors[Object.keys(chartColors)[iColor]];
                datasets.push({
                                    label: v.apelido,
                                    // lineTension: 0,
                                    backgroundColor: colorSet,
                                    borderColor: colorSet,
                                    data: $.map(jmespath.search(data, "[*].produtividade | [*][?apelido=='"+v.apelido+"'].produtividade"), function(v){ return parseFloat(v) }),
                                    fill: false,
                                }); 
                                if (Object.keys(chartColors).length-1 == i) {
                                    iColor = 0;
                                } else {
                                    iColor++;
                                } 
            });
        var chartData = {
                            labels: jmespath.search(data, "[*].label"),
                            datasets: datasets
                        };
        setChartLines(idElem, chartData, title, xTitle, yTitle);
}
function setChartDemandasEstoqueAtiv(data) {
    var idElem = 'chartAtivPanelEstoque';
    var datasets = data.estoque;
    var labels = data.label;
    var title = 'Estoque de  '+__.Demandas;
    var backgroundColor = [
            chartColors.green,
            chartColors.blue,
            chartColors.red
        ];
    setChartDonut(idElem, datasets, labels, title, backgroundColor);
}
function setChartDemandasProcessuaisAtiv(data) {
    var idElem = 'chartAtivPanelProcessuais';
    var datasets = data.processuais;
    var labels = data.label;
    var title = __.Demandas+' Processuais x N\u00E3o Processuais';
    var backgroundColor = [
            chartColors.blue,
            chartColors.green
        ];
    setChartPie(idElem, datasets, labels, title, backgroundColor);
}
function setChartDemandasMediaTempoAtiv(data) {
    var idElem = 'chartAtivPanelMediaTempo';
    var datasets = [{
                        label: __.Demandas+' \u00DAnicas',
                        backgroundColor: chartColors.orange,
                        data: data.mediatempo.demandas_unicas
                    },{
                        label: 'Tempo Despendido',
                        backgroundColor: chartColors.green,
                        data: data.mediatempo.tempo_despendido
                    }, {
                        label: 'Dias Despendido',
                        backgroundColor: chartColors.blue,
                        data: data.mediatempo.dias_despendido 
                    }];
    var labels = data.label;
    var title = __.Demandas+' Processuais x N\u00E3o Processuais';
    setChartHbar(idElem, datasets, labels, title);
}
function setChartDemandasStatusEntregasAtiv(data) {
    var idElem = 'chartAtivPanelStatusEntregas';
    var datasets = data.statusentregas;
    var labels = data.label;
    var title = 'Status das Entregas';
    var backgroundColor = [
            chartColors.green,
            chartColors.orange
        ];
    setChartDonut(idElem, datasets, labels, title, backgroundColor);
}
function setChartDemandasRequisicoesAtiv(data) {
    var idElem = 'chartAtivPanelRequisicoes';
    var datasets = jmespath.search(data, "[*].total_requisicoes");
    var labels = jmespath.search(data, "[*].nome_requisicao");
    var title = 'Tipos de Requisi\u00E7\u00E3o';
    setChartPie(idElem, datasets, labels, title);
}
function setChartDemandasDocumentosAtiv(data) {
    var idElem = 'chartAtivPanelDocumentos';
    var datasets = jmespath.search(data, "[*].total_documentos");
    var labels = jmespath.search(data, "[*].nome_documento");
    var title = 'Tipos de Documentos';
    setChartPie(idElem, datasets, labels, title);
}
function setChartDemandasProdutividadeAtiv(data) {
    var idElem = 'chartAtivPanelProdutividade';
    var title = 'Ganho de Produtividade';
    var chartData = {
        labels: jmespath.search(data, "[*].apelido"),
        datasets: [{
            type: 'line',
            yAxesGroup: "1",
            label: 'Produtividade',
            borderColor: window.chartColors.red,
            borderWidth: 2,
            fill: false,
            data: jmespath.search(data, "[*].produtividade")
        }, {
            type: 'bar',
            yAxesGroup: "2",
            label: 'Tempo Pactuado',
            backgroundColor: window.chartColors.blue,
            data: jmespath.search(data, "[*].tempo_pactuado")
        }, {
            type: 'bar',
            yAxesGroup: "2",
            label: 'Tempo Despendido',
            backgroundColor: window.chartColors.green,
            data: jmespath.search(data, "[*].tempo_despendido")
        }]
    };
    setChartLineBar(idElem, chartData, title);
}
function setChartLines(idElem, chartData, title, xTitle, yTitle) {
    $('#'+idElem).html('<canvas id="'+idElem+'_canvas" width="380" height="200"></canvas>');
    var element = $('#'+idElem+'_canvas');
    new Chart(element).destroy();

    var chartLines = new Chart(element, {
        type: 'line',
        data: chartData,
        options: {
            responsive: true,
            legend: {
                display: true,
                align: 'end',
                labels: {
                    boxWidth: 10,
                    fontSize: 10
                },
                onClick: setChartLabelItemStore
            },
            title: {
                display: true,
                text: title
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: xTitle
                    }
                }],
                yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: yTitle
                    }
                }]
            }
        }
    });
    getChartLabelItemStore(idElem, chartLines);
}
function setChartLines2Y(idElem, chartData, title, xTitle, y1Title, y2Title) {
    $('#'+idElem).html('<canvas id="'+idElem+'_canvas" width="380" height="200"></canvas>');
    var element = $('#'+idElem+'_canvas');
    new Chart(element).destroy();

    var chartLines = new Chart(element, {
        type: 'line',
        data: chartData,
        options: {
            responsive: true,
            legend: {
                display: true,
                align: 'end',
                labels: {
                    boxWidth: 10,
                    fontSize: 10
                },
                onClick: setChartLabelItemStore
            },
            title: {
                display: true,
                text: title
            },
            tooltips: {
                mode: 'index',
                intersect: false,
                callbacks: {
                    label: function(tooltipItem, data) {
                        let label = data.datasets[tooltipItem.datasetIndex].label;
                        let value = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                        return (label.indexOf('Produtividade') === -1) ? label+': '+value : label+': '+(value * 100).toLocaleString('pt-BR') + '%'; // convert it to percentage
                    }
                },
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: xTitle
                    }
                }],
                yAxes: [{
                    id: 'y',
                    display: true,
                    type: 'linear',
                    position: 'left',
                    ticks: {
                      min: 0,
                      callback: function (value) {
                        return (value * 100).toLocaleString('pt-BR') + '%'; // convert it to percentage
                      },
                    },
                    scaleLabel: {
                        display: true,
                        labelString: y1Title
                    }
                },{
                    id: 'y1',
                    display: true,
                    type: 'linear',
                    position: 'right',
                    scaleLabel: {
                        display: true,
                        labelString: y2Title
                    }
                }]
            }
        }
    });
    getChartLabelItemStore(idElem, chartLines);
}
function setChartLineBar(idElem, chartData, title) {
    $('#'+idElem).html('<canvas id="'+idElem+'_canvas" width="380" height="200"></canvas>');
    var element = $('#'+idElem+'_canvas');
    new Chart(element).destroy();

    var chartLineBar = new Chart(element, {
        type: 'bar',
        data: chartData,
        options: {
            scales: {
                yAxes: [
                    {
                      name: '1',
                      type: 'linear',
                      position: 'left',
                      scalePositionLeft: true
                    },
                    {
                      name: '2',
                      type: 'linear',
                      position: 'right',
                      scalePositionLeft: false
                    }
                ]
            },
            legend: {
                display: true,
                align: 'end',
                labels: {
                    boxWidth: 10,
                    fontSize: 10
                },
                onClick: setChartLabelItemStore
            },
            title: {
                display: true,
                text: title
            },
            tooltips: {
                mode: 'index',
                intersect: true
            },
            responsive: true
        }
    });
    getChartLabelItemStore(idElem, chartLineBar);
}
function setChartPie(idElem, datasets, labels, title, backgroundColor = false) {
    $('#'+idElem).html('<canvas id="'+idElem+'_canvas" width="380" height="300"></canvas>');
    var element = $('#'+idElem+'_canvas');
    new Chart(element).destroy();

    backgroundColor = (backgroundColor) 
                    ? backgroundColor 
                    : $.map(chartColors,function(v){ return v });
    var chartPie = new Chart(element, {
        type: 'pie',
        data: {
            datasets: [{
                data: datasets,
                backgroundColor: backgroundColor,
                label: 'Dados'
            }],
            labels: labels
        },
        options: {
            legend: {
                display: true,
                align: 'end',
                labels: {
                    boxWidth: 10,
                    fontSize: 10
                },
                onClick: setChartLabelItemStore
            },
            title: {
                display: true,
                text: title
            },
            responsive: true
        }
    });
    getChartLabelItemStore(idElem, chartPie);
}
function setChartDonut(idElem, datasets, labels, title, backgroundColor = false) {
    $('#'+idElem).html('<canvas id="'+idElem+'_canvas" width="380" height="300"></canvas>');
    var element = $('#'+idElem+'_canvas');
    new Chart(element).destroy();

        backgroundColor = (backgroundColor) 
                        ? backgroundColor 
                        : $.map(chartColors,function(v){ return v });
    var chartDonut = new Chart(element, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: datasets,
                backgroundColor: backgroundColor,
                label: 'Dados'
            }],
            labels: labels
        },
        options: {
            legend: {
                display: true,
                align: 'end',
                labels: {
                    boxWidth: 10,
                    fontSize: 10
                },
                onClick: setChartLabelItemStore
            },
            title: {
                display: true,
                text: title
            },
            responsive: true
        }
    });
    getChartLabelItemStore(idElem, chartDonut);
}
function setChartHbar(idElem, datasets, labels, title) {
    $('#'+idElem).html('<canvas id="'+idElem+'_canvas" width="380" height="250"></canvas>');
    var element = $('#'+idElem+'_canvas');
    new Chart(element).destroy();

    var chartHBar = new Chart(element, {
        type: 'horizontalBar',
        data: {
            datasets: datasets,
            labels: labels
        },
        options: {
            legend: {
                display: true,
                align: 'end',
                labels: {
                    boxWidth: 10,
                    fontSize: 10
                },
                onClick: setChartLabelItemStore
            },
            title: {
                display: true,
                text: title
            },
            responsive: true
        }
    });
    getChartLabelItemStore(idElem, chartHBar);
}
function getChartPlanosTrabalho(data = false, checkProgramado = true) {
    var idElem = 'chartAtivPanelPlanos';

    var selectChart = getOptionsPro('selectChartAtiv');
    var selectPrograma = $('#selectChartProgramasAtiv');
    var selectUnidadeID = selectPrograma.find('option:selected').data('id_unidade');
        selectUnidadeID = (typeof selectUnidadeID !== 'undefined' && selectUnidadeID !== null) ? selectUnidadeID : 0;
    var id_unidade = (typeof selectChart !== 'undefined' && selectChart && selectChart.id_unidade !== null) ? selectChart.id_unidade : selectUnidadeID;

    var qunidade = (id_unidade != 0) ? "?id_unidade==`"+id_unidade+"`" : "*";
    var id_user = $('#selectChartUserAtiv').val();
    var quser = (id_user != 0) ? "?id_user==`"+id_user+"`" : "*";
    var planosSelected = (data) ? jmespath.search(data, "["+qunidade+"] | ["+quser+"] | [?data_fim=='0000-00-00 00:00:00']") : null;
        planosSelected = (planosSelected !== null && planosSelected.length > 0 ) ? planosSelected : false;
    var elemChart = $('#'+idElem);

    if (planosSelected && elemChart.length > 0) {
        var height = (planosSelected.length > 1 ) 
                        ? 23*(planosSelected.length+1) 
                        : 80;
        var infoPlanos = '<div style="position: absolute;right: 20px;" class="infoPlanosChart"><a class="newLink" onclick="dialogNomenclaturasPlanos()"><i class="fas fa-info-circle"></i>Entenda as nomenclaturas</a></div>';
            elemChart.find('.infoPlanosChart').remove();
            elemChart.html(infoPlanos+'<canvas id="'+idElem+'_canvas" width="380" height="'+height+'"></canvas>');
        var element = $('#'+idElem+'_canvas');
        if (element.length > 0) {
            new Chart(element).destroy();
            var dataset = [{
                    label: 'Homologado',
                    backgroundColor: chartColors.green,
                    data: jmespath.search(planosSelected, "[].tempo_homologado")
                },{
                    label: 'Entregue',
                    backgroundColor: chartColors.dark_blue,
                    data: jmespath.search(planosSelected, "[].tempo_entregue")
                }, {
                    label: 'Despendido',
                    backgroundColor: chartColors.yellow,
                    data: jmespath.search(planosSelected, "[].tempo_despendido"),
                    hidden: checkOptionEntidade('desativa_produtividade_geral')
                }, {
                    label: 'Pactuado',
                    backgroundColor: chartColors.blue,
                    data: jmespath.search(planosSelected, "[].tempo_pactuado")
                }, {
                    label: 'Programado',
                    backgroundColor: chartColors.silver,
                    data: jmespath.search(planosSelected, "[].tempo_programado")
                    /* data: $.map(planosSelected, function(v){
                                var tempoProgramado = moment(v.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').diff(moment(v.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss'),'days');
                                    tempoProgramado = (tempoProgramado) ? v.tempo_proporcional/tempoProgramado : tempoProgramado;
                                    tempoProgramado = (tempoProgramado) ? parseInt((moment().diff(moment(v.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss'),'days'))*tempoProgramado) : tempoProgramado;
                                    tempoProgramado = (tempoProgramado > v.tempo_proporcional) ? v.tempo_proporcional : tempoProgramado;
                                if (tempoProgramado || tempoProgramado == 0) { return tempoProgramado };
                            }) */
                }, {
                    label: 'Plano',
                    backgroundColor: chartColors.light_grey,
                    data: jmespath.search(planosSelected, "[].tempo_proporcional")
                }];
            var id_unidade_perfil = (id_unidade && id_unidade > 0) ? id_unidade : arrayConfigAtivUnidade.id_unidade;
            var mostrar_notas = jmespath.search(arrayConfigAtividades.unidades, "[?id_unidade==`"+id_unidade_perfil+"`] | [0].config.planos.mostrar_notas");
            var apelido_display = (mostrar_notas !== null && mostrar_notas) ? 'apelido_avaliacao_duracao' : 'apelido';
            var planos = jmespath.search(planosSelected, "{tempo_projetado: max([*].tempo_pactuado), tempo_total: max([*].tempo_proporcional)}");

                // console.log('apelido_display',apelido_display, id_unidade, mostrar_notas, id_unidade_perfil);

            var chartTempoPlano = new Chart(element, {
                type: 'horizontalBar',
                data: {
                        labels: jmespath.search(planosSelected, "[]."+apelido_display),
                        datasets: dataset,
                        dataplanos: jmespath.search(planosSelected, "[].id_plano")
                    },
                options: {
                    scales: {
                        xAxes: [{
                            //stacked: true,
                            gridLines: { display: false },
                            ticks: {
                                fontSize: 10,
                                min: 0,
                                max: (planos.tempo_projetado > planos.tempo_proporcional) ? planos.tempo_projetado : planos.tempo_proporcional,
                                padding: -10
                            }
                        }],
                        yAxes: [{
                            stacked: true,
                            gridLines: { display: false }
                        }]
                    },
                    legend: {
                        display: true,
                        align: 'end',
                        labels: {
                            boxWidth: 10,
                            fontColor: (localStorage.getItem('darkModePro') ? chartColors.light_grey : chartColors.dark_grey),
                            fontSize: 10
                        },
                        onClick: setChartLabelItemStore
                    },
                    title: {
                        display: true,
                        text: 'Planos de Trabalho ('+planosSelected.length+')'
                    },
                    tooltips: {
                        caretPadding: -10,
                        caretSize: 0,
                        titleFontSize: 0,
                        titleSpacing: 0,
                        titleMarginBottom: 0,
                        callbacks: {
                            label: function(tooltipItem, data) {
                                let label = data.datasets[tooltipItem.datasetIndex].label;
                                let value = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                                var planoIndex = data.datasets.findIndex(function(id_key) {
                                                    return id_key.label == "Plano"
                                                });
                                let valuePlano = data.datasets[planoIndex].data[tooltipItem.index];
                                var valuePercent = (tooltipItem.datasetIndex != planoIndex) ? ' ('+((value/valuePlano)*100).toFixed(2)+'%)' : '';
                                return ' ' + label + ': '+value+' horas'+valuePercent;
            
                            }
                        }
                    }
                }
            });

            element.on('click', function(evt) {
                var activePoints = chartTempoPlano.getElementsAtEventForMode(evt, 'point', chartTempoPlano.options);
                var firstPoint = activePoints[0];
                if (typeof firstPoint !== 'undefined') {
                    var label = chartTempoPlano.data.labels[firstPoint._index];
                    var id_plano = chartTempoPlano.data.dataplanos[firstPoint._index];
                    var value = chartTempoPlano.data.datasets[firstPoint._datasetIndex].data[firstPoint._index];
                    getChartProdutividadeMes(id_plano);
                }
            });
            setTimeout(() => {
                if (checkProgramado) {
                    getTempoProgamadoPlanos();
                    $('.infoPlanosChart').prepend('<a class="newLink calcTempoProgramado"><i class="fas fa-sync fa-spin"></i> Calculando tempo programado <span></span></a>');
                }
            }, 1000);
            getChartLabelItemStore(idElem, chartTempoPlano);
        }
    } else {
        elemChart.html('<div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div>');
    }
}
function getTempoProgamadoPlanos() {
    var dataPlanos = window.chart_data_planos;
    var listPlanos = typeof dataPlanos !== 'undefined' ? jmespath.search(dataPlanos,"[?!tempo_programado]") : null;
    var id_plano = typeof listPlanos !== 'undefined' && listPlanos !== null && listPlanos.length ? listPlanos[0].id_plano : null;
    if (id_plano !== null) {
        var statusProgress = dataPlanos.length-listPlanos.length+'/'+dataPlanos.length;
        getChartProdutividadeMes(id_plano, 'get', false, false);
        $('.calcTempoProgramado span').text('('+statusProgress+')');
    } else if (typeof dataPlanos !== 'undefined' && dataPlanos.length) {
        getChartPlanosTrabalho(dataPlanos, false); 
        $('.calcTempoProgramado').remove();
    }
}
function dialogNomenclaturasPlanos() {

    var htmlBox =   '<div id="boxInfoPlanos" class="atividadeWork">'+
                    '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableInfo tableZebra tableFollow">'+
                    '      <tr>'+
                    '          <td style="text-align: left;width: 200px;" class="label">'+
                    '               <label style="background-color: '+chartColors.light_grey+';padding: 5px 8px;border-radius: 5px;"><i class="iconPopup iconSwitch fas fa-clock cinzaColor"></i>Tempo do Plano:</label>'+
                    '           </td>'+
                    '           <td style="text-align: left;">'+
                    '               <label>Tempo l\u00EDquido estabelecido para o cumprimento do plano de trabalho (meta), j\u00E1 reduzido pelos afastamentos e dias n\u00E3o-\u00FAteis (tempo proporcional).</label>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr>'+
                    '          <td style="text-align: left;" class="label">'+
                    '               <label style="background-color: '+chartColors.blue+';color:#fff;padding: 5px 8px;border-radius: 5px;"><i class="iconPopup iconSwitch fas fa-handshake cinzaColor"></i>Tempo Pactuado:</label>'+
                    '           </td>'+
                    '           <td style="text-align: left;">'+
                    '               <label>Somat\u00F3rio dos tempos acordados de todas as demandas <u>cadastradas</u> dentro do plano de trabalho. Em outras palavras, significa o total de tempos a serem entregues pela usu\u00E1rio nas demandas criadas no plano.</label>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr>'+
                    '          <td style="text-align: left;" class="label">'+
                    '               <label style="background-color: '+chartColors.dark_blue+';color:#fff;padding: 5px 8px;border-radius: 5px;"><i class="iconPopup iconSwitch fas fa-handshake cinzaColor"></i>Tempo Entregue:</label>'+
                    '           </td>'+
                    '           <td style="text-align: left;">'+
                    '               <label>Somat\u00F3rio dos tempos acordados de todas as demandas <u>entregues</u> dentro do plano de trabalho. Em outras palavras, significa o total de tempos j\u00E1 conclu\u00EDdos pela usu\u00E1rio nas demandas criadas no plano.</label>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr>'+
                    '          <td style="text-align: left;" class="label">'+
                    '               <label style="background-color: '+chartColors.yellow+';padding: 5px 8px;border-radius: 5px;"><i class="iconPopup iconSwitch fas fa-hourglass-half cinzaColor"></i>Tempo Despendido:</label>'+
                    '           </td>'+
                    '           <td style="text-align: left;">'+
                    '               <label>Somat\u00F3rio dos tempo de execu\u00E7\u00E3o de todas as demandas <u>entregues</u> dentro do plano de trabalho. Em outros termos, representa o total de tempos de dura\u00E7\u00E3o das demandas realizadas no plano.</label>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr>'+
                    '          <td style="text-align: left;" class="label">'+
                    '               <label style="background-color: '+chartColors.green+';color:#fff;padding: 5px 8px;border-radius: 5px;"><i class="iconPopup iconSwitch fas fa-star cinzaColor"></i>Tempo Homologado:</label>'+
                    '           </td>'+
                    '           <td style="text-align: left;">'+
                    '               <label>Somat\u00F3rio dos tempo validados pelo gestor em todas as demandas <u>avaliadas</u> dentro do plano de trabalho. Quer dizer, total de tempos aceitos das demandas chanceladas no plano. '+
                    '                   <br>Caso a demanda seja aceita (nota final da avalia\u00E7\u00E3o maior ou igual a 5 (cinco)), o <u>tempo homologado ser\u00E1 igual ao tempo pactuado</u> da demanda. <br>Caso n\u00E3o aceita, o tempo homologado ser\u00E1 igual a 0 (zero).</label>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr>'+
                    '          <td style="text-align: left;" class="label">'+
                    '               <label style="background-color: '+chartColors.silver+';padding: 5px 8px;border-radius: 5px;"><i class="iconPopup iconSwitch fas fa-history cinzaColor"></i>Tempo Programado:</label>'+
                    '           </td>'+
                    '           <td style="text-align: left;">'+
                    '               <label>Tempo estimado da meta do plano de trabalho caso ele encerrasse na data de hoje. Ou seja, \u00E9 o valor m\u00EDnimo ideal do Tempo Homologado para que o plano de trabalho seja considerado "em dia".</label>'+
                    '           </td>'+
                    '      </tr>'+
                    '   </table>'+
                    '</div>';

    resetDialogBoxPro('dialogBoxPro');
    dialogBoxPro = $('#dialogBoxPro')
        .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
        .dialog({
            title: 'Nomenclaturas do Programa de Gest\u00E3o por Desempenho',
            width: 780,
            open: function() { 
                updateButtonConfirm(this, true);
            },
            close: function() { 
                $('#boxInfoPlanos').remove();
                resetDialogBoxPro('dialogBoxPro');
            },
    });
}
function getSingleChartTempoPlano(element, plano, labels = false) {
    var dataset = [{
        label: 'Homologado',
        barPercentage: 0.7,
        backgroundColor: chartColors.green,
        data: [roundToTwo(plano.tempo_homologado)]
    },{
        label: 'Entregue',
        barPercentage: 0.7,
        backgroundColor: chartColors.dark_blue,
        data: [roundToTwo(plano.tempo_entregue)]
    },{
        label: 'Despendido',
        barPercentage: 0.7,
        backgroundColor: chartColors.yellow,
        data: [roundToTwo(plano.tempo_despendido)],
        hidden: checkOptionEntidade('desativa_produtividade_geral')
    }, {
        label: 'Pactuado',
        barPercentage: 0.7,
        backgroundColor: chartColors.blue,
        data: [roundToTwo(plano.tempo_pactuado)]
    }, {
        label: 'Programado',
        barPercentage: 0.7,
        backgroundColor: chartColors.silver,
        data: typeof plano.tempo_programado !== 'undefined' ? [roundToTwo(plano.tempo_programado)] : [],
        /* data: $.map([plano], function(v){
                    var tempoProgramado = moment(v.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').diff(moment(v.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss'),'days');
                        tempoProgramado = (tempoProgramado) ? v.tempo_proporcional/tempoProgramado : tempoProgramado;
                        tempoProgramado = (tempoProgramado) ? parseInt((moment().diff(moment(v.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss'),'days'))*tempoProgramado) : tempoProgramado;
                        tempoProgramado = (tempoProgramado > v.tempo_proporcional) ? v.tempo_proporcional : tempoProgramado;
                    if (tempoProgramado || tempoProgramado == 0) { return tempoProgramado };
                }) */
    }, {
        label: 'Plano',
        barPercentage: 0.7,
        backgroundColor: chartColors.light_grey,
        data: [roundToTwo(plano.tempo_proporcional)]
    }];
    // console.log(dataset);
    
    if (typeof plano.tempo_projetado !== 'undefined') {
        dataset.splice(3, 0, {
            label: 'Projetado',
            barPercentage: 0.7,
            backgroundColor: chartColors.purple,
            data: [roundToTwo(plano.tempo_projetado)]
        });
    }
    var chartTempoPlano = new Chart(element, {
        type: 'horizontalBar',
        data: {
                labels: [(labels ? labels : 'Tempo (h)')],
                datasets: dataset

            },
        options: {
            scales: {
                xAxes: [{
                    //stacked: true,
                    gridLines: { display: false },
                    ticks: {
                        fontSize: 10,
                        min: 0,
                        max: Math.max.apply(null, [
                                                    roundToTwo(plano.tempo_despendido), 
                                                    roundToTwo(plano.tempo_homologado), 
                                                    roundToTwo(plano.tempo_pactuado), 
                                                    roundToTwo(plano.tempo_proporcional), 
                                                    (typeof plano.tempo_projetado !== 'undefined' ? roundToTwo(plano.tempo_projetado):0) 
                                                ]),
                        padding: -10
                    }
                }],
                yAxes: [{
                    stacked: true,
                    gridLines: { display: false }
                }]
            },
            legend: {
                display: true,
                align: 'end',
                labels: {
                    boxWidth: 10,
                    fontSize: 10
                }
            },
            tooltips: {
                caretPadding: (labels ? -60 : -70),
                caretSize: 0,
                titleFontSize: 0,
                titleSpacing: 0,
                titleMarginBottom: 0,
                callbacks: {
                    label: function(tooltipItem, data) {
                        var label = data.datasets[tooltipItem.datasetIndex].label;
                        var value = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                        var planoIndex = data.datasets.findIndex(function(id_key) {
                                            return id_key.label == "Plano"
                                        });
                        var valuePlano = data.datasets[planoIndex].data[tooltipItem.index];
                        var valuePercent = (tooltipItem.datasetIndex != planoIndex) ? ' ('+((value/valuePlano)*100).toFixed(2)+'%)' : '';
                        return ' ' + label + ': '+value+' horas'+valuePercent;
    
                    }
                }
            }
        }
    });
    return chartTempoPlano;
}
function updateButtonTextarea(this_) {
    if (checkValue($(this_))) { updateButtonConfirm(this_, true) } else { updateButtonConfirm(this_, false) }
}
function moreCommentBox(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.moreCommentBoxDiv');
        _parent.find('.moreCommentBoxText').toggle();
        _this.toggleClass('newLink_active');
    if (_parent.find('textarea').is(':visible')) { 
        _parent.find('textarea').focus();
    } else {
        _parent.find('textarea').val('');
    }
}
function moreInfoBoxAtiv(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var _moreInfo = _parent.find('.moreInfoBox');
        _this.toggleClass('newLink_active').find('i').toggleClass('fa-minus-circle fa-plus-circle');
        _moreInfo.toggle();
    var infoStatus = (_moreInfo.is(':visible')) ? 'show' : 'hide';
    setOptionsPro('moreInfoBoxAtiv',infoStatus);
}
function moreInfoBox(this_) {
    $(this_).closest('.dialogBoxDiv').find('.moreInfoBox').toggle();
    $(this_).toggleClass('newLink_active');
}
function getConfigDateAtiv(value) {
    var config_unidade = getConfigDadosUnidade(value.sigla_unidade); 
    var funcDisplay = 'filterTagView';
    var formatDate = 'YYYY-MM-DD HH:mm:ss';
    var format_hora = (config_unidade && config_unidade.count_horas) ? 'DD/MM/YYYY [\u00E0s] HH:mm' : 'DD/MM/YYYY';
    var titleDoc = value.nome_documento+' '+value.numero_documento;
        titleDoc = (typeof value.documento_sei !== 'undefined' && value.documento_sei !== null && parseInt(value.documento_sei) != 0) 
            ? titleDoc+' ('+value.documento_sei+')' 
            : titleDoc;
    var check_ispaused = (typeof value.data_retomada !== 'undefined' && value.data_retomada !== null && value.data_retomada == '0000-00-00 00:00:00') ? true : false;
    var tipPauseAtiv = (typeof value.data_retomada !== 'undefined' && value.data_retomada !== null && value.data_retomada != '0000-00-00 00:00:00')
            ? '<br> Retomada em: '+moment(value.data_retomada, 'YYYY-MM-DD HH:mm:ss').format(format_hora) 
            : (typeof value.data_pausa !== 'undefined' && value.data_pausa !== null && value.data_pausa != '0000-00-00 00:00:00') 
                ? '<br> '+__.Paralisada+' em: '+moment(value.data_pausa, 'YYYY-MM-DD HH:mm:ss').format(format_hora) 
                : '';
    var tipInitAtiv = (value.data_inicio != '0000-00-00 00:00:00') 
            ? '<br> Iniciada em: '+moment(value.data_inicio, 'YYYY-MM-DD HH:mm:ss').format(format_hora)+tipPauseAtiv
            : '';
    var checklist = (value.checklist) ? '<br>'+getInfoAtividadeChecklist(value, 'text').replace(/'/g, "\\'") : '';
    var checkRateNull = (value.avaliacao && value.avaliacao != 0 && value.avaliacao.nota_atribuida === false) ? true : false;

    var _return = (value.data_entrega == '0000-00-00 00:00:00') 
            ? {
                date: moment(value.data_distribuicao, 'YYYY-MM-DD HH:mm:ss').format(formatDate), 
                dateTo: moment().format(formatDate), 
                dateDue: moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss').format(formatDate), 
                duecounter: 'corrido', 
                countdays: true, 
                workday: false, 
                setdate: true, 
                displayicon:    (value.data_inicio != '0000-00-00 00:00:00' 
                                    ? (moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss') >= moment()) 
                                        ? (typeof value.data_retomada !== 'undefined' && value.data_retomada !== null && value.data_retomada == '0000-00-00 00:00:00') 
                                            ? 'fas fa-pause-circle laranjaColor' 
                                            : 'fas fa-play-circle azulColor' 
                                        : 'fas fa-play-circle vermelhoColor' 
                                    : (moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss') < moment()) 
                                        ? 'fas fa-exclamation-triangle vermelhoColor'
                                        : ($.inArray(('importante' || 'urgente'), $.map(value.etiquetas, function(v){ return v.toLowerCase() })) !== -1) 
                                            ? 'fas fa-exclamation-circle laranjaColor' 
                                            : 'far fa-clock'
                                ),
                displayformat: format_hora,
                duesetdate: true,
                displaydue: true,
                displaydue_txt: 'Vencimento:',
                deliverydoc: false,
                func: funcDisplay,
                paused: check_ispaused,
                displaytip: (value.id_user != 0 
                    ? 'Atribu\u00EDdo \u00E0 '+value.apelido+tipInitAtiv+checklist
                    : 'N\u00E3o atribu\u00EDdo'+checklist)
            } : {
                date: moment(value.data_entrega, 'YYYY-MM-DD HH:mm:ss').format(formatDate), 
                dateTo: moment().format(formatDate), 
                dateDue: moment(value.data_entrega,'YYYY-MM-DD HH:mm:ss').add(45,'d').format(formatDate), 
                duecounter: 'corrido', 
                countdays: true, 
                workday: false, 
                setdate: true, 
                displayicon: (moment(value.data_entrega,'YYYY-MM-DD HH:mm:ss') <= moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss')) ? 'fas fa-check-circle verdeColor' : 'fas fa-check-circle laranjaColor',
                displayformat: format_hora,
                duesetdate: true,
                displaydue: false,
                displaydue_txt: 'Entregue em:',
                deliverydoc: true,
                deliverydoc_style: (moment(value.data_entrega,'YYYY-MM-DD HH:mm:ss') <= moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss')) ? 'fas fa-check-circle verdeColor' : 'fas fa-check-circle laranjaColor',
                func: funcDisplay,
                displaytip: !checkOptionEntidade('desativa_produtividade_geral') && ((checkCapacidade('chart_produtividade') || (typeof arrayConfigAtividades.perfil !== 'undefined' && value.id_user == arrayConfigAtividades.perfil.id_user))
                    ? titleDoc+' (por '+value.apelido+')<br>Produtividade: '+getInfoAtividadeProdutividade_calc(value)+checklist
                    : titleDoc+' (por '+value.apelido+')'+checklist)
            };
    
        _return = (value.data_avaliacao != '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00')
            ? {
                date: moment(value.data_avaliacao, 'YYYY-MM-DD HH:mm:ss').format(formatDate), 
                dateTo: moment().format(formatDate), 
                dateDue: null, 
                duecounter: 'corrido', 
                countdays: true, 
                workday: false, 
                setdate: true, 
                displayicon: false,
                displayformat: format_hora,
                duesetdate: true,
                displaydue_txt: (checkRateNull ? 'Avalia\u00E7\u00E3o dispensada em:' : 'Avaliada em:'),
                displaydue: false,
                deliverydoc: true,
                ratingdoc: true,
                deliverydoc_style: 'fas fa-star starGold'+(checkRateNull ? ' starDisabled' : ''),
                func: funcDisplay,
                displaytip: !checkOptionEntidade('desativa_produtividade_geral') && ((checkCapacidade('chart_produtividade') || (typeof arrayConfigAtividades.perfil !== 'undefined' && value.id_user == arrayConfigAtividades.perfil.id_user))
                    ? 'Tempo homologado: '+value.tempo_homologado+' horas<br>Produtividade: '+getInfoAtividadeProdutividade_calc(value)+checklist
                    : 'Tempo homologado: '+value.tempo_homologado+' horas<br>'+checklist)
            } : _return;

        _return = (value.data_avaliacao != '0000-00-00 00:00:00' && value.data_envio != '0000-00-00 00:00:00')
            ? {
                date: moment(value.data_envio, 'YYYY-MM-DD HH:mm:ss').format(formatDate), 
                dateTo: moment().format(formatDate), 
                dateDue: null, 
                duecounter: 'corrido', 
                countdays: true, 
                workday: false, 
                setdate: true, 
                displayicon: false,
                displayformat: format_hora,
                duesetdate: true,
                displaydue_txt: __.Arquivada+' em:',
                displaydue: false,
                deliverydoc: true,
                senddoc: true,
                deliverydoc_style: 'fas fa-archive cinzaColor',
                func: funcDisplay,
                displaytip: !checkOptionEntidade('desativa_produtividade_geral') && ((checkCapacidade('chart_produtividade') || (typeof arrayConfigAtividades.perfil !== 'undefined' && value.id_user == arrayConfigAtividades.perfil.id_user))
                    ? titleDoc+' (por '+value.apelido+') <br> Tempo homologado: '+value.tempo_homologado+' horas<br>Produtividade: '+getInfoAtividadeProdutividade_calc(value)+checklist
                    : titleDoc+' (por '+value.apelido+') <br> Tempo homologado: '+value.tempo_homologado+' horas<br>'+checklist)
            } : _return;
    
    return _return;
}
function editFieldAtiv(this_) {
    var _this = $(this_);
    var type_container = ($(this_).closest('.kanban-content').length > 0) ? 'kanban' : 'table';
    var _content_desc = _this.closest('.content_edit');
    var _info = _content_desc.find('span.info');
    var data = _content_desc.data();
    var value = _info.text();
    if (_info.is("[contentEditable='true']")) {
        _content_desc.removeClass('info_noclick');
        _content_desc.find('.content_btnsave').toggleClass('newLink_active newLink_confirm').find('i').toggleClass('fa-thumbs-up fa-edit');
        _info.prop('contenteditable',false).unbind();
        if (data.old != value) {
            parent.getServerAtividades(
                {
                    action: 'edit_field', 
                    field: data.field, 
                    id: data.id, 
                    value: value
            }, 'edit_field');
            var ativIndex = (data.id) ? parent.arrayAtividades.findIndex((obj => obj.id_demanda == data.id)) : data.id;
                arrayAtividades[ativIndex][data.field] = value;
                arrayAtividadesPro[ativIndex][data.field] = value;

            if (type_container == 'table' && $('.kanban-item').is(':visible')) {
                var kanban_item = $('.kanban-item[data-eid="_id_'+data.id+'"] .content_edit[data-field="'+data.field+'"]');
                    kanban_item.find('span.info').text(value);
            }
        }
    } else {
        _content_desc.addClass('info_noclick').data('old', value);
        _info.prop('contenteditable',true).focus().on('keypress',function(e) {
            if(e.which == 13) {
                _content_desc.find('.content_btnsave').trigger('click');
                _info.html(replaceTextToProcessoSEI(replaceTextToUrl(_info.html())));
            }
        });
        _content_desc.find('.content_btnsave').toggleClass('newLink_active newLink_confirm').find('i').toggleClass('fa-thumbs-up fa-edit');
    }
}
// INSERE ICONES NA TABELA DE CONTROLE DE PROCESSOS (RECEBIDOS/GERADOS)
function updateTableProcessos() {
    var tblProcessos = $('#tblProcessosRecebidos, #tblProcessosGerados, #tblProcessosDetalhado');
    if (tblProcessos.find('tbody tr').not('.tableHeader').find('td.atividadeBoxDisplay').length == 0) {
            tblProcessos.find('tbody tr').not('.tableHeader').append('<td class="atividadeBoxDisplay" style="text-align: center;"></td>');

        if ( tblProcessos.find('thead').length > 0 ) {
            tblProcessos.find('thead tr').append('<th class="tituloControle tablesorter-header '+(isNewSEI ? 'infraTh' : '')+' atividadeBoxDisplay"> '+__.Demandas+'</th>');
        } else {
            $('#tblProcessosRecebidos tbody tr:first, #tblProcessosGerados tbody tr:first, #tblProcessosDetalhado tbody tr:first').find('.atividadeBoxDisplay').remove();
            $('#tblProcessosRecebidos tbody tr:first, #tblProcessosGerados tbody tr:first, #tblProcessosDetalhado tbody tr:first').not('.tableHeader').append('<th class="tituloControle tablesorter-header '+(isNewSEI ? 'infraTh' : '')+' atividadeBoxDisplay"> '+__.Demandas+'</th>');
        }
        if ($('.tabelaControle').find('tr').hasClass('tableHeader')) { 
            $('.tabelaControle').find('tr.tableHeader').each(function(){ 
                var td = $(this).find('th.tituloControle').eq(1);
                var colspan = parseInt(td.attr('colspan'));
                if (colspan == 6) {
                    td.attr('colspan',colspan+1);
                }
            });
        }
        if ($('#selectGroupTablePro').val() != '') {
            $('#selectGroupTablePro').trigger('change');
        }
        /*
        if ($('.tabelaControle').hasClass('tablesorter')) {
            if ($('#tblProcessosRecebidos, #tblProcessosGerados, #tblProcessosDetalhado').length > 0) {
                $('#tblProcessosRecebidos, #tblProcessosGerados, #tblProcessosDetalhado').trigger("destroy");
                initTableSorterHome();
            }
        }
        */
    }
}
function changeViewStatesAtiv(this_){
    var _this = $(this_);
    var data = _this.data();
    if (data.type == 'view_ativ_send') {
        setOptionsPro('panelAtividadesViewSend',_this.is(':checked'));
    } else if (data.type == 'view_ativ_self') {
        setOptionsPro('panelAtividadesViewSelf',_this.is(':checked'));
    } else if (data.type == 'view_ativ_sub') {
        setOptionsPro('panelAtividadesViewSubordinada',_this.is(':checked'));
    } else if (data.type == 'view_disable_local') {
        changePanelLocalStorePro(this_);
    } else if (data.type == 'view_ativ_lab') {
        changePanelLabPro(this_);
    } else if (data.type == 'sync_unidades') {
        setOptionsPro('panelAtividadesViewSyncUnidade',_this.is(':checked'));
        perfilAtividadesSelected = $('#selInfraUnidades').val().trim();
    }
    removeLocalDataAtiv();
    getAtividades();
    _this.closest('td').addClass('editCellLoading');
}
function changeProgramaAtiv(this_){
    var _this = $(this_);
    setOptionsPro('programaAtividadesSelected', _this.val());
    removeLocalDataAtiv();
    getAtividades();
    _this.closest('tr').find('td').eq(0).addClass('editCellLoading');
}
function getConfigProgramas(this_){
    var _this = $(this_);
    if (_this.is(':checked')) {
        _this.closest('tr').find('.selectProgramaAtiv').show();
    } else {
        _this.closest('tr').find('.selectProgramaAtiv').hide();
    }
}
/*
function changeViewStatesAtivSub(this_){
    var _this = $(this_);
    setOptionsPro('panelAtividadesViewSubordinada',_this.is(':checked'));
    getAtividades();
    _this.closest('td').addClass('editCellLoading');
}
function changeViewStatesSyncUnidade(this_){
    var _this = $(this_);
    setOptionsPro('panelAtividadesViewSyncUnidade',_this.is(':checked'));
    getAtividades();
    _this.closest('td').addClass('editCellLoading');
}
*/
function changeBaseDadosAtiv(this_){
    var _this = $(this_);
    var perfilSelected = parseInt(_this.val());
    var configBasePro = localStorageRestorePro('configBasePro');
    // var dataAPI = jmespath.search(configBasePro, "[?baseTipo=='atividades'] | [?conexaoTipo=='api'||conexaoTipo=='googleapi']");
    var dataAPI = jmespath.search(configBasePro, "[?baseTipo=='atividades'] | [?conexaoTipo=='api']");
    var perfilLoginAtiv = (dataAPI && dataAPI !== null && dataAPI.length > 0 && typeof dataAPI[perfilSelected].KEY_USER !== 'undefined') 
                    ? dataAPI[perfilSelected] 
                    : false;
    if (perfilLoginAtiv) {
        urlServerAtiv = perfilLoginAtiv.URL_API;
        userHashAtiv = perfilLoginAtiv.KEY_USER;
        removeOptionsPro('perfilAtividadesSelected');
        setOptionsPro('configBaseSelectedPro_atividades',perfilSelected);
        localStorageStorePro('configBasePro_atividades', {URL_API: perfilLoginAtiv.URL_API, KEY_USER: perfilLoginAtiv.KEY_USER});
        removeLocalDataAtiv(true);
        getAtividades();
        _this.closest('td').addClass('editCellLoading');
    }
}
function updateAtividade_(this_){
    removeLocalDataAtiv();
    resetDialogBoxPro('dialogBoxPro');
    updateAtividade(this_);
}
function updateAtividade(this_ = false){
    if (this_) { $(this_).find('i').addClass('fa-spin'); }
    getAtividades();
}

// CRIA PAINEL DE GESTAO DE ATIVIDADES DO PROCESSO
function setAtividadesProcessoHome(storeAtividades = arrayAtividadesProcPro) {
    if ($('#ifrArvore').length > 0 && typeof __ !== 'undefined') {
        var ifrArvore = $('#ifrArvore').contents();
            ifrArvore.find('#divArvore .dateboxDisplayAtiv').remove();
        $.each(storeAtividades,function(index, value){
            var datesAtivHtml = (typeof value.data_distribuicao !== 'undefined' && value.data_distribuicao !== null) ? getDatesPreview(getConfigDateAtiv(value)) : '';
                datesAtivHtml = (datesAtivHtml != '') ? $(datesAtivHtml).find('.dateBoxIcon')[0].outerHTML : '';
            var doc_requisicao = ifrArvore.find('a#anchor'+value.id_documento_requisicao);
            if (doc_requisicao.length > 0 && datesAtivHtml != '') {
                doc_requisicao.after('<span class="dateboxDisplay dateboxDisplayAtiv" onclick="parent.actionsAtividade('+value.id_demanda+')">'+datesAtivHtml+'</span>');
            }
        });
        if (ifrArvore.find('.panelDadosArvore_atividades').length == 0 && typeof $('#ifrArvore')[0].contentWindow.initAtividadesProcesso === 'function') {
            $('#ifrArvore')[0].contentWindow.initAtividadesProcesso();
        }
    }
}

// CRIA PAINEL INDIVIDUAL DE ATIVIDADES DO USUARIO
function setAtividadesUser() {
    if ($('#frmProcedimentoControlar').length > 0) {
        var unidade = arrayConfigAtivUnidade;
        var plano = (
                        typeof arrayConfigAtividades !== 'undefined' && arrayConfigAtividades !== null &&
                        typeof arrayConfigAtividades.planos !== 'undefined' && arrayConfigAtividades.planos !== null && arrayConfigAtividades.planos.length > 0 &&
                        typeof arrayConfigAtividades.perfil !== 'undefined' && arrayConfigAtividades.perfil !== null 
                    ) ? jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+arrayConfigAtividades.perfil.id_user+"`] | [0]") : null;
        var filterAtivPanel = $('#tabelaAtivPanel').find('.filterTablePro');
        var target = $('#atividadesProDiv');
        if (plano !== null && target.length > 0) {
                    target.find('.atividadesProStatus').remove();
                var htmlUser =  '<div id="atividadesStatus" class="atividadesProStatus">'+
                                '    <div id="statusUser"><canvas id="chartStatusUser" width="600" height="90"></canvas></div>'+
                                '</div>';
                    target.prepend(htmlUser).css('margin-top', '90px');
                var element = $('#chartStatusUser');
                waitLoadProSimple(element, function(){
                    var mostrar_notas = jmespath.search(arrayConfigAtividades.unidades, "[?id_unidade==`"+plano.id_unidade+"`] | [0].config.planos.mostrar_notas");
                    var apelido_display = (mostrar_notas !== null && mostrar_notas) ? 'apelido_avaliacao' : 'apelido';
                    var chartStatusUser = getSingleChartTempoPlano(element, plano, plano[apelido_display]);
                    chartStatusUser.options.scales.xAxes[0].ticks.display = false;
                    chartStatusUser.options.legend.display = false;
                    chartStatusUser.options.title = {display: true, text: unidade.nome_unidade+' - '+unidade.sigla_unidade};
                    chartStatusUser.update();
                    checkProgramacaoPlano(plano);
                });
                filterAtivPanel.css('top','140px');
        } else {
            filterAtivPanel.css('top','52px');
        }
    }
}
function checkProgramacaoPlano(v) {
    var porcentagemAlerta = getOptionEntidade('alerta_tempo_programado');
    var tempoProgramado = moment(v.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').diff(moment(v.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss'),'days');
        tempoProgramado = (tempoProgramado) ? v.tempo_proporcional/tempoProgramado : tempoProgramado;
        tempoProgramado = (tempoProgramado) ? parseInt((moment().diff(moment(v.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss'),'days'))*tempoProgramado) : tempoProgramado;
        tempoProgramado = (tempoProgramado > v.tempo_proporcional) ? v.tempo_proporcional : tempoProgramado;
        tempoProgramado = (tempoProgramado || tempoProgramado == 0) ? tempoProgramado : false;
    if (tempoProgramado && porcentagemAlerta && porcentagemAlerta != 0 && tempoProgramado * (porcentagemAlerta / 100) > v.tempo_pactuado && tempoProgramado * (porcentagemAlerta / 100) > v.tempo_proporcional) {
        $('#statusUser_alertPlano').remove();
        $('#statusUser').append('<div id="statusUser_alertPlano" style="position: absolute;margin-top: -85px;background: #e46e64;color: white;font-size: 10pt;border-radius: 5px;padding: 5px 10px;"><i class="fas fa-exclamation-triangle brancoColor" style="margin-right: 5px;"></i>Tempo pactuado muito distante do tempo programado<i class="fas fa-times-circle brancoColor" style="margin-left: 5px;cursor: pointer;" onclick="$(this).closest(\'div\').remove()"></i></div>');
    }
}
function setToolbarAtiv() {
    htmlToolbarDoc =    '<div id="toolbar_atividades" class="hidden">'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="none" data-action="info_atividade"><i style="margin: 0 5px;" class="fas fa-info-circle azulColor"></i> <span class="info" alt="Informa\u00E7\u00F5es '+__.da_demanda+'">Informa\u00E7\u00F5es '+__.da_demanda+'</span></a>'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="start_atividade" data-action="edit_atividade"><i style="margin: 0 5px;" class="fas fa-pencil-alt azulColor"></i> <span class="info" alt="Editar '+__.Demanda+'">Editar '+__.Demanda+'</span></a>'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="start_atividade" data-action="edit_atividade" data-subaction="notify_atividade"><i style="margin: 0 5px;" class="fas fa-envelope azulColor"></i> <span class="info" alt="Gerar Notifica\u00E7\u00E3o">Gerar Notifica\u00E7\u00E3o</span></a>'+

                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="complete_atividade pause_atividade" data-action="pause_atividade"><i style="margin: 0 5px;" class="fas fa-pause-circle laranjaColor"></i> <span class="info" alt="Inserir '+__.Paralisacao+'">Inserir '+__.Paralisacao+'</span></a>'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="complete_atividade play_atividade" data-action="pause_atividade"><i style="margin: 0 5px;" class="fas fa-play-circle azulColor"></i> <span class="info" alt="Inserir '+__.Retomar+' '+__.Demanda+'">'+__.Retomar+' '+__.Demanda+'</span></a>'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="complete_atividade paused_atividade" data-action="extend_atividade"><i style="margin: 0 5px;" class="fas fa-retweet azulColor"></i> <span class="info" alt="'+__.Prorrogar+' Prazo">'+__.Prorrogar+' Prazo</span></a>'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="complete_atividade rate_atividade" data-action="variation_atividade"><i style="margin: 0 5px;" class="fas fa-graduation-cap azulColor"></i> <span class="info" alt="Alterar '+__.Complexidade+'">Alterar '+__.Complexidade+'</span></a>'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="complete_atividade rate_atividade" data-action="type_atividade"><i style="margin: 0 5px;" class="fas fa-clipboard-list azulColor"></i> <span class="info" alt="Atribuir '+__.Atividade+'">Atribuir '+__.Atividade+'</span></a>'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="none" data-action="history_atividade"><i style="margin: 0 5px;" class="fas fa-scroll azulColor"></i> <span class="info" alt="Hist\u00F3rico '+__.da_demanda+'">Hist\u00F3rico '+__.da_demanda+'</span></a>'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="complete_atividade" data-action="start_cancel_atividade"><i style="margin: 0 5px;" class="fas fa-times-circle vermelhoColor"></i> <span class="info" alt="Cancelar In\u00EDcio">Cancelar In\u00EDcio</span></a>'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="rate_default_atividade" data-action="rate_default_atividade"><i style="margin: 0 5px;" class="fas fa-exclamation-circle vermelhoColor"></i> <span class="info" alt="Omiss\u00E3o de '+__.Demanda+'">Omiss\u00E3o de '+__.Demanda+'</span></a>'+
                        
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="rate_atividade" data-action="complete_edit_atividade"><i style="margin: 0 5px;" class="fas fa-pencil-alt azulColor"></i> <span class="info" alt="Editar Conclus\u00E3o">Editar Conclus\u00E3o</span></a>'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="rate_atividade" data-action="complete_cancel_atividade"><i style="margin: 0 5px;" class="fas fa-times-circle vermelhoColor"></i> <span class="info" alt="Cancelar Conclus\u00E3o">Cancelar Conclus\u00E3o</span></a>'+
                        
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="send_atividade" data-action="rate_edit_atividade"><i style="margin: 0 5px;" class="fas fa-pencil-alt azulColor"></i> <span class="info" alt="Editar Avalia\u00E7\u00E3o">Editar Avalia\u00E7\u00E3o</span></a>'+
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="send_atividade" data-action="rate_cancel_atividade"><i style="margin: 0 5px;" class="fas fa-times-circle vermelhoColor"></i> <span class="info" alt="Cancelar Avalia\u00E7\u00E3o">Cancelar Avalia\u00E7\u00E3o</span></a>'+
                        
                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="archive_atividade" data-action="send_cancel_atividade"><i style="margin: 0 5px;" class="fas fa-times-circle vermelhoColor"></i> <span class="info" alt="Cancelar Arquivamento">Cancelar Arquivamento</span></a>'+

                        '   <a href="#" style="width: 175px;padding-top: 10px;display:none;" data-mode="start_atividade delete_atividade_all" data-action="delete_atividade"><i style="margin: 0 5px;" class="fas fa-trash-alt vermelhoColor"></i> <span class="info" alt="Excluir '+__.Demanda+'">Excluir '+__.Demanda+'</span></a>'+
                        '<div>';
    return htmlToolbarDoc;
}
// CRIA PAINEL DE GESTAO DE ATIVIDADES
function setPanelAtividades(storeAtividades = arrayAtividadesPro) {
    var statusView = ( getOptionsPro('atividadesProDiv') == 'hide' ) ? 'display:none;' : 'display: inline-table;';
    var statusIconShow = ( getOptionsPro('atividadesProDiv') == 'hide' ) ? '' : 'display:none;';
    var statusIconHide = ( getOptionsPro('atividadesProDiv') == 'hide' ) ? 'display:none;' : '';
    // var arrayProcessosUnidade = getProcessoUnidadePro();
    var viewModePanel = (getOptionsPro('panelAtividadesView')) ? getOptionsPro('panelAtividadesView') : 'Tabela';
    var countAtividade = (storeAtividades.length == 1) ? '<span class="count">'+storeAtividades.length+'</span> registro:' : '<span class="count">'+storeAtividades.length+'</span> registros:';
    var countUnidades = (storeAtividades.length > 0) ? uniqPro(jmespath.search(storeAtividades, "[?sigla_unidade].sigla_unidade")).length : 0;
    var htmlTableAtividades = (userHashAtiv == '') ? '<div class="g-signin2" data-onsuccess="onSignIn" data-longtitle="true"></div>' : '<div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div>';
/*         htmlTableAtividades = (googleOneTap && userHashAtiv == '') 
        ?   '<div id="g_id_onload"'+
            '        data-client_id="'+CLIENT_ID_PRO+'"'+
            '        data-context="signin"'+
            '        data-ux_mode="popup"'+
            '        data-callback="onSignIn"'+
            '        data-nonce=""'+
            '        data-auto_select="true">'+
            '</div>'+
            '<div class="g_id_signin"'+
            '        data-type="standard"'+
            '        data-shape="pill"'+
            '        data-theme="filled_blue"'+
            '        data-text="$ {button.text}"'+
            '        data-size="large"'+
            '        data-locale="pt-BR"'+
            '        data-logo_alignment="left"'+
            '        data-width="300">'+
            '</div>'
        : htmlTableAtividades; */
        updateTableProcessos();
    if (storeAtividades.length > 0 && (!getOptionsPro('panelHomeView') || getOptionsPro('panelHomeView') == 'Atividade')) {

        function getTdRow(type) {
            var html = '';
            if (type == 'proc') {
                html =  '           <th class="tituloControle" data-column-order="0" data-filter-type="proc">ID / Processo / Requisi\u00E7\u00E3o</th>';
            } else if (type == 'date') {
                html =  '           <th class="tituloControle tituloFilter" data-column-order="1" data-filter-type="date">Status</th>';
            } else if (type == 'action') {
                html =  '           <th class="tituloControle tituloFilter" data-column-order="2" data-filter-type="action">A\u00E7\u00E3o</th>';
            } else if (type == 'user') {
                html =  '           <th class="tituloControle tituloFilter" data-column-order="3" data-filter-type="user">Respons\u00E1vel e Tempo Pactuado</th>';
            } else if (type == 'etiqueta') {
                html =  '           <th class="tituloControle tituloFilter" data-column-order="4" data-column-order="0" data-filter-type="etiqueta">Etiqueta</th>';
            } else if (type == 'desc') {
                html =  '           <th class="tituloControle" data-column-order="5" style="width: 30%;" data-filter-type="desc">'+__.Demanda+' e Assunto</th>';
            }
            return html;
        }
        var arrayColumnSort = (getOptionsPro('panelAtividadesViewTableSort')) 
            ? getOptionsPro('panelAtividadesViewTableSort') 
            : [
                "proc",
                "date",
                "action",
                "user",
                "etiqueta",
                "desc"
            ];
        var htmlColumnsAtividades = $.map(arrayColumnSort, function(v){
                                        return getTdRow(v);
                                    }).join('');

        htmlTableAtividades =    '<table class="tableInfo tableZebra tableFollow tableAtividades" data-tabletype="atividades" style="margin-top: 0;">'+
                                '   <caption class="infraCaption" style="text-align: left; margin-top: 10px;">'+countAtividade+'</caption>'+
                                '   <thead>'+
                                '       <tr class="tableHeader">'+
                                '           <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_atividades" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_atividades" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck"></a></th>'+
                                '           '+htmlColumnsAtividades+
                                '       </tr>'+
                                '   </thead>'+
                                '   <tbody>';
        $('.tabelaControle .atividadeBoxDisplay').html('');
        htmlTableAtividades +=   '   </tbody>'+
                                '</table>';
    }
    var idOrder = (getOptionsPro('orderPanelHome') && jmespath.search(getOptionsPro('orderPanelHome'), "[?name=='atividadesPro'].index | length(@)") > 0) ? jmespath.search(getOptionsPro('orderPanelHome'), "[?name=='atividadesPro'].index | [0]") : '';

    var selectListUsers = '<select id="selectChartUserAtiv" data-type="user" onchange="changeChartAtiv(this)" style="max-width: 160px; float: right;" class="selectPro chosen-min" onchange="changeChartAtiv(this);" data-placeholder="Filtrar por usu\u00E1rio" ><option value="0" data-label="">&nbsp;</option></select>';
    
    var selectListProgramas = '<select id="selectChartProgramasAtiv" data-type="programas" onchange="changeChartAtiv(this)" data-placeholder="Filtrar por programa de gest\u00E3o" style="max-width: 260px; width: 300px; float: right;" class="selectPro  chosen-min" onchange="changeChartAtiv(this);"><option value="0" data-label="">&nbsp;</option></select>';
    
    var optionSelectsPerfil = (typeof arrayConfigAtividades.perfil !== 'undefined' && typeof arrayConfigAtividades.perfil.lotacoes_obj !== 'undefined') ? getOptionSelectPerfil(arrayConfigAtividades.perfil.lotacoes_obj, getOptionsPro('perfilAtividadesSelected')) : '';
    var selectListPerfilLotacao = (optionSelectsPerfil == '') ? '' : '<select data-type="perfil" onchange="changePerfilAtiv(this)" data-placeholder="Filtrar por usu\u00E1rio" style="max-width: 300px; float: right;" class="selectPro">'+optionSelectsPerfil+'</select>';

    var urlGuiaUtilizacao = (typeof arrayConfigAtividades !== 'undefined' && typeof arrayConfigAtividades.perfil !== 'undefined' && typeof arrayConfigAtividades.perfil.id_entidade !== 'undefined') ? jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config.guia_utilizacao") : null;
        urlGuiaUtilizacao = (urlGuiaUtilizacao === null) ? urlGuiaUtilizacao : 'https://bit.ly/Guia-ANTAQPro';
    var btnGuiaUtilizacao = '<a class="newLink iconAtividade_guia" href="'+urlGuiaUtilizacao+'" target="_blank" onmouseover="return infraTooltipMostrar(\'Guia de Utiliza\u00E7\u00E3o\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt;float: right;">'+
                            '    <i class="fas fa-graduation-cap"></i>'+
                            '</a>';

    var iconLabel = localStorage.getItem('iconLabel');
    var iconBoxSlim = localStorage.getItem('seiSlim');

    var htmlPanelAtividades =   '<div class="panelHomePro" style="display: inline-block; width: 100%;" id="atividadesPro" data-order="'+idOrder+'">'+
                                '   <div class="infraBarraLocalizacao titlePanelHome '+(iconLabel ? 'iconLabel' : '')+'">'+
                                '       <span class="titlePanel panelHome panelHomeAtividade" style="'+(getOptionsPro('panelHomeView') == 'Atividade' || !getOptionsPro('panelHomeView') ? '' : 'display:none;')+'">'+
                                '           <i class="fas fa-check-circle verdeColor" style="margin: 0 5px; font-size: 1.1em;"></i>'+
                                '           '+__.Demandas+
                                '       </span>'+
                                (checkCapacidade('view_afastamento') ? 
                                '       <span class="titlePanel panelHome panelHomeAfastamento" style="'+(getOptionsPro('panelHomeView') == 'Afastamento' ? '' : 'display:none;')+'">'+
                                '           <i class="fas fa-luggage-cart verdeColor" style="margin: 0 5px; font-size: 1.1em;"></i>'+
                                '           Afastamentos'+
                                '       </span>': '')+
                                (checkCapacidade('view_contato') ? 
                                '       <span class="titlePanel panelHome panelHomeContato" style="'+(getOptionsPro('panelHomeView') == 'Contato' ? '' : 'display:none;')+'">'+
                                '           <i class="fas fa-id-card verdeColor" style="margin: 0 5px; font-size: 1.1em;"></i>'+
                                '           Contatos'+
                                '       </span>': '')+
                                (checkCapacidade('view_relatorio') ? 
                                '       <span class="titlePanel panelHome panelHomeRelatorio" style="'+(getOptionsPro('panelHomeView') == 'Relatorio' ? '' : 'display:none;')+'">'+
                                '           <i class="fas fa-chart-pie verdeColor" style="margin: 0 5px; font-size: 1.1em;"></i>'+
                                '           Relat\u00F3rios'+
                                '       </span>': '')+
                                '       <span class="titlePanel panelHome panelHomeConfiguracao" style="'+(getOptionsPro('panelHomeView') == 'Configuracao' ? '' : 'display:none;')+'">'+
                                '           <i class="fas fa-cog verdeColor" style="margin: 0 5px; font-size: 1.1em;"></i>'+
                                '           Configura\u00E7\u00F5es'+
                                '       </span>'+
                                '       <a class="newLink" id="atividadesProDiv_showIcon" onclick="toggleTablePro(\'#atividadesProDiv\',\'show\'); getPanelAtividades_();" onmouseover="return infraTooltipMostrar(\'Mostrar Tabela\');" onmouseout="return infraTooltipOcultar();" style="font-size: 11pt; '+statusIconShow+'"><i class="fas fa-plus-square cinzaColor"></i></a>'+
                                '       <a class="newLink" id="atividadesProDiv_hideIcon" onclick="toggleTablePro(\'#atividadesProDiv\',\'hide\')" onmouseover="return infraTooltipMostrar(\'Recolher Tabela\');" onmouseout="return infraTooltipOcultar();" style="font-size: 11pt; '+statusIconHide+'"><i class="fas fa-minus-square cinzaColor"></i></a>'+
                                '   </div>'+
                                '   <div id="atividadesProDiv" style="width: 98%; '+statusView+'">'+
                                '   	<div id="atividadesProActions" class="panelHome panelHomeAtividade" style="'+(getOptionsPro('panelHomeView') == 'Atividade' || !getOptionsPro('panelHomeView') ? '' : 'display:none;')+' position: absolute; z-index: 19999; left: 200px; width: calc(100% - 220px)">'+
                                '           <div class="btn-group atividadesBtnPanel" role="group" style="float: right;margin-right: 10px;">'+
                                '              <button type="button" onclick="getPanelAtiv(this)" onmouseover="return _infraTooltipMostrar(this, \'Tabela\');" onmouseout="return infraTooltipOcultar();" data-value="Tabela" class="btn btn-sm btn-light '+(getOptionsPro('panelAtividadesView') == 'Tabela' || !getOptionsPro('panelAtividadesView') ? 'active' : '')+'"><i class="fas fa-table" style="color: #888;"></i> <span class="text">Tabela</span></button>'+
                                '              <button type="button" onclick="getPanelAtiv(this)" onmouseover="return _infraTooltipMostrar(this, \'Quadro\');" onmouseout="return infraTooltipOcultar();" data-value="Quadro" class="btn btn-sm btn-light '+(getOptionsPro('panelAtividadesView') == 'Quadro' ? 'active' : '')+'"><i class="fas fa-project-diagram" style="color: #888;"></i> <span class="text">Quadro</span></button>'+
                                '              <button type="button" onclick="getPanelAtiv(this)" onmouseover="return _infraTooltipMostrar(this, \'Cronograma\');" onmouseout="return infraTooltipOcultar();" data-value="Cronograma" class="btn btn-sm btn-light '+(getOptionsPro('panelAtividadesView') == 'Cronograma' ? 'active' : '')+'"><i class="fas fa-tasks" style="color: #888;"></i> <span class="text">Cronograma</span></button>'+
                                (checkCapacidade('chart_demandas') ?
                                '              <button type="button" onclick="getPanelAtiv(this)" data-value="Relatorio" onmouseover="return _infraTooltipMostrar(this, \'Relat\u00F3rio\');" onmouseout="return infraTooltipOcultar();" class="btn btn-sm btn-light '+(getOptionsPro('panelAtividadesView') == 'Relatorio' ? 'active' : '')+'"><i class="fas fa-chart-line" style="color: #888;"></i> <span class="text">Painel</span></button>'
                                : '')+
                                '           </div>'+
                                '           '+selectListPerfilLotacao+
                                '           <a class="newLink iconAtividade_update" onclick="updateAtividade_(this)" onmouseover="return infraTooltipMostrar(\'Atualizar Informa\u00E7\u00F5es\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt;float: right;">'+
                                '               <i class="fas fa-sync-alt"></i>'+
                                '           </a>'+
                                '           '+btnGuiaUtilizacao+
                                '   	</div>'+
                                (checkCapacidade('view_afastamento') ? 
                                '   	<div id="afastamentosProActions" class="panelHome panelHomeAfastamento" style="'+(getOptionsPro('panelHomeView') == 'Afastamento' ? '' : 'display:none;')+' position: absolute; z-index: 9999; left: 250px; width: calc(100% - 270px)">'+
                                '           <div class="btn-group" role="group" style="float: right;margin-right: 10px;">'+
                                '              <button type="button" onclick="getPanelAfast(this)" data-value="Tabela" class="btn btn-sm btn-light '+(getOptionsPro('panelAfastamentosView') == 'Tabela' || !getOptionsPro('panelAfastamentosView') ? 'active' : '')+'">Tabela</button>'+
                                '              <button type="button" onclick="getPanelAfast(this)" data-value="Cronograma" class="btn btn-sm btn-light '+(getOptionsPro('panelAfastamentosView') == 'Cronograma' ? 'active' : '')+'">Cronograma</button>'+
                                '           </div>'+
                                '           '+selectListPerfilLotacao+
                                '           <a class="newLink iconAtividade_update" onclick="updateAtividade_(this)" onmouseover="return infraTooltipMostrar(\'Atualizar Informa\u00E7\u00F5es\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt;float: right;">'+
                                '               <i class="fas fa-sync-alt"></i>'+
                                '           </a>'+
                                '           '+btnGuiaUtilizacao+
                                (checkCapacidade('save_afastamento') ?
                                '           <a class="newLink iconAfastamento_add" onclick="saveAfastamento(this)" onmouseover="return infraTooltipMostrar(\'Adicionar Afastamento\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt;">'+
                                '               <i class="fas fa-user-clock"></i>'+
                                '           </a>'+
                                '' : '')+
                                (checkCapacidade('delete_afastamento') ?
                                '           <a class="newLink iconAfastamento_remove" onclick="removeAfastamento(this)" onmouseover="return infraTooltipMostrar(\'Remover Afastamentos\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt; display: none">'+
                                '                   <span class="fa-layers fa-fw">'+
                                '                       <i class="fas fa-trash-alt"></i>'+
                                '                       <span class="fa-layers-counter">1</span>'+
                                '                   </span>'+
                                '           </a>'+
                                '' : '')+
                                '           <span class="modulesActions">'+
                                '               <a class="newLink newLink_active iconBoxModules iconAtividade_view" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Atividade">'+
                                '                  <i class="fas fa-chevron-left cinzaColor"></i>'+
                                '                  <i class="fas fa-check-circle cinzaColor"></i>'+
                                '                  <span class="txt_cinza" style="font-size: 80%;vertical-align: text-top;"> '+__.Demandas+'</span>'+
                                '               </a>'+
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconConfiguracao_view" onmouseover="return infraTooltipMostrar(\'Configura\u00E7\u00F5es\');" onmouseout="return infraTooltipOcultar();" onclick="'+(checkOptionEntidade('modal_configuracoes') ? 'openModalConfigPanel()' : 'changePanelHome(this)')+'" style="font-size: 14pt;" data-value="Configuracao">'+
                                '                  <i class="fas fa-cog cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Configura\u00E7\u00F5es</span>'+
                                '               </a>'+
                                (checkCapacidade('view_relatorio') ? 
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconRelatorio_view" onmouseover="return infraTooltipMostrar(\'Relat\u00F3rios\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Relatorio">'+
                                '                  <i class="fas fa-chart-pie cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Relat\u00F3rios</span>'+
                                '               </a>' : '')+
                                (checkCapacidade('view_contato') ? 
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconContato_view" onmouseover="return infraTooltipMostrar(\'Contatos\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Contato">'+
                                '                  <i class="fas fa-id-card cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Contatos</span>'+
                                '               </a>' : '')+
                                '           </span>'+
                                '   	</div>': '')+
                                (checkCapacidade('view_contato') ? 
                                '   	<div id="contatosProActions" class="panelHome panelHomeContato" style="'+(getOptionsPro('panelHomeView') == 'Contato' ? '' : 'display:none;')+' position: absolute; z-index: 9999; left: 250px; width: calc(100% - 270px)">'+
                                '           '+selectListPerfilLotacao+
                                '           <a class="newLink iconAtividade_update" onclick="updateAtividade_(this)" onmouseover="return infraTooltipMostrar(\'Atualizar Informa\u00E7\u00F5es\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt;float: right;">'+
                                '               <i class="fas fa-sync-alt"></i>'+
                                '           </a>'+
                                '           '+btnGuiaUtilizacao+
                                '           <span class="modulesActions">'+
                                '               <a class="newLink newLink_active iconBoxModules iconAtividade_view" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Atividade">'+
                                '                  <i class="fas fa-chevron-left cinzaColor"></i>'+
                                '                  <i class="fas fa-check-circle cinzaColor"></i>'+
                                '                  <span class="txt_cinza" style="font-size: 80%;vertical-align: text-top;"> '+__.Demandas+'</span>'+
                                '               </a>'+
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconConfiguracao_view" onmouseover="return infraTooltipMostrar(\'Configura\u00E7\u00F5es\');" onmouseout="return infraTooltipOcultar();" onclick="'+(checkOptionEntidade('modal_configuracoes') ? 'openModalConfigPanel()' : 'changePanelHome(this)')+'" style="font-size: 14pt;" data-value="Configuracao">'+
                                '                  <i class="fas fa-cog cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Configura\u00E7\u00F5es</span>'+
                                '               </a>'+
                                (checkCapacidade('view_relatorio') ? 
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconRelatorio_view" onmouseover="return infraTooltipMostrar(\'Relat\u00F3rios\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Relatorio">'+
                                '                  <i class="fas fa-chart-pie cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Relat\u00F3rios</span>'+
                                '               </a>' : '')+
                                (checkCapacidade('view_afastamento') ? 
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconAfastamento_view" onmouseover="return infraTooltipMostrar(\'Afastamentos\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Afastamento">'+
                                '                  <i class="fas fa-luggage-cart cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Afastamento</span>'+
                                '               </a>' : '')+
                                '           </span>'+
                                '   	</div>': '')+
                                '   	<div id="configuracoesProActions" class="panelHome panelHomeConfiguracao" style="'+(getOptionsPro('panelHomeView') == 'Configuracao' ? '' : 'display:none;')+' position: absolute; z-index: 9999; left: 240px; width: calc(100% - 260px)">'+
                                '           '+selectListPerfilLotacao+
                                '           <a class="newLink iconAtividade_update" onclick="updateAtividade_(this)" onmouseover="return infraTooltipMostrar(\'Atualizar Informa\u00E7\u00F5es\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt;float: right;">'+
                                '               <i class="fas fa-sync-alt"></i>'+
                                '           </a>'+
                                '           '+btnGuiaUtilizacao+
                                (checkCapacidade('config_atividades') ? getHtmlActionsConfig('atividades') : '')+
                                (checkCapacidade('config_planos') || checkCapacidade('config_self_planos') ? getHtmlActionsConfig('planos') : '')+
                                (checkCapacidade('config_termos') || checkCapacidade('config_self_termos') ? getHtmlActionsConfig('termos') : '')+
                                (checkCapacidade('config_programas') ? getHtmlActionsConfig('programas') : '')+
                                (checkCapacidade('config_users') ? getHtmlActionsConfig('users') : '')+
                                (checkCapacidade('config_unidades') ? getHtmlActionsConfig('unidades') : '')+
                                (checkCapacidade('config_cadeia_valor') ? getHtmlActionsConfig('cadeia_valor') : '')+
                                (checkCapacidade('config_tipos_prescricoes') ? getHtmlActionsConfig('tipos_prescricoes') : '')+
                                (checkCapacidade('config_tipos_metadados') ? getHtmlActionsConfig('tipos_metadados') : '')+
                                (checkCapacidade('config_tipos_documentos') ? getHtmlActionsConfig('tipos_documentos') : '')+
                                (checkCapacidade('config_tipos_requisicoes') ? getHtmlActionsConfig('tipos_requisicoes') : '')+
                                (checkCapacidade('config_tipos_justificativas') ? getHtmlActionsConfig('tipos_justificativas') : '')+
                                (checkCapacidade('config_tipos_modalidades') ? getHtmlActionsConfig('tipos_modalidades') : '')+
                                (checkCapacidade('config_tipos_motivos') ? getHtmlActionsConfig('tipos_motivos') : '')+
                                (checkCapacidade('config_tipos_capacidades') ? getHtmlActionsConfig('tipos_capacidades') : '')+
                                (checkCapacidade('config_perfis') ? getHtmlActionsConfig('perfis') : '')+
                                (checkCapacidade('config_nomenclaturas') ? getHtmlActionsConfig('nomenclaturas') : '')+
                                (checkCapacidade('config_entidades') ? getHtmlActionsConfig('entidades') : '')+
                                '           <span class="modulesActions">'+
                                '               <a class="newLink newLink_active iconBoxModules iconAtividade_view" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Atividade">'+
                                '                  <i class="fas fa-chevron-left cinzaColor"></i>'+
                                '                  <i class="fas fa-check-circle cinzaColor"></i>'+
                                '                  <span class="txt_cinza" style="font-size: 80%;vertical-align: text-top;"> '+__.Demandas+'</span>'+
                                '               </a>'+
                                (checkCapacidade('view_afastamento') ? 
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconAfastamento_view" onmouseover="return infraTooltipMostrar(\'Afastamentos\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Afastamento">'+
                                '                  <i class="fas fa-luggage-cart cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Afastamentos</span>'+
                                '               </a>' : '')+
                                (checkCapacidade('view_contato') ? 
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconContato_view" onmouseover="return infraTooltipMostrar(\'Contatos\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Contato">'+
                                '                  <i class="fas fa-id-card cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Contatos</span>'+
                                '               </a>' : '')+
                                (checkCapacidade('view_relatorio') ? 
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconRelatorio_view" onmouseover="return infraTooltipMostrar(\'Relat\u00F3rios\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Relatorio">'+
                                '                  <i class="fas fa-chart-pie cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Relat\u00F3rios</span>'+
                                '               </a>' : '')+
                                '           </span>'+
                                '   	</div>'+
                                '   	<div id="relatoriosProActions" class="panelHome panelHomeRelatorio" style="'+(getOptionsPro('panelHomeView') == 'Relatorio' ? '' : 'display:none;')+' position: absolute; z-index: 9999; left: 240px; width: calc(100% - 260px)">'+
                                '           <div class="btn-group" role="group" style="float: right;margin-right: 10px;">'+
                                '              <button type="button" onclick="getPanelRelatorio(this)" data-value="Tabela" class="btn btn-sm btn-light '+(getOptionsPro('panelRelatoriosView') == 'Tabela' || !getOptionsPro('panelRelatoriosView') ? 'active' : '')+'">Tabela</button>'+
                                '              <button type="button" onclick="getPanelRelatorio(this)" data-value="Grafico" class="btn btn-sm btn-light '+(getOptionsPro('panelRelatoriosView') == 'Grafico' ? 'active' : '')+'">Gr\u00E1fico</button>'+
                                '           </div>'+
                                '           '+selectListPerfilLotacao+
                                '           <a class="newLink iconAtividade_update" onclick="updateAtividade_(this)" onmouseover="return infraTooltipMostrar(\'Atualizar Informa\u00E7\u00F5es\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt;float: right;">'+
                                '               <i class="fas fa-sync-alt"></i>'+
                                '           </a>'+
                                '           '+btnGuiaUtilizacao+
                                '           <span class="modulesActions">'+
                                '               <a class="newLink newLink_active iconBoxModules iconAtividade_view" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Atividade">'+
                                '                  <i class="fas fa-chevron-left cinzaColor"></i>'+
                                '                  <i class="fas fa-check-circle cinzaColor"></i>'+
                                '                  <span class="txt_cinza" style="font-size: 80%;vertical-align: text-top;"> '+__.Demandas+'</span>'+
                                '               </a>'+
                                (checkCapacidade('view_afastamento') ? 
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconAfastamento_view" onmouseover="return infraTooltipMostrar(\'Afastamentos\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Afastamento">'+
                                '                  <i class="fas fa-luggage-cart cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Afastamentos</span>'+
                                '               </a>' : '')+
                                (checkCapacidade('view_contato') ? 
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconContato_view" onmouseover="return infraTooltipMostrar(\'Contatos\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Contato">'+
                                '                  <i class="fas fa-id-card cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Contatos</span>'+
                                '               </a>' : '')+
                                '               <a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconConfiguracao_view" onmouseover="return infraTooltipMostrar(\'Configura\u00E7\u00F5es\');" onmouseout="return infraTooltipOcultar();" onclick="'+(checkOptionEntidade('modal_configuracoes') ? 'openModalConfigPanel()' : 'changePanelHome(this)')+'" style="font-size: 14pt;" data-value="Configuracao">'+
                                '                  <i class="fas fa-cog cinzaColor"></i>'+
                                '                  <span class="newIconTitle">Configura\u00E7\u00F5es</span>'+
                                '               </a>'+
                                '           </span>'+
                                '   	</div>'+
                                '   	<div class="panelInfoHome panelInfoHomeAtividade" style="'+(getOptionsPro('panelHomeView') == 'Atividade' || !getOptionsPro('panelHomeView') ? '' : 'display:none;')+'">'+
                                '   	    <div id="tabelaAtivPanel" class="tabelaPanelScroll" style="margin-top: 40px;">'+
                                '               '+htmlTableAtividades+
                                '   	    </div>'+
                                '   	    <div id="ganttAtivPanel" class="ganttAtividade" style="max-width: 800px; display:none; padding-top: 20px; position: relative;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '   	    <div id="kanbanAtivPanel" class="kanbanAtividade" style="display:none; padding-top: 50px; position: relative;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '   	    <div id="chartAtivPanel" class="chartAtividade" style="display:none; padding-top: 20px; position: relative;">'+
                                '   	        <div id="chartAtivActions" class="chartAtivPanelDiv" style="width: 100%;position: absolute;right: 0;z-index: 99;">'+
                                '   	            '+selectListUsers+selectListProgramas+
                                '   	        </div>'+
                                '   	        <div id="tabChartAtivPanel" style="border: none; min-height: 300px; margin: 0;">'+
                                '                   <ul>'+
                                '                      <li><a href="#tabChartAtivPanel-distribuicao"><i class="fas fa-list-alt cinzaColor" style="margin-right: 5px;"></i> Distribui\u00E7\u00E3o</a></li>'+
                                '                      <li><a href="#tabChartAtivPanel-entregas"><i class="fas fa-list-alt cinzaColor" style="margin-right: 5px;"></i> Entregas</a></li>'+
                                '                      <li><a href="#tabChartAtivPanel-documentos"><i class="fas fa-list-alt cinzaColor" style="margin-right: 5px;"></i> Documentos Produzidos</a></li>'+
                                (checkCapacidade('chart_produtividade') ? 
                                '                       <li><a href="#tabChartAtivPanel-produtividade"><i class="fas fa-list-alt cinzaColor" style="margin-right: 5px;"></i> Produtividade</a></li>'+
                                '' : '')+
                                '                   </ul>'+
                                '                   <div id="tabChartAtivPanel-distribuicao" class="" style="overflow-x: scroll; padding: 0;">'+
                                '                       <div style="position: relative;">'+
                                '                           <div class="chartSection tabelaPanelScroll" id="chartSectionDistribuicao" style="height: 500px;">'+
                                '                               <div id="chartAtivPanelDemandas" class="chartAtivPanelDiv" style="width: 30%; float: left;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '                               <div id="chartAtivPanelPlanos" class="chartAtivPanelDiv" style="width: 70%; float: right;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '                          </div>'+
                                '                       </div>'+
                                '                   </div>'+
                                '                   <div id="tabChartAtivPanel-entregas" class="" style="overflow-x: scroll; padding: 0;">'+
                                '                       <div id="chartAtivPanelEstoque" class="chartAtivPanelDiv" style="width: 23%; float: left; clear: both;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '                       <div id="chartAtivPanelStatusEntregas" class="chartAtivPanelDiv" style="width: 23%; float: left;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '                       <div id="chartAtivPanelProcessuais" class="chartAtivPanelDiv" style="width: 23%; float: left;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '                       <div id="chartAtivPanelMediaTempo" class="chartAtivPanelDiv" style="width: 31%; float: left;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '                   </div>'+
                                '                   <div id="tabChartAtivPanel-documentos" class="" style="overflow-x: scroll; padding: 0;">'+
                                '                       <div id="chartAtivPanelRequisicoes" class="chartAtivPanelDiv" style="width: 25%; float: left; clear: both;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '                       <div id="chartAtivPanelDocumentos" class="chartAtivPanelDiv" style="width: 25%; float: left;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '                   </div>'+
                                (checkCapacidade('chart_produtividade') ? 
                                '                   <div id="tabChartAtivPanel-produtividade" class="" style="overflow-x: scroll; padding: 0;">'+
                                '                       <div id="chartAtivPanelProdutividade" class="chartAtivPanelDiv" style="width: 45%; float: left; clear: both;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '                       <div id="chartAtivPanelProdutividadeMes" class="chartAtivPanelDiv" style="width: 45%; float: right;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '                   </div>'+
                                '' : '')+
                                '   	        </div>'+
                                '   	    </div>'+
                                '   	</div>'+
                                (checkCapacidade('view_afastamento') ? 
                                '   	<div class="panelInfoHome panelInfoHomeAfastamento" style="'+(getOptionsPro('panelHomeView') == 'Afastamento' ? '' : 'display:none;')+'">'+
                                '   	    <div id="ganttAfastamentoPanel" class="afastamentoPanelPro" style="max-width: 800px; display:none; padding-top: 20px; position: relative;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '   	    <div id="tableAfastamentoPanel" class="tabelaPanelScroll afastamentoPanelPro" style="margin-top: 10px; display:none !important;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '   	    <div id="reportAfastamentoPanel" class="afastamentoPanelPro" style="margin-top: 10px; display:none !important;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '   	</div>' : '')+
                                (checkCapacidade('view_contato') ? 
                                '   	<div class="panelInfoHome panelInfoHomeContato" style="'+(getOptionsPro('panelHomeView') == 'Contato' ? '' : 'display:none;')+'">'+
                                '   	    <div id="tableContatoPanel" class="tabelaPanelScroll contatoPanelPro" style="margin-top: 10px;padding-left: 50px; display:none !important;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '   	</div>' : '')+
                                (checkCapacidade('view_relatorio') ? 
                                '   	<div class="panelInfoHome panelInfoHomeRelatorio" style="'+(getOptionsPro('panelHomeView') == 'Relatorio' ? '' : 'display:none;')+'">'+
                                '   	    <div id="tableRelatorioPanel" class="relatorioPanelPro" style="display:none; margin-top: 10px; display:none !important;"><div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                                '   	    <div id="chartRelatorioPanel" class="relatorioPanelPro" style="display:none; padding-top: 20px; position: relative;">'+
                                (checkOptionEntidade('painel_bi') ?
                                '               <iframe id="chartRelatorioPanelBI"></iframe>'+
                                '' : '               <div class="dataFallback" data-text="Em constru\u00E7\u00E3o"></div>')+
                                '           </div>'+
                                '   	</div>' : '')+
                                '   	<div class="panelInfoHome panelInfoHomeConfiguracao" style="border:none; '+(getOptionsPro('panelHomeView') == 'Configuracao' ? '' : 'display:none;')+'">'+
                                '   	</div>'+
                                '   </div>'+
                                '</div>';

    if ( $('#atividadesPro').length > 0 ) { $('#atividadesPro').remove(); }
    orderDivPanel(htmlPanelAtividades, idOrder, 'atividadesPro');

    if (getOptionsPro('panelSortPro')) {
        initSortDivPanel();
    }

    if (!getOptionsPro('panelHeight_atividadesPro') && $('#tabelaAtivPanel').height() > 800) { setOptionsPro('panelHeight_atividadesPro', 800) }
    if (!getOptionsPro('panelHomeView') || getOptionsPro('panelHomeView') == 'Atividade') {  
        initFunctionsPanelAtiv();
    }
    if (sessionStorageRestorePro('configDataAtividadesHTML') !== null) {
        $('#tabelaAtivPanel table tbody').html(sessionStorageRestorePro('configDataAtividadesHTML'));
        setAtividadesUser();
        initFunctionsPanelAtiv();
        setTimeout(function(){ 
            $('.tableAtividades').trigger('update');
            if (typeof $().chosen !== 'undefined' && $('#selectViewControl_tabelaAtivPanel_chosen').length == 0) {
                $('#selectViewControl_tabelaAtivPanel').chosen({
                    placeholder_text_single: ' ',
                    no_results_text: 'Nenhum resultado encontrado'
                });
                forcePlaceHoldChosen();
                setResizeAreaTelaD();
            }
        }, 1000);
    } else if (typeof storeAtividades !== 'undefined' && storeAtividades !== null && storeAtividades) {
        getRowsPanelAtividades(storeAtividades, $('#tabelaAtivPanel table tbody'));
    }
    initPanelAtividadesView();
}
function getBtnActionsAtividade(value, more_options = false) {
    var iconAtivEditHtml = actionsAtividade(value.id_demanda, 'icon', 'start');
    var btnActionAtiv = (iconAtivEditHtml && iconAtivEditHtml.hasOwnProperty('icon')) 
                ?   '<span class="info_dates_extend" style="display:block; padding: 0;opacity: 1;min-width: max-content;">'+
                    '   <a class="newLink info_noclick" style="font-size: 9pt;" onclick="parent.actionsAtividade('+value.id_demanda+', \'action\')">'+
                    '       <i class="'+iconAtivEditHtml.icon+'" style="padding-right: 3px;"></i>'+
                    '       '+iconAtivEditHtml.name+
                    '   </a>'+
                    (more_options ?
                    '   <a class="newLink info_noclick" onclick="parent.initToolbarFunc(this)" style="font-size: 9pt; margin:0;" data-index="'+value.id_demanda+'">'+
                    '       <i class="fas fa-ellipsis-v"></i>'+
                    '   </a>' : '')+
                    '</span>'
                : '';
        btnActionAtiv = (checkPermissionAtiv(value)) ? btnActionAtiv : '';
    return btnActionAtiv;
}
function awaitRowsPanelAtividades(id_demanda) {
    $('#tabelaAtivPanel tr[data-index="'+id_demanda+'"] td[data-type="action"] a[onclick*="actionsAtividade"] i').attr('class','fas fa-spinner fa-spin fa-pulse');
    $('#kanbanAtivPanel .kanban-item[data-eid="_id_'+id_demanda+'"] .drag_handler_icon').attr('class','fas fa-spinner fa-spin fa-pulse').css({'font-size': '160%', 'color': '#4385f4', 'margin-top': '5px'});
}
function getRowsPanelAtividades(storeAtividades, target) {
    function setRowsPanelAtividades(value, index) {
        var tagsAtiv = (typeof value.etiquetas !== 'undefined' && value.etiquetas !== null) ? value.etiquetas.join(';') : '';
        var tagsAtivHtml = (typeof value.etiquetas !== 'undefined' && value.etiquetas !== null) ? $.map(storeAtividades[index].etiquetas, function (i) { return getHtmlEtiqueta(i,'ativ') }).join('') : '';
        var tagsAtivClass = (typeof value.etiquetas !== 'undefined' && value.etiquetas !== null) ? $.map(storeAtividades[index].etiquetas, function (i) { return 'tagTableName_'+normalizeNameTag(i); }).join(' ') : '';   
        var tagsAtivPriority = (tagsAtivClass.indexOf('tagTableName_importante') !== -1) ? 'importanteBoxDisplay' : '';
            tagsAtivPriority = (tagsAtivClass.indexOf('tagTableName_urgente') !== -1) ? 'urgenteBoxDisplay' : tagsAtivPriority;
        var tagPacto =  getTagTempoPactuadoAtiv(value);
        var timerAtiv = (value.data_inicio != '0000-00-00 00:00:00' && value.data_entrega == '0000-00-00 00:00:00')
                        ? getTagTempoDecorridoAtiv(value, false)
                        : (value.data_entrega != '0000-00-00 00:00:00' && value.data_avaliacao == '0000-00-00 00:00:00') 
                            ? getTagTempoDespendidoAtiv(value, false)
                            : '';
            timerAtiv = (!checkOptionEntidade('desativa_produtividade_geral')) ? timerAtiv : '';
        var datesAtivHtml = (typeof value.data_distribuicao !== 'undefined' && value.data_distribuicao !== null) ? getDatesPreview(getConfigDateAtiv(value)) : '';
        var tagDatesAtivClass = (datesAtivHtml != '') ? 'tagTableName_'+$(datesAtivHtml).data('tagname') : '';
        var nameUser = (value.id_user != 0 ? value.apelido : 'N\u00E3o atribu\u00EDdo');
        var tagName_user = normalizeNameTag(nameUser);
        var tagName_unidade = (countUnidades > 1) ? 'tagTableName_'+normalizeNameTag(value.sigla_unidade) : '';
        var ativEditHtml = getBtnActionsAtividade(value, true);
        var checklistHtml = (value.checklist && value.checklist.length > 0) ? getInfoAtividadeChecklist(value, 'icon') : '';

        function getTdRow(type) {
            var html = '';
            if (type == 'proc') {
                html =  '           <td align="left" data-type="proc">'+
                        '               '+getHtmlLinkRequisicao(value)+
                        '           </td>';
            } else if (type == 'date') {
                html =  '           <td align="left" data-type="date">'+
                        '               <span class="info_dates_fav">'+datesAtivHtml+'</span>'+
                        '           </td>';
            } else if (type == 'action') {
                html =  '           <td align="left" data-type="action">'+
                        '               '+ativEditHtml+
                        '           </td>';
            } else if (type == 'user') {
                html =  '           <td align="left" data-type="user">'+
                        '               <span class="info_tags_follow info_tags_user">'+getHtmlEtiquetaUnidade(value)+'</span>'+tagPacto+timerAtiv+
                        '               '+checklistHtml+
                        '           </td>';
            } else if (type == 'etiqueta') {
                html =  '           <td align="left" data-type="etiqueta" class="tdfav_tags '+((tagsAtivHtml.trim() == '' && checkCapacidade('edit_etiqueta') ) ? 'info_tags_follow_empty' : '')+'" data-etiqueta-mode="ativ">'+
                        '               <span class="info_tags_follow">'+tagsAtivHtml+
                        '               </span>'+(!checkCapacidade('edit_etiqueta') ? '' : 
                        '               <span class="info_tags_follow_txt" style="display:none">'+
                        '                   <input value="'+tagsAtiv+'" class="atividadeTagsPro">'+
                        '               </span>'+
                        '               <a class="newLink followLink followLinkTags followLinkTagsEdit" onclick="showFollowEtiqueta(this, \'show\', \'ativ\')" onmouseover="return infraTooltipMostrar(\'Editar etiqueta\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-edit" style="font-size: 100%;"></i></a>'+
                        '               <a class="newLink followLink followLinkTags followLinkTagsAdd" onclick="showFollowEtiqueta(this, \'show\', \'ativ\')" onmouseover="return infraTooltipMostrar(\'Adicionar etiqueta\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-tags" style="font-size: 100%;"></i></a>')+
                        '           </td>';
            } else if (type == 'desc') {
                html =  '           <td class="content_desc" data-type="desc">'+
                        '               <div class="txt_cinza">'+(value.nome_atividade ? value.nome_atividade : '')+'</div>'+
                        '               <div class="content_edit" data-field="assunto" style="position:relative;" data-id="'+value.id_demanda+'">'+
                        '                   <span class="info" style="font-weight: bold;display: block;margin-top: 5px;width: 96%;padding: 0 0 0 5px;">'+value.assunto+'</span>'+
                        '                   '+(checkCapacidade('edit_field') && checkPermissionAtiv(value) && checkCapacidade('edit_assunto') ? '<a class="newLink newLink_active followLink followLinkDesc content_btnsave" onclick="editFieldAtiv(this)" style="right: 0;top: 0;" onmouseover="return infraTooltipMostrar(\'Editar '+__.assunto+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-edit" style="font-size: 100%;"></i></a>' : '')+
                        '               </div>'+
                        (value && value.observacao_gerencial !== null && value.observacao_gerencial != '' ? 
                        '               <div class="inlineAlert content_edit" data-field="observacao_gerencial" style="position:relative" data-id="'+value.id_demanda+'">'+
                        '                   <i class="fas fa-comment-alt" style="color: #7baaf7;position: absolute;"></i>'+
                        '                   <span class="info" style="text-indent: 20px;display: block;">'+replaceTextToProcessoSEI(replaceTextToUrl(value.observacao_gerencial))+'</span>'+
                        '                   '+(checkCapacidade('edit_field') && checkPermissionAtiv(value) && checkCapacidade('edit_observacao_gerencial') ? '<a class="newLink newLink_active followLink followLinkDesc content_btnsave" onclick="editFieldAtiv(this)" style="right: 0;top: 6px;" onmouseover="return infraTooltipMostrar(\'Editar '+__.Observacao+' '+__.Gerencial+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-edit" style="font-size: 100%;"></i></a>' : '')+
                        '               </div>'+
                        '' : '')+
                        (value && value.observacao_tecnica !== null && value.observacao_tecnica != '' ? 
                        '               <div class="inlineAlert content_edit" data-field="observacao_tecnica" style="position:relative" data-id="'+value.id_demanda+'">'+
                        '                   <i class="fas fa-reply-all" style="color: #7baaf7;position: absolute;"></i>'+
                        '                   <span class="info" style="text-indent: 20px;display: block;">'+replaceTextToProcessoSEI(replaceTextToUrl(value.observacao_tecnica))+'</span>'+
                        '                   '+(checkCapacidade('edit_field') && checkPermissionAtiv(value) && checkCapacidade('edit_observacao_tecnica') ? '<a class="newLink newLink_active followLink followLinkDesc content_btnsave" onclick="editFieldAtiv(this)" style="right: 0;top: 6px;" onmouseover="return infraTooltipMostrar(\'Editar '+__.Observacao+' '+__.Tecnica+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-edit" style="font-size: 100%;"></i></a>' : '')+
                        '               </div>'+
                        '' : '')+
                        '           </td>';
            }
            return html;
        }
        var arrayColumnSort = (getOptionsPro('panelAtividadesViewTableSort')) 
            ? getOptionsPro('panelAtividadesViewTableSort') 
            : [
                "proc",
                "date",
                "action",
                "user",
                "etiqueta",
                "desc"
            ];
        var htmlColumnsAtividades = $.map(arrayColumnSort, function(v){
                                        return getTdRow(v);
                                    }).join('');

        var htmlTableAtividades =   '       <tr data-tagname="SemGrupo" data-index="'+value.id_demanda+'" class="tagTableName_'+tagName_user+' '+tagName_unidade+' '+tagsAtivClass+' '+tagDatesAtivClass+' '+tagsAtivPriority+'">'+
                                    '           <td align="center">'+
                                    '               <input type="checkbox" onclick="followSelecionarItens(this)" id="atividadePro_'+value.id_demanda+'" name="atividadePro" value="'+value.id_procedimento+'">'+
                                    '           </td>'+
                                    '           '+htmlColumnsAtividades+
                                    '       </tr>';
        if (datesAtivHtml != '') {
            var iconDateAtiv = ($(datesAtivHtml).find('.dateBoxIcon').length > 0) ? $(datesAtivHtml).find('.dateBoxIcon').attr('onclick', 'actionsAtividade('+value.id_demanda+')')[0].outerHTML : '';
            $('.tabelaControle').find('#P'+value.id_procedimento).each(function(index){ 
                if (iconDateAtiv != '') { $(this).find('.atividadeBoxDisplay').append('<span class="dateboxDisplay" data-prazo-entrega="'+value.prazo_entrega+'">'+iconDateAtiv+'</span>') }
            });
        }
        var tr_demanda = target.find('tr[data-index="'+value.id_demanda+'"]');
        if (tr_demanda.length > 0) {
            tr_demanda.before(htmlTableAtividades).remove();
        } else {
            target.append(htmlTableAtividades);
        }
    }
    function initRowsPanelAtividades(index) {
        loadRowsPanelAtiv = true;
        target.trigger('updateAll');
        initFunctionsPanelAtiv();
        var totaldados = storeAtividades.length-1;
        var caption = $('#tabelaAtivPanel table').find('caption.infraCaption');
            caption.find('.progress').remove().end().append('<span class="progress" style="color: #777;font-size: 0.8em;padding: 5px;margin: 5px;"><i class="fas fa-sync fa-spin cinzaColor"></i> carregando dados... ('+index+'/'+totaldados+')</span>');
        if (totaldados <= index) {
            getHtmlTableAtiv();
            caption.find('.progress').remove();
            loadRowsPanelAtiv = false;
        }
        // console.log('endLoop rowsPanelAtividades', index, loadRowsPanelAtiv);
    }
    var countUnidades = (storeAtividades.length > 0) ? uniqPro(jmespath.search(storeAtividades, "[?sigla_unidade].sigla_unidade")).length : 0;
    var t = new Date();
    var limit = 100;
    storeAtividades.forEach(function (value, index) {
        if (index >= limit) {
            setTimeout(function(){
                setRowsPanelAtividades(value, index);
                if (storeAtividades.length-1 == index || index % 100 == 0) { 
                    initRowsPanelAtividades(index);
                }
            }, 50*index);
        } else {
            setRowsPanelAtividades(value, index);
            loadRowsPanelAtiv = false;
        }
    });
    if (storeAtividades.length <= limit) { initRowsPanelAtividades(100) }
}
function removeRowsPanelAtividades(id_demanda) {
    var tableAtiv = $('#tabelaAtivPanel table');
    var kanbanAtiv = $('#kanbanAtivPanel');
    var tr = tableAtiv.find('tr[data-index="'+id_demanda+'"]');

    if (tr.length > 0) {
        tr.remove();
    } else if (kanbanAtiv.is(':visible')) {
        var value = getAtividadeData(id_demanda);
        var item = getKanbanItem(value);
        kanbanAtividades.removeElement(item.id);
    }
    var objIndexAtiv = (typeof arrayAtividadesPro === 'undefined' || arrayAtividadesPro == 0 || arrayAtividadesPro.length == 0) ? -1 : arrayAtividadesPro.findIndex((obj => obj.id_demanda == id_demanda));
    if (objIndexAtiv !== -1) {
        arrayAtividadesPro.splice(objIndexAtiv, 1);
        hybridStorageStorePro('configDataAtividadesPro', arrayAtividadesPro);
        getHtmlTableAtiv();
        return true;
    } else {
        return false;
    }
}
function getHtmlTableAtiv() {
    var html = $('#tabelaAtivPanel table tbody').html();
    if (typeof html !== 'undefined' && html !== null && html != '') {
        sessionStorageStorePro('configDataAtividadesHTML', html);
    }
}
function getHtmlLinkRequisicao(value, onclick = false) {
    var linkDoc = (value.data_entrega == '0000-00-00 00:00:00') 
                    ? url_host+'?acao=procedimento_trabalhar&id_procedimento='+value.id_procedimento+'&id_documento='+value.id_documento_requisicao 
                    : url_host+'?acao=procedimento_trabalhar&id_procedimento='+value.id_procedimento+'&id_documento='+value.id_documento_entregue;
    var documentoTips = (typeof value.documento_sei !== 'undefined' && value.documento_sei !== null && parseInt(value.documento_sei) != 0) ? (value.nome_documento ? value.nome_documento : '')+' ('+value.documento_sei+')' : (value.nome_documento ? value.nome_documento : '');
    var requisicaoTips = (typeof value.requisicao_sei !== 'undefined' && value.requisicao_sei !== null && parseInt(value.requisicao_sei) != 0) ? (value.nome_requisicao ? value.nome_requisicao : '')+' ('+value.requisicao_sei+')' : (value.nome_requisicao ? value.nome_requisicao : '');
        requisicaoTips = (value.data_entrega == '0000-00-00 00:00:00') ? (requisicaoTips != '' ? 'Requisi\u00E7\u00E3o: '+requisicaoTips : '') : (documentoTips != '' ? 'Entrega: '+documentoTips : '');
    var iconProcesso = (arrayProcessosUnidade && $.inArray(value.processo_sei, arrayProcessosUnidade) == -1 ) ? 'fas fa-folder' : 'far fa-folder-open';
    var tipsProcesso = (arrayProcessosUnidade && $.inArray(value.processo_sei, arrayProcessosUnidade) == -1 ) ? 'Processo fechado nesta unidade' : 'Processo aberto nesta unidade';
        tipsProcesso = (!arrayProcessosUnidade) ? '' : tipsProcesso;
    var iconRequisicao = (value.data_entrega == '0000-00-00 00:00:00') ? 'far fa-list-alt' : 'fas fa-list-alt'; 
    var onclickLink = (onclick) ? 'onclick="openLinkNewTab(\''+linkDoc+'\')"' : '';
    var newTabLink = (onclick) ? '' : '<a class="newLink followLink followLinkNewtab" href="'+linkDoc+'" onmouseover="return infraTooltipMostrar(\'Abrir em nova aba\');" onmouseout="return infraTooltipOcultar();" target="_blank"><i class="fas fa-external-link-alt" style="font-size: 90%; text-decoration: underline;"></i></a>';
    var processoHtml = (value.processo_sei !== null && value.processo_sei != '')
                          ? ''+
                            '               '+newTabLink+
                            '               <a style="text-decoration: underline;" class="bLink" href="'+linkDoc+'" '+onclickLink+'>'+
                            '                   <i class="'+iconProcesso+' bLink" style="text-decoration: underline;" onmouseover="return infraTooltipMostrar(\''+tipsProcesso+'\');" onmouseout="return infraTooltipOcultar();"></i> '+
                            '                   <span class="bLink" onmouseover="return infraTooltipMostrar(\''+requisicaoTips+'\');" onmouseout="return infraTooltipOcultar();"></i> '+
                            '                       '+value.processo_sei+
                            '                       '+(onclick ? '<i class="fas fa-external-link-alt bLink" style="font-size: 80%;text-decoration: underline;vertical-align: text-top;"></i>' : '')+
                            '                   </span>'+
                            '               </a>'+
                            ''
                          : '               <a style="text-decoration: underline;" class="bLink" '+onclickLink+'>'+
                            '                   <i class="'+iconRequisicao+' bLink" style="text-decoration: underline;" onmouseover="return infraTooltipMostrar(\''+requisicaoTips+'\');" onmouseout="return infraTooltipOcultar();"></i> '+
                            '                   <span class="bLink" onmouseover="return infraTooltipMostrar(\''+requisicaoTips+'\');" onmouseout="return infraTooltipOcultar();"></i> '+
                            '                       '+value.nome_requisicao+(value.requisicao_sei ? ' '+value.requisicao_sei : '')+
                            '                   </span>'+
                            '               </a>';
        processoHtml = (value.id_tipo_requisicao == 0 && value.id_procedimento == 0) ? '' : processoHtml;
        processoHtml = '<div class="type-id">#'+value.id_demanda+'</div>'+processoHtml;
    return processoHtml;
}
function getHtmlActionsConfig(type) {
    var param = (type == 'atividades') ? {name_new: 'Novo Tipo de '+__.Atividade, name: 'Tipo de '+__.Atividade, icon: 'fas fa-clipboard-list', index: 1} : '';
        param = (type == 'planos') ? {name_new: 'Novo Plano de Trabalho', name: 'Plano de Trabalho', icon: 'fas fa-handshake', index: 2} : param;
        param = (type == 'termos') ? {name_new: 'Novo Termo de Ci\u00EAncia e Responsabilidade', name: 'Termo de Ci\u00EAncia e Responsabilidade', icon: 'fas fa-file-signature', index: 3} : param;
        param = (type == 'programas') ? {name_new: 'Novo Programa de Gest\u00E3o', name: 'Programa de Gest\u00E3o', icon: 'fas fa-cubes', index: 4} : param;
        param = (type == 'users') ? {name_new: 'Novo Usu\u00E1rio', name: 'Usu\u00E1rios', icon: 'fas fa-users', index: 5} : param;
        param = (type == 'unidades') ? {name_new: 'Nova Unidade', name: 'Unidades', icon: 'fas fa-briefcase', index: 6} : param;
        param = (type == 'cadeia_valor') ? {name_new: 'Novo Processo', name: 'Cadeia de Valor', icon: 'fas fa-share-alt', index: 7} : param;
        param = (type == 'tipos_prescricoes') ? {name_new: 'Novo Tipo de '+__.Prescricao+'', name: __.Prescricao, icon: 'fas fa-history', index: 8} : param;
        param = (type == 'tipos_metadados') ? {name_new: 'Novo Tipo de Metadado', name: 'Tipo de Metadado', icon: 'fas fa-dice-d6', index: 9} : param;
        param = (type == 'tipos_documentos') ? {name_new: 'Novo Tipo de Documento', name: 'Tipo de Documento', icon: 'fas fa-file-alt', index: 10} : param;
        param = (type == 'tipos_requisicoes') ? {name_new: 'Novo Tipo de Requisi\u00E7\u00E3o', name: 'Tipo de Requisi\u00E7\u00E3o', icon: 'fas fa-inbox', index: 11} : param;
        param = (type == 'tipos_justificativas') ? {name_new: 'Novo Tipo de Justificativa de Avalia\u00E7\u00E3o', name: 'Tipo de Justificativa', icon: 'fas fa-star', index: 12} : param;
        param = (type == 'tipos_modalidades') ? {name_new: 'Novo Tipo de Modalidade de Trabalho', name: 'Tipo de Modalidade', icon: 'fas fa-wrench', index: 13} : param;
        param = (type == 'tipos_motivos') ? {name_new: 'Novo Tipo de Motivo de Afastamento', name: 'Tipo de Motivo', icon: 'fas fa-luggage-cart', index: 14} : param;
        param = (type == 'tipos_capacidades') ? {name_new: 'Novo Tipo de Capacidade', name: 'Tipo de Capacidade', icon: 'fas fa-users-cog', index: 15} : param;
        param = (type == 'perfis') ? {name_new: 'Novo Tipo de Perfil', name: 'Tipo de Perfil', icon: 'fas fa-shield-alt', index: 16} : param;
        param = (type == 'nomenclaturas') ? {name_new: 'Nova Nomenclatura', name: 'Nomenclatura', icon: 'fas fa-ad', index: 17} : param;
        param = (type == 'entidades') ? {name_new: 'Nova Entidade', name: 'Entidades', icon: 'fas fa-university', index: 18} : param;

    var html =  '           <span class="actionsConfig_'+type+' actionsConfig_icons" '+(getOptionsPro('tabsPanelConfigActiveTabs') != param.index ? 'style="display:none"' : '')+'>'+
                (checkCapacidade('config_new_'+type) ? 
                '               <a class="newLink iconConfig_add iconConfig_confirm" data-icon="'+param.icon+' icon-parent" onclick="newConfig_(this)" data-type="'+type+'" data-mode="add" onmouseover="return infraTooltipMostrar(\'Adicionar '+param.name_new+'\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt;">'+
                '                   <span class="fa-layers fa-fw">'+
                '                       <i class="'+param.icon+' icon-parent"></i>'+
                '                       <i class="fas fa-plus-circle fa-layers-counter fa-layers-bottom"></i>'+
                '                   </span>'+
                '               </a>'+
                '' : '')+
                ( type == 'planos' && (checkCapacidade('config_update_planos') || checkCapacidade('config_update_self_planos') ) ? 
                '               <a class="newLink iconConfig_recalc" data-type="'+type+'" data-mode="recalc" data-id="0" onclick="updateCalcPlanos(this)" onmouseover="return infraTooltipMostrar(\'Recalcular horas de planos de trabalho\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt; display: none">'+
                '                   <span class="fa-layers fa-fw">'+
                '                       <i class="fas fa-calculator"></i>'+
                '                       <span class="fa-layers-counter">1</span>'+
                '                   </span>'+
                '               </a>'+
                '' : '')+
                ( type == 'planos' && checkCapacidade('config_update_planos') ? 
                '               <a class="newLink iconConfig_close" data-type="'+type+'" data-mode="close" data-id="0" onclick="closeConfig(this)" onmouseover="return infraTooltipMostrar(\'Encerrar antecipadamente planos de trabalho\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt; display: none">'+
                '                   <span class="fa-layers fa-fw">'+
                '                       <i class="fas fa-hourglass-end"></i>'+
                '                       <span class="fa-layers-counter">1</span>'+
                '                   </span>'+
                '               </a>'+
                '' : '')+
                ( type == 'atividades' && checkCapacidade('config_update_pgr') ? 
                '               <a class="newLink iconConfig_approve" data-type="'+type+'" data-mode="approve" data-id="0" onclick="approveConfig(this)" onmouseover="return infraTooltipMostrar(\'Homologar '+param.name+'\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt; display: none">'+
                '                   <span class="fa-layers fa-fw">'+
                '                       <i class="fas fa-thumbs-up azulColor"></i>'+
                '                       <span class="fa-layers-counter">1</span>'+
                '                   </span>'+
                '               </a>'+
                '               <a class="newLink iconConfig_disapprove" data-type="'+type+'" data-mode="disapprove" data-id="0" onclick="approveConfig(this)" onmouseover="return infraTooltipMostrar(\'Cancelar a Homologa&ccedil;&atilde;o de '+param.name+'\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt; display: none">'+
                '                   <span class="fa-layers fa-fw">'+
                '                       <i class="fas fa-thumbs-down vermelhoColor"></i>'+
                '                       <span class="fa-layers-counter">1</span>'+
                '                   </span>'+
                '               </a>'+
                '' : '')+
                ( (type != 'users' && checkCapacidade('config_update_'+type)) || (type == 'users' && checkCapacidade('config_users_all')) ? 
                '               <a class="newLink iconConfig_remove" data-type="'+type+'" data-mode="disable" data-id="0" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar '+param.name+'\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt; display: none">'+
                '                   <span class="fa-layers fa-fw">'+
                '                       <i class="fas fa-times-circle"></i>'+
                '                       <span class="fa-layers-counter">1</span>'+
                '                   </span>'+
                '               </a>'+
                '               <a class="newLink iconConfig_reactive" data-type="'+type+'" data-mode="reactive" data-id="0" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar '+param.name+'\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt; display: none">'+
                '                   <span class="fa-layers fa-fw">'+
                '                       <i class="fas fa-undo-alt"></i>'+
                '                       <span class="fa-layers-counter">1</span>'+
                '                   </span>'+
                '               </a>'+
                (checkCapacidade('config_new_'+type) ? 
                '               <a class="newLink iconConfig_clone" data-type="'+type+'" data-mode="clone" data-id="0" onclick="cloneConfig(this, event);" onmouseover="return infraTooltipMostrar(\'Duplicar '+param.name+'\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt; display: none">'+
                '                   <span class="fa-layers fa-fw">'+
                '                       <i class="fas fa-copy"></i>'+
                '                       <span class="fa-layers-counter">1</span>'+
                '                   </span>'+
                '               </a>'+
                '' : '')+
                '' : '')+
                '           </span>';
    return html;
}

function getSelectViewControl(panel) {
    var tabelaAtiv = $('#tabelaAtivPanel table.tableAtividades');

    var listUnidades = jmespath.search(arrayAtividadesPro, "[?sigla_unidade].sigla_unidade");
        listUnidades = (listUnidades !== null) ? uniqPro(listUnidades) : [];

    var listEtiquetas = jmespath.search(arrayAtividadesPro,"[*].etiquetas");
        listEtiquetas = (listEtiquetas !== null) ? uniqPro($.map(jmespath.search(arrayAtividadesPro,"[*].etiquetas"),function(v){ return v })) : [];

    var selectFilterKanban =    '<select id="selectViewControl_'+panel+'" style="min-width: 150px;" data-placeholder="Filtrar '+__.demandas+'" data-panel="'+panel+'" onchange="selectViewControl(this)" class="chosen-min">'+
                                '<option>&nbsp;</option>'+
                                '<optgroup label="por Usu\u00E1rio">';
        selectFilterKanban += $.map(uniqPro(jmespath.search(arrayAtividadesPro,"[*].apelido")),function(v){
                                var tagName = (v == '') ? 'N\u00E3o atribu\u00EDdo' : v;
                                var tagText = normalizeNameTag(tagName);
                                return '<option data-mode="atividades" data-bar="'+tagText+'" value="tagTableText_'+tagText+'">'+tagName+' ('+tabelaAtiv.find('tbody tr.tagTableName_'+tagText).length+')</option>';
                            }).join('');
    if (listUnidades.length > 1) {
        selectFilterKanban += '<optgroup label="por Unidades">';
        selectFilterKanban += $.map(uniqPro(listUnidades),function(v){
                                    var tagText = normalizeNameTag(v);
                                    return '<option data-mode="atividades" data-bar="'+tagText+'" value="tagTableText_'+tagText+'">'+v+' ('+tabelaAtiv.find('tbody tr.tagTableName_'+tagText).length+')</option>';
                                }).join('');
        selectFilterKanban +=   '</optgroup>';
    }
    if (listEtiquetas.length > 1) {
        selectFilterKanban += '<optgroup label="por Etiquetas">';
        selectFilterKanban += $.map(uniqPro(listEtiquetas),function(v){
                                    var tagText = normalizeNameTag(v);
                                    return '<option data-mode="atividades" data-bar="'+tagText+'" value="tagTableText_'+tagText+'">'+v+' ('+tabelaAtiv.find('tbody tr.tagTableName_'+tagText).length+')</option>';
                                }).join('');
        selectFilterKanban +=   '</optgroup>';
    }

        selectFilterKanban +=   '</optgroup>'+
                                '<optgroup label="por Status">'+
                                '   <option data-mode="atividades" data-bar="date_noprazo" value="tagTableText_date_noprazo">No prazo ('+tabelaAtiv.find('tbody tr.tagTableName_date_noprazo').length+')</option>'+
                                '   <option data-mode="atividades" data-bar="date_atrasado" value="tagTableText_date_atrasado">Atrasadas ('+tabelaAtiv.find('tbody tr.tagTableName_date_atrasado').length+')</option>'+
                                '   <option data-mode="atividades" data-bar="date_entregue" value="tagTableText_date_entregue">Entregues ('+tabelaAtiv.find('tbody tr.tagTableName_date_entregue').length+')</option>'+
                                '   <option data-mode="atividades" data-bar="date_avaliado" value="tagTableText_date_avaliado">Avaliadas ('+tabelaAtiv.find('tbody tr.tagTableName_date_avaliado').length+')</option>'+
                                '</optgroup>';
        selectFilterKanban +=   '</select>';
    return selectFilterKanban;
}
function selectViewControl(this_) {
    var _this = $(this_);
    var value = _this.val().trim();
    var modView = _this.data('panel');
    if (value != '' && modView != 'ganttAtivPanel') {
        $('#'+modView).find('.info_tags_follow, .info_dates_fav').find('.'+value).eq(0).click();
    } else if (value != '' && modView == 'ganttAtivPanel') {
        var data_bar = $(this_).find('option:selected').data('bar');
        var data_text = $(this_).find('option:selected').text();
        
        getGanttAtividades(data_bar);
        setOptionsPro('ganttAtividadesFilter', data_bar);
        $('.filterGanttTag .filterCustom').show().find('.bar-custom').addClass('active').removeClass('inative').attr('data-bar', data_bar).data('bar', data_bar).find('.text').text(data_text);
    }
    _this.val('').chosen("destroy").chosen({
        placeholder_text_single: ' ',
        no_results_text: 'Nenhum resultado encontrado'
    });
    forcePlaceHoldChosen();
}
function getAtividadeData(id_demanda) {
    var value = (id_demanda && id_demanda != 0) ? jmespath.search(arrayAtividadesPro, "[?id_demanda==`"+id_demanda+"`] | [0]") : false;
        value = (value === null && typeof arrayAtividadesProcPro !== 'undefined') ? jmespath.search(arrayAtividadesProcPro, "[?id_demanda==`"+id_demanda+"`] | [0]") : value;
        value = (value === null) ? false : value;
    return value;
}
function getHtmlEtiquetaUnidade(value) {
    var nameUser = (value.id_user != 0 ? value.apelido : 'N\u00E3o atribu\u00EDdo');
    var tagName_user = normalizeNameTag(nameUser);

    var listUnidades = jmespath.search(arrayAtividadesPro, "[?sigla_unidade].sigla_unidade");
        listUnidades = (listUnidades !== null) ? uniqPro(listUnidades) : [];
    var tagName_unidade = (listUnidades.length > 1) ? normalizeNameTag(value.sigla_unidade) : '';

    var htmlTagUnidade =  (listUnidades.length > 1)
                    ?   '<span data-colortag="#bfd5e8" data-type="user" style="background-color: #bfd5e8;" data-tagname="'+tagName_unidade+'" data-textcolor="black" data-icontag="briefcase" class="tag_text tagTableText_'+tagName_unidade+'" onclick="parent.filterTagView(this)">'+
                        '    <i data-colortag="#406987" class="fas fa-briefcase" style="font-size: 90%; margin: 0px 2px; color: #406987;"></i> '+value.sigla_unidade+
                        '</span>' 
                    :   '';

    var htmlTags =      '               <span class="info_tags_follow info_tags_user">'+htmlTagUnidade+
                        '                   <span data-colortag="#bfd5e8" data-type="user" data-tagname="'+tagName_user+'" data-textcolor="black" data-icontag="user" style="background-color: #bfd5e8;" class="tag_text tagTableText_'+tagName_user+'" onclick="parent.filterTagView(this)">'+
                        '                       <i data-colortag="#406987" class="fas fa-user" style="font-size: 90%; margin: 0px 2px; color: #406987;"></i> '+nameUser+
                        '                   </span>'+
                        '               </span>';
    return htmlTags;
}
function initPanelAtividadesView() {

    var namePanel = (getOptionsPro('panelHomeView')) ? getOptionsPro('panelHomeView') : 'Atividade';

    if (getOptionsPro('panelHomeView') == 'Atividade' || checkCapacidade('view_'+namePanel.toLowerCase())) {
        var viewModePanel = (getOptionsPro('panel'+namePanel+'sView')) ? getOptionsPro('panel'+namePanel+'sView') : 'Tabela';
        $('#'+namePanel.toLowerCase()+'sProActions').find('button[data-value="'+viewModePanel+'"].btn').trigger('click');
    }
    if ($('.panelInfoHomeConfiguracao').is(':visible')) {
        getTabsConfigPanel();
    } else if ($('.panelInfoHomeContato').is(':visible')) {
        getTableContatoPanel();
    } 
}
function removeLocalDataAtiv(force = false) {
    removeLocalDataConfigArray();
    localStorageRemovePro('lastUpdateAtividades');
    hybridStorageRemovePro('configDataAtividadesPro');
    hybridStorageRemovePro('configDataAtividadesProcPro');
    hybridStorageRemovePro('configDataAtividadesPadraoPro');
    sessionStorageRemovePro('configDataAtividadesHTML');
    sessionStorageRemovePro('configDataContatosArray');
    removeOptionsPro('selectReport_planos');
    removeOptionsPro('selectReport_demandas');
    removeOptionsPro('selectReport_afastamentos');
    removeOptionsPro('selectReport_atividades');
    if (force) {
        arrayAtividadesPro = [];
        arrayAtividadesProcPro = [];
        arrayConfigAtividades = [];
    }
    lastUpdateAtividades = false;
}
function changePerfilAtiv(this_) {
    var _this = $(this_);
    removeLocalDataAtiv(true);
    $('#projetosGantt').remove();
    $('.tabelaControle .atividadeBoxDisplay').html('');
    resetDialogBoxPro('dialogBoxPro');
    removeOptionsPro('selectChartAtiv');
    setOptionsPro('perfilAtividadesSelected', _this.val());
    updateAtividade(_this.closest('.panelHome').find('.iconAtividade_update')[0]);
    perfilAtividadesSelected = _this.val();
}
function changePanelHome(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.panelHomePro');
    var data = $(this_).data();
    var mode = data.value;
        _parent.find('#atividadesProDiv_hideIcon, .panelHome').hide();
        _parent.find('#atividadesProDiv_hideIcon, .panelHome'+mode).show("slide", { direction: "down" }, 500);
        _parent.find('.panelInfoHome').hide();
        _parent.find('.panelInfoHome'+mode).show();
    if (mode == 'Afastamento') {
        var viewModePanel = (getOptionsPro('panelAfastamentosView')) ? getOptionsPro('panelAfastamentosView') : 'Cronograma';
        $('#afastamentosProActions').find('button[data-value="'+viewModePanel+'"].btn').trigger('click');
    } else if (mode == 'Contato') {
        getTableContatoPanel();
    } else if (mode == 'Relatorio') {
        // getTabsRelatorio();
        var viewModePanel = (getOptionsPro('panelRelatoriosView')) ? getOptionsPro('panelRelatoriosView') : 'Tabela';
        $('#relatoriosProActions').find('button[data-value="'+viewModePanel+'"].btn').trigger('click');
    } else if (mode == 'Atividade') {
        updateAtividade();
        setTimeout(function(){ 
            if (perfilLoginAtiv) {
                setPanelAtividades();
            } else {
                getServersPro();
            }
        }, 300);
        $('#tabelaAtivPanel').find('.dataFallback').addClass('dataLoading');
        $('#atividadesProActions').find('.iconAtividade_update i').addClass('fa-spin');
    } else if (mode == 'Configuracao') {
        getTabsConfigPanel();
        // initClassicEditor();
    }
    setOptionsPro('panelHomeView', mode);
    $('.tableRelatorioView caption.infraCaption').html('');
}
function getPanelAtiv(this_) {
    var data = $(this_).data();
    var mode = data.value;
    $(this_).closest('#atividadesProActions').find('.btn.active').removeClass('active');
    $(this_).addClass('active');
    $('#ganttAtivPanel').html('').hide();
    $('#kanbanAtivPanel').html('').hide();
    $('#chartAtivPanel').hide();
    if (mode == 'Tabela') {
        $('#tabelaAtivPanel').show();
    } else {
        $('#tabelaAtivPanel').attr('style', function(i,s) { return (s || '') + 'display: none !important;' });
    } 
    if (mode == 'Cronograma') {
        getGanttAtividades(getOptionsPro('ganttAtividadesFilter'));
        if (getOptionsPro('ganttAtividadesFilter').indexOf('bar-') === -1) {
            $('#selectViewControl_ganttAtivPanel option[data-bar="'+getOptionsPro('ganttAtividadesFilter')+'"]').prop('selected', true).trigger('change');
        }
    } else if (mode == 'Quadro') {
        getKanbanAtividades(this_);
    } else if (mode == 'Relatorio') {
        $('#tabChartAtivPanel').tabs();
        getChartAtividades(this_);
    }
    setOptionsPro('panelAtividadesView', mode);
}
function getPanelAfast(this_) {
    var data = $(this_).data();
    var mode = data.value;
    var _parent = $(this_).closest('#afastamentosProActions');
        _parent.find('.btn.active').removeClass('active');
    $(this_).addClass('active');
    $('.afastamentoPanelPro').attr('style', function(i,s) { return (s || '') + 'display: none !important;' });
    if (mode == 'Cronograma') {
        var defaultView = getOptionsPro('ganttAfastamentosFilter');
        getGanttAfastamento(defaultView ? defaultView : 'bar-ativos');
    } else if (mode == 'Tabela') {
        initTableAfastamentoPanel(this_);
    } else if (mode == 'Relatorio') {
        getChartAfastamentoPanel(this_);
    }
    setOptionsPro('panelAfastamentosView', mode);
}
function getPanelRelatorio(this_) {
    var data = $(this_).data();
    var mode = data.value;
    var _parent = $(this_).closest('#relatoriosProActions');
        _parent.find('.btn.active').removeClass('active');
    $(this_).addClass('active');
    $('.relatorioPanelPro').attr('style', function(i,s) { return (s || '') + 'display: none !important;' });
    if (mode == 'Tabela') {
        getTabsRelatorio(this_);
    } else if (mode == 'Grafico') {
        getChartRelatorio(this_);
    }
    setOptionsPro('panelRelatoriosView', mode);
}
function getChartRelatorio(this_) {
    $('#chartRelatorioPanel').show();
    $('#tableRelatorioPanel').hide();
    if (checkOptionEntidade('painel_bi')) {
        $('#chartRelatorioPanelBI').attr('src',getOptionEntidade('painel_bi'));
    }
}
function getTabsRelatorio(this_) {
    $('#chartRelatorioPanel').hide();
    var _this = $(this_);
    var panel = 'tableRelatorioPanel';
    var tabs = 'tabsPanelRelatorio'; //tabelaPanelScroll resizeObserve
    var htmlToolbar =   '<div id="'+tabs+'" style="border: none; min-height: 300px; margin: 0;">'+
                        '    <ul>'+
                        (checkCapacidade('report_demandas') ? 
                        '       <li><a href="#tabs_report-demandas"><i class="fas fa-list-alt cinzaColor" style="margin-right: 5px;"></i> '+__.Demandas+'</a></li>'+
                        '' : '')+
                        (checkCapacidade('report_planos') ? 
                        '       <li><a href="#tabs_report-planos"><i class="fas fa-list-alt cinzaColor" style="margin-right: 5px;"></i> Planos de Trabalho</a></li>'+
                        '' : '')+
                        (checkCapacidade('report_atividades') ? 
                        '       <li><a href="#tabs_report-atividades"><i class="fas fa-list-alt cinzaColor" style="margin-right: 5px;"></i> '+__.Atividades+'</a></li>'+
                        '' : '')+
                        (checkCapacidade('report_afastamentos') ? 
                        '       <li><a href="#tabs_report-afastamentos"><i class="fas fa-list-alt cinzaColor" style="margin-right: 5px;"></i> Afastamentos</a></li>'+
                        '' : '')+
                        (!checkOptionEntidade('desativa_produtividade_geral') && checkCapacidade('report_produtividade') ? 
                        '       <li><a href="#tabs_report-produtividade"><i class="fas fa-list-alt cinzaColor" style="margin-right: 5px;"></i> Produtividade</a></li>'+
                        '' : '')+
                        (checkCapacidade('report_demandas_excluidas') ? 
                        '       <li><a href="#tabs_report-demandas_excluidas"><i class="fas fa-list-alt cinzaColor" style="margin-right: 5px;"></i> '+__.Demandas+' exclu\u00EDdas</a></li>'+
                        '' : '')+
                        (checkCapacidade('report_prescricoes') ? 
                        '       <li><a href="#tabs_report-prescricoes"><i class="fas fa-history cinzaColor" style="margin-right: 5px;"></i> '+__.Prescricoes+'</a></li>'+
                        '' : '')+
                        '    </ul>'+
                        (checkCapacidade('report_demandas') ? 
                        '    <div id="tabs_report-demandas" class="" style="overflow-x: scroll; padding: 0;"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('report_planos') ? 
                        '    <div id="tabs_report-planos" class="" style="overflow-x: scroll; padding: 0;"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('report_atividades') ? 
                        '    <div id="tabs_report-atividades" class="" style="overflow-x: scroll; padding: 0;"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('report_afastamentos') ? 
                        '    <div id="tabs_report-afastamentos" class="" style="overflow-x: scroll; padding: 0;"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (!checkOptionEntidade('desativa_produtividade_geral') && checkCapacidade('report_produtividade') ? 
                        '    <div id="tabs_report-produtividade" class="" style="overflow-x: scroll; padding: 0;"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('report_demandas_excluidas') ? 
                        '    <div id="tabs_report-demandas_excluidas" class="" style="overflow-x: scroll; padding: 0;"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('report_prescricoes') ? 
                        '    <div id="tabs_report-prescricoes" class="" style="overflow-x: scroll; padding: 0;"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        '</div>';
    $('#'+panel).html(htmlToolbar).show();
    $('#'+tabs).tabs({
        activate: function (event, ui) {
            var active = $(this).tabs( "option", "active" );
            var type = ui.newPanel[0].id.replace('tabs_report-', '');
            setOptionsPro('report_'+tabs+'ActiveTabs', active);
            removeOptionsPro('rememberScroll_report_'+type);
            resetDialogBoxPro('dialogBoxPro');
            getTabReport(type, 'get');
            $('.tableRelatorioView caption.infraCaption').html('');
        }
    });
    var tabActive = getOptionsPro('report_'+tabs+'ActiveTabs');
    if (tabActive) {
        $('#'+tabs).tabs( "option", "active", tabActive);
    } else {
        getTabReport('demandas', 'get');
    }
    //initDaterangePicker();
}
function initDaterangePicker(TimeOut = 9000) {
    if (TimeOut <= 0) { return; }
    if (typeof $().daterangepicker === 'function') { 
        $('input[name="dates"]').daterangepicker({
            "locale": {
              "format": "DD/MM/YYYY",
              "separator": " - ",
              "applyLabel": "Aplicar",
              "cancelLabel": "Cancelar",
              "daysOfWeek": [
                "Dom",
                "Seg",
                "Ter",
                "Qua",
                "Qui",
                "Sex",
                "Sab"
              ],
              "monthNames": [
                "Janeiro",	
                "Fevereiro",
                "Mar\u00E7o",
                "Abril",
                "Maio",
                "Junho",
                "Julho",
                "Agosto",
                "Setembro",
                "Outubro",
                "Novembro",
                "Dezembro"
              ],
              "firstDay": 1
            }
          });
    } else {
        setTimeout(function(){ 
            if (TimeOut == 9000) {
                $.getScript((URL_SPRO+"js/lib/daterangepicker.js"));
                loadStylePro(URL_SPRO+"css/daterangepicker.css");
            }
            initDaterangePicker(TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initDaterangePicker'); 
        }, 500);
    }
}
function getTabReport(type, mode, data_ = false, offset = 0, return_param = false) {
    if (checkCapacidade('report_'+type) && mode == 'get') {

        var data = getOptionsPro('selectReport_'+type);
            data = (typeof data !== 'undefined' && data !== null && data) ? data : return_param;
        var id_programa = (data && typeof data.id_programa !== 'undefined' && data.id_programa !== null) ? data.id_programa : 0;
            id_programa = (id_programa == 0) ? jmespath.search(arrayConfigAtividades.programas, "[*].id_programa | [0]") : id_programa;
            id_programa = (id_programa === null) ? 0 : id_programa;
        var id_plano = (return_param && typeof return_param.id_plano !== 'undefined' && return_param.id_plano !== null) ? return_param.id_plano : false;
        var disabled = (getOptionsPro('changeDisabledTableReport_'+type) && getOptionsPro('changeDisabledTableReport_'+type) == 'show') ? 'show' : 'hide';

        // console.log(data, return_param, id_programa);

        var all_data = (getOptionsPro('changeViewTableReport_'+type) == 'show') ? true : false;
        var action = 'report_'+type;
        var param = {
            action: action,
            disabled: disabled,
            all_data: all_data,
            id_programa: id_programa,
            id_plano: id_plano,
            offset: offset
        };
        getServerAtividades(param, action, type);

        $('#tabs_report-'+type).css('width',$('#tabsPanelRelatorio').width()).find('.dataFallback').addClass('dataLoading');

    } else if (checkCapacidade('report_'+type) && mode == 'set') {
        updateServerTabReport(data, param);
        infraTooltipOcultar();
    }
}
function updateServerTabReport(data, param) {
    loadingButtonConfirm(false);
    getTableRelatorioPanel(data, param);
}
function openModalConfigPanel(){
    openConfigBoxPro('', 
        function(){ 
            getTabsConfigPanel('configBoxProDiv');
            var htmlBox =     '   	<div id="configuracoesProActions" class="panelHome panelHomeConfiguracao">'+
                            '           <a class="newLink iconAtividade_update" onclick="updateAtividade_(this)" onmouseover="return infraTooltipMostrar(\'Atualizar Informa\u00E7\u00F5es\');" onmouseout="return infraTooltipOcultar();" style="margin: 0;font-size: 14pt;float: right;">'+
                            '               <i class="fas fa-sync-alt"></i>'+
                            '           </a>'+
                            (checkCapacidade('config_atividades') ? getHtmlActionsConfig('atividades') : '')+
                            (checkCapacidade('config_planos') || checkCapacidade('config_self_planos') ? getHtmlActionsConfig('planos') : '')+
                            (checkCapacidade('config_termos') || checkCapacidade('config_self_termos') ? getHtmlActionsConfig('termos') : '')+
                            (checkCapacidade('config_programas') ? getHtmlActionsConfig('programas') : '')+
                            (checkCapacidade('config_users') ? getHtmlActionsConfig('users') : '')+
                            (checkCapacidade('config_unidades') ? getHtmlActionsConfig('unidades') : '')+
                            (checkCapacidade('config_cadeia_valor') ? getHtmlActionsConfig('cadeia_valor') : '')+
                            (checkCapacidade('config_tipos_prescricoes') ? getHtmlActionsConfig('tipos_prescricoes') : '')+
                            (checkCapacidade('config_tipos_metadados') ? getHtmlActionsConfig('tipos_metadados') : '')+
                            (checkCapacidade('config_tipos_documentos') ? getHtmlActionsConfig('tipos_documentos') : '')+
                            (checkCapacidade('config_tipos_requisicoes') ? getHtmlActionsConfig('tipos_requisicoes') : '')+
                            (checkCapacidade('config_tipos_justificativas') ? getHtmlActionsConfig('tipos_justificativas') : '')+
                            (checkCapacidade('config_tipos_modalidades') ? getHtmlActionsConfig('tipos_modalidades') : '')+
                            (checkCapacidade('config_tipos_motivos') ? getHtmlActionsConfig('tipos_motivos') : '')+
                            (checkCapacidade('config_tipos_capacidades') ? getHtmlActionsConfig('tipos_capacidades') : '')+
                            (checkCapacidade('config_perfis') ? getHtmlActionsConfig('perfis') : '')+
                            (checkCapacidade('config_nomenclaturas') ? getHtmlActionsConfig('nomenclaturas') : '')+
                            (checkCapacidade('config_entidades') ? getHtmlActionsConfig('entidades') : '')+
                            '   	</div>';

            $('#configBoxProDiv').prepend(htmlBox);
            setTimeout(function(){ 
                if (configBoxPro) centralizeDialogBox(configBoxPro);
            }, 500);
        }, 
        function() {
            updateAtividade($('.panelHome').find('.iconAtividade_update')[0]);
        }
    );
}
function getTabsConfigPanel(panel = 'panelInfoHomeConfiguracao') {
    var tabs = 'tabsPanelConfig';
    var htmlToolbar =   '<div id="'+tabs+'" style="border: none; min-height: 300px;">'+
                        '    <ul>'+
                        '    <li><a href="#tabs-configpessoal"><i data-icon="user-cog" class="fas fa-user-cog cinzaColor" style="margin-right: 5px;"></i>Configura\u00E7\u00F5es Pessoais</a></li>'+
                        (checkCapacidade('config_atividades') ? 
                        '    <li><a href="#tabs-atividades"><i data-icon="clipboard-list" class="fas fa-clipboard-list cinzaColor" style="margin-right: 5px;"></i>'+__.Atividades+'</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_planos') || checkCapacidade('config_self_planos') ? 
                        '    <li><a href="#tabs-planos"><i data-icon="handshake" class="fas fa-handshake cinzaColor" style="margin-right: 5px;"></i>Planos de Trabalho</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_termos') || checkCapacidade('config_self_termos') ? 
                        '    <li><a href="#tabs-termos"><i data-icon="file-signature" class="fas fa-file-signature cinzaColor" style="margin-right: 5px;"></i>Termos de Ci\u00EAncia e Responsabilidade</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_programas') ? 
                        '    <li><a href="#tabs-programas"><i data-icon="cubes" class="fas fa-cubes cinzaColor" style="margin-right: 5px;"></i>Programas de Gest\u00E3o</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_users') ? 
                        '    <li><a href="#tabs-users"><i data-icon="users" class="fas fa-users cinzaColor" style="margin-right: 5px;"></i>Usu\u00E1rios</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_unidades') ? 
                        '    <li><a href="#tabs-unidades"><i data-icon="briefcase" class="fas fa-briefcase cinzaColor" style="margin-right: 5px;"></i>Unidades</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_cadeia_valor') ? 
                        '    <li><a href="#tabs-cadeia_valor"><i data-icon="share-alt" class="fas fa-share-alt cinzaColor" style="margin-right: 5px;"></i>Cadeia de Valor</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_prescricoes') ? 
                        '    <li><a href="#tabs-tipos_prescricoes"><i data-icon="history" class="fas fa-history cinzaColor" style="margin-right: 5px;"></i>Tipos de '+__.Prescricoes+'</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_metadados') ? 
                        '    <li><a href="#tabs-tipos_metadados"><i data-icon="dice-d6" class="fas fa-dice-d6 cinzaColor" style="margin-right: 5px;"></i>Tipos de Metadados</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_documentos') ? 
                        '    <li><a href="#tabs-tipos_documentos"><i data-icon="file-alt" class="fas fa-file-alt cinzaColor" style="margin-right: 5px;"></i>Tipos de Documentos</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_requisicoes') ? 
                        '    <li><a href="#tabs-tipos_requisicoes"><i data-icon="inbox" class="fas fa-inbox cinzaColor" style="margin-right: 5px;"></i>Tipos de Requisi\u00E7\u00F5es</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_justificativas') ? 
                        '    <li><a href="#tabs-tipos_justificativas"><i data-icon="star" class="fas fa-star cinzaColor" style="margin-right: 5px;"></i>Tipos de Justificativas de Avalia\u00E7\u00E3o</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_modalidades') ? 
                        '    <li><a href="#tabs-tipos_modalidades"><i data-icon="wrench" class="fas fa-wrench cinzaColor" style="margin-right: 5px;"></i>Tipos de Modalidades de Trabalho</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_motivos') ? 
                        '    <li><a href="#tabs-tipos_motivos"><i data-icon="luggage-cart" class="fas fa-luggage-cart cinzaColor" style="margin-right: 5px;"></i>Tipos de Motivos de Afastamento</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_capacidades') ? 
                        '    <li><a href="#tabs-tipos_capacidades"><i data-icon="users-cog" class="fas fa-users-cog cinzaColor" style="margin-right: 5px;"></i>Tipos de Capacidades</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_perfis') ? 
                        '    <li><a href="#tabs-perfis"><i data-icon="shield-alt" class="fas fa-shield-alt cinzaColor" style="margin-right: 5px;"></i>Tipos de Perfis</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_nomenclaturas') ? 
                        '    <li><a href="#tabs-nomenclaturas"><i data-icon="ad" class="fas fa-ad cinzaColor" style="margin-right: 5px;"></i>Nomenclaturas</a></li>'+
                        '' : '')+
                        (checkCapacidade('config_entidades') ? 
                        '    <li><a href="#tabs-entidades"><i data-icon="university" class="fas fa-university cinzaColor" style="margin-right: 5px;"></i>Entidades</a></li>'+
                        '' : '')+
                        '    </ul>'+
                        '    <div id="tabs-configpessoal">'+
                        '       '+configPessoal()+
                        '    </div>'+
                        (checkCapacidade('config_atividades') ? 
                        '    <div id="tabs-atividades"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_planos') || checkCapacidade('config_self_planos') ? 
                        '    <div id="tabs-planos"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_termos') || checkCapacidade('config_self_termos') ? 
                        '    <div id="tabs-termos"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_programas') ? 
                        '    <div id="tabs-programas"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_users') ? 
                        '    <div id="tabs-users"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_unidades') ? 
                        '    <div id="tabs-unidades"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_cadeia_valor') ? 
                        '    <div id="tabs-cadeia_valor"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_prescricoes') ? 
                        '    <div id="tabs-tipos_prescricoes"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_metadados') ? 
                        '    <div id="tabs-tipos_metadados"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_documentos') ? 
                        '    <div id="tabs-tipos_documentos"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_requisicoes') ? 
                        '    <div id="tabs-tipos_requisicoes"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_justificativas') ? 
                        '    <div id="tabs-tipos_justificativas"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_modalidades') ? 
                        '    <div id="tabs-tipos_modalidades"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_motivos') ? 
                        '    <div id="tabs-tipos_motivos"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_tipos_capacidades') ? 
                        '    <div id="tabs-tipos_capacidades"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_perfis') ? 
                        '    <div id="tabs-perfis"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_nomenclaturas') ? 
                        '    <div id="tabs-nomenclaturas"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        (checkCapacidade('config_entidades') ? 
                        '    <div id="tabs-entidades"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div>'+
                        '' : '')+
                        '</div>';
    $('.'+panel).html(htmlToolbar);
    $('#'+tabs).tabs({
        activate: function (event, ui) {
            var active = $(this).tabs( "option", "active" );
            var type = ui.newPanel[0].id.replace('tabs-', '');
            setOptionsPro(tabs+'ActiveTabs', active);
            removeOptionsPro('rememberScroll_config_'+type);
            resetDialogBoxPro('dialogBoxPro');
            getTabConfig(type, 'get');
            $('.actionsConfig_icons').hide().find('.newLink').not('.iconConfig_confirm').hide();
            $('.actionsConfig_'+type).show();
            // initClassicEditor();
        }
    });
    var tabActive = getOptionsPro(tabs+'ActiveTabs');
    if (tabActive) {
        $('#'+tabs).tabs( "option", "active", tabActive);
    }
    getListTypesSEI();
    initMaskPhoneConfig();
}
function initMaskPhoneConfig(TimeOut = 9000) {
    if (TimeOut <= 0) { return; }
    if (TimeOut == 9000 && typeof $.mask === 'undefined') $.getScript(URL_SPRO+"js/lib/jquery.maskedinput.min.js");

    if (typeof $.mask !== 'undefined') {
        if ($("#tabs-configpessoal #tel_celular").length > 0) {
            $("#tabs-configpessoal #tel_celular").mask('+99 (99) 99999-999?9', {placeholder: '+55 (__) _____-____', completed: function () { 
                    this.removeClass('requiredNull');
                }
            }).on('keypress', function(){
                var value = $(this).val();
                if (value.substring(0,3) != '+55') {
                    $(this).after('<input type="text" id="tel_celular" onchange="saveConfigPersonalUser(this)" style="width:calc(100% - 15px) !important" tabindex="0" value="'+value.substring(0,3)+'">').remove();
                    setTimeout(() => {
                        $('#tel_celular').focus();
                    }, 1000);
                }
            }).on('focus', function(){
                setTimeout(() => {
                    if ($(this).val() == '+55 (__) _____-____') {
                        setCaretPosition(this, 5);
                    }
                }, 1000);
            });
        }
    } else {
        setTimeout(function(){ 
            initMaskPhoneConfig(TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initMaskPhoneConfig'); 
        }, 500);
    }
}
function getTabConfig(type, mode, data = false, loop = true, offset = 0, return_param = false) {
    if ((checkCapacidade('config_'+type) || checkCapacidade('config_self_'+type)) && mode == 'get') {
        var disabled = (getOptionsPro('changeDisabledTableConfig_'+type) && getOptionsPro('changeDisabledTableConfig_'+type) == 'show') ? 'show' : 'hide';
        var lista_inferior = (getOptionsPro('changeListaInfTableConfig_'+type) && getOptionsPro('changeListaInfTableConfig_'+type) == 'show') ? 'show' : 'hide';
        var action = (checkCapacidade('config_self_'+type)) ? 'config_self_'+type : 'config_'+type;
        var param = {
            disabled: disabled,
            lista_inferior: lista_inferior,
            offset: offset,
            action: action
        };
        getServerAtividades(param, action);
        $('#tabs-'+type).find('.dataFallback').addClass('dataLoading');
        var iconTab = $('a[href="#tabs-'+type+'"]').find('i');
            iconTab.addClass('fa-spinner').addClass('fa-spin');
    } else if ((checkCapacidade('config_'+type) || checkCapacidade('config_self_'+type)) && mode == 'set') {

        if (typeof SimpleTableCellEditor === 'undefined' && loop) { 
            $.getScript((URL_SPRO+"js/lib/jquery-table-edit.min.js"));
            setTimeout(function(){
                getTabConfig(type, mode, data, false, offset, return_param);
            }, 1000);
        } else {
            getTableTabConfig(type, data, return_param);
            infraTooltipOcultar();
            var iconTab = $('a[href="#tabs-'+type+'"]').find('i');
            iconTab.removeClass('fa-spinner').removeClass('fa-spin');
        }
    }
}
function setNewItemCell(this_, event) {
    if (event.which == 13) { 
        setTimeout(function(){ 
            $(this_).closest('td').text($(this_).val().trim());
        }, 500);
    }
}
function addConfigItem(this_) {
    var _this = $(this_);
    var table = _this.closest('table');
    var tr = table.find('tbody tr:last-child');
    var len = table.find('tbody tr').length;
    var div = table.closest('div');
    table.find('tbody tr td').removeClass('inEdit');
    table.find('tbody').append(tr.clone().attr('data-index',len).attr('data-value',''));
    table.find('tbody tr:last-child').find('td:first-child').removeClass('inEdit').text('').trigger('click');
    if (typeof div !== 'undefined' && typeof div[0] !== 'undefined')  div.scrollTop(div[0].scrollHeight); 
    if (tr.data('key') == 'documentos') {
        table.find('tbody tr:last-child').find('td:nth-child(2)')
            .removeClass('editCellLoadingError')
            .removeClass('editCellConfirm')
            .removeClass('inEdit')
            .text('');
        table.find('tbody tr:last-child').find('td:nth-child(3)').text('');
        table.find('tbody tr:last-child').find('td:nth-child(4)').text('');
        table.find('tbody tr:last-child').find('td:nth-child(5)').text('');
    } else if (tr.data('key') == 'id_unidade' || tr.data('key') == 'id_user') {
        table.find('tbody tr:last-child').find('.onoffswitch-checkbox').prop('checked',false);
    } else if (tr.data('key') == 'modalidades') {
        table.find('tbody tr:last-child').find('td:nth-child(2)').text('');
    } else if (tr.data('key') == 'metadados') {
        table.find('tbody tr:last-child').find('td:nth-child(2)').text('');
    } else if (tr.data('key') == 'exclui_unidades' || tr.data('key') == 'unidades') {
        table.find('tbody tr:last-child').find('td:nth-child(2)').text('');
    } else if (tr.data('key') == 'complexidade') {
        table.find('tbody tr:last-child').find('td').removeClass('inEdit');
        table.find('tbody tr:last-child').find('td:nth-child(1)').text('').trigger('click');
        table.find('tbody tr:last-child').find('td:nth-child(2)').text('');
        table.find('tbody tr:last-child').find('td:nth-child(3)').text('');
        var onoffswitch = table.find('tbody tr:last-child').find('.onoffswitch');
            onoffswitch.find('input[type="checkbox"]')
                .attr('class','onoffswitch-checkbox switch_complexidadeDefault switch_complexidadeDefault_'+len)
                .attr('id', 'changeItemConfig_atividades_'+len).prop('checked',false);
            onoffswitch.find('label.onoffswitch-label').attr('for', 'changeItemConfig_atividades_'+len)
    }
}
function changeSwitchConfigItem(this_) {
    var _this = $(this_);
    var tr = _this.closest('tr');
    var data_type = tr.data('key');
    var table = _this.closest('table');
    table.find('.switch_'+data_type+'Default').not('.switch_'+data_type+'Default_'+tr.data('index')).prop('checked',false);
    // _this.prop('checked',true);

}
function changeSwitchConfigTable(this_) {
    var _this = $(this_);
    var td = _this.closest('td');
    var tr = _this.closest('tr');
    var data = td.data();
    var data_tr = tr.data();
    var type = tr.data('key');
    var value = (_this.is(':checked')) ? 1 : 0;
        updateConfigServerInline(_this, type, value, data, data_tr);
        td.addClass('editCellLoading');
}
function changeSelectConfigItem(this_) {
    var _this = $(this_);
    var tr = _this.closest('tr');
    var td = _this.closest('td');
    var data_tr = tr.data();
    var table = _this.closest('table');
    var value_txt = _this.find('option:selected').text().trim();
    var value = _this.val();

    if (td.data('key') == 'tipo_modalidade') {
        tr.find('td').eq(2).text(value);
    }
    if (tr.data('key') == 'exclui_unidades' || tr.data('key') == 'unidades') {
        tr.find('td').eq(1).text(value);
    }
    if (td.data('key') == 'cadeia_valor') {
        tr.find('td').eq(1).text(value);
    }
    if (td.data('key') == 'tipos_prescricoes') {
        tr.find('td').eq(1).text(value);
    }
    if (td.data('key') == 'id_usuario_metadado') {
        var config = _this.find('option:selected').data('config');
        var tipo_metadado = typeof config !== 'undefined' ? config.tipo_metadado : false;
        var classEdit = tipo_metadado == 'text' ? 'editCell' : '';
            classEdit = tipo_metadado == 'number' ? 'editCellNum' : classEdit;
            classEdit = tipo_metadado == 'boolean' ? 'editCellSelect' : classEdit;
            classEdit = tipo_metadado == 'cpf' ? 'editCellCPF' : classEdit;
            classEdit = tipo_metadado == 'cnpj' ? 'editCellCNPJ' : classEdit;
            classEdit = tipo_metadado == 'processo' ? 'editCellPEN' : classEdit;
            classEdit = tipo_metadado == 'telefone' ? 'editCellPhone' : classEdit;
            classEdit = tipo_metadado == 'date' ? 'editCellDate' : classEdit;
            classEdit = tipo_metadado == 'datetime' ? 'editCellDatetime' : classEdit;
            classEdit = tipo_metadado == 'latlong' ? 'editCellLatlong' : classEdit;
        tr.find('td').eq(1).attr('class',classEdit).attr('data-tipometa', tipo_metadado).data('tipometa',tipo_metadado);
    }

    if (table.data('format') == 'obj_mult' && typeof td.data('tipometa') !== 'undefined') {
        td.attr('data-value',value);
        td.data('value',value);
    }
    if (table.data('format') == 'obj_mult' && typeof td.data('tipometa') === 'undefined') {
        value = (value == '') ? 'remove' : value;
        tr.attr('data-value',value);
        tr.data('value',value);
    }
    if (tr.find('td').length > 2) {
        _this.closest('td').next().trigger('click');
    } else {
        table.find('tbody tr:last-child').find('td:first-child').trigger('click');
    }
    if (tr.find('td').length == 2 && tr.data('index') == table.find('tbody tr').length-1 && value_txt != '' && (data_tr.key != 'perfil' || data_tr.key != 'cadeia_valor' || data_tr.key != 'tipos_prescricoes')) {
        addConfigItem(this_);
    }

    setTimeout(function(){ 
        if (!td.find('input, select').is(':visible')) {
            td.removeClass('inEdit');
        }
    }, 500);
}
function configTableNewItem(this_) {
    var _this = $(this_);
    var td = _this.closest('td');
    var tr = _this.closest('tr');
    if (_this.val() == 'new') {
        setTimeout(function(){ 
            td.removeClass('inEdit').removeClass('editCellSelect').addClass('editCellNew');
            td.html('').trigger('click');
        }, 100);
    }
}
function updateConfigServer(param) {

    // var param_key = param.key;
    var param_key = (isJson(param.key)) ? JSON.parse(param.key) : param.key;

    objIndex = (typeof tableConfigList[param.type] === 'undefined' || tableConfigList[param.type] == 0 || tableConfigList[param.type].length == 0) ? -1 : tableConfigList[param.type].findIndex((obj => obj[param.rowindex] == param.id));
    if (objIndex !== -1) {
        tableConfigList[param.type][objIndex][param_key] = param.value;
    }

    objIndexAtiv = (typeof arrayConfigAtividades[param.type] === 'undefined' || arrayConfigAtividades[param.type] == 0 || arrayConfigAtividades[param.type].length == 0) ? -1 : arrayConfigAtividades[param.type].findIndex((obj => obj[param.rowindex] == param.id));
    if (objIndexAtiv !== -1) {
        arrayConfigAtividades[param.type][objIndexAtiv][param_key] = param.value;
    }

    var action = checkCapacidade('config_update_self_'+param.type) ? 'config_update_self_'+param.type : 'config_update_'+param.type;
    if (checkCapacidade(action)) {
        param.action = action;
        getServerAtividades(param, action);
    }
    return {objIndex: objIndex, objIndexAtiv: objIndexAtiv};
}
function resetButtonTabConfig(classPanel = '') {
    var loadConfirm = $('#configuracoesProActions '+classPanel+' .iconConfig_confirm');
    loadConfirm.find('i.icon-parent').attr('class', loadConfirm.data('icon'));
}
function updateServerTabConfig(data, param) {
    var table = $('#tabelaConfigPanel_'+param.type)
    var body = table.find('tbody');
        resetButtonTabConfig('.actionsConfig_'+param.type);
        
    if (data.status == 1) {
        if (param.id != 0) {
            var id = (param.id == -1) ? data.result : param.id;
            var tr = body.find('tr[data-id="'+id+'"]');
            updateConfigCells(data, param, tr, id);
        } else {
            $.each(param.ids, function(index, value){
                var tr = body.find('tr[data-id="'+value+'"]');
                updateConfigCells(data, param, tr, value);
            })
        }
    }
}
function updateConfigCells(data, param, tr, id = false) {

    var param_key = (isJson(param.key)) ? JSON.parse(param.key) : param.key;
    var td = tr.find('td[data-key="'+param_key+'"]');
    
    if (data.status == 0) {
        td.removeClass('editCellLoading').addClass('editCellLoadingError');
    } else {
        if (param.mode == 'disable') { tr.addClass('disabled') }
        else if (param.mode == 'close') { 

            if (moment() > moment(param.date_config, 'YYYY-MM-DD')) { tr.addClass('closed'); }
            
            var ids = (param.ids.length == 0) ? [param.id.toString()] : param.ids;
            var type_id = (param.type == 'planos') ? 'id_plano' : false;
                type_id = (param.type == 'termos') ? 'id_termo' : type_id;
            var date_config = param.date_config+' 23:59:59';
            var listUpdate = [];
            $.each(tableConfigList[param.type], function(i,v){
                if ($.inArray(v[type_id].toString(), ids) !== -1) {
                    listUpdate.push(v);
                    tableConfigList[param.type][i][param_key] = date_config;
                    td.text(moment(param.date_config, 'YYYY-MM-DD').format('DD/MM/YYYY')).attr('data-time-sorter', param.date_config);
                }
            });
            if (listUpdate.length > 0) {
                if (param.type == 'planos') dialogUpdateCalcPlanos(listUpdate, 'update');
            }
        }
        else if (param.mode == 'approve') { tr.addClass('approve').removeClass('disapprove') }
        else if (param.mode == 'disapprove') { tr.addClass('disapprove').removeClass('approve') }
        else if (param.mode == 'reactive') { tr.removeClass('disabled') }
        else if (param.mode == 'clone' || param.mode == 'new') {
            setTimeout(function(){
                if (delayServerAtiv == 0) {
                    delayServerAtiv = 1; setTimeout(function(){ delayServerAtiv = 0; }, 1000);
                    getTabConfig(param.type, 'get');
                }
            }, 1000);
        } else if (param.mode == 'option') {
            loadingButtonConfirm(false);
            if (data.status == 1) {
                dialogBoxPro.dialog('close');
                resetDialogBoxPro('dialogBoxPro');
                alertaBoxPro('Sucess', 'check-circle', 'Op\u00E7\u00F5es editadas com sucesso!');
            } else {
                alertaBoxPro('Error', 'exclamation-triangle', 'Erro ao enviar sua informa\u00E7\u00F5es.');
            }
        } 
        if (typeof data.return_row !== 'undefined' && data.return_row.length) {
            var value = !id ? data.return_row[0] : jmespath.search(data.return_row,"[?"+data.return_row[0].primarykey+"==`"+id+"`] | [0]");
            var label_id = (param.type == 'tipos_modalidades') ? 'id_tipo_modalidade' : 'id_'+param.type.slice(0, -1);
                label_id = (param.type == 'tipos_prescricoes') ? 'id_tipo_prescricao' : label_id;
                
            objIndex = tableConfigList[param.type].findIndex((obj => obj[label_id] == param.id));
            if (objIndex !== -1) {
                tableConfigList[param.type][objIndex] = value;
            }
            
            objIndexAtiv = (typeof arrayConfigAtividades[param.type] === 'undefined' || arrayConfigAtividades[param.type] == 0 || arrayConfigAtividades[param.type].length == 0) ? -1 : arrayConfigAtividades[param.type].findIndex((obj => obj[label_id] == param.id));
            if (objIndexAtiv !== -1) {
                arrayConfigAtividades[param.type][objIndexAtiv] = value;
            }
            if (typeof data.refresh_page !== 'undefined' && data.refresh_page) {
                getTableTabConfig(param.type, {offset: false, next_offset: false, status: 1, config: tableConfigList[param.type]}, param);
            } else {
                var htmlRowConfig = getRowsTableTabConfig(param.type, 'body', tableConfigList[param.type], value);
                    tr.after(htmlRowConfig).remove();
                    $('#tableConfiguracoesPanel_'+param.type).trigger('update');
            }
        }
        if (param.action == 'config_update_users' && param.mode == 'new') {
            loadingButtonConfirm(false);
            resetDialogBoxPro('dialogBoxPro');
            alertaBoxPro('Sucess', 'check-circle', 'Usu\u00E1rio criado com sucesso! Link de acesso enviado para o email cadastrado.');
        } else if (param.action == 'config_resend_keys') {
            loadingButtonConfirm(false);
            alertaBoxPro('Sucess', 'check-circle', 'Link de acesso reenviado com sucesso para o email do usu\u00E1rio!');
        } else if (param.action == 'config_update_keys') {
            var table = $('#configBox_keys');
            if (param.mode == 'disable_key') {
                loadingButtonConfirm(false);
                alertaBoxPro('Sucess', 'check-circle', 'Chave de acesso revogada com sucesso!');
                var trKey = table.find('tbody tr[data-id="'+param.id+'"]');
                    trKey.find('.keyVigente').hide();
                    trKey.find('.keyRevogada').show();
            } else if (param.mode == 'resend_key') {
                loadingButtonConfirm(false);
                alertaBoxPro('Sucess', 'check-circle', 'Link de acesso reenviado com sucesso para o email do usu\u00E1rio!');
            } else if (param.mode == 'new_key') {
                loadingButtonConfirm(false);
                alertaBoxPro('Sucess', 'check-circle', 'Chave de acesso criada com sucesso! Link de acesso enviado no email do usu\u00E1rio');
                table.find('tbody tr .keyVigente').hide();
                table.find('tbody tr .keyRevogada').show();
                
                var last_tr = table.find('tbody tr:last-child');
                var id_hash = data.id_hash;
                var len = table.find('tbody tr').length;
                table.find('tbody').append(last_tr.clone().attr('data-index',len).attr('data-id',id_hash));
                table.find('tbody tr:last-child').find('td:first-child').text('ID:'+id_hash);
                table.find('tbody tr:last-child').find('.keyVigente').show();
                table.find('tbody tr:last-child').find('.keyRevogada').hide();
            }
            var linkIcon = table.find('.newLink.loading');
            var icon = linkIcon.find('i');
                linkIcon.removeClass('loading');
                icon.attr('class',icon.data('icon'));
        } else if (param.action == 'config_update_planos' && param.mode == 'clone') {
            setTimeout(function(){
                if (delayServerAtiv == 0) {
                    delayServerAtiv = 1; setTimeout(function(){ delayServerAtiv = 0; }, 1000);
                    var listUpdate = [];
                    var tableConfig = $('#tabelaConfigPanel_'+param.type);
                    if (data.last_ids.length > 0) {
                        $.each(data.last_ids,function(i,v){
                            var checkbox = tableConfig.find('tr[data-id="'+v+'"]').find('input[name="configuracoesPro"]');
                                checkbox.trigger('click');
                            var value = jmespath.search(tableConfigList.planos, "[?id_plano==`"+v+"`] | [0]");
                            if (value !== null) {
                                listUpdate.push(value);
                            }
                        });
                        dialogUpdateCalcPlanos(listUpdate, 'clone');
                    }
                }
            }, 5000);
        }

        setTimeout(function(){ 
            td.removeClass('editCellLoading').removeClass('editCellLoadingError');
            if (tr.find('.checkboxSelectConfiguracoes').is(':checked')) {
                tr.find('.checkboxSelectConfiguracoes').trigger('click');
            }
        }, 500);
    }
}
function dialogUpdateCalcPlanos(listUpdate = tableConfigList.planos, messageBox = 'update') {
    alertaBoxPro('Sucess', 'check-circle','Atualizando c\u00E1lculo de horas nos planos de trabalho... <span id="countLoopPlanos"></span> <div class="info_checklist" style="height:20px"><div id="progressLoopPlanos" class="checklist_progress" style="float:none; width:95%"></div></div>');
    var time = 0;
    var index = 0;
    var total = listUpdate.length;
    $('#progressLoopPlanos').progressbar({
        value: 0,
        max: total
    });

    $.each(listUpdate,function(i, v){
            time += 2000;
        
        setTimeout( function(){ 
            var counter = index+1;
                updateConfigTempoPactuadoById(v.id_plano);
                $('#progressLoopPlanos').progressbar({value: counter});
                $('#countLoopPlanos').text('('+counter+'/'+total+')');
                index++;

                if (index >= total) {
                    resetDialogBoxPro('alertBoxPro');
                    if (messageBox == 'update') {
                        alertaBoxPro('Sucess', 'check-circle','C\u00E1lculos de horas dos planos atualizados com sucesso');
                    } else if (messageBox == 'clone') {
                        alertaBoxPro('Sucess', 'check-circle','Planos de trabalho duplicados com sucesso');
                    }
                }
        }, time);
    });
}
function getMotivosPendenciasPlanos(plano) {
    if (plano) {
        var return_ = (plano.avaliacao_pendente && checkOptionEntidade('pendencias_plano_avaliacao_pendente')) ? '<br>- Avalia\u00E7\u00E3o Pendente: Demandas do plano sem avalia\u00E7\u00E3o' : '';
            return_ += (plano.entrega_insuficiente && checkOptionEntidade('pendencias_plano_entrega_insuficiente')) ? '<br>- Entregas Insuficientes: Tempo entregue menor que a meta proporcional do plano' : '';
            // return_ += (plano.execucao_parcial) ? '<br>- Execu\u00E7\u00E3o Parcial: Tempo homologado menor que a meta proporcional do plano' : '';
            return_ += (plano.pactuacao_insuficiente && checkOptionEntidade('pendencias_plano_pactuacao_insuficiente')) ? '<br>- Pactua\u00E7\u00E3o Insuficiente: Tempo pactuado menor que a meta proporcional do plano' : '';
            return_ += (plano.produtividade_insuficiente && checkOptionEntidade('pendencias_plano_produtividade_insuficiente')) ? '<br>- Produtividade Insuficiente: Tempo despendido maior que o tempo pactuado' : '';
            return return_;
    } else {
        return '';
    }
}
function regularizaPlano(this_ = false, data_this = false) {
    var _this = this_ ? $(this_) : false;
    var data = _this ? _this.data() : data_this;
    var id_plano = _this ? _this.closest('tr').data('id') : data.id_plano;
        id_plano = (typeof id_plano === 'undefined') ? data.id_plano : id_plano;
    var plano = (typeof id_plano !== 'undefined') ? jmespath.search(tableConfigList.planos, "[?id_plano==`"+id_plano+"`] | [0]") : null;
        plano = (plano === null) ? jmespath.search(arrayConfigAtividades.planos, "[?id_plano==`"+id_plano+"`] | [0]") : plano;
    var pendencias_plano = (plano !== null) ? plano.pendencias_plano[data.refplano] : false;
    var action = 'config_update_planos';
    var capacidade = checkCapacidade(action);

    if (_this) {
        var idTable = '#tableConfiguracoesPanel_planos';
        var countSelected = $(idTable+' tr.infraTrMarcada').length;
        if ($(idTable).is(':visible') && countSelected > 0) {
            $(idTable).find('.lnkInfraCheck').data('index',1).trigger('click');
        }
        _this.closest('tr').find('td').eq(0).find('input[type="checkbox"]').trigger('click');
    }
    

    if (pendencias_plano) {
        var htmlBox =   '<div id="boxPlano" class="atividadeWork">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        '           <tr>'+
                        '               <td colspan="3">'+
                        '                   <i style="margin: 0 5px;" class="fas fa-exclamation-triangle vermelhoColor"></i> Existe pend\u00EAncias do '+(data.refplano == 'presente' ? 'plano vigente' : 'plano anterior')+' que necessitam de regulariza\u00E7\u00E3o ('+moment(pendencias_plano.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(pendencias_plano.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+')'+
                        '               </td>'+
                        '           </tr>'+
                        '           <tr>'+
                        '               <td colspan="3">'+
                        '                   <div id="statusUserRegulariza"><canvas id="chartStatusUserRegulariza" width="500" height="70"></canvas></div>'+
                        '               </td>'+
                        '           </tr>'+
                        (pendencias_plano.avaliacao_pendente && checkOptionEntidade('pendencias_plano_avaliacao_pendente') ?
                        '           <tr>'+
                        '               <td style="vertical-align: bottom; text-align: left; width: 200px;" class="label">'+
                        '                    <label><i class="iconPopup iconSwitch fas fa-star cinzaColor"></i>Avalia\u00E7\u00E3o Pendente</label>'+
                        '                </td>'+
                        '                <td style="text-align: left;">Demandas do plano sem avalia\u00E7\u00E3o cadastrada</td>'+
                        '                <td style="text-align: left;"><i style="margin: 0 5px;" class="fas fa-exclamation-triangle vermelhoColor"></i> Solicite a avalia\u00E7\u00E3o pela chefia imediata '+(!capacidade ? 'com a chefia imediata': '')+'</td>'+
                        '           </tr>'+
                        '' : '')+
                        (pendencias_plano.entrega_insuficiente && checkOptionEntidade('pendencias_plano_entrega_insuficiente') ?
                        '           <tr>'+
                        '               <td style="vertical-align: bottom; text-align: left; width: 200px;" class="label">'+
                        '                    <label><i class="iconPopup iconSwitch fas fa-inbox cinzaColor"></i>Entregas Insuficientes</label>'+
                        '                </td>'+
                        '                <td style="text-align: left;">Tempo entregue menor que a meta proporcional do plano</td>'+
                        '                <td style="text-align: left;"><i style="margin: 0 5px;" class="fas fa-exclamation-circle laranjaColor"></i> Conclua demandas at\u00E9 a meta ou justifique a circunst\u00E2ncia '+(!capacidade ? 'com a chefia imediata': '')+'</td>'+
                        '           </tr>'+
                        '' : '')+
                        (pendencias_plano.pactuacao_insuficiente && checkOptionEntidade('pendencias_plano_pactuacao_insuficiente') ?
                        '           <tr>'+
                        '               <td style="vertical-align: bottom; text-align: left; width: 200px;" class="label">'+
                        '                    <label><i class="iconPopup iconSwitch fas fa-handshake cinzaColor"></i>Pactua\u00E7\u00E3o Insuficiente</label>'+
                        '                </td>'+
                        '                <td style="text-align: left;">Tempo pactuado menor que a meta proporcional do plano</td>'+
                        '                <td style="text-align: left;"><i style="margin: 0 5px;" class="fas fa-exclamation-circle laranjaColor"></i> Conclua demandas at\u00E9 a meta ou justifique a circunst\u00E2ncia '+(!capacidade ? 'com a chefia imediata': '')+'</td>'+
                        '           </tr>'+
                        '' : '')+
                        (pendencias_plano.produtividade_insuficiente && checkOptionEntidade('pendencias_plano_produtividade_insuficiente') ?
                        '           <tr>'+
                        '               <td style="vertical-align: bottom; text-align: left; width: 200px;" class="label">'+
                        '                    <label><i class="iconPopup iconSwitch fas fa-chart-line cinzaColor"></i>Produtividade Insuficiente</label>'+
                        '                </td>'+
                        '                <td style="text-align: left;">Tempo despendido maior que o tempo pactuado</td>'+
                        '                <td style="text-align: left;"><i style="margin: 0 5px;" class="fas fa-exclamation-circle laranjaColor"></i> Justifique a circunst\u00E2ncia '+(!capacidade ? 'com a chefia imediata': '')+'</td>'+
                        '           </tr>'+
                        '' : '')+
                        (capacidade ?
                        '           <tr>'+
                        '               <td colspan="3">'+
                        '                   <textarea id="comment_homologacao" style="height: 150px;" oninput="if ($(this).val().length > 100) {updateButtonConfirm(this, true)} else {updateButtonConfirm(this, false)}"></textarea>'+
                        '               </td>'+
                        '           </tr>'+
                        '' : '')+
                        '   </table>'+
                        '</div>';

            resetDialogBoxPro('dialogBoxPro');
            dialogBoxPro = $('#dialogBoxPro')
                .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
                .dialog({
                    title: 'Regularizar plano de trabalho',
                    width: 780,
                    open: function() { 
                        var element = $('#chartStatusUserRegulariza');
                            var mostrar_notas = jmespath.search(arrayConfigAtividades.unidades, "[?id_unidade==`"+pendencias_plano.id_unidade+"`] | [0].config.planos.mostrar_notas");
                            var apelido_display = (mostrar_notas !== null && mostrar_notas) ? 'apelido_avaliacao' : 'apelido';
                            var chartStatusUser = getSingleChartTempoPlano(element, pendencias_plano, pendencias_plano[apelido_display]);
                                chartStatusUser.options.scales.xAxes[0].ticks.display = false;
                                // chartStatusUser.options.legend.display = false;
                                // chartStatusUser.options.title = {display: true, text: unidade.nome_unidade+' - '+unidade.sigla_unidade};
                                chartStatusUser.update();
                    },
                    close: function() { 
                        $('#boxPlano').remove();
                        resetDialogBoxPro('dialogBoxPro');
                    },
                    buttons: [{
                        text: (capacidade ? 'Salvar' : 'Ok'),
                        class: 'confirm',
                        click: function(event) { 
                            if (capacidade) {
                                var comment_homologacao = $('#comment_homologacao').val();
                                if (comment_homologacao.length < 100) {
                                    alertaBoxPro('Error', 'exclamation-triangle', 'Justificativa curta.');
                                } else {
                                    var param = {
                                        action: action,
                                        id: pendencias_plano.id_plano,
                                        type: 'planos',
                                        key: comment_homologacao,
                                        mode: 'homologacao'
                                    };
                                    getServerAtividades(param, action);
                                }
                            } else {
                                $('#boxPlano').remove();
                                resetDialogBoxPro('dialogBoxPro');
                            }
                        }
                    }]
                });
    }
}
function getRowsTableTabConfig(type, mode, list = false, value = false) {
    var _return = '';
    var listUnidades = (list) ? uniqPro(jmespath.search(list, "[?sigla_unidade].sigla_unidade")) : null;
    var countUnidades = (listUnidades !== null) ? listUnidades.length : 0;
    var checkOutrasUnidades = (countUnidades > 1 || (countUnidades == 1 && arrayConfigAtivUnidade.sigla_unidade != listUnidades[0])) ? true : false;
    var isInitOffset = (typeof list.offset === 'undefined' || list.offset == 0) ? true : false;

    if (type == 'atividades') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Nome d'+__.a_Atividade+'</th>'+
                            '              <th class="tituloControle tituloFilter">Tempo Pactuado (horas)</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 160px;">Dias de Planejamento</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 350px;">Macroatividade</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 250px;">Etiquetas</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 350px;">Cadeia de Valor</th>'+
                            (checkOutrasUnidades ?
                            '              <th class="tituloControle tituloFilter" style="width: 90px;">Unidade</th>'+
                            '' : '')+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 100px;">Op\u00E7\u00F5es</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 160px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value) {
                if (value.exclude == false) {
                    var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                    var classClone = (value.nome_atividade.indexOf('(C\u00F3pia)') !== -1) ? {name: ' clone', text: 'C\u00D3PIA' } : false;
                    var classNew = (value.nome_atividade.indexOf('(Novo)') !== -1) ? {name: ' new', text: 'NOVO' } : false;
                    var classHomologa = (value.homologado) ? {name: ' approve', text: 'HOMOLOGADO' } : {name: 'disapprove', text: '' };
                    // var config = (typeof value.config !== 'undefined' && value.config !== null) ? value.config : false;
                    var tagsAtiv = (typeof value.etiquetas !== 'undefined' && value.etiquetas !== null) ? value.etiquetas.join(';') : '';
                    var tagsAtivHtml = (typeof value.etiquetas !== 'undefined' && value.etiquetas !== null) ? $.map(value.etiquetas, function (i) { return getHtmlEtiqueta(i,'ativ') }).join('') : '';

                        _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_atividade+'" data-index="'+value.id_atividade+'" class="'+classDisabled+(classClone ? ' '+classClone.name : '')+(classNew ? ' '+classNew.name : (classHomologa ? ' '+classHomologa.name : '') )+'">'+
                                    '           <td align="center" data-id="'+value.id_atividade+'">'+
                                    '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_atividade+'" name="configuracoesPro" value="'+value.id_atividade+'" '+((checkCapacidade('config_update_pgr') || !value.homologado) ? '' : 'disabled')+'></td>'+
                                    '           <td align="left" class="'+(checkCapacidade('config_update_pgr') || !value.homologado ? 'editCell' : '')+'" data-key="nome_atividade" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : (classHomologa ? ' '+classHomologa.text : '') ))+'"><span>'+value.nome_atividade+'</span></td>'+
                                    '           <td align="left" class="'+(checkCapacidade('config_update_pgr') || !value.homologado ? 'editCellNum' : '')+'" data-key="tempo_pactuado">'+value.tempo_pactuado+'</td>'+
                                    '           <td align="left" class="editCellNum" data-key="dias_planejado">'+value.dias_planejado+'</td>'+
                                    '           <td align="left" class="editCellSelect" data-array="self" data-key="macroatividade" data-value="macroatividade" data-blank-item="true" data-blank-value="">'+(value.macroatividade ? value.macroatividade : '')+'</td>'+
                                    '           <td align="left" class="" data-array="self" data-key="etiquetas" data-value="etiquetas" data-type="etiqueta" data-etiqueta-mode="tipo_ativ" class="tdfav_tags '+((tagsAtivHtml.trim() == '' && checkCapacidade('config_update_pgr') ) ? 'info_tags_follow_empty' : '')+'" >'+
                                    '               <span class="info_tags_follow">'+tagsAtivHtml+
                                    '               </span>'+
                                    (!checkCapacidade('edit_etiqueta_atividades') ? '' : 
                                    '               <span class="info_tags_follow_txt" style="display:none">'+
                                    '                   <input value="'+tagsAtiv+'" class="atividadeTagsPro">'+
                                    '               </span>'+
                                    '               <a class="newLink followLink followLinkTags followLinkTagsEdit" onclick="showFollowEtiqueta(this, \'show\', \'tipo_ativ\')" onmouseover="return infraTooltipMostrar(\'Editar etiqueta\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-edit" style="font-size: 100%;"></i></a>'+
                                    '               <a class="newLink followLink followLinkTags followLinkTagsAdd" onclick="showFollowEtiqueta(this, \'show\', \'tipo_ativ\')" onmouseover="return infraTooltipMostrar(\'Adicionar etiqueta\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-tags" style="font-size: 100%;"></i></a>'
                                    )+
                                    '           </td>'+
                                    '           <td align="left" class="editCellSelect" data-array="cadeia_valor" data-key="id_cadeia_valor" data-value="nome_processo" data-blank-item="true" data-blank-value="0">'+(value.id_cadeia_valor ? value.nome_processo : '')+'</td>'+
                                    (checkOutrasUnidades ?
                                    '           <td align="left" class="'+(checkCapacidade('config_update_pgr') || !value.homologado ? 'editCellSelect' : '')+'" data-array="unidades" data-key="id_unidade" data-value="sigla_unidade" data-new-item="false">'+value.sigla_unidade+'</td>'+
                                    '' : '')+
                                    (checkCapacidade('config_update_'+type) ? 
                                    '           <td align="left">'+
                                    '               <a class="newLink followLinkTr '+(value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 ) ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_atividade+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                    '           </td>'+
                                    '           <td align="right" data-key="action">'+
                                    (checkCapacidade('config_update_pgr') ? 
                                    '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_atividade+'" data-mode="disapprove" onclick="approveConfig(this)" onmouseover="return infraTooltipMostrar(\'Cancelar Homologa\u00E7\u00E3o\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-thumbs-down vermelhoColor" style="font-size: 100%;"></i></a>'+
                                    '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_atividade+'" data-mode="approve" onclick="approveConfig(this)" onmouseover="return infraTooltipMostrar(\'Homologar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-thumbs-up" style="font-size: 100%;"></i></a>'+
                                    '' : '')+
                                    (checkCapacidade('config_update_pgr') || !value.homologado ? 
                                    '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_atividade+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                    '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_atividade+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                    (checkCapacidade('config_new_'+type) ? 
                                    '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_atividade+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                    '' : '')+
                                    '' : '')+
                                    '           </td>'+
                                    '' : '')+
                                    '       </tr>';
                }
            } else {
                var colspan = 7;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                    colspan = (checkOutrasUnidades) ? colspan+1 : colspan;
                    _return =   '       <tr class="noData">'+
                                '           <td align="center" colspan="'+colspan+'">'+
                                '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                                '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                                '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                                '                   </div>'+
                                '               </div>'+
                                '           </td>'+
                                '       </tr>';
            }
        }
    } else if (type == 'planos') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Nome do Respons\u00E1vel</th>'+
                            (checkOutrasUnidades ?
                            '              <th class="tituloControle tituloFilter" style="width: 100px;">Unidade</th>'+
                            '' : '')+
                            '              <th class="tituloControle tituloFilter" style="min-width: 110px;">Tipo de Modalidade</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 100px;">Carga Hor\u00E1ria</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 150px;">Data de In\u00EDcio</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 150px;">Data de Encerramento</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 140px;">Meta Total do Plano (horas)</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 140px;">Meta Proporcional do Plano (horas)</th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 350px;" colspan="2">Op\u00E7\u00F5es</th>'+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 150px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value && value.show) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClosed = (moment(value.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss') < moment()) ? {name: ' closed', text: 'ENCERRADO' } : false;
                var classFuture = (moment(value.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss') > moment()) ? {name: ' future', text: 'FUTURO' } : false;
                var modalidade = jmespath.search(arrayConfigAtividades.tipos_modalidades,"[?id_tipo_modalidade==`"+value.id_tipo_modalidade+"`] | [0]");
                var view_modelos = (modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('modelos')) ? modalidade.config.modelos : false;        
                var assinatura = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.assinatura !== 'undefined' && value.config.hasOwnProperty('assinatura')) ? value.config.assinatura : false;
                var checkPlanoTrabalho = checkPlanoAntesAssinatura(value, type);
                var checkLimitePlano = calcLimitePlanosModalidade(value); 
                var classCheckLimitePlano = !checkPlanoTrabalho.check && typeof checkLimitePlano !== 'undefined' && checkLimitePlano.excede_limite ? 'editCellLoadingError' : '';
                var textExcedeLimite = !checkPlanoTrabalho.check && typeof checkLimitePlano !== 'undefined' && checkLimitePlano.excede_limite ? 'O plano de trabalho excede o limite de vagas da modalidade ('+checkLimitePlano.limite_modalidade+'% dos '+checkLimitePlano.vagas_programa+' participantes v\u00E1lidos = '+checkLimitePlano.limite_vagas+' vagas). Reduza ao menos '+(checkLimitePlano.planos_vigentes-checkLimitePlano.limite_vagas)+' vagas' : '';
                    textExcedeLimite = !checkPlanoTrabalho.check && typeof checkLimitePlano !== 'undefined' && checkLimitePlano.vagas_programa < checkLimitePlano.minimo_participantes ? 'A unidade n\u00E3o possui o m\u00EDnimo de '+checkLimitePlano.minimo_participantes+' participantes para a ades\u00E3o a essa modalidade de plano' : textExcedeLimite;
                var alertaExcedeLimite = !checkPlanoTrabalho.check && typeof checkLimitePlano !== 'undefined' && checkLimitePlano.excede_limite ? 'onmouseover="return infraTooltipMostrar(\''+textExcedeLimite+'\');" onmouseout="return infraTooltipOcultar();"' : '';

                var btnAssinatura = checkPlanoTrabalho.btn;
                    btnAssinatura = typeof btnAssinatura !== 'undefined' ? btnAssinatura : '';
                    // console.log(value, checkLimitePlano, checkPlanoTrabalho);

                var homologacao = (typeof value.homologado !== 'undefined' && value.homologado !== null && value.homologado && typeof value.config !== 'undefined' && value.config !== null && typeof value.config.homologacao !== 'undefined' && value.config.hasOwnProperty('homologacao')) ? value.config.homologacao : false;
                var btnHomologacao = (homologacao) 
                                ? '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" '+(checkCapacidade('config_update_cancela_homologa_plano') ? 'onclick="cancelHomologacaoPlano(this)"' : '')+' onmouseover="return infraTooltipMostrar(\''+value.config.homologacao.result+' em '+moment(value.config.homologacao.datetime,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm')+(value.config.homologacao.type != 'system' ? '<br>- '+value.config.homologacao.comment.replace(/(\r\n|\n|\r)/gm, "<br>") : '')+(checkCapacidade('config_update_cancela_homologa_plano') ? '<br><br><b>Clique para Cancelar a Homologa\u00E7\u00E3o</b>' : '')+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-check-double azulColor" style="font-size: 100%;"></i><i class="fas fa-'+(value.config.homologacao.type == 'system' ? 'cog' : 'user-tie')+' azulColor iconPlanoHomologa" style="font-size: 100%; margin-left: -10px;"></i></a>' 
                                : !value.homologado && !value.em_execucao && value.vigencia && value.pendencias_plano && value.pendencias_plano.presente && !value.pendencias_plano.presente.homologavel
                                    ? '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onclick="regularizaPlano(this)" data-refplano="presente" onmouseover="return infraTooltipMostrar(\'Plano de trabalho pendente de homologa\u00E7\u00E3o. Clique para mais detalhes. '+getMotivosPendenciasPlanos(value.pendencias_plano.presente)+' \');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-check-double vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>' 
                                    : '';
                var btnProdutividadeMensalPlano = !checkCapacidade('chart_produtividade_mensal') ? '' : '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onclick="getChartProdutividadeMes('+value.id_plano+')" onmouseover="return infraTooltipMostrar(\'Clique para visualizar a produtividade mensal do plano\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-chart-line azulColor" style="font-size: 100%;"></i></a>';
                var btnMemoriaCalculoPlano = '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onclick="getRelatorioMetaProporcional('+value.id_plano+')" onmouseover="return infraTooltipMostrar(\'Clique para visualizar a mem\u00F3ria de c\u00E1lculo da meta proporcional do plano\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-calculator azulColor" style="font-size: 100%;"></i></a>';
                var btnDemandasPlano = '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onclick="getTableRelatorioPlano('+value.id_plano+')" onmouseover="return infraTooltipMostrar(\'Clique para visualizar a lista de '+__.demandas+' do plano\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-check-circle azulColor" style="font-size: 100%;"></i></a>';
                
                var classAssinatura = (view_modelos && assinatura) ? 'alertAssinatura' : '';
                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_plano+'"  data-idref="'+value.id_user+'" data-idreftype="id_user" class="'+classDisabled+(classClosed ? ' '+classClosed.name : (classFuture ? classFuture.name : ''))+'">'+
                                '           <td align="center" data-id="'+value.id_plano+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_plano+'" name="configuracoesPro" value="'+value.id_plano+'" '+( (type == 'planos' && checkCapacidade('config_update_self_planos')) || checkCapacidade('config_update_'+type) ? '' : 'disabled')+'></td>'+
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) ? 'editCellSelect' : '')+' '+classAssinatura+'" data-array="usuarios" data-key="id_user" data-value="nome_completo" data-new-item="false" data-text="'+(classClosed ? classClosed.text : (classFuture ? classFuture.text : '') )+'"><span>'+value.nome_completo+'</span></td>'+
                                (checkOutrasUnidades ?
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) ? 'editCellSelect' : '')+' '+classAssinatura+'" data-array="unidades" data-key="id_unidade" data-value="sigla_unidade" data-new-item="false">'+value.sigla_unidade+'</td>'+
                                '' : '')+
                                '           <td align="left" '+alertaExcedeLimite+' class="'+classCheckLimitePlano+' '+(checkCapacidade('config_update_'+type) ? 'editCellSelect' : '')+' '+classAssinatura+'" data-array="tipos_modalidades" data-key="id_tipo_modalidade" data-value="nome_modalidade" data-new-item="false">'+value.nome_modalidade+'</td>'+
                                '           <td align="left" style="text-align:center;" class="'+(checkCapacidade('config_update_'+type) ? 'editCellNum' : '')+' '+classAssinatura+'" data-key="carga_horaria">'+value.carga_horaria+'</td>'+
                                '           <td align="left" style="text-align:center;" class="'+(checkCapacidade('config_update_'+type) ? 'editCellDate' : '')+' '+classAssinatura+'" data-key="data_inicio_vigencia" data-ref-limit="data_inicio" data-label-limit="data_fim" data-limit="max" data-time-sorter="'+moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD')+'">'+moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</td>'+
                                '           <td align="left" style="text-align:center;" class="'+(checkCapacidade('config_update_'+type) ? 'editCellDate' : '')+' '+classAssinatura+'" data-key="data_fim_vigencia" data-ref-limit="data_fim" data-label-limit="data_inicio" data-limit="min" data-time-sorter="'+moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD')+'">'+moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</td>'+
                                '           <td align="left" class="" data-key="tempo_total" style="text-align: center;">'+value.tempo_total+'</td>'+
                                '           <td align="left" class="" data-key="tempo_proporcional" style="text-align: center;">'+value.tempo_proporcional+'</td>'+
                                '           <td align="left" style="width: 190px;" data-time-sorter="'+(view_modelos && assinatura ? assinatura[0].datetime : (view_modelos ? '0000-00-00 00:00:00' : '') )+'">'+
                                '               '+btnDemandasPlano+btnProdutividadeMensalPlano+btnMemoriaCalculoPlano+btnAssinatura+btnHomologacao+
                                '           </td>'+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left" style="width: 150px;">'+
                                '               <a class="newLink followLinkTr '+(value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 ) ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_plano+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action" style="width: 200px;">'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_plano+'" data-mode="close" onclick="closeConfig(this)" onmouseover="return infraTooltipMostrar(\'Encerrar Antecipadamente\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-hourglass-end" style="font-size: 100%;"></i></a>'+
                                (checkCapacidade('config_update_pgr') ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_plano+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_plano+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                (checkCapacidade('config_new_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_plano+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else if (!value) {
                var colspan = 9;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                    colspan = (checkOutrasUnidades ) ? colspan+1 : colspan;
                    _return =   '       <tr class="noData">'+
                                '           <td align="center" colspan="'+(colspan+1)+'">'+
                                '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                                '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                                '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                                '                   </div>'+
                                '               </div>'+
                                '           </td>'+
                                '       </tr>';
            }
        }
    } else if (type == 'termos') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Nome do Respons\u00E1vel</th>'+
                            (checkOutrasUnidades ?
                            '              <th class="tituloControle tituloFilter" style="width: 100px;">Unidade</th>'+
                            '' : '')+
                            '              <th class="tituloControle tituloFilter" style="min-width: 110px;">Tipo de Modalidade</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 150px;">Data de In\u00EDcio</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 150px;">Data de Encerramento</th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 350px;" colspan="2">Op\u00E7\u00F5es</th>'+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 150px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value && value.show) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClosed = (moment(value.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss') < moment()) ? {name: ' closed', text: 'ENCERRADO' } : false;
                var classFuture = (moment(value.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss') > moment()) ? {name: ' future', text: 'FUTURO' } : false;
                var modalidade = jmespath.search(arrayConfigAtividades.tipos_modalidades,"[?id_tipo_modalidade==`"+value.id_tipo_modalidade+"`] | [0]");
                var view_modelos = (modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('modelos')) ? modalidade.config.modelos : false;        
                var assinatura = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.assinatura !== 'undefined' && value.config.hasOwnProperty('assinatura')) ? value.config.assinatura : false;
                var checkPlanoTrabalho = checkTermoAntesAssinatura(value, type);
                var btnAssinatura = checkPlanoTrabalho.btn;
                    btnAssinatura = typeof btnAssinatura !== 'undefined' ? btnAssinatura : '';
                var classAssinatura = (view_modelos && assinatura) ? 'alertAssinatura' : '';

                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_termo+'"  data-idref="'+value.id_user+'" data-idreftype="id_user" class="'+classDisabled+(classClosed ? ' '+classClosed.name : (classFuture ? classFuture.name : ''))+'">'+
                                '           <td align="center" data-id="'+value.id_termo+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_termo+'" name="configuracoesPro" value="'+value.id_termo+'" '+( (type == 'planos' && checkCapacidade('config_update_self_planos')) || checkCapacidade('config_update_'+type) ? '' : 'disabled')+'></td>'+
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) ? 'editCellSelect' : '')+' '+classAssinatura+'" data-array="usuarios" data-key="id_user" data-value="nome_completo" data-new-item="false" data-text="'+(classClosed ? classClosed.text : (classFuture ? classFuture.text : '') )+'"><span>'+value.nome_completo+'</span></td>'+
                                (checkOutrasUnidades ?
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) ? 'editCellSelect' : '')+' '+classAssinatura+'" data-array="unidades" data-key="id_unidade" data-value="sigla_unidade" data-new-item="false">'+value.sigla_unidade+'</td>'+
                                '' : '')+
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) ? 'editCellSelect' : '')+' '+classAssinatura+'" data-array="tipos_modalidades" data-key="id_tipo_modalidade" data-value="nome_modalidade" data-new-item="false">'+value.nome_modalidade+'</td>'+
                                '           <td align="left" style="text-align:center;" class="'+(checkCapacidade('config_update_'+type) ? 'editCellDate' : '')+' '+classAssinatura+'" data-key="data_inicio_vigencia" data-ref-limit="data_inicio" data-label-limit="data_fim" data-limit="max" data-time-sorter="'+moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD')+'">'+moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</td>'+
                                '           <td align="left" style="text-align:center;" class="'+classAssinatura+'" data-time-sorter="'+(value.data_fim_vigencia == '0000-00-00 00:00:00' ? '0000-00-00' : moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD'))+'">'+(value.data_fim_vigencia == '0000-00-00 00:00:00' ? '-' : moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY'))+'</td>'+
                                '           <td align="left" style="width: 190px;" data-time-sorter="'+(view_modelos && assinatura ? assinatura[0].datetime : (view_modelos ? '0000-00-00 00:00:00' : '') )+'">'+
                                '               '+btnAssinatura+
                                '           </td>'+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left" style="width: 150px;">'+
                                '               <a class="newLink followLinkTr '+(value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 ) ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_termo+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action" style="width: 200px;">'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_termo+'" data-mode="close" onclick="closeConfig(this)" onmouseover="return infraTooltipMostrar(\'Encerrar Antecipadamente\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-hourglass-end" style="font-size: 100%;"></i></a>'+
                                (checkCapacidade('config_update_pgr') ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_termo+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_termo+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                (checkCapacidade('config_new_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_termo+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else if (!value) {
                var colspan = 9;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                    colspan = (checkOutrasUnidades ) ? colspan+1 : colspan;
                    _return =   '       <tr class="noData">'+
                                '           <td align="center" colspan="'+(colspan+1)+'">'+
                                '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                                '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                                '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                                '                   </div>'+
                                '               </div>'+
                                '           </td>'+
                                '       </tr>';
            }
        }
    } else if (type == 'programas') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            (checkOutrasUnidades ?
                            '              <th class="tituloControle tituloFilter">Unidade</th>'+
                            '' : '')+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle tituloFilter" style="width: 150px;">Data de In\u00EDcio</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 150px;">Data de Encerramento</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 80px;">Planos V\u00E1lidos</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 80px;">Qtd. de Demandas</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 80px;">Meta Total (horas)</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 80px;">Meta Proporcional (horas)</th>'+
                            (!checkOptionEntidade('desativa_produtividade_geral') ? 
                            '              <th class="tituloControle tituloFilter" style="width: 80px;">Produtividade M\u00E9dia (%)</th>'+
                            '' : '')+
                            '              <th class="tituloControle tituloFilter" style="width: 80px;">Execu\u00E7\u00E3o (%)</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 100px;">Op\u00E7\u00F5es</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 120px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClosed = (moment(value.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss') < moment()) ? {name: ' closed', text: 'ENCERRADO' } : false;
                var classFuture = (moment(value.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss') > moment()) ? {name: ' future', text: 'FUTURO' } : false;
                var produtividade = parseFloat((value.produtividade*100).toFixed(2));
                var execucao_plano = parseFloat((value.execucao_plano*100).toFixed(2));
                var btnConformidade = checkProgramaConformidade(value, type).btn;

                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_programa+'" data-idref="'+value.id_unidade+'" data-idreftype="id_unidade" class="'+classDisabled+(classClosed ? ' '+classClosed.name : (classFuture ? classFuture.name : ''))+'">'+
                                '           <td align="center" data-id="'+value.id_programa+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_programa+'" name="configuracoesPro" value="'+value.id_programa+'" '+(checkCapacidade('config_update_'+type) ? '' : 'disabled')+'></td>'+
                                (checkOutrasUnidades ?
                                '           <td align="left" class="editCellSelect" data-array="unidades" data-key="id_unidade" data-value="nome_unidade" data-new-item="false">'+value.nome_unidade+'</td>'+
                                '' : '')+
                                '           <td align="left" class="editCellDate" data-key="data_inicio_vigencia" data-ref-limit="data_inicio" data-label-limit="data_fim" data-limit="max" data-time-sorter="'+moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD')+'">'+moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</td>'+
                                '           <td align="left" class="editCellDate" data-key="data_fim_vigencia" data-ref-limit="data_fim" data-label-limit="data_inicio" data-limit="min" data-time-sorter="'+moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD')+'">'+moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</td>'+
                                '           <td align="left" class="" data-key="total_planos" style="text-align: center;">'+value.total_planos+'</td>'+
                                '           <td align="left" class="" data-key="quantidade_demandas" style="text-align: center;">'+value.quantidade_demandas+'</td>'+
                                '           <td align="left" class="" data-key="tempo_total" style="text-align: center;">'+value.tempo_total+'</td>'+
                                '           <td align="left" class="" data-key="tempo_proporcional" style="text-align: center;">'+value.tempo_proporcional+'</td>'+
                                (!checkOptionEntidade('desativa_produtividade_geral') ? 
                                '           <td align="left" class="" data-key="produtividade" style="text-align: center;">'+produtividade+'</td>'+
                                '' : '')+
                                '           <td align="left" class="" data-key="execucao_plano" style="text-align: center;">'+execucao_plano+'</td>'+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left">'+btnConformidade+
                                '               <a class="newLink followLinkTr '+(value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 ) ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_programa+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action">'+
                                (checkCapacidade('config_update_pgr') ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_programa+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_programa+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                (checkCapacidade('config_new_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_programa+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else {
                var colspan = 12;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                    colspan = (checkOutrasUnidades) ? colspan+1 : colspan;
                _return =   '       <tr class="noData">'+
                            '           <td align="center" colspan="'+colspan+'">'+
                            '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                            '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                            '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                            '                   </div>'+
                            '               </div>'+
                            '           </td>'+
                            '       </tr>';
            }
        }
    } else if (type == 'users') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Nome Completo</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 150px;">Apelido</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 150px;">Matr\u00EDcula</th>'+
                            (checkCapacidade('view_lgpd') ? 
                            '              <th class="tituloControle tituloFilter" style="width: 150px;">CPF</th>'+
                            '' : '')+
                            '              <th class="tituloControle tituloFilter" style="width: 150px;">Usu\u00E1rio SEI</th>'+
                            '              <th class="tituloControle tituloFilter">E-mail</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 200px;" data-filter-type="lotacao">Lota\u00E7\u00E3o</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 120px;">Perfil</th>'+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 100px;">Op\u00E7\u00F5es</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 120px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClone = (value.nome_completo.indexOf('(C\u00F3pia)') !== -1) ? {name: ' clone', text: 'C\u00D3PIA' } : false;
                var classNew = (value.nome_completo.indexOf('(Novo)') !== -1) ? {name: ' new', text: 'NOVO' } : false;
                var lotacao = (value.lotacao !== null) ? $.map(value.lotacao, function(v){ 
                                                            var tagName = normalizeNameTag(v.sigla_unidade);
                                                            var tagColor = (typeof v.config_lotacao !== 'undefined' && v.config_lotacao !== null && v.config_lotacao.principal)  ? {color: '#bfd5e8', background: '#406987', textcolor: 'white'} : {color: '#406987', background: '#bfd5e8', textcolor: 'black'};
                                                            return  '<span data-tagname="'+tagName+'" data-textcolor="'+tagColor.textcolor+'" data-icontag="briefcase" data-type="lotacao" style="background-color: '+tagColor.background+'; color: '+tagColor.color+';" class="tag_text tagTableText_'+tagName+'" onclick="filterTagView(this)" data-colortag="'+tagColor.color+'">'+
                                                                    '   <i class="tagicon fas fa-briefcase" style="font-size: 90%;margin: 0 2px; color: '+tagColor.color+'"></i>'+
                                                                    '   '+v.sigla_unidade+
                                                                    '</span>';
                                                        }).join('') : false;
                    lotacao = (lotacao) ? '<span class="info_tags_follow" style="display: block;">'+lotacao+'</span>' : '';
                var tagsConfigClass = (lotacao) ? $.map(value.lotacao, function (i) { return 'tagTableName_'+normalizeNameTag(i.sigla_unidade); }).join(' ') : '';   

                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_user+'" class="'+tagsConfigClass+' '+classDisabled+(classClone ? ' '+classClone.name : '')+(classNew ? ' '+classNew.name : '')+'">'+
                                '           <td align="center" data-id="'+value.id_user+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_user+'" name="configuracoesPro" value="'+value.id_user+'" '+(checkCapacidade('config_update_'+type) ? '' : 'disabled')+'></td>'+
                                '           <td align="left" class="editCell" data-key="nome_completo" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : ''))+'"><span>'+value.nome_completo+'</span></td>'+
                                '           <td align="left" class="editCell" data-key="apelido">'+value.apelido+'</td>'+
                                '           <td align="left" class="editCell" data-key="matricula">'+value.matricula+'</td>'+
                                (checkCapacidade('view_lgpd') ? 
                                '           <td align="left" class="editCellCPF" data-key="cpf">'+(typeof value.cpf !== 'undefined' && value.cpf !== null ? maskCPF(value.cpf) : '')+'</td>'+
                                '' : '')+
                                '           <td align="left" class="editCell" data-key="login">'+value.login+'</td>'+
                                '           <td align="left" class="editCell" data-key="email">'+value.email+'</td>'+
                                '           <td align="left" class="" data-key="lotacao">'+
                                '               '+lotacao+
                                // '               <table style="width: 110px;float: right;" data-id="'+value.id_user+'"><tr data-id="'+value.keys[0].id_hash+'"><td style="height: 25px !important;"><a class="newLink keyVigente keyResend" style="font-size: 10pt; cursor:pointer;" onclick="configUpdateKey(this,\'resend_key\')"><i class="fas fa-envelope-open-text" data-icon="fas fa-envelope-open-text" style="font-size: 100%;"></i>Reenviar</a></td></tr></table>'+
                                '           </td>'+
                                '           <td align="left" data-key="perfil">'+value.nome_perfil+'</td>'+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left">'+
                                '               <a class="newLink followLinkTr '+(value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 ) ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_user+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action">'+
                                (checkCapacidade('config_users_all') ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_user+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_user+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                (checkCapacidade('config_new_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_user+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else {
                var colspan = 9;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                    colspan = (checkOutrasUnidades) ? colspan+1 : colspan;
                _return =   '       <tr class="noData">'+
                            '           <td align="center" colspan="'+colspan+'">'+
                            '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                            '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                            '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                            '                   </div>'+
                            '               </div>'+
                            '           </td>'+
                            '       </tr>';
            }
        }
    } else if (type == 'unidades') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Nome da Unidade</th>'+
                            '              <th class="tituloControle tituloFilter">Sigla da Unidade</th>'+
                            '              <th class="tituloControle tituloFilter">C\u00F3digo SIORG</th>'+
                            '              <th class="tituloControle tituloFilter">Depend\u00EAncia</th>'+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 100px;">Op\u00E7\u00F5es</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 120px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClone = (value.nome_unidade.indexOf('(C\u00F3pia)') !== -1) ? {name: ' clone', text: 'C\u00D3PIA' } : false;
                var classNew = (value.nome_unidade.indexOf('(Novo)') !== -1) ? {name: ' new', text: 'NOVO' } : false;
                var config = (value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 )) ? value.config : false;
                var dependencia_config = (value.dependencia_config && value.dependencia_config !== null && (Object.keys(value.dependencia_config).length > 0 || value.dependencia_config.length > 0 )) ? value.dependencia_config : false;
                var autoedicao_subordinadas = (dependencia_config && dependencia_config !== null && typeof dependencia_config.administrativo !== 'undefined' && typeof dependencia_config.administrativo.autoedicao_subordinadas !== 'undefined' && dependencia_config.administrativo.autoedicao_subordinadas) ? dependencia_config.administrativo.autoedicao_subordinadas : false;
                var checkAutoEdit = (checkCapacidade('config_unidades_all') || arrayConfigAtivUnidade.dependencia == 0 || (arrayConfigAtivUnidade.dependencia != 0 && jmespath.search(tableConfigList.unidades, "[?dependencia==`"+arrayConfigAtivUnidade.dependencia+"`] | [0].dependencia_config.administrativo.autoedicao_subordinadas")) || value.dependencia == 0 || autoedicao_subordinadas) ? true : false;
                // console.log(value.nome_unidade, value.dependencia, autoedicao_subordinadas, checkAutoEdit, tableConfigList.unidades);
                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_unidade+'" class="'+classDisabled+(classClone ? ' '+classClone.name : '')+(classNew ? ' '+classNew.name : '')+'">'+
                                '           <td align="center" data-id="'+value.id_unidade+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_unidade+'" name="configuracoesPro" value="'+value.id_unidade+'" '+(checkCapacidade('config_update_'+type) && checkAutoEdit ? '' : 'disabled')+'></td>'+
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) && checkAutoEdit ? 'editCell' : '')+'" data-key="nome_unidade" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : ''))+'"><span>'+value.nome_unidade+'</span></td>'+
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) && checkAutoEdit ? 'editCell' : '')+'" data-key="sigla_unidade">'+value.sigla_unidade+'</td>'+
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) && checkAutoEdit ? 'editCell' : '')+'" data-key="cod_siorg">'+value.cod_siorg+'</td>'+
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) && checkAutoEdit ? 'editCellSelect' : '')+'" data-array="unidades_all" data-keyref="id_unidade" data-key="dependencia" data-value="sigla_unidade" data-new-item="false" data-blank-item="true">'+(value.dependencia_sigla ? value.dependencia_sigla : '')+'</td>'+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left">'+
                                '               <a class="newLink followLinkTr '+(config ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_unidade+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action">'+
                                (checkCapacidade('config_update_'+type) && checkAutoEdit ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_unidade+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_unidade+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                (checkCapacidade('config_new_'+type) && checkAutoEdit ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_unidade+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else {
                var colspan = 5;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                _return =   '       <tr class="noData">'+
                            '           <td align="center" colspan="'+colspan+'">'+
                            '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                            '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                            '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                            '                   </div>'+
                            '               </div>'+
                            '           </td>'+
                            '       </tr>';
            }
        }
    } else if (type == 'cadeia_valor') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Nome do Processo</th>'+
                            '              <th class="tituloControle tituloFilter">Depend\u00EAncia</th>'+
                            '              <th class="tituloControle tituloFilter">Selecion\u00E1vel</th>'+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 100px;">Op\u00E7\u00F5es</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 120px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClone = (value.nome_processo.indexOf('(C\u00F3pia)') !== -1) ? {name: ' clone', text: 'C\u00D3PIA' } : false;
                var classNew = (value.nome_processo.indexOf('(Novo)') !== -1) ? {name: ' new', text: 'NOVO' } : false;
                var config = (value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 )) ? value.config : false;
                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_cadeia_valor+'" class="'+classDisabled+(classClone ? ' '+classClone.name : '')+(classNew ? ' '+classNew.name : '')+'">'+
                                '           <td align="center" data-id="'+value.id_cadeia_valor+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_cadeia_valor+'" name="configuracoesPro" value="'+value.id_cadeia_valor+'" '+(checkCapacidade('config_update_'+type) ? '' : 'disabled')+'></td>'+
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) ? 'editCell' : '')+'" data-key="nome_processo" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : ''))+'"><span>'+value.nome_processo+'</span></td>'+
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) ? 'editCellSelect' : '')+'" data-array="cadeia_valor" data-keyref="id_cadeia_valor" data-key="dependencia" data-value="nome_processo" data-new-item="false" data-blank-item="true">'+(value.dependencia_nome ? value.dependencia_nome : '')+'</td>'+
                                '           <td align="left" data-key="selecionavel" style="text-align: center;">'+
                                '              <div class="onoffswitch" style="transform: scale(0.8);display: inline-block;">'+
                                '                  <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox switch_selecionavel" onchange="changeSwitchConfigTable(this)" id="changeItemConfig_'+type+'_'+value.id_cadeia_valor+'" tabindex="0" '+(value.selecionavel && value.selecionavel == 1  ? 'checked' : '')+' '+(checkCapacidade('config_update_'+type) ? '' : 'disabled')+'>'+
                                '                  <label class="onoffswitch-label" for="changeItemConfig_'+type+'_'+value.id_cadeia_valor+'"></label>'+
                                '              </div>'+
                                '           </td>'+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left">'+
                                '               <a class="newLink followLinkTr '+(config ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_cadeia_valor+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action">'+
                                (checkCapacidade('config_update_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_cadeia_valor+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_cadeia_valor+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                (checkCapacidade('config_new_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_cadeia_valor+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else {
                var colspan = 4;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                _return =   '       <tr class="noData">'+
                            '           <td align="center" colspan="'+colspan+'">'+
                            '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                            '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                            '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                            '                   </div>'+
                            '               </div>'+
                            '           </td>'+
                            '       </tr>';
            }
        }
    } else if (type == 'tipos_prescricoes') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Nome da '+__.Prescricao+'</th>'+
                            '              <th class="tituloControle tituloFilter">Prazo (Dias)</th>'+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 100px;">Op\u00E7\u00F5es</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 120px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClone = (value.nome_prescricao.indexOf('(C\u00F3pia)') !== -1) ? {name: ' clone', text: 'C\u00D3PIA' } : false;
                var classNew = (value.nome_prescricao.indexOf('(Novo)') !== -1) ? {name: ' new', text: 'NOVO' } : false;
                var config = (value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 )) ? value.config : false;
                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_tipo_prescricao+'" class="'+classDisabled+(classClone ? ' '+classClone.name : '')+(classNew ? ' '+classNew.name : '')+'">'+
                                '           <td align="center" data-id="'+value.id_tipo_prescricao+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_tipo_prescricao+'" name="configuracoesPro" value="'+value.id_tipo_prescricao+'" '+(checkCapacidade('config_update_'+type) ? '' : 'disabled')+'></td>'+
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) ? 'editCell' : '')+'" data-key="nome_prescricao" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : ''))+'"><span>'+value.nome_prescricao+'</span></td>'+
                                '           <td align="left" class="editCellNum" data-key="prazo">'+value.prazo+'</td>'+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left">'+
                                '               <a class="newLink followLinkTr '+(config ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_tipo_prescricao+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action">'+
                                (checkCapacidade('config_update_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_tipo_prescricao+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_tipo_prescricao+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                (checkCapacidade('config_new_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_tipo_prescricao+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else {
                var colspan = 3;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                _return =   '       <tr class="noData">'+
                            '           <td align="center" colspan="'+colspan+'">'+
                            '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                            '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                            '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                            '                   </div>'+
                            '               </div>'+
                            '           </td>'+
                            '       </tr>';
            }
        }
    } else if (type == 'entidades') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Nome da Entidade</th>'+
                            '              <th class="tituloControle tituloFilter">Sigla da Entidade</th>'+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 100px;">Op\u00E7\u00F5es</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 120px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClone = (value.nome_entidade.indexOf('(C\u00F3pia)') !== -1) ? {name: ' clone', text: 'C\u00D3PIA' } : false;
                var classNew = (value.nome_entidade.indexOf('(Novo)') !== -1) ? {name: ' new', text: 'NOVO' } : false;
                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_entidade+'" class="'+classDisabled+(classClone ? ' '+classClone.name : '')+(classNew ? ' '+classNew.name : '')+'">'+
                                '           <td align="center" data-id="'+value.id_entidade+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_entidade+'" name="configuracoesPro" value="'+value.id_entidade+'" '+(checkCapacidade('config_update_'+type) ? '' : 'disabled')+'></td>'+
                                '           <td align="left" class="editCell" data-key="nome_entidade" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : ''))+'"><span>'+value.nome_entidade+'</span></td>'+
                                '           <td align="left" class="editCell" data-key="sigla_entidade">'+value.sigla_entidade+'</td>'+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left">'+
                                '               <a class="newLink followLinkTr '+(value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 ) ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_entidade+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action">'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_entidade+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_entidade+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                (checkCapacidade('config_new_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_entidade+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else {
                var colspan = 4;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                _return =   '       <tr class="noData">'+
                            '           <td align="center" colspan="'+colspan+'">'+
                            '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                            '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                            '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                            '                   </div>'+
                            '               </div>'+
                            '           </td>'+
                            '       </tr>';
            }
        }
    } else if (type == 'nomenclaturas') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Nome da Nomenclatura</th>'+
                            '              <th class="tituloControle tituloFilter">Refer\u00EAncia</th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Descri\u00E7\u00E3o</th>'+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 100px;">Op\u00E7\u00F5es</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 120px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClone = (value.nome_nomenclatura.indexOf('(C\u00F3pia)') !== -1) ? {name: ' clone', text: 'C\u00D3PIA' } : false;
                var classNew = (value.nome_nomenclatura.indexOf('(Novo)') !== -1) ? {name: ' new', text: 'NOVO' } : false;
                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_nomenclatura+'" class="'+classDisabled+(classClone ? ' '+classClone.name : '')+(classNew ? ' '+classNew.name : '')+'">'+
                                '           <td align="center" data-id="'+value.id_nomenclatura+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_nomenclatura+'" name="configuracoesPro" value="'+value.id_nomenclatura+'" '+(checkCapacidade('config_update_'+type) ? '' : 'disabled')+'></td>'+
                                '           <td align="left" class="editCell" data-key="nome_nomenclatura" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : ''))+'"><span>'+value.nome_nomenclatura+'</span></td>'+
                                '           <td align="left" class="editCell" data-key="ref_nomenclatura">'+value.ref_nomenclatura+'</td>'+
                                '           <td align="left" class="editCell" data-key="descricao">'+value.descricao+'</td>'+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left">'+
                                '               <a class="newLink followLinkTr '+(value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 ) ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_nomenclatura+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action">'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_nomenclatura+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_nomenclatura+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                (checkCapacidade('config_new_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_nomenclatura+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else {
                var colspan = 4;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                _return =   '       <tr class="noData">'+
                            '           <td align="center" colspan="'+colspan+'">'+
                            '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                            '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                            '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                            '                   </div>'+
                            '               </div>'+
                            '           </td>'+
                            '       </tr>';
            }
        }
    } else if (type == 'perfis') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Tipo de Perfil</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 160px;">N\u00EDvel</th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Descri\u00E7\u00E3o</th>'+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 100px;">Op\u00E7\u00F5es</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 120px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClone = (value.nome_perfil.indexOf('(C\u00F3pia)') !== -1) ? {name: ' clone', text: 'C\u00D3PIA' } : false;
                var classNew = (value.nome_perfil.indexOf('(Novo)') !== -1) ? {name: ' new', text: 'NOVO' } : false;
                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_perfil+'" class="'+classDisabled+(classClone ? ' '+classClone.name : '')+(classNew ? ' '+classNew.name : '')+'">'+
                                '           <td align="center" data-id="'+value.id_perfil+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_perfil+'" name="configuracoesPro" value="'+value.id_perfil+'" '+(checkCapacidade('config_update_'+type) ? '' : 'disabled')+'></td>'+
                                '           <td align="left" class="editCell" data-key="nome_perfil" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : ''))+'"><span>'+value.nome_perfil+'</span></td>'+
                                '           <td align="left" class="editCellNum" data-key="nivel">'+value.nivel+'</td>'+
                                '           <td align="left" class="editCell" data-key="descricao">'+(value.descricao || '')+'</td>'+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left">'+
                                '               <a class="newLink followLinkTr '+(value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 ) ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_perfil+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action">'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_perfil+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_perfil+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                (checkCapacidade('config_new_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_perfil+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else {
                var colspan = 4;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                _return =   '       <tr class="noData">'+
                            '           <td align="center" colspan="'+colspan+'">'+
                            '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                            '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                            '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                            '                   </div>'+
                            '               </div>'+
                            '           </td>'+
                            '       </tr>';
            }
        }
    } else if (type == 'tipos_metadados') {
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Nome do Metadado</th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Refer\u00EAncia do Metadado</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 160px;">Tipo de Metadado</th>'+
                            '              <th class="tituloControle tituloFilter" style="width: 160px;">Dado Sens\u00EDvel (LGPD)</th>'+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 100px;">Op\u00E7\u00F5es</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="min-width: 120px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClone = (value.nome_metadado.indexOf('(C\u00F3pia)') !== -1) ? {name: ' clone', text: 'C\u00D3PIA' } : false;
                var classNew = (value.nome_metadado.indexOf('(Novo)') !== -1) ? {name: ' new', text: 'NOVO' } : false;
                var nome_tipo_metadado = jmespath.search(listLabelsTiposMetadados,"[?value=='"+value.tipo_metadado+"'] | [0].label");
                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="id_'+type.slice(0, -1)+'" data-id="'+value.id_tipo_metadado+'" class="'+classDisabled+(classClone ? ' '+classClone.name : '')+(classNew ? ' '+classNew.name : '')+'">'+
                                '           <td align="center" data-id="'+value.id_tipo_metadado+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_tipo_metadado+'" name="configuracoesPro" value="'+value.id_tipo_metadado+'" '+(checkCapacidade('config_update_'+type) ? '' : 'disabled')+'></td>'+
                                '           <td align="left" class="editCell" data-key="nome_metadado" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : ''))+'"><span>'+value.nome_metadado+'</span></td>'+
                                '           <td align="left" class="editCell" data-key="ref_metadado">'+(value.ref_metadado || '')+'</td>'+
                                '           <td align="left" class="editCellSelect" data-array="'+type+'" data-key="tipo_metadado" data-value="tipo_metadado" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : ''))+'" data-new-item="false" data-blank-item="false" data-key="tipo_metadado">'+(nome_tipo_metadado || '')+'</td>'+
                                '           <td align="left" data-key="lgpd" style="text-align: center;">'+
                                '              <div class="onoffswitch" style="transform: scale(0.8);display: inline-block;">'+
                                '                  <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox switch_lgpd" onchange="changeSwitchConfigTable(this)" id="changeItemConfig_'+type+'_'+value.id_tipo_metadado+'" tabindex="0" '+(value.lgpd && value.lgpd == 1  ? 'checked' : '')+' '+(checkCapacidade('config_update_'+type) ? '' : 'disabled')+'>'+
                                '                  <label class="onoffswitch-label" for="changeItemConfig_'+type+'_'+value.id_tipo_metadado+'"></label>'+
                                '              </div>'+
                                '           </td>'+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left">'+
                                '               <a class="newLink followLinkTr '+(value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 ) ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value.id_tipo_metadado+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action">'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_tipo_metadado+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_tipo_metadado+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                (checkCapacidade('config_new_'+type) ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value.id_tipo_metadado+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else {
                var colspan = 4;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                _return =   '       <tr class="noData">'+
                            '           <td align="center" colspan="'+colspan+'">'+
                            '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                            '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                            '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                            '                   </div>'+
                            '               </div>'+
                            '           </td>'+
                            '       </tr>';
            }
        }
    } else if (
            type == 'tipos_documentos' ||
            type == 'tipos_justificativas' ||
            type == 'tipos_modalidades' ||
            type == 'tipos_motivos' ||
            type == 'tipos_capacidades' ||
            type == 'perfis' ||
            type == 'tipos_requisicoes'
        ) {
            param = (type == 'tipos_documentos') ? {name_head: 'Tipo de Documento', label_id: 'id_tipo_documento', label_name: 'nome_documento', icon: 'fas fa-file-alt', index: 6, edit_table: true, col_descricao: false} : null;
            param = (type == 'tipos_requisicoes') ? {name_head: 'Tipo de Requisi\u00E7\u00E3o', label_id: 'id_tipo_requisicao', label_name: 'nome_requisicao', icon: 'fas fa-inbox', index: 7, edit_table: true, col_descricao: false} : param;
            param = (type == 'tipos_justificativas') ? {name_head: 'Tipo de Justificativa de Avalia\u00E7\u00E3o', label_id: 'id_tipo_justificativa', label_name: 'nome_justificativa', icon: 'fas fa-star', index: 8, edit_table: true, col_descricao: false} : param;
            param = (type == 'tipos_modalidades') ? {name_head: 'Tipo de Modalidade de Trabalho', label_id: 'id_tipo_modalidade', label_name: 'nome_modalidade', icon: 'fas fa-wrench', index: 9, edit_table: true, col_descricao: false} : param;
            param = (type == 'tipos_motivos') ? {name_head: 'Tipo de Motivos de Afastamento', label_id: 'id_tipo_motivo', label_name: 'nome_motivo', icon: 'fas fa-luggage-cart', index: 10, edit_table: true, col_descricao: false} : param;
            param = (type == 'tipos_capacidades') ? {name_head: 'Tipo de Capacidade', label_id: 'id_tipo_capacidade', label_name: 'nome_capacidade', icon: 'fas fa-users-cog', index: 11, edit_table: true, col_descricao: true} : param;
            param = (type == 'perfis') ? {name_head: 'Tipo de Perfil', label_id: 'id_perfil', label_name: 'nome_perfil', icon: 'fas fa-shield-alt', index: 12, edit_table: true, col_descricao: true} : param;
    
        if (mode == 'header') {
                _return =   (!isInitOffset) ? '' : 
                            '          <tr class="tableHeader">'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_configuracoes_'+type+'" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_configuracoes_'+type+'" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck_'+type+'"></a></th>'+
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">'+param.name_head+'</th>'+
                            (param.col_descricao ?
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Descri\u00E7\u00E3o</th>'+
                            '': '')+
                            (type == 'tipos_capacidades' ?
                            '              <th class="tituloControle tituloFilter" style="min-width: 250px;">Vincula\u00E7\u00E3o</th>'+
                            '': '')+
                            (checkCapacidade('config_update_'+type) ? 
                            '              <th class="tituloControle" data-sorter="false" style="width: 100px;">Op\u00E7\u00F5es</th>'+
                            '              <th class="tituloControle" data-sorter="false" style="width: 120px;">A\u00E7\u00F5es</th>'+
                            '' : '')+
                            '          </tr>';
        } else if (mode == 'body') {
            if (value) {
                var classDisabled = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? ' disabled' : '';
                var classClone = (value[param.label_name].indexOf('(C\u00F3pia)') !== -1) ? {name: ' clone', text: 'C\u00D3PIA' } : false;
                var classNew = (value[param.label_name].indexOf('(Novo)') !== -1) ? {name: ' new', text: 'NOVO' } : false;
                    _return =   '       <tr data-tagname="SemGrupo" data-type="'+type+'" data-rowindex="'+value[param.label_id]+'" data-id="'+value[param.label_id]+'" class="'+classDisabled+(classClone ? ' '+classClone.name : '')+(classNew ? ' '+classNew.name : '')+'">'+
                                '           <td align="center" data-id="'+value[param.label_id]+'">'+
                                '               <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value[param.label_id]+'" value="'+value[param.label_id]+'" name="configuracoesPro" '+(checkCapacidade('config_update_'+type) && param.edit_table ? '' : 'disabled')+'></td>'+
                                (type == 'tipos_documentos' || type == 'tipos_requisicoes' ? 
                                '           <td align="left" class="editCellSelect" data-array="'+type+'" data-key="'+param.label_name+'" data-value="'+param.label_name+'" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : ''))+'" data-new-item="false" data-blank-item="true">'+(value[param.label_name] ? value[param.label_name] : '')+'</td>'+
                                '' : 
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) && param.edit_table ? 'editCell' : '')+'" data-key="'+param.label_name+'" data-text="'+(classNew ? classNew.text : (classClone ? classClone.text : ''))+'"><span>'+value[param.label_name]+'</span></td>'+
                                (param.col_descricao ?
                                '           <td align="left" class="'+(checkCapacidade('config_update_'+type) && param.edit_table ? 'editCell' : '')+'" data-key="descricao"><span>'+(value.descricao !== null ? value.descricao : '')+'</span></td>'+
                                '': '')+
                                (type == 'tipos_capacidades' ?
                                '           <td align="left" data-key="lista_perfis"><span>'+(value.lista_perfis !== null ? value.lista_perfis : '')+'</span></td>'+
                                '': '')+
                                '')+
                                (checkCapacidade('config_update_'+type) ? 
                                '           <td align="left">'+
                                '               <a class="newLink followLinkTr '+(value.config && value.config !== null && (Object.keys(value.config).length > 0 || value.config.length > 0 ) ? 'newLink_selected' : '')+'" style="font-size: 10pt;" onclick="editConfigOptions(this, '+value[param.label_id]+')"><i class="fas fa-plus-circle" style="font-size: 100%;"></i>Op\u00E7\u00F5es</a>'+
                                '           </td>'+
                                '           <td align="right" data-key="action">'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value[param.label_id]+'" data-mode="disable" onclick="disableConfig_(this)" onmouseover="return infraTooltipMostrar(\'Desativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-times-circle" style="font-size: 100%;"></i></a>'+
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value[param.label_id]+'" data-mode="reactive" onclick="reactiveConfig(this)" onmouseover="return infraTooltipMostrar(\'Reativar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-undo-alt" style="font-size: 100%;"></i></a>'+
                                (checkCapacidade('config_new_'+type) && param.edit_table ? 
                                '               <a class="newLink followLinkTr" data-type="'+type+'" data-id="'+value[param.label_id]+'" data-mode="clone" onclick="cloneConfig(this)" onmouseover="return infraTooltipMostrar(\'Duplicar\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-copy" style="font-size: 100%;"></i></a>'+
                                '' : '')+
                                '           </td>'+
                                '' : '')+
                                '       </tr>';
            } else {
                var colspan = 4;
                    colspan = (checkCapacidade('config_update_'+type)) ? colspan+1 : colspan;
                    colspan = (checkOutrasUnidades) ? colspan+1 : colspan;
                _return =   '       <tr class="noData">'+
                            '           <td align="center" colspan="'+colspan+'">'+
                            '               <div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                            '                   <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                            '                   '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                            '                   </div>'+
                            '               </div>'+
                            '           </td>'+
                            '       </tr>';
            }
        }
    }
    return _return;
}
function cancelHomologacaoPlano(this_) {
    var _this = $(this_);
    var data = _this.closest('tr').data();
    confirmaFraseBoxPro('O plano de trabalho j\u00E1 foi homologado. Tem certeza que deseja <b style="font-weight: bold;">CANCELAR</b>?', 'CANCELAR', function() { 
        getCancelHomologacaoPlano(this_, data.id);
    });
}
function getCancelHomologacaoPlano(this_, id_plano) {
    var _this = $(this_);
    if (id_plano > 0) {
        var action = 'config_update_cancela_homologa_plano';
        var param = {
            action: action,
            type: 'planos',
            mode: 'update',
            id: id_plano
        };
        getServerAtividades(param, action);
        _this.find('.iconPlanoHomologa').attr('class','fas fa-spinner fa-spin azulColor');
        infraTooltipOcultar();
    }
}
function checkProgramaConformidade(value, type) {
    var entidade = jmespath.search(arrayConfigAtividades.entidades, "[?id_entidade==`"+value.id_entidade+"`] | [0]");
    var limiteMesesPrograma = (entidade !== null && entidade.hasOwnProperty('config') && typeof entidade.config !== 'undefined' && entidade.config !== null && entidade.config.hasOwnProperty('limite_meses_programas')) ? entidade.config.limite_meses_programas : 6;
    var nrMesesPrograma = moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').diff(moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss'), 'months');
        nrMesesPrograma = typeof nrMesesPrograma !== 'undefined' && nrMesesPrograma !== null ? nrMesesPrograma+1 : 0;
    var limitarAnoCivil = (entidade !== null && entidade.hasOwnProperty('config') && typeof entidade.config !== 'undefined' && entidade.config !== null && entidade.config.hasOwnProperty('limitar_ano_civil')) ? entidade.config.limitar_ano_civil : false;
    var checkLimiteAnoCivil = (limitarAnoCivil && moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss') > moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').endOf('year')) ? false : true;
    var returnConformidade = (checkLimiteAnoCivil && nrMesesPrograma <= limiteMesesPrograma) 
            ? {
                check: true,
                alert: 'Em conformidade', 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'Em conformidade\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-check-double azulColor" style="font-size: 100%;"></i></a>'}
            : '';
        returnConformidade = (nrMesesPrograma > limiteMesesPrograma) 
            ? {
                check: false,
                alert: 'A dura\u00E7\u00E3o do programa de gest\u00E3o supera o limite m\u00E1ximo de meses permitido ('+limiteMesesPrograma+')', 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'A dura\u00E7\u00E3o do programa de gest\u00E3o supera o limite m\u00E1ximo de meses permitido ('+limiteMesesPrograma+')\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnConformidade;
        returnConformidade = (!checkLimiteAnoCivil) 
            ? {
                check: false,
                alert: 'Final da vig\u00EAncia do programa de gest\u00E3o superior ao fim do ano civil (31/12)', 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'Final da vig\u00EAncia do programa de gest\u00E3o superior ao fim do ano civil (31/12)\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnConformidade;
    return returnConformidade;
}
function checkTermoAntesAssinatura(value, type) {
    var classFuture = (moment(value.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss') > moment()) ? {name: ' future', text: 'FUTURO' } : false;
    var modalidade = jmespath.search(arrayConfigAtividades.tipos_modalidades,"[?id_tipo_modalidade==`"+value.id_tipo_modalidade+"`] | [0]");
    var assinatura = (typeof value.config_documento !== 'undefined' && value.config_documento !== null && typeof value.config_documento.assinatura !== 'undefined' && value.config_documento.hasOwnProperty('assinatura')) ? value.config_documento.assinatura : false;
    var view_modelos = ((assinatura || getOptionEntidade('tipo_vinculacao_termo') == 2) && modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('modelos')) ? modalidade.config.modelos : false;   
    var returnAssinatura = (view_modelos && value.vigencia) 
            ? {
                check: true,
                alert: (assinatura ? 'Documento assinado eletronicamente por '+assinatura[0].nome_completo+', em '+moment(assinatura[0].datetime,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm') : 'Visualizar Termo de Ades\u00E3o para assinatura'), 
                btn: '<a class="newLink viewModelDoc" data-type="'+type+'" data-sign="true" data-user="'+value.id_user+'" data-id_reference="'+value.id_termo+'" data-icon="pencil-alt" data-action="view" data-mode="modelo_termo_adesao" data-title="Termo de Ades\u00E3o" onclick="editModelConfigItem(this)" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\''+(assinatura ? 'Documento assinado eletronicamente por '+assinatura[0].nome_completo+', em '+moment(assinatura[0].datetime,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm') : 'Visualizar Termo de Ades\u00E3o para assinatura')+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature '+(assinatura ? 'azulColor' : 'cinzaColor')+'" style="font-size: 100%;"></i> <i class="fas fa-'+(assinatura ? 'user-edit azulColor' : 'pencil-alt cinzaColor')+'" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : '';
        returnAssinatura = (classFuture && !assinatura) 
            ? {
                check: false,
                alert: 'Dispon\u00EDvel para assinatura ap\u00F3s iniciada a vig\u00EAncia do termo', 
                btn: '<a class="newLink viewModelDoc" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'Dispon\u00EDvel para assinatura ap\u00F3s iniciada a vig\u00EAncia do plano\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature cinzaColor" style="font-size: 100%;"></i> <i class="fas fa-pencil-alt cinzaColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
        returnAssinatura = (value.vigencia && value.termo_concomitante)
            ? {
                check: false,
                alert: 'Existe termo concomitante para esse usu\u00E1rio na unidade '+value.termo_concomitante.sigla_unidade+' ('+moment(value.termo_concomitante.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+(value.termo_concomitante.data_fim_vigencia == '0000-00-00 00:00:00' ? 'atual' : moment(value.termo_concomitante.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY'))+'). Desative um dos planos e tente novamente.', 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'Existe termo concomitante para esse usu\u00E1rio na unidade '+value.termo_concomitante.sigla_unidade+' ('+moment(value.termo_concomitante.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+(value.termo_concomitante.data_fim_vigencia == '0000-00-00 00:00:00' ? 'atual' : moment(value.termo_concomitante.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY'))+'). Encerre ou desative um dos termos e tente novamente.\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
    return returnAssinatura;
}
function checkPlanoAntesAssinatura(value, type) {
    var classFuture = (moment(value.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss') > moment()) ? {name: ' future', text: 'FUTURO' } : false;
    var modalidade = jmespath.search(arrayConfigAtividades.tipos_modalidades,"[?id_tipo_modalidade==`"+value.id_tipo_modalidade+"`] | [0]");
    var assinatura = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.assinatura !== 'undefined' && value.config.hasOwnProperty('assinatura')) ? value.config.assinatura : false;
    var view_modelos = ((assinatura || !getOptionEntidade('tipo_vinculacao_termo') || getOptionEntidade('tipo_vinculacao_termo') == 1) && modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('modelos')) ? modalidade.config.modelos : false;        
    var exige_autorizacao = (modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('exige_autorizacao')) ? modalidade.config.exige_autorizacao : false;        
    var carga_horaria_padrao = (modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('carga_horaria_padrao')) ? modalidade.config.carga_horaria_padrao : false;        
    var exclui_unidades = (modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('exclui_unidades')) ? modalidade.config.exclui_unidades : false;        
    var checkExcluiUnidades = (exclui_unidades) ? jmespath.search(exclui_unidades, "[?id_unidade==`"+value.id_unidade+"`]") : false;
        checkExcluiUnidades = (exclui_unidades && checkExcluiUnidades !== null && checkExcluiUnidades.length > 0) ? true : false;
        
    var documento_autorizacao = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.documentos !== 'undefined' && value.config.hasOwnProperty('documentos') && value.config.documentos.length) ? value.config.documentos : false;
        documento_autorizacao = (documento_autorizacao) ? jmespath.search(documento_autorizacao,"[?nr_sei!=''] | [?id_procedimento!=`0`]"): false;
        documento_autorizacao = (documento_autorizacao && documento_autorizacao !== null && documento_autorizacao.length > 0) ? true : false;
    var checkLimitePlano = calcLimitePlanosModalidade(value); 
    var textExcedeLimite = typeof checkLimitePlano !== 'undefined' && checkLimitePlano.excede_limite ? 'O plano de trabalho excede o limite de vagas da modalidade ('+checkLimitePlano.limite_modalidade+'% dos '+checkLimitePlano.vagas_programa+' participantes v\u00E1lidos = '+checkLimitePlano.limite_vagas+' vagas). Reduza ao menos '+(checkLimitePlano.planos_vigentes-checkLimitePlano.limite_vagas)+' vagas' : '';
    var alertaExcedeLimite = typeof checkLimitePlano !== 'undefined' && checkLimitePlano.excede_limite ? 'onmouseover="return infraTooltipMostrar(\''+textExcedeLimite+'\');" onmouseout="return infraTooltipOcultar();"' : '';
    var entidade = jmespath.search(arrayConfigAtividades.entidades, "[?id_entidade==`"+value.id_entidade+"`] | [0]");
    var limiteMesesPlanos = (entidade !== null && entidade.hasOwnProperty('config') && typeof entidade.config !== 'undefined' && entidade.config !== null && entidade.config.hasOwnProperty('limite_meses_planos')) ? entidade.config.limite_meses_planos : 6;
    var nrMesesPlano = moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').diff(moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss'), 'months');
        nrMesesPlano = typeof nrMesesPlano !== 'undefined' && nrMesesPlano !== null ? nrMesesPlano+1 : 0;
    var limitarAnoCivil = (entidade !== null && entidade.hasOwnProperty('config') && typeof entidade.config !== 'undefined' && entidade.config !== null && entidade.config.hasOwnProperty('limitar_ano_civil')) ? entidade.config.limitar_ano_civil : false;
    var checkLimiteAnoCivil = (limitarAnoCivil && moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss') > moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').endOf('year')) ? false : true;

    var returnAssinatura = (view_modelos && value.vigencia) 
            ? {
                check: true,
                alert: (assinatura ? 'Documento assinado eletronicamente por '+assinatura[0].nome_completo+', em '+moment(assinatura[0].datetime,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm') : 'Visualizar Termo de Ades\u00E3o para assinatura'), 
                btn: '<a class="newLink viewModelDoc" data-type="'+type+'" data-sign="true" data-user="'+value.id_user+'" data-id_reference="'+value.id_plano+'" data-icon="pencil-alt" data-action="view" data-mode="modelo_termo_adesao" data-title="Termo de Ades\u00E3o" onclick="editModelConfigItem(this)" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\''+(assinatura ? 'Documento assinado eletronicamente por '+assinatura[0].nome_completo+', em '+moment(assinatura[0].datetime,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm') : 'Visualizar Termo de Ades\u00E3o para assinatura')+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature '+(assinatura ? 'azulColor' : 'cinzaColor')+'" style="font-size: 100%;"></i> <i class="fas fa-'+(assinatura ? 'user-edit azulColor' : 'pencil-alt cinzaColor')+'" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : '';
        returnAssinatura = (classFuture && !assinatura) 
            ? {
                check: false,
                alert: 'Dispon\u00EDvel para assinatura ap\u00F3s iniciada a vig\u00EAncia do plano', 
                btn: '<a class="newLink viewModelDoc" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'Dispon\u00EDvel para assinatura ap\u00F3s iniciada a vig\u00EAncia do plano\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature cinzaColor" style="font-size: 100%;"></i> <i class="fas fa-pencil-alt cinzaColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
        returnAssinatura = (checkExcluiUnidades && !assinatura) 
            ? {
                check: false,
                alert: 'Tipo de modalidade n\u00E3o dispon\u00EDvel para essa unidade', 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'Tipo de modalidade n\u00E3o dispon\u00EDvel para essa unidade\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
        returnAssinatura = (!checkLimiteAnoCivil && !assinatura) 
            ? {
                check: false,
                alert: 'Final da vig\u00EAncia do plano de trabalho superior ao fim do ano civil (31/12)', 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'Final da vig\u00EAncia do plano de trabalho superior ao fim do ano civil (31/12)\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
        returnAssinatura = ((typeof value.id_programa === 'undefined' || value.id_programa === null && !value.id_programa || value.id_programa == 0) && !assinatura) 
            ? {
                check: false,
                alert: 'Nenhum programa de gest\u00E3o definido pela unidade dentro da vig\u00EAncia do atual plano de trabalho. Comunique o Gestor da unidade e tente novamente mais tarde', 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'Nenhum programa de gest\u00E3o definido pela unidade dentro da vig\u00EAncia do atual plano de trabalho. Comunique o Gestor da unidade e tente novamente mais tarde\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
        returnAssinatura = (exige_autorizacao && !documento_autorizacao && !assinatura) 
            ? {
                check: false,
                alert: 'A ades\u00E3o \u00E0 modalidade exige a vincula\u00E7\u00E3o de ato administrativo autorizativo', 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'A ades\u00E3o \u00E0 modalidade exige a vincula\u00E7\u00E3o de ato administrativo autorizativo\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
        returnAssinatura = (carga_horaria_padrao && value.carga_horaria < carga_horaria_padrao && !documento_autorizacao && !assinatura) 
            ? {
                check: false,
                alert: 'A redu\u00E7\u00E3o da carga hor\u00E1ria exige a vincula\u00E7\u00E3o de ato administrativo autorizativo', 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'A redu\u00E7\u00E3o da carga hor\u00E1ria exige a vincula\u00E7\u00E3o de ato administrativo autorizativo\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
        returnAssinatura = (nrMesesPlano > limiteMesesPlanos && !assinatura) 
            ? {
                check: false,
                alert: 'A dura\u00E7\u00E3o do plano de trabalho supera o limite m\u00E1ximo de meses permitido ('+limiteMesesPlanos+')', 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'A dura\u00E7\u00E3o do plano de trabalho supera o limite m\u00E1ximo de meses permitido ('+limiteMesesPlanos+')\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
        returnAssinatura = (value.vigencia && value.pendencias_plano && value.pendencias_plano.presente && value.pendencias_plano.presente.plano_concomitante)
            ? {
                check: false,
                alert: 'Existe plano de trabalho concomitante nesta unidade para esse usu\u00E1rio ('+moment(value.pendencias_plano.presente.plano_concomitante.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(value.pendencias_plano.presente.plano_concomitante.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'). Desative um dos planos e tente novamente.', 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onmouseover="return infraTooltipMostrar(\'Existe plano de trabalho concomitante nesta unidade para esse usu\u00E1rio ('+moment(value.pendencias_plano.presente.plano_concomitante.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(value.pendencias_plano.presente.plano_concomitante.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'). Desative um dos planos e tente novamente.\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
        returnAssinatura = (!assinatura && value.vigencia && value.pendencias_plano && value.pendencias_plano.anterior && !value.pendencias_plano.anterior.homologavel)
            ? {
                check: false,
                alert: 'Existe pend\u00EAncias do plano anterior que necessitam de regulariza\u00E7\u00E3o ('+moment(value.pendencias_plano.anterior.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(value.pendencias_plano.anterior.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'). Clique para mais detalhes. '+getMotivosPendenciasPlanos(value.pendencias_plano.anterior), 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" onclick="regularizaPlano(this)" data-refplano="anterior" onmouseover="return infraTooltipMostrar(\'Existe pend\u00EAncias do plano anterior que necessitam de regulariza\u00E7\u00E3o ('+moment(value.pendencias_plano.anterior.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(value.pendencias_plano.anterior.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'). Clique para mais detalhes. '+getMotivosPendenciasPlanos(value.pendencias_plano.anterior)+' \');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
        returnAssinatura = (!assinatura && typeof checkLimitePlano !== 'undefined' && checkLimitePlano.excede_limite)
            ? {
                check: false,
                alert: textExcedeLimite, 
                btn: '<a class="newLink" style="cursor: pointer; margin: 0;display: inline-block;" '+alertaExcedeLimite+'><i class="fas fa-signature vermelhoColor" style="font-size: 100%;"></i><i class="fas fa-exclamation-triangle vermelhoColor" style="font-size: 100%; margin-left: -10px;"></i></a>'}
            : returnAssinatura;
    return returnAssinatura;
}
function getTableTabConfig(type, data, param) {
    var tabsID = $('#tabs-'+type);
    var idConfigTabela = 'tableConfiguracoesPanel_'+type;
    var tabelaConfig = $('#'+idConfigTabela);
    var listConfig = data.config;
    var isInitOffset = (typeof data.offset === 'undefined' || data.offset == 0) ? true : false;
    var offset = (typeof data.offset !== 'undefined' && data.offset != 0) ? data.offset : false;
    var checkListConfig = (typeof listConfig !== 'undefined' && listConfig.length > 0 && listConfig != 0) ? listConfig.length : false;
    var countConfig = (checkListConfig && checkListConfig == 1) 
                        ? checkListConfig+' registro:' 
                        : (checkListConfig && checkListConfig > 1) ? checkListConfig+' registros:' : 'nenhum registro';

    var numRegistros = tabelaConfig.find('caption.infraCaption span.count');
        numRegistros = (numRegistros.length > 0 && !isInitOffset) ? parseInt(numRegistros.text()) : 0;
    var novosRegistros = (typeof listConfig !== 'undefined' && listConfig.length > 0 && listConfig != 0) ? listConfig.length : 0;
    var totalRegistros = numRegistros+novosRegistros;
    // var totalRegistros = 0;
    var countConfig = (totalRegistros == 1) ? '<span class="count">'+totalRegistros+'</span> registro:' : '<span class="count">'+totalRegistros+'</span> registros:';
    var loadingRegistros = (typeof data.next_offset === 'undefined' || !data.next_offset) ? '' : '<span class="progress" style="color: #777;font-size: 0.9em !important;padding: 5px;margin: 5px;"><i class="fas fa-sync fa-spin cinzaColor"></i> carregando dados... <a class="cancel" style="cursor:pointer" onclick="$(this).closest(\'table\').trigger(\'updateAll\');$(this).remove();"><i class="fas fa-times cinzaColor" style="font-size: 100%;"></i></a></span>';

    if (typeof listConfig !== 'undefined' && listConfig.length > 0 && listConfig != 0) {
        if (checkListConfig) {
            listConfig = jmespath.search(listConfig, "sort_by([*],&data_fim)");
            
            var countUnidades = uniqPro(jmespath.search(listConfig, "[?sigla_unidade].sigla_unidade"));
                countUnidades = (countUnidades !== null) ? countUnidades.length : 0;
        } else {
            var countUnidades = 0;
        }

        if (isInitOffset) {
            tableConfigList[type] = listConfig;
        } else {
            tableConfigList[type] = tableConfigList[type].concat(listConfig);
        }

        var tableConfigPanel = tabsID.find('table.tableIDInfo');

        if (isInitOffset) {
            var htmlTableConfig = getColumnPanelConfigs(listConfig, type, idConfigTabela, isInitOffset, countConfig+loadingRegistros);
            tabsID.html(htmlTableConfig);
        } else {
            if (tableConfigPanel.find('caption.infraCaption a.cancel').is(':visible')) {
                tableConfigPanel.find('caption.infraCaption span.count').text(totalRegistros);
            }
        }
        getRowsPanelConfigs(listConfig, type, offset);

        if (tabsID.find('caption.infraCaption a.cancel').is(':visible') && (typeof data.next_offset !== 'undefined' || !data.next_offset)) {
            getTabConfig(type, 'get', data, false, data.next_offset, param);
        } else {
            tableConfigPanel.find('caption.infraCaption span.progress').remove();
        }

        var tableConfigID = '#tabelaConfigPanel_'+type;
        var tableConfigElem = $(tableConfigID);
        if (!getOptionsPro('panelHeight_configuracoesTabelaPro_'+type) && tableConfigElem.height() > 800) { setOptionsPro('panelHeight_configuracoesTabelaPro_'+type, 800) }
        initPanelResize(tableConfigID, 'configuracoesTabelaPro_'+type);
        initChosenReplace('panel');

        $.each(listConfig,function(i, v){
            var id = (type == 'atividades') ? v.id_atividade : 0;
                id = (type == 'planos') ? v.id_plano : id;
                id = (type == 'programas') ? v.id_programa : id;
                id = (type == 'users') ? v.id_user : id;
                id = (type == 'unidades') ? v.id_unidade : id;
                id = (type == 'entidades') ? v.id_entidade : id;
            if (getRecentDateRow(v.data_inicio, -5)) {
                var row = tableConfigElem.find('tbody tr[data-id="'+id+'"]');
                setTimeout(function(){ 
                    row.find('td').effect('highlight').delay(2).effect('highlight').delay(2).effect('highlight');
                    if (
                        (type == 'atividades' && row.hasClass('new')) ||
                        type == 'planos' || 
                        type == 'programas' || 
                        type == 'users' || 
                        type == 'unidades' ||
                        type == 'entidades' 
                        ) {
                        row.get(0).scrollIntoView();
                        tableConfigElem.scrollTop(tableConfigElem.scrollTop()-30);
                    }
                }, 500);
            }
        });
        rememberScroll(tableConfigID, 'config_'+type, false);
        initFunctionsPanelConfigs(idConfigTabela, type);

    } else {
        if (totalRegistros == 0 && isInitOffset) {

            var htmlTableConfigs = getColumnPanelConfigs(listConfig, type, idConfigTabela, isInitOffset, countConfig+loadingRegistros);
                tabsID.html(htmlTableConfigs);

            var htmlNullData =  '<div class="dataFallback" style="z-index: 9" data-text="Nenhum dado dispon\u00EDvel">'+
                                '    <div style="position: absolute;top: calc(50% - 60px);width: 100%;text-align: center;">'+
                                '    '+($('.actionsConfig_'+type).find('.iconConfig_add')[0].outerHTML)+
                                '    </div>'+
                                '</div>';

            var tableConfigPanel = tabsID.find('table.tableIDInfo');
            var colspan = tableConfigPanel.find('thead th').length;
                tableConfigPanel.find('tbody').html('<tr><td colspan="'+colspan+1+'">'+htmlNullData+'</td></tr>');
                tableConfigPanel.find('caption.infraCaption span.progress').remove();
                initFunctionsPanelConfigs(idConfigTabela, type);

        } else {
            tabsID.find('table.tableIDInfo caption.infraCaption span.progress').remove();
        }
    }
}
function initFunctionsPanelConfigs(idConfigTabela, type) {

    var tableSorterList = (type == 'atividades') ? [[4,0], [1,0]] : undefined;
        tableSorterList = (type == 'planos') ? [[2,0], [1,0]] : tableSorterList;
        tableSorterList = (type == 'programas') ? [[1,0]] : tableSorterList;
        tableSorterList = (type == 'users') ? [[1,0]] : tableSorterList;
        tableSorterList = (type == 'unidades') ? [[3,0], [1,0]] : tableSorterList;
        tableSorterList = (type == 'entidades') ? [[1,0]] : tableSorterList;
        
    var configTabela = $('#'+idConfigTabela);
        configTabela.tablesorter({
                sortList: tableSorterList,
                sortLocaleCompare : true,
                textExtraction: {
                    1: function (elem, table, cellIndex) {
                        var text = $(elem).find('span').text().trim();
                        var tr = $(elem).closest('tr');
                        var priority = (tr.hasClass('new')) ? 'AAA ' : 'BBB ';
                            priority = (tr.hasClass('closed')) ? 'YYY ' : 'BBB ';
                            priority = (tr.hasClass('disabled')) ? 'ZZZ ' : 'BBB ';
                        return priority+text;
                    },
                    2: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                    3: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                    4: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                    5: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                    6: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                    7: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                    8: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                    9: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) }
                },
                widgets: ["saveSort", "filter"],
                widgetOptions: {
                    saveSort: true,
                    filter_hideFilters: true,
                    filter_columnFilters: true,
                    filter_saveFilters: true,
                    filter_hideEmpty: true,
                    filter_excludeFilter: {}
                },
                sortReset: true,
                headers: {
                    0: { sorter: false, filter: false },
                    1: { filter: true },
                    2: { filter: true },
                    3: { filter: true },
                    4: { filter: true },
                    5: { filter: true },
                    6: { filter: true },
                    7: { filter: true },
                    8: { filter: true },
                    9: { filter: true }
                }
            }).on("sortEnd", function (event, data) {
                checkboxRangerSelectShift();
            }).on("filterEnd", function (event, data) {
                checkboxRangerSelectShift();
                $(this).find('caption span.count').text(data.filteredRows);
                $(this).find('tbody > tr:visible > td > input').prop('disabled', false);
                $(this).find('tbody > tr:hidden > td > input').prop('disabled', true);
            });

    if (checkCapacidade('config_update_'+type)) {
        initTableCellEditor(idConfigTabela, type);
    }

    var filterConfig = configTabela.find('.tablesorter-filter-row').get(0);
    if (typeof filterConfig !== 'undefined') {
        var observerFilterConfig = new MutationObserver(function(mutations) {
            var _this = $(mutations[0].target);
            var _parent = _this.closest('table');
            var iconFilter = _parent.find('.filterTablePro button');
            var checkIconFilter = iconFilter.hasClass('active');
            var hideme = _this.hasClass('hideme');
            if (hideme && checkIconFilter) {
                iconFilter.removeClass('active');
            }
        });
        setTimeout(function(){ 

            var htmlFilterConfig =  '<div class="btn-group filterTablePro" role="group" style="right: 55px;top: -31px;z-index: 99;position: absolute;">'+
                                    '   <button type="button" onclick="downloadTablePro(this)" data-icon="fas fa-download" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="Baixar" class="btn btn-sm btn-light">'+
                                    '       <i class="fas fa-download" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                    '       <span class="text">Baixar</span>'+
                                    '   </button>'+
                                    '   <button type="button" onclick="copyTablePro(this)" data-icon="fas fa-copy" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="Copiar" class="btn btn-sm btn-light">'+
                                    '       <i class="fas fa-copy" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                    '       <span class="text">Copiar</span>'+
                                    '   </button>'+
                                    '   <button type="button" onclick="filterTablePro(this)" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="Pesquisar" class="btn btn-sm btn-light '+(configTabela.find('tr.tablesorter-filter-row').hasClass('hideme') ? '' : 'active')+'">'+
                                    '       <i class="fas fa-search" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                    '       Pesquisar'+
                                    '   </button>'+
                                    '</div>';
                configTabela.find('thead .filterTablePro').remove();
                configTabela.find('thead').prepend(htmlFilterConfig);
                observerFilterConfig.observe(filterConfig, {
                    attributes: true
                });
                configTabela.find('.tablesorter-filter-row input.tablesorter-filter[aria-label*="Data"]').attr('type','date');
        }, 500);
        $.getScript(URL_SPRO+"js/lib/jquery-visible.min.js");
    }

    var observerTableConfig = new MutationObserver(function(mutations) {
        var _this = $(mutations[0].target);
        var _parent = _this.closest('table');
        var count_all = _parent.find('tr.infraTrMarcada').length;
        var count_disable = _parent.find('tr.infraTrMarcada').not('.disabled').length;
        var count_reactive = _parent.find('tr.infraTrMarcada.disabled').length;
        var count_approve = _parent.find('tr.infraTrMarcada.approve').length;
        var count_disapprove = _parent.find('tr.infraTrMarcada.disapprove').length;
        if (count_approve > 0) {
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_disapprove').show().find('.fa-layers-counter').text(count_approve);
        } else {
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_disapprove').hide();
        }
        if (count_disapprove > 0) {
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_approve').show().find('.fa-layers-counter').text(count_disapprove);
        } else {
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_approve').hide();
        }
        if (count_disable > 0) {
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_remove').show().find('.fa-layers-counter').text(count_disable);
        } else {
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_remove').hide();
        }
        if (count_reactive > 0) {
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_reactive').show().find('.fa-layers-counter').text(count_reactive);
        } else {
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_reactive').hide();
        }
        if (count_all > 0) {
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_clone').show().find('.fa-layers-counter').text(count_all);
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_recalc').show().find('.fa-layers-counter').text(count_all);
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_close').show().find('.fa-layers-counter').text(count_all);
        } else {
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_clone').hide();
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_recalc').hide();
            $('#configuracoesProActions .actionsConfig_'+type).find('.iconConfig_close').hide();
        }
    });
    setTimeout(function(){ 
        configTabela.find('tbody tr').each(function(){
            observerTableConfig.observe(this, {
                    attributes: true
            });
        });
        checkboxRangerSelectShift();
        if (configBoxPro) centralizeDialogBox(configBoxPro);
    }, 500);
    if (type == 'planos') initClassicEditor();
    if (type == 'atividades') getAtividadeTagsPro();
}
function getColumnPanelConfigs(listConfig, type, idConfigTabela, isInitOffset, captionConfig) {
    var htmlTableConfig = '';
        htmlTableConfig =   (!isInitOffset) ? '' : 
                            '<div id="tabelaConfigPanel_'+type+'" class="tabelaPanelScroll" style="margin-top: 5px;">'+
                            (type == 'planos' || type == 'programas' || type == 'unidades' || type == 'atividades' || type == 'users' ? 
                            '   <div class="editTableToggle hideListaInfItens" style="right: 650px;width: 200px;">'+
                            '           <label class="label" for="changeListaInfTableConfig_'+type+'"><i class="fas fa-eye-slash '+(getOptionsPro('changeListaInfTableConfig_'+type) && getOptionsPro('changeListaInfTableConfig_'+type) == 'show' ? 'azulColor' : 'cinzaColor')+'" style="margin: 0px 6px 0 4px;"></i> Unidades Vinculadas</label>'+
                            '           <div class="onoffswitch">'+
                            '               <input type="checkbox" name="onoffswitch" data-type="'+type+'" onchange="changeListaInfTableConfig(this)" class="onoffswitch-checkbox" id="changeListaInfTableConfig_'+type+'" tabindex="0" '+(getOptionsPro('changeListaInfTableConfig_'+type) && getOptionsPro('changeListaInfTableConfig_'+type) == 'show' ? 'checked' : '')+'>'+
                            '               <label class="onoffswitch-label" for="changeListaInfTableConfig_'+type+'"></label>'+
                            '           </div>'+
                            '   </div>'+
                            '': '')+
                            '   <div class="editTableToggle hideDisabledItens" style="right: 500px;">'+
                            '           <label class="label" for="changeDisabledTableConfig_'+type+'"><i class="fas fa-eye-slash '+(getOptionsPro('changeDisabledTableConfig_'+type) && getOptionsPro('changeDisabledTableConfig_'+type) == 'show' ? 'azulColor' : 'cinzaColor')+'" style="margin: 0px 6px 0 4px;"></i> Inativos</label>'+
                            '           <div class="onoffswitch">'+
                            '               <input type="checkbox" name="onoffswitch" data-type="'+type+'" onchange="changeDisabledTableConfig(this)" class="onoffswitch-checkbox" id="changeDisabledTableConfig_'+type+'" tabindex="0" '+(getOptionsPro('changeDisabledTableConfig_'+type) && getOptionsPro('changeDisabledTableConfig_'+type) == 'show' ? 'checked' : '')+'>'+
                            '               <label class="onoffswitch-label" for="changeDisabledTableConfig_'+type+'"></label>'+
                            '           </div>'+
                            '   </div>'+
                            (checkCapacidade('config_update_'+type) ? 
                            '   <div class="editTableToggle">'+
                            '           <label class="label" for="changeViewTableConfig_'+type+'"><i class="fas fa-edit azulColor" style="margin: 0px 6px 0 4px;"></i> Edi\u00E7\u00E3o</label>'+
                            '           <div class="onoffswitch">'+
                            '               <input type="checkbox" name="onoffswitch" data-type="'+type+'" onchange="changeViewTableConfig(this)" class="onoffswitch-checkbox" id="changeViewTableConfig_'+type+'" tabindex="0" checked>'+
                            '               <label class="onoffswitch-label" for="changeViewTableConfig_'+type+'"></label>'+
                            '           </div>'+
                            '   </div>'+
                            '' : '')+
                            '   <table id="'+idConfigTabela+'" class="tableIDInfo tableInfo tableZebra tableFollow tableAtividades" data-tabletype="'+type+'">'+
                            '      <caption class="infraCaption" style="text-align: left; margin-top: 10px;">'+captionConfig+'</caption>'+
                            '      <thead style="position:relative">'+
                            getRowsTableTabConfig(type, 'header', listConfig)+
                            '      </thead>'+
                            '      <tbody>';
                            
        htmlTableConfig +=  (!isInitOffset) ? '' : 
                            '       </tbody>'+
                            '   </table>'+
                            '</div>';
    return htmlTableConfig;
}
function getRowsPanelConfigs(listConfig, type, offset) {
    var tableConfig = $('#tableConfiguracoesPanel_'+type);
    var tableConfigBody = $('#tableConfiguracoesPanel_'+type+' tbody');

    function initRowsPanelConfigs(index) {
        loadRowsPanelConfig = true;
        var totaldados = listConfig.length;
        var caption = tableConfig.find('caption.infraCaption');
        var numRegistros = caption.find('span.count');
            numRegistros = (numRegistros.length > 0) ? parseInt(numRegistros.text())+totaldados : 0;
            // caption.find('span.count').text(numRegistros);
        setTimeout(() => {
            if (totaldados-1 <= index && !caption.find('a.cancel').is(':visible')) {
                loadRowsPanelConfig = false;
                setTimeout(() => { if (!loadRowsPanelConfig) { tableConfig.trigger('updateAll') } }, 1000);
            }
        }, 2000);
    }
    var limit = 100;
    var time = offset+200;
    listConfig.forEach(function (value, index) {
        if (index >= limit) {
            setTimeout(function(){
                var htmlRowConfig = getRowsTableTabConfig(type, 'body', listConfig, value);
                    tableConfigBody.append(htmlRowConfig);
                if (listConfig.length-1 == index || index % 100 == 0) { 
                    initRowsPanelConfigs(index);
                }
            }, time*index);
        } else {
            var htmlRowConfig = getRowsTableTabConfig(type, 'body', listConfig, value);
                tableConfigBody.append(htmlRowConfig);
                loadRowsPanelReport = false;
        }
    });
    if (listConfig.length <= limit) { initRowsPanelConfigs(100) }
}
function initTableCellEditor(idConfigTabela, type, TimeOut = 9000) {
    if (TimeOut <= 0) { return; }
    if (typeof SimpleTableCellEditor !== 'undefined') { 
        getTableCellEditor(idConfigTabela, type);
    } else {
        if (typeof SimpleTableCellEditor === 'undefined' && typeof URL_SPRO !== 'undefined' && TimeOut == 9000) { 
            $.getScript(URL_SPRO+"js/lib/jquery-table-edit.min.js");
        }
        setTimeout(function(){ 
            initTableCellEditor(idConfigTabela, type, TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initTableCellEditor'); 
        }, 500);
    }
}
function getTableCellEditor(idConfigTabela, type) {
    var configTabela = $('#'+idConfigTabela);
    configEditor = new SimpleTableCellEditor(idConfigTabela);
    configEditor.SetEditableClass("editCell");
    configEditor.SetEditableClass("editCellCPF", { 
        internals: {
            renderEditor: (elem, oldVal) => {
                $(elem).html('<input type="text" style="max-width: 80%;" value="'+oldVal+'">').find('input').mask("999.999.999-99").focus();
            }
        }
    });
    configEditor.SetEditableClass("editCellCNPJ", { 
        internals: {
            renderEditor: (elem, oldVal) => {
                $(elem).html('<input type="text" style="max-width: 80%;" value="'+oldVal+'">').find('input').mask("99.999.999/9999-99").focus();
            }
        }
    });
    configEditor.SetEditableClass("editCellPhone", { 
        internals: {
            renderEditor: (elem, oldVal) => {
                $(elem).html('<input type="text" style="max-width: 80%;" value="'+oldVal+'">').find('input').mask("(99) 99999-9999").focus();
            }
        }
    });
    configEditor.SetEditableClass("editCellPEN", { 
        internals: {
            renderEditor: (elem, oldVal) => {
                $(elem).html('<input type="text" style="max-width: 80%;" value="'+oldVal+'">').find('input').mask("99999.999999/9999-99").focus();
            }
        }
    });
    configEditor.SetEditableClass("editCellDatetime", {
        internals: {
            renderEditor: (elem, oldVal) => {
                $(elem).html('<input type="datetime-local" style="max-width:none" value="'+moment(oldVal,'DD/MM/YYYY HH:mm:ss').format('YYYY-MM-DD HH:mm:ss')+'">').find('input').focus();
            },
            renderValue: (elem, formattedNewVal) => { 
                $(elem).text(formattedNewVal); 
            },
            extractEditorValue: (elem) => { 
                return moment($(elem).find('input').val(),'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm:ss');
            },
        }
    });
    configEditor.SetEditableClass("editCellNum", { 
        validation: $.isNumeric,
        internals: {
            renderEditor: (elem, oldVal) => {
                $(elem).html('<input type="number" style="max-width:none" value="'+oldVal+'">').find('input').focus();
            }
        }
    });
    configEditor.SetEditableClass("editCellNew");
    configEditor.SetEditableClass("editCellDate", {
        internals: {
            renderEditor: (elem, oldVal) => {
                var data = $(elem).data();
                var dateLimit = $(elem).closest('tr').find('td[data-label-limit="'+data.refLimit+'"]').text();
                var arrayDateLimit = (data.limit == 'min') 
                                        ? 'min="'+moment(dateLimit,'DD/MM/YYYY').format('YYYY-MM-DD')+'"'
                                        : 'max="'+moment(dateLimit,'DD/MM/YYYY').format('YYYY-MM-DD')+'"';
                $(elem).html('<input type="date" '+arrayDateLimit+' style="max-width:none" value="'+moment(oldVal,'DD/MM/YYYY').format('YYYY-MM-DD')+'">').find('input').focus();
            },
            renderValue: (elem, formattedNewVal) => { 
                $(elem).text(formattedNewVal); 
            },
            extractEditorValue: (elem) => { 
                return moment($(elem).find('input').val(),'YYYY-MM-DD').format('DD/MM/YYYY');
            },
        }
    });
    configEditor.SetEditableClass("editCellSelect", {
        internals: {
            renderEditor: (elem, oldVal) => {
                var data = $(elem).data();
                var newItem = (typeof data.newItem !== 'undefined' && data.newItem == false) ? '' : '<option value="new">\u2795 Novo Item</option></select>'; 
                var arraySelect = (data.array == 'self') ? tableConfigList[type] : arrayConfigAtividades[data.array]; 
                    arraySelect = (data.array == 'tipos_requisicoes' || data.array == 'tipos_documentos') ? jmespath.search(arrayListTypesSEI.selSeriePesquisa,"[*].{label: name, value: name}") : arraySelect;
                    arraySelect = (data.array == 'tipos_metadados') ? listLabelsTiposMetadados : arraySelect;
                    arraySelect = (data.array == 'cadeia_valor') ? tableConfigList[type] : arraySelect;

                var key_ref = (typeof data.keyref !== 'undefined') ? data.keyref : data.key;
                var selectArray = (data.array == 'tipos_requisicoes' || data.array == 'tipos_documentos' || data.array == 'tipos_metadados') 
                                ?  arraySelect 
                                : (data.array == 'tipos_modalidades') 
                                    ? jmespath.search(arraySelect,(arrayConfigAtividades.perfil.nivel != 1 ? "[?vigencia==`true`] | " : "")+"[*].{label: "+data.value+", value: "+key_ref+"}")
                                    : jmespath.search(arraySelect,"[*].{label: "+data.value+", value: "+key_ref+"}");
                    selectArray = selectArray.filter((v,i,a)=>a.findIndex(t=>(t.value === v.value))===i);

                if (data.array == 'cadeia_valor') {
                    var htmlOptions = getOptionSelectCadeiaValor(arraySelect, $(elem).text().trim());
                } else {
                    var htmlOptions = $.map(selectArray, function(v){
                                            var selected = (v.label == $(elem).text().trim()) ? 'selected' : '';
                                                return '<option value="'+v.value+'" '+selected+'>'+v.label+'</option>';
                                        }).join('');
                }
                var htmlBlankOption = (typeof data.blankItem !== 'undefined' && data.blankItem == true) ? '<option value="'+(typeof data.blankValue !== 'undefined' ? data.blankValue : 0)+'">&nbsp;</option>' : '';
                $(elem).html(`<select data-old="`+oldVal+`" data-type="`+type+`" onchange="configTableNewItem(this)">`+htmlBlankOption+htmlOptions+newItem).find('select').focus().chosen({
                    placeholder_text_single: ' ',
                    no_results_text: 'Nenhum resultado encontrado'
                });
                if (checkBrowser() == 'Firefox') $(elem).find('.chosen-container').addClass('chosen-repair-firefox');
            },
            renderValue: (elem, formattedNewVal) => { 
                if (formattedNewVal != 'new') {
                    $(elem).text(formattedNewVal); 
                }
            },
            extractEditorValue: (elem) => { 
                $(elem).data('newvalue',$(elem).find('select').val());
                return $(elem).find('select').find('option:selected').text().trim(); 
            },
        }
    });
    tableConfigEditor[type] = configEditor;
 
    configTabela.on("cell:edited", function (event) {   
        var _this = $(event.element);
        var td = _this.closest('td');
        var tr = _this.closest('tr');
        var data = td.data();
        var data_tr = tr.data();
        var value = event.newValue;
        if (_this.hasClass('editCellSelect')) {
            if (typeof event.newValue === 'undefined' || event.newValue == 'new') {
                _this.text(event.oldValue);
            }
            if (typeof event.newValue !== 'undefined' && typeof data.newvalue !== 'undefined') {
                value = data.newvalue;
            }
        } else if (_this.hasClass('editCellCPF') && typeof event.newValue !== 'undefined') {
            if (!validaCPF(event.newValue)) {
                // _this.text(event.oldValue);
                td.addClass('editCellLoadingError');
                return false;
            }
        } else if (_this.hasClass('editCellDate') && typeof event.newValue !== 'undefined') {
            var value_nottime = moment(event.newValue,'DD/MM/YYYY').format('YYYY-MM-DD');
            if (value_nottime == 'Invalid date') {
                _this.text(event.oldValue);
                td.addClass('editCellLoadingError');
                return false;
            } else {
                td.attr('data-time-sorter', value_nottime);
                value = (data.key == 'data_fim_vigencia') 
                        ? moment(value,'DD/MM/YYYY').endOf('day').format('YYYY-MM-DD HH:mm:ss') 
                        : moment(value,'DD/MM/YYYY').format('YYYY-MM-DD HH:mm:ss');
                        // console.log('dateEnd',value);
                if (data_tr.type == 'planos' || data_tr.type == 'programas') {
                    var data_inicio = (data.key == 'data_inicio_vigencia') ? value_nottime : tr.find('td[data-key="data_inicio_vigencia"]').data('time-sorter');
                    var data_fim = (data.key == 'data_fim_vigencia') ? value_nottime : tr.find('td[data-key="data_fim_vigencia"]').data('time-sorter');
                    var listDados = jmespath.search(tableConfigList[data_tr.type],"[?vigencia==`true`]");
                    var check = checkDatesLoopArray(listDados, data_inicio, data_fim, data_tr.idref, data_tr.id, {inicio: 'data_inicio_vigencia', fim: 'data_fim_vigencia', idreftype: data_tr.idreftype, id: data_tr.rowindex});
                    if (check && check.length > 0) {
                    // if (1==2) {
                        td.addClass('editCellLoadingError');
                        var v = jmespath.search(listDados,"[?"+data_tr.rowindex+"==`"+check[0]+"`] | [0]");
                        // console.log(v);
                        var text_conflict = (data_tr.type == 'programas') 
                                ? '<br><br>'+v.sigla_unidade+' <b style="font-weight: bold;">'+moment(v.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(v.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</b>'
                                : '<br><br>'+v.nome_completo+' ('+v.nome_modalidade+') <b style="font-weight: bold;">'+moment(v.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(v.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</b>';
                        
                        var text_box_conflict = (data_tr.type == 'programas') 
                                ? 'Um ou mais dias deste programa de gest\u00E3o j\u00E1 est\u00E3o inclu\u00EDdos em outro programa de gest\u00E3o da unidade! '
                                : 'Um ou mais dias deste plano de trabalho j\u00E1 est\u00E3o inclu\u00EDdos em outro plano de trabalho do usu\u00E1rio!';
                        setTimeout(function(){ 
                            alertaBoxPro('Error', 'exclamation-triangle', text_box_conflict+text_conflict);
                        }, 100);
                        return false;
                    }
                }
            }
        }
        if (typeof event.newValue !== 'undefined' && _this.hasClass('editCellNew')) {
            _this.removeClass('editCellNew').addClass('editCellSelect');
        }
        if (typeof event.newValue !== 'undefined' && typeof data.text !== 'undefined' && event.newValue.trim().indexOf('(C\u00F3pia)') === -1) {
            tr.removeClass('clone');
        }
        if (typeof event.newValue !== 'undefined' && typeof data.text !== 'undefined' && event.newValue.trim().indexOf('(Novo)') === -1) {
            tr.removeClass('new');
        }
        if (typeof event.newValue !== 'undefined' && data.key == 'data_fim_vigencia' && moment(value, 'YYYY-MM-DD HH:mm:ss') < moment()) {
            tr.addClass('closed');
        } else {
            tr.removeClass('closed');
        }
        if (typeof event.newValue !== 'undefined' && data.key == 'data_inicio_vigencia' && moment(value, 'YYYY-MM-DD HH:mm:ss') > moment()) {
            tr.addClass('future');
        } else {
            tr.removeClass('future');
        }
        if (typeof event.newValue !== 'undefined') {

            td.addClass('editCellLoading');
            if (td.hasClass('alertAssinatura')) {
                confirmaFraseBoxPro('Editar essas informa\u00E7\u00F5es ir\u00E1 <b style="font-weight: bold;">CANCELAR A ASSINATURA</b> vinculada. Deseja prosseguir?', 'CANCELAR', function() { 
                    updateConfigServerInline(_this, type, value, data, data_tr);
                }, function() {
                    td.removeClass('editCellLoading').text(event.oldValue);
                });
            } else {
                updateConfigServerInline(_this, type, value, data, data_tr);
            }
        }
    });
}
function calcLimitePlanosModalidade(value) {
    var id_unidade = value.id_unidade;
    var id_programa = value.id_programa;
    var arraylistPlanos = typeof tableConfigList.planos !== 'undefined' && tableConfigList.planos !== null && tableConfigList.planos.length > 0 ? tableConfigList.planos : arrayConfigAtividades.planos;
    var listPlanos = jmespath.search(arraylistPlanos,"[?id_unidade==`"+id_unidade+"`] | [?id_programa==`"+id_programa+"`] | [?em_execucao==`true`]");
        listPlanos = (listPlanos === null || listPlanos.length == 0) ? jmespath.search(arraylistPlanos,"[?id_unidade==`"+id_unidade+"`] | [?id_programa==`"+id_programa+"`] | [?execucao_futura==`true`]") : listPlanos;
    var modalidadeAtual = jmespath.search(arrayConfigAtividades.tipos_modalidades,"[?id_tipo_modalidade==`"+value.id_tipo_modalidade+"`] | [0]");
        modalidadeAtual = typeof modalidadeAtual !== 'undefined' && modalidadeAtual !== null ? modalidadeAtual.config : false;
    var limiteModalidadeAtual = modalidadeAtual && !modalidadeAtual.exclui_calculo_vagas && isNumeric(modalidadeAtual.limite_planos) && modalidadeAtual.limite_planos < 100 && modalidadeAtual.limite_planos > 0 ? modalidadeAtual.limite_planos : 100;
    var minimoModalidadeAtual = modalidadeAtual && !modalidadeAtual.exclui_calculo_vagas && isNumeric(modalidadeAtual.minimo_participantes) && modalidadeAtual.minimo_participantes >= 0 ? modalidadeAtual.minimo_participantes : 0;
    var listTiposModalidades = jmespath.search(arrayConfigAtividades.tipos_modalidades,"[?config.exclui_calculo_vagas==`false`] | [*].id_tipo_modalidade");
    var listaPlanosTotais = $.map(listPlanos, function(v){
        if ($.inArray(v.id_tipo_modalidade, listTiposModalidades) !== -1 && (v.em_execucao || v.execucao_futura)) {
            return v;
        } 
    });
    var countVagasTotais = typeof listaPlanosTotais !== 'undefined' && listaPlanosTotais !== null ? listaPlanosTotais.length : 0;
    var limiteVagasModalidadeAtual = Math.ceil((limiteModalidadeAtual/100)*countVagasTotais);
    var countVagasModalidadeAtual = jmespath.search(listPlanos,"[?id_tipo_modalidade==`"+value.id_tipo_modalidade+"`]");
        countVagasModalidadeAtual = typeof countVagasModalidadeAtual !== 'undefined' && countVagasModalidadeAtual !== null ? countVagasModalidadeAtual.length : 0;
    var checkLimitePlano = limiteModalidadeAtual < 100 && (countVagasTotais < minimoModalidadeAtual || countVagasModalidadeAtual > limiteVagasModalidadeAtual) ? true : false;
    var _return = {
        excede_limite: checkLimitePlano, 
        planos_vigentes: countVagasModalidadeAtual,
        limite_vagas: limiteVagasModalidadeAtual,
        vagas_programa: countVagasTotais,
        limite_modalidade: limiteModalidadeAtual,
        minimo_participantes: minimoModalidadeAtual,
        modalidade: modalidadeAtual
    }
    // console.log(_return);
    return _return;
}
function updateConfigServerInline(_this, type, value, data, data_tr, objIndex) {
    if (delayServerAtiv == 1) return; 
    var update = updateConfigServer({mode: 'update', id: data_tr.id, type: data_tr.type, key: data.key, value: value, rowindex: data_tr.rowindex});
    if (type == 'planos' && (data.key == 'data_inicio_vigencia' || data.key == 'data_fim_vigencia' || data.key == 'carga_horaria')) {
        updateConfigTempoPactuado(_this, data_tr.id, update.objIndex, data_tr);
        // console.log('updateConfigTempoPactuado',_this, data_tr.id, update.objIndex, data_tr);
    }
    delayServerAtiv = 1; setTimeout(function(){ delayServerAtiv = 0; }, 1000);
}
function changeListaInfTableConfig(this_) {
    var _this = $(this_);
    var type = _this.data('type');
    var checkbox = _this.is(':checked');
    var table = $('#tableConfiguracoesPanel_'+type);
    var icon = _this.closest('.editTableToggle').find('.label i');
        icon.toggleClass('fa-eye-slash fa-sync-alt').addClass('fa-spin');
    if (checkbox) {
        icon.addClass('azulColor').removeClass('cinzaColor');
        setOptionsPro('changeListaInfTableConfig_'+type,'show');
    } else {
        icon.addClass('cinzaColor').removeClass('azulColor');
        setOptionsPro('changeListaInfTableConfig_'+type,'hide');
    }
    getTabConfig(type, 'get');
}
function changeDisabledTableConfig(this_) {
    var _this = $(this_);
    var type = _this.data('type');
    var checkbox = _this.is(':checked');
    var table = $('#tableConfiguracoesPanel_'+type);
    var icon = _this.closest('.editTableToggle').find('.label i');
        icon.toggleClass('fa-eye-slash fa-sync-alt').addClass('fa-spin');
    if (checkbox) {
        icon.addClass('azulColor').removeClass('cinzaColor');
        setOptionsPro('changeDisabledTableConfig_'+type,'show');
    } else {
        icon.addClass('cinzaColor').removeClass('azulColor');
        setOptionsPro('changeDisabledTableConfig_'+type,'hide');
    }
    getTabConfig(type, 'get');
}
function changeDisabledTableReport(this_) {
    var _this = $(this_);
    var type = _this.data('type');
    var checkbox = _this.is(':checked');
    var icon = _this.closest('.editTableToggle').find('.label i');
        icon.toggleClass('fa-eye-slash fa-sync-alt').addClass('fa-spin');
    if (checkbox) {
        icon.addClass('azulColor').removeClass('cinzaColor');
        setOptionsPro('changeDisabledTableReport_'+type,'show');
    } else {
        icon.addClass('cinzaColor').removeClass('azulColor');
        setOptionsPro('changeDisabledTableReport_'+type,'hide');
    }
    getTabReport(type, 'get');
}
function changeViewTableConfig(this_) {
    var _this = $(this_);
    var type = _this.data('type');
    var checkbox = _this.is(':checked');
    var table = $('#tableConfiguracoesPanel_'+type);
    var icon = _this.closest('.editTableToggle').find('.label i');
    tableConfigEditor[type].Toggle(checkbox);
    if (checkbox) {
        table.removeClass('editDisabled').find('.checkboxSelectConfiguracoes').prop('disabled', false);
        icon.addClass('azulColor').removeClass('cinzaColor');
    } else {
        table.find('.checkboxSelectConfiguracoes:checked').trigger('click');
        table.addClass('editDisabled').find('.checkboxSelectConfiguracoes').prop('disabled', true);
        icon.addClass('cinzaColor').removeClass('azulColor');
    }
}
function changeViewTableReport(this_) {
    var _this = $(this_);
    var type = _this.data('type');
    var checkbox = _this.is(':checked');
    var table = $('#tableRelatorio_'+type);
    var icon = _this.closest('.viewTableToggle').find('.label i');
        icon.toggleClass('fa-university fa-sync-alt').addClass('fa-spin');
    if (checkbox) {
        icon.addClass('azulColor').removeClass('cinzaColor');
        setOptionsPro('changeViewTableReport_'+type,'show');
    } else {
        icon.addClass('cinzaColor').removeClass('azulColor');
        setOptionsPro('changeViewTableReport_'+type,'hide');
    }
    getTabReport(type, 'get');
}
function getWorkDaysBetweenDates(inicio, fim, sigla_unidade) {
    var config_unidade = getConfigDadosUnidade(sigla_unidade);
    var config_feriados = (typeof config_unidade.feriados !== 'undefined' && config_unidade.feriados !== null) ? config_unidade.feriados : false;
    var arrayFeriados = (config_unidade.count_dias_uteis && inicio != '' && fim != '') 
                    ? getHolidayBetweenDates(moment(inicio, 'YYYY-MM-DD HH:mm:ss').format('Y')+'-01-01', moment(fim, 'YYYY-MM-DD HH:mm:ss').add(1, 'Y').format('Y')+'-01-01', config_feriados)
                    : [];
    var listFeriados = (typeof arrayFeriados !== 'undefined' && arrayFeriados !== null) ? jmespath.search(arrayFeriados, "[*].d_") : [];
    var dias = (config_unidade.count_dias_uteis) 
                ? moment().isoWeekdayCalc({  
                    rangeStart: inicio,  
                    rangeEnd: fim,  
                    weekdays: [1,2,3,4,5],  
                    exclusions: listFeriados
                })
                : moment(fim, 'YYYY-MM-DD HH:mm:ss').diff(moment(inicio, 'YYYY-MM-DD HH:mm:ss'), 'days');
        dias = (dias < 0) ? false : dias;

    calcRelatorioMetaProporcional('feriados', {dias: dias, feriados: arrayFeriados, lista_feriados: listFeriados});
    // console.log('feriados', {dias: dias, feriados: arrayFeriados, lista_feriados: listFeriados});
    return {dias: dias, feriados: arrayFeriados};
}
function updateConfigTempoPactuadoById(id_plano) {
    var objIndex = (typeof tableConfigList.planos === 'undefined' || tableConfigList.planos == 0 || tableConfigList.planos.length == 0) ? -1 : tableConfigList.planos.findIndex((obj => obj['id_plano'] == id_plano));
    if (objIndex !== -1) {
        var tableConfigElem = $('#tableConfiguracoesPanel_planos');
        var tableConfigScroll = $('#tabelaConfigPanel_planos');
        var _parent = tableConfigElem.find('tr[data-id="'+id_plano+'"]');
        var _this = _parent.find('td[data-key="data_fim_vigencia"]');
        var data_tr = _parent.data();
            _parent.find('td[data-key="tempo_total"]').addClass('editCellLoading')
            _parent.get(0).scrollIntoView();
            tableConfigScroll.scrollTop(tableConfigScroll.scrollTop()-35);
            updateConfigTempoPactuado(_this, data_tr.id, objIndex, data_tr);
        return true;
    } else {
        return false;
    }
}
function updateConfigTempoPactuado(_this, id, objIndex, data_tr) {
    var value = jmespath.search(tableConfigList.planos, "[?id_plano==`"+id+"`] | [0]");
    if (value !== null) {
        var dates = getWorkDaysBetweenDates(value.data_inicio_vigencia, value.data_fim_vigencia, value.sigla_unidade);
        if (dates.dias) {
            var tempo_total = parseInt(dates.dias)*parseFloat(value.carga_horaria);
            var tr = _this.closest('tr');
                tr.find('td[data-key="tempo_total"]').text(tempo_total);
                tableConfigList.planos[objIndex].tempo_total = tempo_total;


            var array_tempo_proporcional = checkDatesPlanoAfast(value);
            var check_afastamento_list = jmespath.search(arrayConfigAtividades.afastamentos.lista, "[?id_user==`"+array_tempo_proporcional.id_user+"`]");
                check_afastamento_list = typeof check_afastamento_list !== 'undefined' && check_afastamento_list !== null && check_afastamento_list.length > 0 && check_afastamento_list != 0 ? true : false;
            if (typeof array_tempo_proporcional !== 'undefined' && 
                (
                    (array_tempo_proporcional.tempo_proporcional != value.tempo_proporcional && check_afastamento_list) ||
                    (value.tempo_total < value.tempo_proporcional) ||
                    (typeof arrayConfigAtividades.perfil.nivel !== 'undefined' && arrayConfigAtividades.perfil.nivel !== null && arrayConfigAtividades.perfil.nivel == 1)
                )
                ) {
                var tempo_proporcional = array_tempo_proporcional.tempo_proporcional;
                    tempo_proporcional = parseInt(tempo_proporcional.toFixed(2));
                    tempo_proporcional = tempo_proporcional < 0 ? 0 : tempo_proporcional;

                tr.find('td[data-key="tempo_proporcional"]').text(tempo_proporcional).addClass('editCellLoading');
                tableConfigList.planos[objIndex].tempo_proporcional = tempo_proporcional;
                updateConfigServer({mode: 'update', id: id, type: 'planos', key: 'tempo_proporcional', value: tempo_proporcional, rowindex: data_tr.rowindex});
            }

            tempo_total = parseInt(tempo_total.toFixed(2));

            updateConfigServer({mode: 'update', id: id, type: 'planos', key: 'tempo_total', value: tempo_total, rowindex: data_tr.rowindex});
        }
    }
}
function reactiveConfig(this_) {
    var _this = $(this_);
    var data_this = _this.data();
    var id = data_this.id;
    var ids = $('#tabelaConfigPanel_'+data_this.type).find('.checkboxSelectConfiguracoes:checked').map(function(){ if($(this).closest('tr').hasClass('disabled')) { return $(this).val() } }).get();
    if (id != 0 || ids.length > 0) {
        var action = 'config_update_'+data_this.type;
        if (checkCapacidade(action)) {
            var param = {
                action: action,
                id: id,
                ids: ids,
                type: data_this.type,
                key: 'data_fim',
                mode: 'reactive'
            };
            getServerAtividades(param, action);
        }
    }
}
function cloneConfig(this_, e) {
    var _this = $(this_);
    var data_this = _this.data();
    var id = data_this.id;
    var action = 'config_update_'+data_this.type;
    var table =  $('#tabelaConfigPanel_'+data_this.type);
    var ids = table.find('.checkboxSelectConfiguracoes:checked').map(function(){ return $(this).val() }).get();
    var param = {
        action: action,
        id: id,
        ids: ids,
        type: data_this.type,
        key: 'all',
        mode: 'clone'
    };
    var countSelected = table.find('tr.infraTrMarcada').length;
    if (id != 0 ) {
        _this.find('i').attr('class','fas fa-spinner fa-spin');
        getConfigServer(action, param);
    } else if (ids.length > 0) {
        confirmaFraseBoxPro('Tem certeza que deseja <b style="font-weight: bold;">DUPLICAR</b> '+(countSelected > 1 ? 'os registros' : 'o registro')+(id == 0 ? (countSelected > 1 ? ' selecionados' : ' selecionado') : '')+'?', 'SIM', 
        function(){
            getConfigServer(action, param);
        });
    }
    setOptionsPro('rememberScroll_config_'+data_this.type, table.scrollTop());
}
function newConfig_(this_) {
    var _this = $(this_);
    if (_this.data('type') == 'users' || (_this.data('type') == 'planos' && !checkCapacidade('config_self_planos')) ) {
        newConfig(this_);
    } else {
        var textBox = (typeof _this.attr('onmouseover') !== 'undefined') ? extractTooltip(_this.attr('onmouseover')) : 'adicionar novo item';
        confirmaBoxPro('Tem certeza que deseja '+textBox.toLowerCase()+'?', function(){
            newConfig(this_);
        });
    }
}
function newConfig(this_) {
    var _this = $(this_);
    var data_this = _this.data();
    var type = data_this.type;

    var config_unidade = (typeof arrayConfigAtivUnidade !== 'undefined' && arrayConfigAtivUnidade !== null && typeof arrayConfigAtivUnidade.config !== 'undefined' && arrayConfigAtivUnidade.config !== null) ? arrayConfigAtivUnidade.config : false;
    var duracao_padrao = (config_unidade && typeof config_unidade.planos !== 'undefined' && config_unidade.planos !== null && typeof config_unidade.planos.duracao_padrao !== 'undefined' && config_unidade.planos.duracao_padrao !== null) ? config_unidade.planos.duracao_padrao : 1;
        duracao_padrao = parseInt(duracao_padrao)-1;

    var config_entidade = jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config");
        config_entidade = (config_entidade !== null) ? config_entidade : false;
    var carga_horaria_padrao = (config_entidade && typeof config_entidade.carga_horaria_padrao !== 'undefined' && config_entidade.carga_horaria_padrao !== null) ? config_entidade.carga_horaria_padrao : 8;
    var limitar_ano_civil = (config_entidade && typeof config_entidade.limitar_ano_civil !== 'undefined' && config_entidade.limitar_ano_civil !== null) ? config_entidade.limitar_ano_civil : false;
    // var tipo_modalidade_padrao = jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config.tipo_modalidade_padrao");
    // tipo_modalidade_padrao = (tipo_modalidade_padrao == null) ? 4 : tipo_modalidade_padrao;
    var tipo_modalidade_padrao = (config_entidade && typeof config_entidade.tipo_modalidade_padrao !== 'undefined' && config_entidade.tipo_modalidade_padrao !== null) ? config_entidade.tipo_modalidade_padrao : 4;

    var action = (checkCapacidade('config_new_'+type)) ? 'config_new_'+type: 'config_update_'+type;
    var dates_inicio = (type == 'planos' || type == 'programas') ? moment().startOf('month').format('YYYY-MM-DD HH:mm:ss') : false;
    var dates_fim = (type == 'planos' || type == 'programas') 
                    ? (duracao_padrao > 0) 
                        ? moment().add(duracao_padrao, 'months').endOf('month').format('YYYY-MM-DD HH:mm:ss') 
                        : moment().endOf('month').format('YYYY-MM-DD HH:mm:ss') 
                    : false;
        dates_fim = ((type == 'planos' || type == 'programas') && limitar_ano_civil && moment(dates_fim, 'YYYY-MM-DD HH:mm:ss') > moment(dates_inicio, 'YYYY-MM-DD HH:mm:ss').endOf('year') )
                    ? moment(dates_inicio, 'YYYY-MM-DD HH:mm:ss').endOf('year').format('YYYY-MM-DD HH:mm:ss')
                    : dates_fim;
    var datesKey = (type == 'planos' || type == 'programas') ? getWorkDaysBetweenDates(dates_inicio, dates_fim, arrayConfigAtivUnidade.sigla_unidade) : false;
    var key = (type == 'atividades') 
            ? {
                id_unidade: arrayConfigAtivUnidade.id_unidade,
                id_cadeia_valor: 0,
                nome_atividade: '(Novo)',
                tempo_pactuado: 1,
                dias_planejado: 1,
                macroatividade: 'NULL',
                config: 
                    {
                        etiqueta: [],
                        complexidade: [
                            {
                                complexidade: "Baixo", 
                                fator: 0.5, 
                                default: true
                            },{
                                complexidade: "M\u00E9dio", 
                                fator: 1, 
                                default: false
                            },{
                                complexidade: "Alto", 
                                fator: 1.5, 
                                default: false
                            }],
                        tipo_processo: []
                    }
            } : [];

        key = (type == 'planos') 
            ? {
                id_user: parseInt(arrayConfigAtividades.perfil.id_user),
                id_unidade: parseInt(arrayConfigAtivUnidade.id_unidade),
                id_tipo_modalidade: tipo_modalidade_padrao,
                carga_horaria: carga_horaria_padrao,
                tempo_total: datesKey.dias*carga_horaria_padrao,
                tempo_proporcional: datesKey.dias*carga_horaria_padrao,
                data_inicio_vigencia: dates_inicio,
                data_fim_vigencia: dates_fim,
                config: {
                    atividades_lista_integral:true
                }
            } : key;

        key = (type == 'termos') 
            ? {
                id_user: parseInt(arrayConfigAtividades.perfil.id_user),
                id_tipo_modalidade: tipo_modalidade_padrao,
                data_inicio_vigencia: dates_inicio,
                data_fim_vigencia: dates_fim,
                config: []
            } : key;

        key = (type == 'programas') 
            ? {
                id_unidade: arrayConfigAtivUnidade.id_unidade,
                data_inicio_vigencia: dates_inicio,
                data_fim_vigencia: dates_fim,
                config: []
            } : key;

        key = (type == 'unidades') 
            ? {
                sigla_unidade: 'SIGLA',
                nome_unidade: '(Novo)',
                entidade: arrayConfigAtividades.entidades[0].id_entidade.toString(),
                dependencia: arrayConfigAtivUnidade.id_unidade,
                config: {
                    atividades:{
                        lista_superior:true
                    },
                    planos:{
                        prazo_comparecimento: 1,
                        data_comparecimento: "Dia"
                    },
                    distribuicao:{
                        horario_util:{
                            inicio:"00:00",
                            fim:"23:59"
                        },
                        count_dias_uteis:true,
                        count_horas:true,
                        notificacao:{
                            texto_criacao: "Prezado(a) {usuario}, \n\nInformo a edi\u00E7\u00E3o da {requisicao}, relativa \u00E0 "+__.atividade+" {atividade}: \n\nProcesso: {processo} \n\nAssunto: {assunto} \n\nPrazo: {prazo} dias \u00FAteis \n\nAtenciosamente,",
                            texto_conclusao: "Prezado(a), \n\nInformo a cria\u00E7\u00E3o do documento {documento_produto} para a aprecia\u00E7\u00E3o "+__.Gerencial+", relativa \u00E0 "+__.atividade+" {atividade}: \n\nProcesso: {processo} \n\nAssunto: {assunto} \n\nData de Entrega: at\u00E9 {data_entrega} \n\nObserva\u00E7\u00F5es: {observacoes} \n\nAtenciosamente,".replace(/'/g, "\\'"),
                            email: "sigla@"+window.location.hostname.replace(window.location.hostname.split('.')[0]+'.','')
                        }
                    }
                },
            } : key;

            key = (type == 'tipos_documentos') 
                ? {
                    nome_documento: '(Novo)'
                } : key;

            key = (type == 'tipos_metadados') 
                ? {
                    ref_metadado: 'novo',
                    nome_metadado: '(Novo)'
                } : key;

            key = (type == 'tipos_justificativas') 
                ? {
                    nome_justificativa: '(Novo)'
                } : key;

            key = (type == 'tipos_modalidades') 
                ? {
                    nome_modalidade: '(Novo)'
                } : key;

            key = (type == 'tipos_motivos') 
                ? {
                    nome_motivo: '(Novo)'
                } : key;

            key = (type == 'tipos_capacidades') 
                ? {
                    nome_capacidade: '(Novo)'
                } : key;

            key = (type == 'perfis') 
                ? {
                    nome_perfil: '(Novo)'
                } : key;

            key = (type == 'tipos_requisicoes') 
                ? {
                    nome_requisicao: '(Novo)'
                } : key;

            key = (type == 'cadeia_valor') 
                ? {
                    nome_processo: '(Novo)',
                    dependencia: 0,
                    config: [],
                    selecionavel: 0
                } : key;

            key = (type == 'tipos_prescricoes') 
                ? {
                    nome_prescricao: '(Novo)',
                    config: [],
                    prazo: 60
                } : key;

            key = (type == 'nomenclaturas') 
                ? {
                    ref_nomenclatura: 'novo',
                    nome_nomenclatura: '(Novo)',
                    config: []
                } : key;

            key = (type == 'entidades') 
                ? {
                    nome_entidade: '(Novo)',
                    sigla_entidade: 'SIGLA',
                    config: []
                } : key;
    

    if (type != 'users' && (type != 'planos' || checkCapacidade('config_self_planos') )) {
        var param = {
            action: action,
            id: -1,
            ids: [],
            type: data_this.type,
            key: (type == 'unidades' ? key : JSON.stringify(key)),
            mode: 'new'
        };
        _this.find('i.icon-parent').attr('class','fas fa-spinner fa-spin icon-parent');
        getConfigServer(action, param);
    } else if (type == 'planos' && !checkCapacidade('config_self_planos')) {
        newConfigPlano(this_);
    } else if (type == 'users') {
        newConfigUser(this_);
    }
}
function changeConfigCargaHPadrao(this_) {
    var _this = $(this_);
    var carga_horaria_padrao = _this.find('option:selected').data('carga_horaria_padrao');
    _this.closest('table').find('#carga_horaria').val(carga_horaria_padrao);
}
function newConfigPlano(this_) {
    var _this = $(this_);
    var carga_horaria_entidade = jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config.carga_horaria_padrao");
        carga_horaria_entidade = (carga_horaria_entidade == null) ? 8 : carga_horaria_entidade;
    var selectModalidadesOptions = $.map(arrayConfigAtividades.tipos_modalidades,function(v){ 
                                    if (v.data_fim == '0000-00-00 00:00:00' || (typeof arrayConfigAtividades.perfil.nivel !== 'undefined' && arrayConfigAtividades.perfil.nivel !== null && arrayConfigAtividades.perfil.nivel == 1)) {
                                        var carga_horaria_padrao = (v.config && typeof v.config.carga_horaria_padrao !== 'undefined' && v.config.carga_horaria_padrao !== null) ? v.config.carga_horaria_padrao : 8;
                                        return '<option value="'+v.id_tipo_modalidade+'" data-carga_horaria_padrao="'+carga_horaria_padrao+'">'+v.nome_modalidade+'</option>';
                                    }
                                }).join('');

    var config_unidade = (typeof arrayConfigAtivUnidade !== 'undefined' && arrayConfigAtivUnidade !== null && typeof arrayConfigAtivUnidade.config !== 'undefined' && arrayConfigAtivUnidade.config !== null) ? arrayConfigAtivUnidade.config : false;
    var duracao_padrao = (config_unidade && typeof config_unidade.planos !== 'undefined' && config_unidade.planos !== null && typeof config_unidade.planos.duracao_padrao !== 'undefined' && config_unidade.planos.duracao_padrao !== null) ? config_unidade.planos.duracao_padrao : 1;
        duracao_padrao = parseInt(duracao_padrao)-1;

    var selectUsuariosOptions = $.map(arrayConfigAtividades.usuarios,function(v){ 
                                    return '<option value="'+v.id_user+'">'+v.nome_completo+'</option>';
                                }).join('');
    var htmlBox =   '<div id="boxPlano" class="atividadeWork">'+
                    '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                    '      <tr>'+
                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                    '               <label for="id_user"><i class="iconPopup iconSwitch fas fa-user-tie cinzaColor"></i>Nome do Respons\u00E1vel:</label>'+
                    '           </td>'+
                    '           <td class="required" colspan="3">'+
                    '               <select class="singleOptionConfig" data-key="id_user" id="id_user">'+
                    '               '+selectUsuariosOptions+
                    '               </select>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr>'+
                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                    '               <label for="id_tipo_modalidade"><i class="iconPopup iconSwitch fas fa-wrench cinzaColor"></i>Tipo de Modalidade:</label>'+
                    '           </td>'+
                    '           <td class="required">'+
                    '               <select class="singleOptionConfig" onchange="changeConfigCargaHPadrao(this)" data-key="id_tipo_modalidade" id="id_tipo_modalidade">'+
                    '               '+selectModalidadesOptions+
                    '               </select>'+
                    '           </td>'+
                    '           <td style="vertical-align: bottom;" class="label">'+
                    '               <label class="last" for="carga_horaria"><i class="iconPopup iconSwitch fas fa-user-circle cinzaColor" style="float: initial;"></i>Carga hor\u00E1ria</label>'+
                    '           </td>'+
                    '           <td class="required">'+
                    '               <input id="carga_horaria" type="number" min="1" max="24" value="'+carga_horaria_entidade+'" required>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr>'+
                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                    '               <label for="data_inicio_vigencia"><i class="iconPopup iconSwitch fas fa-calendar-check cinzaColor"></i>Data de In\u00EDcio:</label>'+
                    '           </td>'+
                    '           <td class="required">'+
                    '               <input id="data_inicio_vigencia" type="date" value="'+moment().startOf('month').format('YYYY-MM-DD')+'" required>'+
                    '           </td>'+
                    '           <td style="vertical-align: bottom;" class="label">'+
                    '               <label class="last" for="data_fim_vigencia"><i class="iconPopup iconSwitch fas fa-calendar-check cinzaColor" style="float: initial;"></i>Data de Encerramento:</label>'+
                    '           </td>'+
                    '           <td class="required">'+
                    '               <input id="data_fim_vigencia" type="date" value="'+moment().add(duracao_padrao,'month').endOf('month').format('YYYY-MM-DD')+'" required>'+
                    '           </td>'+
                    '      </tr>'+
                    '   </table>'+
                    '</div>';

    resetDialogBoxPro('dialogBoxPro');
    dialogBoxPro = $('#dialogBoxPro')
        .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
        .dialog({
            title: 'Adicionar Plano de Trabalho',
            width: 780,
            open: function() { 
                updateButtonConfirm(this, true);
                initChosenReplace('box_init', this, true);
                $('.dialogBoxDiv #id_tipo_modalidade').trigger('change');
            },
            close: function() { 
                $('#boxUser').remove();
                resetDialogBoxPro('dialogBoxPro');
            },
            buttons: [{
                text: 'Adicionar',
                class: 'confirm',
                click: function(event) { 
                    var _parent = $(this).closest('.ui-dialog');
                    var id_user = _parent.find('select#id_user').val();
                    var id_tipo_modalidade = _parent.find('select#id_tipo_modalidade').val();
                    var carga_horaria = _parent.find('input#carga_horaria').val();
                    var data_inicio_vigencia = moment(_parent.find('input#data_inicio_vigencia').val(), 'YYYY-MM-DD').startOf('day').format('YYYY-MM-DD HH:mm:ss');
                    var data_fim_vigencia = moment(_parent.find('input#data_fim_vigencia').val(), 'YYYY-MM-DD').endOf('day').format('YYYY-MM-DD HH:mm:ss');
                    var datesKey = getWorkDaysBetweenDates(data_inicio_vigencia, data_fim_vigencia, arrayConfigAtivUnidade.sigla_unidade);

                    if (checkAtivRequiredFields(_parent.find('select#id_user'), 'mark')) {
                        var key = {
                                id_user: parseInt(id_user),
                                id_unidade: parseInt(arrayConfigAtivUnidade.id_unidade),
                                id_tipo_modalidade: parseInt(id_tipo_modalidade),
                                carga_horaria: parseInt(carga_horaria),
                                tempo_total: datesKey.dias*carga_horaria,
                                tempo_proporcional: datesKey.dias*carga_horaria,
                                data_inicio_vigencia: data_inicio_vigencia,
                                data_fim_vigencia: data_fim_vigencia,
                                config: {
                                    atividades_lista_integral:true
                                }
                            }; 
                        var action = 'config_new_planos';
                        var param = {
                                action: action,
                                id: -1,
                                ids: [],
                                type: 'planos',
                                key: JSON.stringify(key),
                                mode: 'new'
                            };
                        _this.find('i.icon-parent').attr('class','fas fa-spinner fa-spin icon-parent');
                        getConfigServer(action, param);
                    }
                }
            }]
    });
}
function newConfigUser(this_) {
    var _this = $(this_);
    
    var perfilOptions = $.map(arrayConfigAtividades.perfis, function(v){
                        if (arrayConfigAtividades.perfil.nivel <= v.nivel)  {
                            return '<option value="'+v.id_perfil+'">'+v.nome_perfil+'</option>';
                        }
                    }).join('');

    var htmlBox =   '<div id="boxUser" class="atividadeWork">'+
                    '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                    '      <tr>'+
                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                    '               <label for="user_nome_completo"><i class="iconPopup iconSwitch fas fa-user-tie cinzaColor"></i>Nome Completo:</label>'+
                    '           </td>'+
                    '           <td class="required">'+
                    '               <input id="user_nome_completo" type="text" required>'+
                    '           </td>'+
                    '           <td style="vertical-align: bottom;" class="label">'+
                    '               <label class="last" for="user_email"><i class="iconPopup iconSwitch fas fa-envelope cinzaColor" style="float: initial;"></i>E-mail:</label>'+
                    '           </td>'+
                    '           <td class="required">'+
                    '               <input id="user_email" type="email" data-server="true" onblur="checkInputEmail(this)" style="font-size: 1em;" placeholder="usuario'+'@'+window.location.hostname.replace(window.location.hostname.split('.')[0]+'.','')+'" required>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr>'+
                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                    '               <label for="user_apelido"><i class="iconPopup iconSwitch fas fa-user-circle cinzaColor"></i>Apelido:</label>'+
                    '           </td>'+
                    '           <td class="required">'+
                    '               <input id="user_apelido" type="text" required>'+
                    '           </td>'+
                    '           <td style="" class="label">'+
                    '               <label class="last" for="user_login"><i class="iconPopup iconSwitch fas fa-user-shield cinzaColor" style="float: initial;"></i>Usu\u00E1rio SEI:</label>'+
                    '           </td>'+
                    '           <td class="required">'+
                    '               <input id="user_login" type="text" data-server="true" onblur="checkInputUserServer(this)" style="font-size: 1em;" value="" required>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr>'+
                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                    '               <label for="matricula"><i class="iconPopup iconSwitch fas fa-id-badge cinzaColor"></i>Matr\u00EDcula:</label>'+
                    '           </td>'+
                    '           <td class="required">'+
                    '               <input id="matricula" data-server="true" onblur="checkInputUserServer(this)" type="text" required>'+
                    '           </td>'+
                    '           <td style="vertical-align: bottom;" class="label">'+
                    '               <label class="last" for="id_perfil"><i class="iconPopup iconSwitch fas fa-user-cog cinzaColor" style="float: initial;"></i>Perfil:</label>'+
                    '           </td>'+
                    '           <td class="required">'+
                    '               <select id="id_perfil" style="font-size: 1em;" required>'+perfilOptions+
                    '               </select>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr style="height: 20px;">'+
                    '           <td style="font-size: 9pt;text-align: left;" colspan="4">'+
                    '              <div class="onoffswitch" style="float: left;transform: scale(0.8);">'+
                    '                  <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="novo_plano" tabindex="0" checked>'+
                    '                  <label class="onoffswitch-label" for="novo_plano"></label>'+
                    '              </div>'+
                    '              <label for="novo_plano" style="vertical-align: sub;color: #666;">Cria plano de trabalho vinculado \u00E0 unidade '+arrayConfigAtivUnidade.nome_unidade+'</label>'+
                    '           </td>'+
                    '      </tr>'+
                    '   </table>'+
                    '</div>';

    resetDialogBoxPro('dialogBoxPro');
    dialogBoxPro = $('#dialogBoxPro')
        .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
        .dialog({
            title: 'Adicionar Usu\u00E1rio',
            width: 780,
            open: function() { 
                updateButtonConfirm(this, true);
                initChosenReplace('box_init', this, true);
            },
            close: function() { 
                $('#boxUser').remove();
                resetDialogBoxPro('dialogBoxPro');
            },
            buttons: [{
                text: 'Adicionar',
                class: 'confirm',
                click: function(event) { 
                    var _parent = $(this).closest('.ui-dialog');
                    var nome_completo = _parent.find('input#user_nome_completo');
                    var user_login = _parent.find('input#user_login');
                    var apelido = _parent.find('input#user_apelido');
                    var matricula = _parent.find('input#matricula');
                    var id_perfil = _parent.find('select#id_perfil');
                    var email = _parent.find('input#user_email');
                    var novo_plano = (_parent.find('input#novo_plano').is(':checked')) ? true : false;
                    var carga_horaria_padrao = jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config.carga_horaria_padrao");
                        carga_horaria_padrao = (carga_horaria_padrao == null) ? 8 : carga_horaria_padrao;
                    var tipo_modalidade_padrao = jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config.tipo_modalidade_padrao");
                        tipo_modalidade_padrao = (tipo_modalidade_padrao == null) ? 4 : tipo_modalidade_padrao;
                    var dates_inicio = moment().startOf('month').format('YYYY-MM-DD HH:mm:ss');
                    var dates_fim = moment().endOf('month').format('YYYY-MM-DD HH:mm:ss');
                    var datesKey = getWorkDaysBetweenDates(dates_inicio, dates_fim, arrayConfigAtivUnidade.sigla_unidade);

                    if (checkAtivRequiredFields(nome_completo[0], 'mark')) {
                        var key = {
                                id_unidade: arrayConfigAtivUnidade.id_unidade,
                                nome_completo: nome_completo.val(),
                                login: user_login.val(),
                                apelido: apelido.val(),
                                matricula: matricula.val(),
                                id_perfil: id_perfil.val(),
                                novo_plano: novo_plano,
                                host: url_host.replace('controlador.php',''),
                                email: email.val(),
                                plano: {
                                    id_tipo_modalidade: tipo_modalidade_padrao,
                                    carga_horaria: carga_horaria_padrao,
                                    tempo_total: datesKey.dias*carga_horaria_padrao,
                                    data_inicio_vigencia: dates_inicio,
                                    data_fim_vigencia: dates_fim,
                                    config: {
                                        atividades_lista_integral: true
                                    }
                                },
                                config: []
                            };
                        var action = 'config_update_users';
                        var param = {
                                action: action,
                                id: -1,
                                ids: [],
                                type: 'users',
                                key: JSON.stringify(key),
                                mode: 'new'
                            };
                        _this.find('i.icon-parent').attr('class','fas fa-spinner fa-spin icon-parent');
                        getConfigServer(action, param);
                    }
                }
            }]
    });
}
function getConfigServerDoc(action, param) {
    param.hash = userHashAtiv;
    param.version = VERSION_SPRO;
    param.perfil = (getOptionsPro('perfilAtividadesSelected')) ? getOptionsPro('perfilAtividadesSelected') : '';
    $.ajax({
        type: "POST",
        url: urlServerAtiv,
        processData: false,
        dataType: "json",
        // contentType: 'application/json',
        data: JSON.stringify(param),
        success: function(ativData){
            loadingButtonConfirm(false);
            if (  ativData.status == 0 || ativData.length == 0 ) {
                alertaBoxPro('Error', 'exclamation-triangle', (typeof ativData.status_txt != 'undefined' ? ativData.status_txt : 'Erro ao enviar sua informa\u00E7\u00F5es.'));
            } else {
                resetDialogBoxPro('editorBoxPro');
                getAtividades();
                var txtAlert = (action == 'sign_documento') ? 'Documento assinado' : 'Assinatura do documento cancelada';
                alertaBoxPro('Sucess', 'check-circle', txtAlert+' com sucesso!');

                if (typeof ativData.refresh_page !== 'undefined' && ativData.refresh_page && $('#tableConfiguracoesPanel_'+param.type).is(':visible')) {
                    getTabConfig(param.type, 'get');
                }
            }

        }
    }).fail(function(data, textStatus){
        failureScreen(data, textStatus, param);
    });
}
function getConfigServer(action, param) {
    if (checkCapacidade(action)) {
        getServerAtividades(param, action);
    }
}
function approveConfig(this_) {
    var _this = $(this_);
    var td = _this.closest('td');
    var tr = _this.closest('tr');
    var data = td.data();
    var data_this = _this.data();
    var label = (data_this.mode == 'disapprove') ? '<b style="font-weight: bold;">CANCELAR A HOMOLOGA\u00C7\u00C3O</b> d' : '<b style="font-weight: bold;">HOMOLOGAR</b> ';
    var id = data_this.id;
    var data_tr = tr.data();
        data_tr = (typeof data_tr !== 'undefined') ? tr.data() : data_this;
    var ids = [];
    var idTable = '#tableConfiguracoesPanel_'+data_tr.type;
    var countSelected = $(idTable+' tr.infraTrMarcada').length;
    if (id != 0) {
        if ($(idTable).is(':visible') && countSelected > 0) {
            $(idTable).find('.lnkInfraCheck').data('index',1).trigger('click');
        }
        _this.closest('tr').find('td').eq(0).find('input[type="checkbox"]').trigger('click');
    } else {
        ids = $(idTable).find('.checkboxSelectConfiguracoes:checked').map(function(){ if(!$(this).closest('tr').hasClass('disabled')) { return $(this).val() } }).get();
    }

    confirmaFraseBoxPro('Tem certeza que deseja '+label+(countSelected > 1 ? 'os registros' : 'o registro')+(id == 0 ? (countSelected > 1 ? ' selecionados' : ' selecionado') : '')+'?', 'SIM', 
        function(){
            var action = 'config_update_'+data_this.type;
            if (checkCapacidade(action)) {
                var param = {
                    action: action,
                    id: id,
                    ids: ids,
                    type: data_this.type,
                    key: 'homologado',
                    mode: data_this.mode
                };
                getServerAtividades(param, action);
            }
        }, function() {
            if (id != 0) {
                if ($(idTable).is(':visible') && _this.closest('tr').hasClass('infraTrMarcada')) {
                    $(idTable).find('.lnkInfraCheck').data('index',1).trigger('click');
                }
            }
        }
    );
}
function updateCalcPlanos(this_) {
    var _this = $(this_);
    var td = _this.closest('td');
    var tr = _this.closest('tr');
    var data = td.data();
    var data_this = _this.data();
    var label = '<b style="font-weight: bold;">RECALCULAR</b>';
    var id = data_this.id;
    var data_tr = tr.data();
        data_tr = (typeof data_tr !== 'undefined') ? tr.data() : data_this;
    var ids = [];
    var idTable = '#tableConfiguracoesPanel_'+data_tr.type;
    var countSelected = $(idTable+' tr.infraTrMarcada').length;
    if (id != 0) {
        if ($(idTable).is(':visible') && countSelected > 0) {
            $(idTable).find('.lnkInfraCheck').data('index',1).trigger('click');
        }
        _this.closest('tr').find('td').eq(0).find('input[type="checkbox"]').trigger('click');
    } else {
        ids = $(idTable).find('.checkboxSelectConfiguracoes:checked').map(function(){ return $(this).val() }).get();
    }

    confirmaFraseBoxPro('Tem certeza que deseja '+label+(countSelected > 1 ? 'os registros' : 'o registro')+(id == 0 ? (countSelected > 1 ? ' selecionados' : ' selecionado') : '')+'?', 'SIM', 
        function(){
            var action = checkCapacidade('config_update_self_'+data_this.type) ? 'config_update_self_'+data_this.type : 'config_update_'+data_this.type;
            var listUpdate = [];
            if (checkCapacidade(action)) {
                $.each(tableConfigList.planos, function(i,v){
                    if ($.inArray(v.id_plano.toString(), ids) !== -1) {
                        listUpdate.push(v);
                    }
                });
                if (listUpdate.length > 0) {
                    dialogUpdateCalcPlanos(listUpdate, 'update');
                }
            }
        }, function() {
            if (id != 0) {
                if ($(idTable).is(':visible') && _this.closest('tr').hasClass('infraTrMarcada')) {
                    $(idTable).find('.lnkInfraCheck').data('index',1).trigger('click');
                }
            }
        }
    );
}
function disableConfig_(this_) {
    var _this = $(this_);
    var data_this = _this.data();
    if (data_this.type == 'users') {
        var value = jmespath.search(tableConfigList[data_this.type], "[?id_"+data_this.type.slice(0, -1)+" == `"+data_this.id+"`] | [0]");
            value = (value == null) ? false : value;
        if (value && typeof value.list_planos !== 'undefined' && value.list_planos !== null && value.list_planos !== '' && value.list_planos) {
            alertaBoxPro('Error', 'exclamation-triangle', 'Existe plano de trabalho ativo na unidade '+value.list_planos+'. <br><br>Encerre-o antes de prosseguir.');
        } else {
            disableConfig(this_);
        }
    } else if (data_this.type == 'unidades') {
        var value = jmespath.search(tableConfigList[data_this.type], "[?id_"+data_this.type.slice(0, -1)+" == `"+data_this.id+"`] | [0]");
            value = (value == null) ? false : value;
        if (value && typeof value.planos_ativos !== 'undefined' && value.planos_ativos !== null && value.planos_ativos !== '' && value.planos_ativos > 0) {
            var txt = value.planos_ativos == 1 ? 'Existe 1 (um) plano de trabalho ativo na unidade '+value.nome_unidade+'. <br><br>Encerre-o antes de prosseguir.' : 'Existem '+value.planos_ativos+' planos de trabalho ativos na unidade '+value.nome_unidade+'. <br><br>Encerre-os antes de prosseguir.';
            alertaBoxPro('Error', 'exclamation-triangle', txt);
        } else {
            disableConfig(this_);
        }
    } else {
        disableConfig(this_);
    }
}
function disableConfig(this_) {
    var _this = $(this_);
    var td = _this.closest('td');
    var tr = _this.closest('tr');
    var data = td.data();
    var data_this = _this.data();
    var id = data_this.id;
    var data_tr = tr.data();
        data_tr = (typeof data_tr !== 'undefined') ? tr.data() : data_this;
    var ids = [];
    var idTable = '#tableConfiguracoesPanel_'+data_tr.type;
    var countSelected = $(idTable+' tr.infraTrMarcada').length;
    if (id != 0) {
        if ($(idTable).is(':visible') && countSelected > 0) {
            $(idTable).find('.lnkInfraCheck').data('index',1).trigger('click');
        }
        _this.closest('tr').find('td').eq(0).find('input[type="checkbox"]').trigger('click');
    } else {
        ids = $(idTable).find('.checkboxSelectConfiguracoes:checked').map(function(){ if(!$(this).closest('tr').hasClass('disabled')) { return $(this).val() } }).get();
    }

    confirmaFraseBoxPro('Tem certeza que deseja <b style="font-weight: bold;">DESATIVAR</b> '+(countSelected > 1 ? 'os registros' : 'o registro')+(id == 0 ? (countSelected > 1 ? ' selecionados' : ' selecionado') : '')+'?', 'SIM', 
        function(){
            var action = 'config_update_'+data_this.type;
            if (checkCapacidade(action)) {
                var param = {
                    action: action,
                    id: id,
                    ids: ids,
                    type: data_this.type,
                    key: 'data_fim',
                    mode: 'disable'
                };
                getServerAtividades(param, action);
            }
        }, function() {
            if (id != 0) {
                if ($(idTable).is(':visible') && _this.closest('tr').hasClass('infraTrMarcada')) {
                    $(idTable).find('.lnkInfraCheck').data('index',1).trigger('click');
                }
            }
        }
    );
}
function closeConfig(this_) {
    var _this = $(this_);
    var td = _this.closest('td');
    var tr = _this.closest('tr');
    var data = td.data();
    var data_this = _this.data();
    var id = data_this.id;
    var data_tr = tr.data();
        data_tr = (typeof data_tr !== 'undefined') ? tr.data() : data_this;
    var ids = [];
    var idTable = '#tableConfiguracoesPanel_'+data_tr.type;
    var countSelected = $(idTable+' tr.infraTrMarcada').length;
    if (id != 0) {
        if ($(idTable).is(':visible') && countSelected > 0) {
            $(idTable).find('.lnkInfraCheck').data('index',1).trigger('click');
        }
        _this.closest('tr').find('td').eq(0).find('input[type="checkbox"]').trigger('click');
    } else {
        ids = $(idTable).find('.checkboxSelectConfiguracoes:checked').map(function(){ if(!$(this).closest('tr').hasClass('disabled')) { return $(this).val() } }).get();
    }
    var typeText = (countSelected > 1) ? 'os registros' : 'o registro';
    var inputText = '';

    if (data_this.type == 'planos') {
        typeText = (countSelected > 1) ? 'os planos de trabalho' : 'o plano de trabalho';
        var dateMinMax = (id != 0) 
                        ?   jmespath.search(tableConfigList[data_this.type], "[?id_plano==`"+id+"`]")
                        :   $.map(tableConfigList[data_this.type],function(v){
                                if($.inArray(v.id_plano.toString(), ids) !== -1) { return v }
                            });
        var dateInicio = jmespath.search(dateMinMax, "[*].data_inicio_vigencia");
            dateInicio = (dateInicio == null) ? null : dateInicio.reduce(function (a, b) { return a > b ? a : b; });
            dateInicio = (dateInicio == null) ? null : moment(dateInicio,'YYYY-MM-DD HH:mm:ss');
        var dateFim = jmespath.search(dateMinMax, "[*].data_fim_vigencia");
            dateFim = (dateFim == null) ? null : dateFim.reduce(function (a, b) { return a > b ? a : b; });
            dateFim = (dateFim == null) ? null : moment(dateFim,'YYYY-MM-DD HH:mm:ss');
        var inputText = (data_this.type == 'planos') ? '<br>Data de encerramento do plano: <input id="configClose_date" type="date" style="width: 200px;" min="'+dateInicio.format('YYYY-MM-DD')+'" value="'+(moment() > dateFim ? dateFim : moment().format('YYYY-MM-DD'))+'" max="'+dateFim.format('YYYY-MM-DD')+'">' : '';
    } else if (data_this.type == 'termos') {
        typeText = (countSelected > 1) ? 'os termos de ci\u00EAncia e responsabilidade' : 'o termo de ci\u00EAncia e responsabilidade';
        var dateMinMax = (id != 0) 
                        ?   jmespath.search(tableConfigList[data_this.type], "[?id_termo==`"+id+"`]")
                        :   $.map(tableConfigList[data_this.type],function(v){
                                if($.inArray(v.id_plano.toString(), ids) !== -1) { return v }
                            });
        var dateInicio = jmespath.search(dateMinMax, "[*].data_inicio_vigencia");
            dateInicio = (dateInicio == null) ? null : dateInicio.reduce(function (a, b) { return a > b ? a : b; });
            dateInicio = (dateInicio == null) ? null : moment(dateInicio,'YYYY-MM-DD HH:mm:ss');
        var dateFim = jmespath.search(dateMinMax, "[*].data_fim_vigencia");
            dateFim = (dateFim == null) ? null : dateFim.reduce(function (a, b) { return a > b ? a : b; });
            dateFim = (dateFim == null) ? null : moment(dateFim,'YYYY-MM-DD HH:mm:ss');
        var inputText = (data_this.type == 'termos') ? '<br>Data de encerramento do termo: <input id="configClose_date" type="date" style="width: 200px;" min="'+dateInicio.format('YYYY-MM-DD')+'" value="'+(moment() > dateFim ? dateFim : moment().format('YYYY-MM-DD'))+'" max="'+dateFim.format('YYYY-MM-DD')+'">' : '';
    }
        typeText = typeText+(id == 0 ? (countSelected > 1 ? ' selecionados' : ' selecionado') : '');

    confirmaFraseBoxPro('Tem certeza que deseja <b style="font-weight: bold;">ENCERRAR ANTECIPADAMENTE</b> '+typeText+'?'+inputText, 'ENCERRAR', 
        function(){
            var action = 'config_update_'+data_this.type;
            if (checkCapacidade(action)) {
                var param = {
                    action: action,
                    id: id,
                    ids: ids,
                    type: data_this.type,
                    key: 'data_fim_vigencia',
                    date_config: ($('#configClose_date').length ? $('#configClose_date').val() : false),
                    mode: 'close'
                };
                getServerAtividades(param, action);
            }
        }, function() {
            if (id != 0) {
                if ($(idTable).is(':visible') && _this.closest('tr').hasClass('infraTrMarcada')) {
                    $(idTable).find('.lnkInfraCheck').data('index',1).trigger('click');
                }
            }
        }
    );
}
function editConfigOptions(this_, id) {
    var _this = $(this_);
    var tr = _this.closest('tr');
    var table = _this.closest('table');
    var data = tr.data();
    var htmlBox =   '';
    var countSelected = table.find('tr.infraTrMarcada').length;
    if (countSelected > 0) {
        table.find('.lnkInfraCheck').data('index',1).trigger('click');
    }
    _this.closest('tr').find('td').eq(0).find('input[type="checkbox"]').trigger('click');

    if (data.type == 'atividades') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_atividade==`"+id+"`] | [0]");
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = __.Atividades;
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_atividade;
        var complexidade = (value.config !== null && typeof value.config.complexidade !== 'undefined' && value.config.complexidade !== null) ? value.config.complexidade : false;
        var tempo_minimo = (value.config !== null && typeof value.config.tempo_minimo !== 'undefined' && value.config.tempo_minimo !== null) ? value.config.tempo_minimo : 20;
        var complexidade_len = (complexidade) ? complexidade.length : 0;
        var complexidade_style = (complexidade_len > 6) ? 'style="height: 300px;"' : '';

            htmlBox =   '<div id="'+idConfigBox+'" class="atividadeWork" data-atividade="'+(value && value.id_atividade ? value.id_atividade : 0)+'">'+
                        '<div id="'+idConfigBox+'_tabs" style="border: none; min-height: 300px; margin: 0;">'+
                        '   <ul style="font-size: 10px;">'+
                        '       <li><a href="#tabs_'+idConfigBox+'_variacao_produtividade">'+__.Complexidade+' e Produtividade</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_predefinidas">Configura\u00E7\u00F5es Pr\u00E9-definidas</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_param_entregas">Par\u00E2metros e Entregas</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_outrasopcoes">Outras Op\u00E7\u00F5es</a></li>'+
                        '   </ul>'+
                        '   <div id="tabs_'+idConfigBox+'_variacao_produtividade">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-graduation-cap cinzaColor"></i>Grau de '+__.Complexidade+':</label>'+
                        '           </td>'+
                        '           <td style="position:relative">'+
                        '   	        <div id="tabelaConfigPanel_'+data.type+'_complexidade" class="tabelaConfigPanel_'+data.type+'_scroll" '+complexidade_style+'>'+
                        '               <table id="configBox_complexidade" data-format="obj" data-key="complexidade" data-tempo-pactuado="'+value.tempo_pactuado+'" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                    <thead>'+
                        '                        <tr class="tableHeader">'+
                        '                            <th class="tituloControle">Grau</th>'+
                        '                            <th class="tituloControle" style="width: 80px;">Fator</th>'+
                        '                            <th class="tituloControle" style="width: 180px;">Tempo Pactuado</th>'+
                        '                            <th class="tituloControle" style="width: 50px;">Padr\u00E3o</th>'+
                        '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                        '                        </tr>'+
                        '                    </thead>'+
                        '                    <tbody>';
            if (complexidade){
                $.each(value.config.complexidade, function(i, v){
                    htmlBox +=  '                        <tr data-index="'+i+'" data-key="complexidade">'+
                                '                            <td class="editCell" data-key="complexidade" data-type="text" style="padding: 0 10px; text-align: left;">'+unicodeToChar(v.complexidade)+'</td>'+
                                '                            <td class="editCellNumComplex" data-key="fator" data-type="num" style="width: 80px; text-align: center;">'+v.fator+'</td>'+
                                '                            <td class="editCellNumComplex" data-key="tempo_pactuado" data-type="num" style="width: 180px; text-align: center;">'+roundToTwo(v.fator*value.tempo_pactuado)+'</td>'+  
                                '                            <td data-key="default" data-type="switch" data-required="true" style="width: 50px; text-align: center;">'+
                                '                               <div class="onoffswitch" style="transform: scale(0.8);">'+
                                '                                   <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox switch_complexidadeDefault switch_complexidadeDefault_'+i+'" onchange="changeSwitchConfigItem(this)" id="changeItemConfig_'+data.type+'_'+i+'" tabindex="0" '+(v.default  ? 'checked' : '')+'>'+
                                '                                   <label class="onoffswitch-label" for="changeItemConfig_'+data.type+'_'+i+'"></label>'+
                                '                               </div>'+
                                '                            </td>'+
                                '                            <td style="width: 80px; text-align: center;">'+
                                '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                           </td>'+  
                                '                        </tr>';
                });
            }
            htmlBox +=      (complexidade_len == 0 ? 
                            '                        <tr data-index="'+complexidade_len+'" data-key="complexidade">'+
                            '                            <td class="editCell" data-key="complexidade" data-type="text" style="padding: 0 10px; text-align: left;"></td>'+
                            '                            <td class="editCellNumComplex" data-key="fator" data-type="num" style="width: 80px; text-align: center;"></td>'+
                            '                            <td class="editCellNumComplex" data-key="tempo_pactuado" data-type="num" style="width: 180px; text-align: center;"></td>'+
                            '                            <td data-key="default" data-type="switch" data-required="true" style="width: 50px; text-align: center;">'+
                            '                               <div class="onoffswitch" style="transform: scale(0.8);">'+
                            '                                   <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox switch_complexidadeDefault switch_complexidadeDefault_'+complexidade_len+'" onchange="changeSwitchConfigItem(this)" id="changeItemConfig_'+data.type+'_'+complexidade_len+'" tabindex="0">'+
                            '                                   <label class="onoffswitch-label" for="changeItemConfig_'+data.type+'_'+complexidade_len+'"></label>'+
                            '                               </div>'+
                            '                            </td>'+
                            '                            <td style="width: 80px; text-align: center;">'+
                            '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                            '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                            '                           </td>'+  
                            '                        </tr>'+
                            '' : '')+
                            '                    </tbody>'+
                            '                    <tfoot style="position: sticky;bottom: -4px;" class="trCinza">'+
                            '                       <tr>'+
                            '                           <th colspan="5" style="text-align: right;">'+
                            '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px 5px 15px 5px;display: inline-block;">'+
                            '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                   Adicionar novo item'+
                            '                               </a>'+
                            '                           </th>'+
                            '                       </tr>'+
                            '                    </tfoot>'+
                            '                </table>'+
                            '                </div>'+
                            '           </td>'+
                            '      </tr>'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-chart-line cinzaColor"></i>Produtividade:</label>'+
                            '           </td>'+
                            '           <td>'+
                            '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;vertical-align: bottom;height: 40px;"><i class="iconPopup fas fa-hourglass-half cinzaColor"></i> Tempo despendido m\u00EDnimo aceit\u00E1vel para '+__.a_atividade+' (% do tempo pactuado)</td>'+
                            '                      <td>'+
                            '                            <input type="number" style="width: 50px !important;" id="tempo_minimo" data-key="tempo_minimo" min="0" max="100" step=".1" class="singleOptionConfig" tabindex="0" value="'+tempo_minimo+'">'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;vertical-align: bottom;height: 40px;"><i class="iconPopup fas fa-chart-line cinzaColor"></i> Utilizar as configura\u00E7\u00F5es de Ganho de Produtividade da unidade</td>'+
                            '                      <td>'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" onchange="changeConfigGanhoUnidade(this)" class="onoffswitch-checkbox singleOptionConfig" id="ganho_unidade" data-key="ganho_unidade" tabindex="0" '+(value.config && typeof value.config.ganho_unidade !== 'undefined' && value.config.ganho_unidade === false  ? '' : 'checked')+'>'+
                            '                              <label class="onoffswitch-label" for="ganho_unidade"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '               </table>'+
                            '               <div style="position:relative">'+
                            '   	        <div id="tabelaConfigPanel_'+data.type+'_modalidades" class="tabelaConfigPanel_'+data.type+'_scroll">'+
                            '               <table id="configBox_modalidades_atividade" data-format="obj" data-key="modalidades" style="font-size: 8pt !important;width: 100%; '+(value.config && typeof value.config.ganho_unidade !== 'undefined' && value.config.ganho_unidade === false  ? '' : 'display:none')+'" class="tableOptionConfig seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                            '                    <thead>'+
                            '                        <tr class="tableHeader">'+
                            '                            <th class="tituloControle" style="width: 350px;">Tipo de Modalidade</th>'+
                            '                            <th class="tituloControle" style="width: 175px;">Fator</th>'+
                            '                            <th class="tituloControle" style="display:none">ID</th>'+
                            '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                            '                        </tr>'+
                            '                    </thead>'+
                            '                    <tbody>';
                var modalidades = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.modalidades !== 'undefined' && value.config.modalidades !== null) ? value.config.modalidades : false;
                var modalidades_len = (modalidades) ? modalidades.length : 0;
                if (modalidades){
                    $.each(value.config.modalidades, function(i, v){
                        htmlBox +=  '                        <tr data-index="'+i+'" data-key="modalidades">'+
                                    '                            <td class="editCellSelect" data-key="tipo_modalidade" data-type="text" style="width: 350px; padding: 0 10px; text-align: left;">'+unicodeToChar(v.tipo_modalidade)+'</td>'+
                                    '                            <td class="editCellNum" data-key="fator" data-type="text" style="width: 175px; text-align: left;">'+v.fator+'</td>'+ 
                                    '                            <td data-key="id_tipo_modalidade" data-type="text" style="display:none;">'+v.id_tipo_modalidade+'</td>'+ 
                                    '                            <td style="width: 80px; text-align: center;">'+
                                    '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                    '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                    '                           </td>'+  
                                    '                        </tr>';
                    });
                }
            htmlBox +=      '                        <tr data-index="'+modalidades_len+'" data-key="modalidades">'+
                            '                            <td class="editCellSelect" data-key="tipo_modalidade" data-type="text" style="width: 350px; padding: 0 10px; text-align: left;"></td>'+
                            '                            <td class="editCellNum" data-key="fator" data-type="text" style="width: 175px; text-align: left;"></td>'+
                            '                            <td data-key="id_tipo_modalidade" data-type="text" style="display:none;"></td>'+
                            '                            <td style="width: 80px; text-align: center;">'+
                            '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                            '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                            '                           </td>'+  
                            '                        </tr>'+
                            '                    </tbody>'+
                            '                    <tfoot style="position: sticky;bottom: -4px;" class="trCinza">'+
                            '                       <tr>'+
                            '                           <th colspan="3" style="text-align: right;">'+
                            '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px 5px 15px 5px;display: inline-block;">'+
                            '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                   Adicionar novo item'+
                            '                               </a>'+
                            '                           </th>'+
                            '                       </tr>'+
                            '                    </tfoot>'+
                            '                </table>'+
                            '                </div>'+
                            '                </div>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '   </div>'+
                            '   <div id="tabs_'+idConfigBox+'_predefinidas">'+
                            '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left; width: 170px;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-folder-open cinzaColor"></i>Tipos de Processos:</label>'+
                            '           </td>'+
                            '           <td style="position:relative">'+
                            '   	        <div id="tabelaConfigPanel_'+data.type+'_tipo_processo" class="tabelaConfigPanel_'+data.type+'_scroll">'+
                            '               <table id="configBox_tipo_processo" data-format="array" data-key="tipo_processo" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                            '                    <thead>'+
                            '                        <tr class="tableHeader">'+
                            '                            <th class="tituloControle">Tipo</th>'+
                            '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                            '                        </tr>'+
                            '                    </thead>'+
                            '                    <tbody>';
            var tipo_processo = (value.config !== null && typeof value.config.tipo_processo !== 'undefined' && value.config.tipo_processo !== null) ? value.config.tipo_processo : false;
            var tipo_processo_len = (tipo_processo) ? tipo_processo.length : 0;
            if (tipo_processo){
                $.each(value.config.tipo_processo, function(i, v){
                    htmlBox +=  '                        <tr data-index="'+i+'" data-key="tipo_processo" style="text-align: left;">'+
                                '                            <td class="editCellSelect" data-type="text" style="padding: 0 10px;">'+unicodeToChar(v[0])+'</td>'+
                                '                            <td style="width: 80px; text-align: center;">'+
                                '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                           </td>'+  
                                '                        </tr>';
                });
            }
            htmlBox +=      (tipo_processo_len == 0 ? 
                            '                        <tr data-index="'+tipo_processo_len+'" data-key="tipo_processo" style="text-align: left;">'+
                            '                            <td class="editCellSelect" data-type="text" style="padding: 0 10px;"></td>'+
                            '                            <td style="width: 80px; text-align: center;">'+
                            '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                            '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                            '                           </td>'+  
                            '                        </tr>'+
                            '' : '')+
                            '                    </tbody>'+
                            '                    <tfoot style="position: sticky;bottom: -4px;" class="trCinza">'+
                            '                       <tr>'+
                            '                           <th colspan="2" style="text-align: right;">'+
                            '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; 5px 5px 15px 5px;display: inline-block;">'+
                            '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                   Adicionar novo item'+
                            '                               </a>'+
                            '                           </th>'+
                            '                       </tr>'+
                            '                    </tfoot>'+
                            '                </table>'+
                            '                </div>'+
                            '           </td>'+
                            '      </tr>'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-tags cinzaColor"></i>Etiquetas Pr\u00E9-definidas:</label>'+
                            '           </td>'+
                            '           <td style="position:relative">'+
                            '   	        <div id="tabelaConfigPanel_'+data.type+'_etiquetas" class="tabelaConfigPanel_'+data.type+'_scroll">'+
                            '               <table id="configBox_etiquetas" data-format="array" data-key="etiquetas" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                            '                    <thead>'+
                            '                        <tr class="tableHeader">'+
                            '                            <th class="tituloControle">Nome da etiqueta</th>'+
                            '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                            '                        </tr>'+
                            '                    </thead>'+
                            '                    <tbody>';
            var etiquetas = (value.config !== null && typeof value.config.etiquetas !== 'undefined' && value.config.etiquetas !== null) ? value.config.etiquetas : false;
            var etiquetas_len = (etiquetas) ? etiquetas.length : 0;
            if (etiquetas){
                $.each(value.config.etiquetas, function(i, v){
                    htmlBox +=  '                        <tr data-index="'+i+'" data-key="etiquetas" style="text-align: left;">'+
                                '                            <td onchange="changeConfigItemCell(this)" class="editCell" data-type="text" style="padding: 0 10px;">'+unicodeToChar(v[0])+'</td>'+
                                '                            <td style="width: 80px; text-align: center;">'+
                                '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                           </td>'+  
                                '                        </tr>';
                });
            }
            htmlBox +=      (etiquetas_len == 0 ? 
                            '                        <tr data-index="'+etiquetas_len+'" data-key="etiquetas" style="text-align: left;">'+
                            '                            <td onchange="changeConfigItemCell(this)" class="editCell" data-type="text" style="padding: 0 10px;"></td>'+
                            '                            <td style="width: 80px; text-align: center;">'+
                            '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                            '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                            '                           </td>'+  
                            '                        </tr>'+
                            '' : '')+
                            '                    </tbody>'+
                            '                    <tfoot style="position: sticky;bottom: -4px;" class="trCinza">'+
                            '                       <tr>'+
                            '                           <th colspan="3" style="text-align: right;">'+
                            '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px 5px 15px 5px;display: inline-block;">'+
                            '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                   Adicionar novo item'+
                            '                               </a>'+
                            '                           </th>'+
                            '                       </tr>'+
                            '                    </tfoot>'+
                            '                </table>'+
                            '                </div>'+
                            '           </td>'+
                            '      </tr>'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-check-double cinzaColor"></i>Checklist Pr\u00E9-definido:</label>'+
                            '           </td>'+
                            '           <td style="position:relative">'+
                            '   	        <div id="tabelaConfigPanel_'+data.type+'_checklist" class="tabelaConfigPanel_'+data.type+'_scroll">'+
                            '               <table id="configBox_checklist" data-format="array" data-key="checklist" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                            '                    <thead>'+
                            '                        <tr class="tableHeader">'+
                            '                            <th class="tituloControle">Nome do item</th>'+
                            '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                            '                        </tr>'+
                            '                    </thead>'+
                            '                    <tbody>';
            var checklist = (value.config !== null && typeof value.config.checklist !== 'undefined' && value.config.checklist !== null) ? value.config.checklist : false;
            var checklist_len = (checklist) ? checklist.length : 0;
            if (checklist){
                $.each(value.config.checklist, function(i, v){
                    htmlBox +=  '                        <tr data-index="'+i+'" data-key="checklist" style="text-align: left;">'+
                                '                            <td onchange="changeConfigItemCell(this)" class="editCell" data-type="text" style="padding: 0 10px;">'+unicodeToChar(v[0])+'</td>'+
                                '                            <td style="width: 80px; text-align: center;">'+
                                '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                           </td>'+  
                                '                        </tr>';
                });
            }
            htmlBox +=      (checklist_len == 0 ? 
                            '                        <tr data-index="'+checklist_len+'" data-key="checklist" style="text-align: left;">'+
                            '                            <td onchange="changeConfigItemCell(this)" class="editCell" data-type="text" style="padding: 0 10px;"></td>'+
                            '                            <td style="width: 80px; text-align: center;">'+
                            '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                            '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                            '                           </td>'+  
                            '                        </tr>'+
                            '' : '')+
                            '                    </tbody>'+
                            '                    <tfoot style="position: sticky;bottom: -4px;" class="trCinza">'+
                            '                       <tr>'+
                            '                           <th colspan="3" style="text-align: right;">'+
                            '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px 5px 15px 5px;display: inline-block;">'+
                            '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                   Adicionar novo item'+
                            '                               </a>'+
                            '                           </th>'+
                            '                       </tr>'+
                            '                    </tfoot>'+
                            '                </table>'+
                            '                </div>'+
                            '           </td>'+
                            '      </tr>'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-comment-alt cinzaColor"></i>'+__.Observacao+' '+__.Gerencial+' Pr\u00E9-'+(getNameGenre('observacao', 'definido', 'definida'))+':</label>'+
                            '           </td>'+
                            '           <td style="position:relative">'+
                            '                <textarea id="observacao_gerencial" data-key="observacao_gerencial" class="singleOptionInput">'+(value.config !== null && typeof value.config.observacao_gerencial !== 'undefined' && value.config.observacao_gerencial !== null && value.config.observacao_gerencial != '' ? value.config.observacao_gerencial : '')+'</textarea>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '   </div>'+
                            '   <div id="tabs_'+idConfigBox+'_param_entregas">'+
                            '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-puzzle-piece cinzaColor"></i>Par\u00E2metros adotados:</label>'+
                            '           </td>'+
                            '           <td style="position:relative">'+
                            '   	        <div id="tabelaConfigPanel_'+data.type+'_parametros" class="tabelaConfigPanel_'+data.type+'_scroll">'+
                            '               <table id="configBox_parametros" data-format="array" data-key="parametros" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                            '                    <thead>'+
                            '                        <tr class="tableHeader">'+
                            '                            <th class="tituloControle">Nome do par\u00E2metro</th>'+
                            '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                            '                        </tr>'+
                            '                    </thead>'+
                            '                    <tbody>';
            var parametros = (value.config !== null && typeof value.config.parametros !== 'undefined' && value.config.parametros !== null) ? value.config.parametros : false;
            var parametros_len = (parametros) ? parametros.length : 0;
            if (parametros){
                $.each(value.config.parametros, function(i, v){
                    htmlBox +=  '                        <tr data-index="'+i+'" data-key="parametros" style="text-align: left;">'+
                                '                            <td onchange="changeConfigItemCell(this)" class="editCell" data-type="text" style="padding: 0 10px;">'+unicodeToChar(v[0])+'</td>'+
                                '                            <td style="width: 80px; text-align: center;">'+
                                '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                           </td>'+  
                                '                        </tr>';
                });
            }
            htmlBox +=      (parametros_len == 0 ? 
                            '                        <tr data-index="'+parametros_len+'" data-key="parametros" style="text-align: left;">'+
                            '                            <td onchange="changeConfigItemCell(this)" class="editCell" data-type="text" style="padding: 0 10px;"></td>'+
                            '                            <td style="width: 80px; text-align: center;">'+
                            '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                            '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                            '                           </td>'+  
                            '                        </tr>'+
                            '' : '')+
                            '                    </tbody>'+
                            '                    <tfoot style="position: sticky;bottom: -4px;" class="trCinza">'+
                            '                       <tr>'+
                            '                           <th colspan="3" style="text-align: right;">'+
                            '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px 5px 15px 5px;display: inline-block;">'+
                            '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                   Adicionar novo item'+
                            '                               </a>'+
                            '                           </th>'+
                            '                       </tr>'+
                            '                    </tfoot>'+
                            '                </table>'+
                            '                </div>'+
                            '           </td>'+
                            '      </tr>'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-file-export cinzaColor"></i>Entregas esperadas:</label>'+
                            '           </td>'+
                            '           <td style="position:relative">'+
                            '   	        <div id="tabelaConfigPanel_'+data.type+'_entregas" class="tabelaConfigPanel_'+data.type+'_scroll">'+
                            '               <table id="configBox_entregas" data-format="array" data-key="entregas" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                            '                    <thead>'+
                            '                        <tr class="tableHeader">'+
                            '                            <th class="tituloControle">Tipo de entrega</th>'+
                            '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                            '                        </tr>'+
                            '                    </thead>'+
                            '                    <tbody>';
            var entregas = (value.config !== null && typeof value.config.entregas !== 'undefined' && value.config.entregas !== null) ? value.config.entregas : false;
            var entregas_len = (entregas) ? entregas.length : 0;
            if (entregas){
                $.each(value.config.entregas, function(i, v){
                    htmlBox +=  '                        <tr data-index="'+i+'" data-key="entregas" style="text-align: left;">'+
                                '                            <td onchange="changeConfigItemCell(this)" class="editCell" data-type="text" style="padding: 0 10px;">'+unicodeToChar(v[0])+'</td>'+
                                '                            <td style="width: 80px; text-align: center;">'+
                                '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                           </td>'+  
                                '                        </tr>';
                });
            }
            htmlBox +=      (entregas_len == 0 ? 
                            '                        <tr data-index="'+entregas_len+'" data-key="entregas" style="text-align: left;">'+
                            '                            <td onchange="changeConfigItemCell(this)" class="editCell" data-type="text" style="padding: 0 10px;"></td>'+
                            '                            <td style="width: 80px; text-align: center;">'+
                            '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                            '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                            '                           </td>'+  
                            '                        </tr>'+
                            '' : '')+
                            '                    </tbody>'+
                            '                    <tfoot style="position: sticky;bottom: -4px;" class="trCinza">'+
                            '                       <tr>'+
                            '                           <th colspan="3" style="text-align: right;">'+
                            '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px 5px 15px 5px;display: inline-block;">'+
                            '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                   Adicionar novo item'+
                            '                               </a>'+
                            '                           </th>'+
                            '                       </tr>'+
                            '                    </tfoot>'+
                            '                </table>'+
                            '                </div>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '   </div>'+
                            '   <div id="tabs_'+idConfigBox+'_outrasopcoes">'+
                            '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-wrench cinzaColor"></i>Outras Op\u00E7\u00F5es</label>'+
                            '           </td>'+
                            '           <td>'+
                            '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-calendar-check cinzaColor"></i> Recalcular o prazo de entrega depois de '+__.iniciada_a_demanda+'</td>'+
                            '                      <td>'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" id="recalcula_prazo" data-key="recalcula_prazo" tabindex="0" '+(value.config && typeof value.config.recalcula_prazo !== 'undefined' && value.config.recalcula_prazo  ? 'checked' : '')+'>'+
                            '                              <label class="onoffswitch-label" for="recalcula_prazo"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-stopwatch cinzaColor"></i> Desativar o c\u00E1lculo de produtividade e controle de tempo de execu\u00E7\u00E3o <br>(para '+__.atividades+' do tipo <em>monitoramento</em>)</td>'+
                            '                      <td>'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" id="desativa_produtividade" data-key="desativa_produtividade" tabindex="0" '+(value.config && typeof value.config.desativa_produtividade !== 'undefined' && value.config.desativa_produtividade  ? 'checked' : '')+'>'+
                            '                              <label class="onoffswitch-label" for="desativa_produtividade"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '               </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '   </div>'+
                            '   </div>'+
                            '</div>';
    } else if (data.type == 'planos') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_plano==`"+id+"`] | [0]");
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = 'Planos de Trabalho';
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_completo;
        var modalidade = jmespath.search(arrayConfigAtividades.tipos_modalidades,"[?id_tipo_modalidade==`"+value.id_tipo_modalidade+"`] | [0]");
        var view_modelos = (modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('modelos')) ? modalidade.config.modelos : false;
        var exige_autorizacao = (modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('exige_autorizacao')) ? modalidade.config.exige_autorizacao : false;
        var assinatura =  (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.assinatura !== 'undefined' && value.config.hasOwnProperty('assinatura')) ? value.config.assinatura : false;
        var inputAssinatura = (assinatura) ? "<input type='hidden' class='hiddenOptionConfig' data-type='json' data-key='assinatura' value='"+JSON.stringify(assinatura)+"'>" : '';
        var carga_horaria_padrao = (modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('carga_horaria_padrao')) ? modalidade.config.carga_horaria_padrao : false;        

        var documento_autorizacao = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.documentos !== 'undefined' && value.config.hasOwnProperty('documentos') && value.config.documentos.length) ? value.config.documentos : false;
            documento_autorizacao = (documento_autorizacao) ? jmespath.search(documento_autorizacao,"[?nr_sei!=''] | [?id_procedimento!=`0`]"): false;
            documento_autorizacao = (documento_autorizacao && documento_autorizacao !== null && documento_autorizacao.length > 0) ? true : false;
        var reducao_carga_horaria = (carga_horaria_padrao && value.carga_horaria < carga_horaria_padrao && !documento_autorizacao && !assinatura) ? true : false;

            htmlBox =   '<div id="'+idConfigBox+'" class="atividadeWork" data-plano="'+(value && value.id_plano ? value.id_plano : 0)+'">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        ''+(view_modelos ? 
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-file-signature cinzaColor"></i>Documentos Dispon\u00EDveis</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 8pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;">'+
                        '                           <a class="newLink viewModelDoc" data-type="'+data.type+'" data-sign="true" data-user="'+value.id_user+'" data-id_reference="'+value.id_plano+'" data-icon="pencil-alt" data-action="view" data-mode="modelo_termo_adesao" data-title="Termo de Ades\u00E3o" onclick="editModelConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                        '                               <i class="fas fa-signature '+(assinatura ? 'azulColor' : 'cinzaColor')+'" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                               <i class="fas fa-'+(assinatura ? 'user-edit azulColor' : 'pencil-alt cinzaColor')+'" style="padding-right: 3px; cursor: pointer; font-size: 12pt; margin-left: -10px;"></i>'+
                        '                               Termo de Ades\u00E3o'+
                        '                           </a>'+
                        (assinatura ? 
                        '                           <div class="signed" style="font-size: 9pt;">'+
                        '                               <span>'+
                        '                                   <i class="fas fa-key laranjaColor" style="margin-right: 10px;"></i>'+
                        '                                   Documento assinado eletronicamente por <strong style="font-weight: bold;">'+assinatura[0].nome_completo+'</strong>, em '+moment(assinatura[0].datetime, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm')+', conforme hor\u00E1rio oficial de Bras\u00EDlia'+
                        '                               </span>'+
                        '                           </div>'+
                        '                           '+inputAssinatura+
                        '' : '')+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '' : '')+
                        (exige_autorizacao || !view_modelos || reducao_carga_horaria ?
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-file-signature cinzaColor"></i>Documentos Vinculados:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table id="configBox_documentos" data-format="obj" data-key="documentos" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                    <thead>'+
                        '                        <tr class="tableHeader">'+
                        '                            <th class="tituloControle" style="width: 350px;">Tipo de Documento</th>'+
                        '                            <th class="tituloControle" style="width: 175px;">N\u00FAmero SEI</th>'+
                        '                            <th class="tituloControle" style="display:none">id_procedimento</th>'+
                        '                            <th class="tituloControle" style="display:none">id_documento</th>'+
                        '                            <th class="tituloControle" style="width: 50px;">Pr\u00E9via</th>'+
                        '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                        '                        </tr>'+
                        '                    </thead>'+
                        '                    <tbody>' : '');
            var documentos = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.documentos !== 'undefined' && value.config !== null) ? value.config.documentos : false;
            var documentos_len = (documentos) ? documentos.length : 0;
            if (documentos && (exige_autorizacao || !view_modelos || reducao_carga_horaria)){
                $.each(value.config.documentos, function(i, v){
                    var previewDoc =    '<a class="newLink" style="cursor: pointer;" onclick="openDialogDoc({title: \''+unicodeToChar(v.documento)+' ('+v.nr_sei+')\', id_procedimento: \''+v.id_procedimento+'\', id_documento: \''+v.id_documento+'\'})" onmouseover="return infraTooltipMostrar(\'Visualiza\u00E7\u00E3o r\u00E1pida\');" onmouseout="return infraTooltipOcultar();">'+
                                        '   <i class="fas fa-eye" style="font-size: 80%;"></i>'+
                                        '</a>';
                    htmlBox +=  '                        <tr data-index="'+i+'" data-key="documentos" data-value="'+i+'" data-id="'+i+'">'+
                                '                            <td class="editCellSelect" data-key="documento" data-type="value" style="width: 350px; padding: 0 10px; text-align: left;">'+unicodeToChar(v.documento)+'</td>'+
                                '                            <td class="editCellSEI" data-key="nr_sei" data-type="num" style="width: 175px; text-align: left;">'+v.nr_sei+'</td>'+
                                '                            <td data-key="id_procedimento" data-type="num" style="text-align: left; display:none">'+v.id_procedimento+'</td>'+
                                '                            <td data-key="id_documento" data-type="num" style="text-align: left; display:none">'+v.id_documento+'</td>'+
                                '                            <td data-ref="previa" style="text-align: center; width: 50px;">'+previewDoc+'</td>'+
                                '                            <td style="width: 80px; text-align: center;">'+
                                '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                           </td>'+  
                                '                        </tr>';
                });
            }
            htmlBox +=      (exige_autorizacao || !view_modelos || reducao_carga_horaria ? 
                            '                        <tr data-index="'+documentos_len+'" data-key="documentos" data-value="'+documentos_len+'" data-id="'+documentos_len+'">'+
                            '                            <td class="editCellSelect" data-key="documento" data-type="value" style="width: 350px; padding: 0 10px; text-align: left;"></td>'+
                            '                            <td class="editCellSEI" data-key="nr_sei" data-type="num" style="width: 175px; text-align: left;"></td>'+
                            '                            <td data-key="id_procedimento" data-type="num" style="text-align: left; display:none"></td>'+
                            '                            <td data-key="id_documento" data-type="num" style="text-align: left; display:none"></td>'+
                            '                            <td data-ref="previa" style="text-align: center; width: 50px;"></td>'+
                            '                            <td style="width: 80px; text-align: center;">'+
                            '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                            '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                            '                           </td>'+  
                            '                        </tr>'+
                            '                    </tbody>'+
                            '                    <tfoot>'+
                            '                       <tr>'+
                            '                           <th colspan="6" style="text-align: right;">'+
                            '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                            '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                   Adicionar novo item'+
                            '                               </a>'+
                            '                           </th>'+
                            '                       </tr>'+
                            '                    </tfoot>'+
                            '                </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '' : '')+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-clipboard-list cinzaColor"></i>'+__.Atividades+'</label>'+
                            '           </td>'+
                            '           <td>'+
                            '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-retweet cinzaColor"></i> Vincular toda a lista de '+__.atividades+'</td>'+
                            '                      <td>'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" id="atividades_lista_integral" onchange="changeConfigAtivIntegral(this)" data-key="atividades_lista_integral" tabindex="0" '+(value.config && typeof value.config.atividades_lista_integral !== 'undefined' && value.config.atividades_lista_integral === false ? '' : 'checked')+'>'+
                            '                              <label class="onoffswitch-label" for="atividades_lista_integral"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px; '+(value.config !== null && typeof value.config.lista_atividades !== 'undefined' && value.config.lista_atividades !== null && value.config.lista_atividades.length > 0 ? '' : 'display:none;')+'" id="configBox_lista_atividades_tr">'+
                            '                      <td style="text-align: left;" colspan="2">'+
                            '                           <div><i class="iconPopup fas fa-mouse-pointer cinzaColor"></i> Selecionar '+__.atividades+' '+getNameGenre('atividade', 'espec\u00EDficos', 'espec\u00EDficas')+'</div>'+
                            '                           <div id="tabsPanelConfig" class="tabelaPanelScroll" style="height: 400px; width: 100%;">'+
                            '                               <table id="configBox_lista_atividades" data-format="obj_mult" data-key="lista_atividades" style="font-size: 8pt !important;width: 100%;" class="tableCheckboxConfig seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                            '                                    <thead>'+
                            '                                        <tr class="tableHeader">'+
                            '                                            <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_atividades" accesskey=";"></label><a class="lnkInfraCheck" id="lnkInfraCheck_atividades" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck"></a></th>'+
                            '                                            <th class="tituloControle">Nome d'+__.a_Atividade+'</th>'+
                            '                                            <th class="tituloControle">Tempo Pactuado</th>'+
                            '                                        </tr>'+
                            '                                    </thead>'+
                            '                                    <tbody>'+
                            '                                    </tbody>'+
                            '                                </table>'+
                            '                           </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '               </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '</div>';
    } else if (data.type == 'programas') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_programa==`"+id+"`] | [0]");
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = 'Programas de Gest\u00E3o';
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_sigla;

            htmlBox =   '<div id="'+idConfigBox+'" class="atividadeWork" data-programa="'+(value && value.id_programa ? value.id_programa : 0)+'">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-file-signature cinzaColor"></i>Documentos Vinculados:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table id="configBox_documentos" data-format="obj" data-key="documentos" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                    <thead>'+
                        '                        <tr class="tableHeader">'+
                        '                            <th class="tituloControle" style="width: 350px;">Tipo de Documento</th>'+
                        '                            <th class="tituloControle" style="width: 175px;">N\u00FAmero SEI</th>'+
                        '                            <th class="tituloControle" style="display:none">id_procedimento</th>'+
                        '                            <th class="tituloControle" style="display:none">id_documento</th>'+
                        '                            <th class="tituloControle" style="width: 50px;">Pr\u00E9via</th>'+
                        '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                        '                        </tr>'+
                        '                    </thead>'+
                        '                    <tbody>';
            var documentos = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.documentos !== 'undefined' && value.config.documentos !== null) ? value.config.documentos : false;
            var documentos_len = (documentos) ? documentos.length : 0;
            if (documentos){
                $.each(value.config.documentos, function(i, v){
                    var previewDoc =    '<a class="newLink" style="cursor: pointer;" onclick="openDialogDoc({title: \''+unicodeToChar(v.documento)+' ('+v.nr_sei+')\', id_procedimento: \''+v.id_procedimento+'\', id_documento: \''+v.id_documento+'\'})" onmouseover="return infraTooltipMostrar(\'Visualiza\u00E7\u00E3o r\u00E1pida\');" onmouseout="return infraTooltipOcultar();">'+
                                        '   <i class="fas fa-eye" style="font-size: 80%;"></i>'+
                                        '</a>';
                    htmlBox +=  '                        <tr data-index="'+i+'" data-key="documentos">'+
                                '                            <td class="editCellSelect" data-key="documento" data-type="text" style="width: 350px; padding: 0 10px; text-align: left;">'+unicodeToChar(v.documento)+'</td>'+
                                '                            <td class="editCellSEI" data-key="nr_sei" data-type="text" style="width: 175px; text-align: left;">'+v.nr_sei+'</td>'+
                                '                            <td data-key="id_procedimento" data-type="text" style="text-align: left; display:none">'+v.id_procedimento+'</td>'+
                                '                            <td data-key="id_documento" data-type="text" style="text-align: left; display:none">'+v.id_documento+'</td>'+
                                '                            <td data-ref="previa" style="text-align: center; width: 50px;">'+previewDoc+'</td>'+
                                '                            <td style="width: 80px; text-align: center;">'+
                                '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                           </td>'+   
                                '                        </tr>';
                });
            }
            htmlBox +=      '                        <tr data-index="'+documentos_len+'" data-key="documentos">'+
                            '                            <td class="editCellSelect" data-key="documento" data-type="text" style="width: 350px; padding: 0 10px; text-align: left;"></td>'+
                            '                            <td class="editCellSEI" data-key="nr_sei" data-type="text" style="width: 175px; text-align: left;"></td>'+
                            '                            <td data-key="id_procedimento" data-type="text" style="text-align: left; display:none"></td>'+
                            '                            <td data-key="id_documento" data-type="text" style="text-align: left; display:none"></td>'+
                            '                            <td data-ref="previa" style="text-align: center; width: 50px;"></td>'+
                            '                            <td style="width: 80px; text-align: center;">'+
                            '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                            '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                            '                           </td>'+  
                            '                        </tr>'+
                            '                    </tbody>'+
                            '                    <tfoot>'+
                            '                       <tr>'+
                            '                           <th colspan="6" style="text-align: right;">'+
                            '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                            '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                   Adicionar novo item'+
                            '                               </a>'+
                            '                           </th>'+
                            '                       </tr>'+
                            '                    </tfoot>'+
                            '                </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '</div>';
    } else if (data.type == 'users') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_user==`"+id+"`] | [0]");
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = 'Usu\u00E1rios';
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_completo;

            htmlBox =   '<div id="'+idConfigBox+'" class="atividadeWork" data-atividade="'+(value && value.id_user ? value.id_user : 0)+'">'+
                        '<div id="'+idConfigBox+'_tabs" style="border: none; min-height: 300px; margin: 0;">'+
                        '   <ul style="font-size: 10px;">'+
                        '       <li><a href="#tabs_'+idConfigBox+'_seguranca">Seguran\u00E7a</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_lotacao">Lota\u00E7\u00E3o</a></li>'+
                        (checkCapacidade('config_view_metadados') ? 
                        '       <li><a href="#tabs_'+idConfigBox+'_metadados">Metadados</a></li>'+
                        '' : '')+
                        '   </ul>'+
                        '   <div id="tabs_'+idConfigBox+'_seguranca">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-user-lock cinzaColor"></i>Perfil:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table id="configBox_perfil" data-format="obj_mult" data-key="perfil" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                    <thead>'+
                        '                        <tr class="tableHeader">'+
                        '                            <th class="tituloControle" style="width: 40%;">Tipo de Perfil</th>'+
                        '                        </tr>'+
                        '                    </thead>'+
                        '                    <tbody>';

        var id_perfil = (value.id_perfil !== null && typeof value.id_perfil !== 'undefined') ? value.id_perfil : '0';
        var value_perfil = jmespath.search(arrayConfigAtividades.perfis,"[?id_perfil==`"+id_perfil+"`] | [0].nome_perfil");
            value_perfil = (value_perfil !== null) ? unicodeToChar(value_perfil) : '';
            htmlBox +=  '                        <tr data-index="0" data-id="'+id_perfil+'" data-value="'+id_perfil+'" data-key="perfil" style="text-align: left;">'+
                        '                            <td class="editCellSelect" data-type="num" data-key="perfil" style="padding: 0 10px;">'+value_perfil+'</td>'+
                        '                        </tr>'+
                        '                    </tbody>'+
                        '                </table>'+
                        '           </td>'+
                        '      </tr>';

        if (checkCapacidade('config_update_keys')) {
            htmlBox +=  '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-key cinzaColor"></i>Chaves de Acesso:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table id="configBox_keys" data-id="'+value.id_user+'" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                    <thead>'+
                        '                        <tr class="tableHeader">'+
                        '                            <th class="tituloControle" style="width: 80px;">ID</th>'+
                        '                            <th class="tituloControle">Status</th>'+
                        '                            <th class="tituloControle" style="min-width: 250px;">A\u00E7\u00F5es</th>'+
                        '                        </tr>'+
                        '                    </thead>'+
                        '                    <tbody>';
            var keys = (value.keys !== null && typeof value.keys !== 'undefined') ? value.keys : false;
            if (keys){
                $.each(keys, function(i, v){
                    var check_status = (v.data_fim == '0000-00-00 00:00:00' || moment(v.data_fim, 'YYYY-MM-DD HH:mm:ss') > moment()) ? true : false;
                    var status =    '<span class="info_tags_follow">'+
                                    '   <span style="background-color: #bfe8c4; '+(!check_status ? 'display:none;' : '')+'" class="tag_text keyVigente"><i class="tagicon fas fa-key" style="font-size: 90%;margin: 0 2px;color: #408743;"></i> Vigente</span>'+
                                    '   <span style="'+(check_status ? 'display:none;' : '')+'" class="tag_text urgenteBoxDisplay keyRevogada"><i class="tagicon fas fa-key" style="font-size: 90%;margin: 0 2px;color: #c24242;"></i> Revogada</span>'+
                                    '</span>';
                    var btn_revoga = (!checkCapacidade('config_update_keys_disable')) ? '' : '<a class="newLink keyVigente keyRevoke" style="font-size: 10pt; cursor:pointer; '+(!check_status ? 'display:none;' : '')+'" onclick="configUpdateKey(this,\'disable_key\')"><i class="fas fa-user-slash" data-icon="fas fa-user-slash" style="font-size: 100%;"></i>Revogar</a>';
                    var btn_email = (!checkCapacidade('config_update_keys_resend')) ? '' : '<a class="newLink keyVigente keyResend" style="font-size: 10pt; cursor:pointer; '+(!check_status ? 'display:none;' : '')+'" onclick="configUpdateKey(this,\'resend_key\')"><i class="fas fa-envelope-open-text" data-icon="fas fa-envelope-open-text" style="font-size: 100%;"></i>Reenviar</a>';
                                    
                    htmlBox +=  '                        <tr data-index="'+i+'" data-id="'+v.id_hash+'" data-value="'+v.data_fim+'" style="text-align: left;">'+
                                '                            <td data-type="value" data-key="id_hash" style="padding: 0 10px;">ID:'+v.id_hash+'</td>'+
                                '                            <td data-type="value" data-key="status" style="padding: 0 10px;">'+status+'</td>'+
                                '                            <td data-type="value" data-key="actions" style="padding: 0 10px; text-align: right;">'+btn_revoga+btn_email+'</td>'+
                                '                        </tr>';
                });
            }
            htmlBox +=  '                    </tbody>'+
                        '                    <tfoot>'+
                        '                       <tr data-id="-1">'+
                        '                           <th colspan="3" style="text-align: right;">'+
                        (!checkCapacidade('config_update_keys_new') ? '' : 
                        '                               <a class="newLink" onclick="configUpdateKey(this,\'new_key\')" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                        '                                   <i class="fas fa-plus-circle cinzaColor" data-icon="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                                   Criar nova chave'+
                        '                               </a>'+
                        '')+
                        '                           </th>'+
                        '                       </tr>'+
                        '                    </tfoot>'+
                        '                </table>'+
                        '           </td>'+
                        '      </tr>';
        }
        htmlBox +=  '       </table>'+
                    '   </div>'+
                    '   <div id="tabs_'+idConfigBox+'_lotacao">'+
                    '       <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                    '          <tr>'+
                    '              <td style="vertical-align: middle; text-align: left;" class="label">'+
                    '                   <label><i class="iconPopup iconSwitch fas fa-briefcase cinzaColor"></i>Lota\u00E7\u00E3o:</label>'+
                    '               </td>'+
                    '               <td>'+
                    '                   <table id="configBox_lotacao" data-format="obj_mult" data-key="lotacao" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                    '                        <thead>'+
                    '                            <tr class="tableHeader">'+
                    '                                <th class="tituloControle">Unidade</th>'+
                    '                                <th class="tituloControle" style="width: 50px;">Principal</th>'+
                    '                                <th class="tituloControle" style="width: 50px;"></th>'+
                    '                            </tr>'+
                    '                        </thead>'+
                    '                        <tbody>';
        var lotacao = (value.lotacao !== null && typeof value.lotacao !== 'undefined') ? value.lotacao : false;
        var lotacao_len = (lotacao) ? lotacao.length : 0;
        if (lotacao) {
            $.each(lotacao, function(i, v){
                htmlBox +=  '                        <tr data-index="'+i+'" data-id="'+v.id_lotacao+'" data-value="'+v.id_unidade+'" data-key="lotacao" style="text-align: left;">'+
                            '                            <td class="" data-type="num_switch" data-key="unidade" style="padding: 0 10px;">'+unicodeToChar(v.sigla_unidade+' - '+v.nome_unidade)+'</td>'+
                            '                            <td data-key="default" data-type="switch" data-required="true" style="width: 50px; text-align: center;">'+
                            '                               <div class="onoffswitch" style="transform: scale(0.8);">'+
                            '                                   <input data-key="principal" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox switch_lotacaoDefault switch_lotacaoDefault_'+i+'" onchange="changeSwitchConfigItem(this)" id="changeItemConfig_'+data.type+'_'+i+'" tabindex="0" '+(typeof v.config_lotacao !== 'undefined' && v.config_lotacao !== null && v.config_lotacao.principal  ? 'checked' : '')+'>'+
                            '                                   <label class="onoffswitch-label" for="changeItemConfig_'+data.type+'_'+i+'"></label>'+
                            '                               </div>'+
                            '                            </td>'+
                            '                            <td style="width: 50px; text-align: center;">'+
                            '                                 <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRowByID(this)"></i>'+
                            '                            </td>'+ 
                            '                        </tr>';
            });
        }
            htmlBox +=  '                            <tr data-index="'+lotacao_len+'" data-id="new" data-value="" data-key="lotacao" style="text-align: left;">'+
                        '                                <td class="editCellSelect" data-type="num" data-key="unidade" style="padding: 0 10px;"></td>'+
                        '                                <td data-key="default" data-type="switch" data-required="true" style="width: 50px; text-align: center;">'+
                        '                                   <div class="onoffswitch" style="transform: scale(0.8);">'+
                        '                                       <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox switch_lotacaoDefault switch_lotacaoDefault_'+lotacao_len+'" onchange="changeSwitchConfigItem(this)" id="changeItemConfig_'+data.type+'_'+lotacao_len+'" tabindex="0">'+
                        '                                       <label class="onoffswitch-label" for="changeItemConfig_'+data.type+'_'+lotacao_len+'"></label>'+
                        '                                   </div>'+
                        '                                </td>'+
                        '                                <td style="width: 50px; text-align: center;">'+
                        '                                     <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRowByID(this)"></i>'+
                        '                                </td>'+ 
                        '                            </tr>'+
                        '                        </tbody>'+
                        '                        <tfoot>'+
                        '                           <tr>'+
                        '                               <th colspan="3" style="text-align: right;">'+
                        '                                   <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                        '                                       <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                                       Adicionar novo item'+
                        '                                   </a>'+
                        '                               </th>'+
                        '                           </tr>'+
                        '                        </tfoot>'+
                        '                    </table>'+
                        '               </td>'+
                        '          </tr>'+
                        '       </table>'+
                        '   </div>'+
                        (checkCapacidade('config_view_metadados') ? 
                        '   <div id="tabs_'+idConfigBox+'_metadados">'+
                        '       <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '           <tr>'+
                        '               <td>'+
                        '                   <table id="configBox_metadados" data-format="obj_mult" data-key="metadados" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                        <thead>'+
                        '                            <tr class="tableHeader">'+
                        '                                <th class="tituloControle" style="width: 100px;">Metadado</th>'+
                        '                                <th class="tituloControle">Valor</th>'+
                        '                                <th class="tituloControle" style="width: 50px;"></th>'+
                        '                            </tr>'+
                        '                        </thead>'+
                        '                        <tbody>'+
                        '' : '');
            if (checkCapacidade('config_view_metadados')) {
                var metadados = (value.metadados !== null && typeof value.metadados !== 'undefined') ? value.metadados : false;
                var metadados_len = (metadados) ? metadados.length : 0;
                if (metadados) {
                    $.each(metadados, function(i, v){
                        var valor_metadado = v.tipo_metadado == 'boolean' 
                                    ? v.valor_metadado == '1' ? 'Sim' : 'N\u00E3o'
                                    : v.valor_metadado;
                            valor_metadado = v.tipo_metadado == 'text' ?  unicodeToChar(valor_metadado) : valor_metadado;
                            valor_metadado = v.tipo_metadado == 'number' ?  parseFloat(valor_metadado) : valor_metadado;
                            valor_metadado = v.tipo_metadado == 'cpf' ?  maskCPF(valor_metadado) : valor_metadado;
                            valor_metadado = v.tipo_metadado == 'cnpj' ?  maskCNPJ(valor_metadado) : valor_metadado;
                            valor_metadado = v.tipo_metadado == 'processo' ?  maskPEN(valor_metadado) : valor_metadado;

                        var htmlBoxTr = '                        <tr data-index="'+i+'" data-id="'+v.id_usuario_metadado+'" data-value="'+v.id_usuario_metadado+'" data-key="metadados" style="text-align: left;">'+
                                        '                            <td class="" data-type="select_meta" data-key="id_usuario_metadado" style="padding: 0 10px;">'+unicodeToChar(v.nome_metadado)+'</td>'+
                                        '                            <td class="" data-ref="value" data-key="valor_metadado" data-input="'+v.tipo_metadado+'" style="width: 80px; text-align: left;">'+valor_metadado+'</td>'+
                                        '                            <td style="width: 50px; text-align: center;">'+
                                        (checkCapacidade('config_remove_metadado') ? 
                                        '                                 <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRowByID(this)"></i>'+
                                        '' : '')
                                        '                            </td>'+ 
                                        '                        </tr>';
                            htmlBox +=  (v.lgpd == 0 || (v.lgpd == 1 && checkCapacidade('view_lgpd'))) ? htmlBoxTr : '';
                    });
                }
                htmlBox +=  (checkCapacidade('config_new_metadado') ? 
                            '                            <tr data-index="'+metadados_len+'" data-id="new" data-value="" data-key="metadados" style="text-align: left;">'+
                            '                                <td class="editCellSelect" data-type="select_meta" data-key="id_usuario_metadado" style="padding: 0 10px;"></td>'+
                            '                                <td class="editCell" data-ref="value" data-key="valor_metadado" style="width: 80px; text-align: left;"></td>'+
                            '                                <td style="width: 50px; text-align: center;">'+
                            '                                     <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRowByID(this)"></i>'+
                            '                                </td>'+ 
                            '                            </tr>'+
                            '                        </tbody>'+
                            '                        <tfoot>'+
                            '                           <tr>'+
                            '                               <th colspan="3" style="text-align: right;">'+
                            '                                   <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                            '                                       <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                       Adicionar novo item'+
                            '                                   </a>'+
                            '                               </th>'+
                            '                           </tr>'+
                            '                        </tfoot>'+
                            '' : '</tbody>')+
                            '                    </table>'+
                            '               </td>'+
                            '           </tr>'+
                            '       </table>'+
                            '   </div>'+
                            '</div>';
            } else {
                htmlBox +=  '</div>';
            }
    } else if (data.type == 'tipos_prescricoes') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_tipo_prescricao==`"+id+"`] | [0]");
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = __.Prescricao;
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_prescricao;

            htmlBox =   '<div id="'+idConfigBox+'" class="atividadeWork" data-programa="'+(value && value.id_tipo_prescricao ? value.id_tipo_prescricao : 0)+'">'+
                        '<div id="'+idConfigBox+'_tabs" style="border: none; min-height: 300px; margin: 0;">'+
                        '   <ul style="font-size: 10px;">'+
                        '       <li><a href="#tabs_'+idConfigBox+'_processos">Processos</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_documentos">Documentos</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_unidades">Unidades</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_avancado">Avan\u00E7ado</a></li>'+
                        '   </ul>'+
                        '   <div id="tabs_'+idConfigBox+'_processos">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left; width: 170px;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-folder-open cinzaColor"></i>Tipos de Processos Vinculados:</label>'+
                        '           </td>'+
                        '           <td style="position:relative">'+
                        '   	        <div style="overflow-y: scroll; height: 300px;" id="tabelaConfigPanel_'+data.type+'_tipo_processo" class="tabelaConfigPanel_'+data.type+'_scroll">'+
                        '               <table id="configBox_tipo_processo" data-format="obj_mult" data-key="tipo_processo" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                    <thead>'+
                        '                       <tr>'+
                        '                           <th colspan="2" style="text-align: right;">'+
                        '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; 5px 5px 15px 5px;display: inline-block;">'+
                        '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                                   Adicionar novo item'+
                        '                               </a>'+
                        '                           </th>'+
                        '                       </tr>'+
                        '                        <tr class="tableHeader">'+
                        '                            <th class="tituloControle">Tipo</th>'+
                        '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                        '                        </tr>'+
                        '                    </thead>'+
                        '                    <tbody>';
            var tipo_processo = (value.config !== null && typeof value.config.tipo_processo !== 'undefined' && value.config.tipo_processo !== null) ? value.config.tipo_processo : false;
            var tipo_processo_len = (tipo_processo) ? tipo_processo.length : 0;
            if (tipo_processo){
                $.each(value.config.tipo_processo, function(i, v){
                    var nomeTipoProc = jmespath.search(arrayListTypesSEI.selectTipoProc, "[?value=='"+v.value+"'].name | [0]");
                        nomeTipoProc = (nomeTipoProc !== null) ? nomeTipoProc : false;
                    if (nomeTipoProc) {
                        htmlBox +=  '                        <tr data-id="'+i+'" data-key="tipo_processo" data-index="'+v.id+'" data-value="'+v.value+'" style="text-align: left;">'+
                                    '                            <td class="editCellSelect" data-key="tipo_processo" data-type="value" style="padding: 0 10px;">'+nomeTipoProc+'</td>'+
                                    '                            <td style="width: 80px; text-align: center;">'+
                                    '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                    '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                    '                           </td>'+  
                                    '                        </tr>';
                    }
                });
            }
            htmlBox +=      (tipo_processo_len == 0 ? 
                        '                        <tr data-id="'+tipo_processo_len+'" data-key="tipo_processo" style="text-align: left;">'+
                        '                            <td class="editCellSelect" data-key="tipo_processo" data-value="" data-type="value" style="padding: 0 10px;"></td>'+
                        '                            <td style="width: 80px; text-align: center;">'+
                        '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                        '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                        '                           </td>'+  
                        '                        </tr>'+
                        '' : '')+
                        '                    </tbody>'+
                        '                </table>'+
                        '                </div>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '   <div id="tabs_'+idConfigBox+'_documentos">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left; width: 170px;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-file cinzaColor"></i>Tipos de Documentos Prescricionais:</label>'+
                        '           </td>'+
                        '           <td style="position:relative">'+
                        '   	        <div style="overflow-y: scroll; height: 300px;" id="tabelaConfigPanel_'+data.type+'_tipo_documento" class="tabelaConfigPanel_'+data.type+'_scroll">'+
                        '               <table id="configBox_tipo_documento" data-format="obj_mult" data-key="tipo_documento" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                    <thead>'+
                        '                       <tr>'+
                        '                           <th colspan="2" style="text-align: right;">'+
                        '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; 5px 5px 15px 5px;display: inline-block;">'+
                        '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                                   Adicionar novo item'+
                        '                               </a>'+
                        '                           </th>'+
                        '                       </tr>'+
                        '                        <tr class="tableHeader">'+
                        '                            <th class="tituloControle">Tipo</th>'+
                        '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                        '                        </tr>'+
                        '                    </thead>'+
                        '                    <tbody>';
            var tipo_documento = (value.config !== null && typeof value.config.tipo_documento !== 'undefined' && value.config.tipo_documento !== null) ? value.config.tipo_documento : false;
            var tipo_documento_len = (tipo_documento) ? tipo_documento.length : 0;
            if (tipo_documento){
                $.each(value.config.tipo_documento, function(i, v){
                    var nomeTipoDoc = jmespath.search(arrayListTypesSEI.selSeriePesquisa, "[?value=='"+v.value+"'].name | [0]");
                    nomeTipoDoc = (nomeTipoDoc !== null) ? nomeTipoDoc : false;
                    if (nomeTipoDoc) {
                        htmlBox +=  '                        <tr data-id="'+i+'" data-key="tipo_documento" data-index="'+v.id+'" data-value="'+v.value+'" style="text-align: left;">'+
                                    '                            <td class="editCellSelect" data-key="tipo_documento" data-type="value" style="padding: 0 10px;">'+nomeTipoDoc+'</td>'+
                                    '                            <td style="width: 80px; text-align: center;">'+
                                    '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                    '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                    '                           </td>'+  
                                    '                        </tr>';
                    }
                });
            }
            htmlBox +=      (tipo_documento_len == 0 ? 
                        '                        <tr data-id="'+tipo_documento_len+'" data-key="tipo_documento" data-value="" style="text-align: left;">'+
                        '                            <td class="editCellSelect" data-key="tipo_documento" data-type="value" style="padding: 0 10px;"></td>'+
                        '                            <td style="width: 80px; text-align: center;">'+
                        '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                        '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                        '                           </td>'+  
                        '                        </tr>'+
                        '' : '')+
                        '                    </tbody>'+
                        '                </table>'+
                        '                </div>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '   <div id="tabs_'+idConfigBox+'_unidades">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-briefcase cinzaColor"></i>Unidades permitidas:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <div style="overflow-y: scroll; height: 300px;">'+
                        '               <table id="configBox_unidades" data-format="obj" data-key="unidades" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                    <thead>'+
                        '                       <tr>'+
                        '                           <th colspan="2" style="text-align: right;">'+
                        '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                        '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                                   Adicionar novo item'+
                        '                               </a>'+
                        '                           </th>'+
                        '                       </tr>'+
                        '                        <tr class="tableHeader">'+
                        '                            <th class="tituloControle">Unidade</th>'+
                        '                            <th class="tituloControle" style="display:none">ID</th>'+
                        '                            <th class="tituloControle" style="width: 50px;"></th>'+
                        '                        </tr>'+
                        '                    </thead>'+
                        '                    <tbody>';
        var unidades = (value.config !== null && typeof value.config !== 'undefined' && value.config.unidades !== null && typeof value.config.unidades !== 'undefined') ? value.config.unidades : false;
        var unidades_len = (unidades) ? unidades.length : 0;
        if (unidades) {
            $.each(unidades, function(i, v){
                htmlBox +=  '                        <tr data-index="'+i+'" data-id="'+v.id_unidade+'" data-value="'+v.id_unidade+'" data-key="unidades" style="text-align: left;">'+
                            '                            <td class="editCellSelect" data-type="value" data-key="nome_unidade" style="padding: 0 10px;">'+unicodeToChar(v.nome_unidade)+'</td>'+
                            '                            <td class="" data-type="num" data-key="id_unidade" style="padding: 0 10px;display:none;">'+v.id_unidade+'</td>'+
                            '                            <td style="width: 50px; text-align: center;">'+
                            '                                 <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRowByID(this)"></i>'+
                            '                            </td>'+ 
                            '                        </tr>';
            });
        }
        htmlBox +=      '                        <tr data-index="'+unidades_len+'" data-id="new" data-value="" data-key="unidades" style="text-align: left;">'+
                        '                            <td class="editCellSelect" data-type="value" data-key="nome_unidade" style="padding: 0 10px;"></td>'+
                        '                            <td class="" data-type="num" data-key="id_unidade" style="padding: 0 10px;display:none;"></td>'+
                        '                            <td style="width: 50px; text-align: center;">'+
                        '                                 <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRowByID(this)"></i>'+
                        '                            </td>'+ 
                        '                        </tr>'+
                        '                    </tbody>'+
                        '                </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '   <div id="tabs_'+idConfigBox+'_avancado">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-cog cinzaColor"></i>Configura\u00E7\u00F5es Gerais:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-stop-circle cinzaColor"></i> Permite a suspens\u00E3o da '+__.prescricao+'</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" id="suspensao_prazo" data-key="suspensao_prazo" tabindex="0" '+(typeof value.config !== 'undefined' && typeof value.config.suspensao_prazo !== 'undefined' && typeof value.config.suspensao_prazo  ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="suspensao_prazo"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-exclamation-circle cinzaColor"></i> Adicionar Urg\u00EAncia no processo ao atingir o n\u00EDvel cr\u00EDtico</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" id="urgencia_nivel_critico" data-key="urgencia_nivel_critico" tabindex="0" '+(typeof value.config !== 'undefined' && typeof value.config.urgencia_nivel_critico !== 'undefined' && value.config.urgencia_nivel_critico  ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="urgencia_nivel_critico"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-percentage cinzaColor"></i> N\u00EDvel cr\u00EDtico para a '+__.prescricao+' processual (1 a 100)</td>'+
                        '                      <td>'+
                        '                            <input type="number" class="singleOptionInput" style="width: 50px !important;float: right;" id="nivel_critico" data-key="nivel_critico" min="1" max="100" tabindex="0" value="'+(typeof value.config !== 'undefined' && typeof value.config.nivel_critico !== 'undefined' && value.config.nivel_critico ? value.config.nivel_critico : '90')+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '</div>';
    } else if (data.type == 'unidades') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_unidade==`"+id+"`] | [0]");
        var config = (typeof value.config !== 'undefined' && value.config !== null) ? value.config : false;
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = 'Unidades';
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_unidade;

            htmlBox =   '<div id="'+idConfigBox+'" class="atividadeWork" data-unidade="'+(value && value.id_unidade ? value.id_unidade : 0)+'">'+
                        '<div id="'+idConfigBox+'_tabs" style="border: none; min-height: 300px; margin: 0;">'+
                        '   <ul style="font-size: 10px;">'+
                        '       <li><a href="#tabs_'+idConfigBox+'_produtividade">Produtividade e Plano de Trabalho</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_atividades">'+__.Atividades+'</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_distribuicao">Distribui\u00E7\u00E3o</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_notificacao">Notifica\u00E7\u00E3o</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_administrativo">Administrativo</a></li>'+
                        '   </ul>'+
                        '   <div id="tabs_'+idConfigBox+'_produtividade">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-chart-line cinzaColor"></i>Ganho de Produtividade:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table id="configBox_modalidades" data-format="obj" data-key="modalidades" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                    <thead>'+
                        '                        <tr class="tableHeader">'+
                        '                            <th class="tituloControle" style="width: 350px;">Tipo de Modalidade</th>'+
                        '                            <th class="tituloControle" style="width: 175px;">Fator</th>'+
                        '                            <th class="tituloControle" style="display:none">ID</th>'+
                        '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                        '                        </tr>'+
                        '                    </thead>'+
                        '                    <tbody>';
            var modalidades = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.modalidades !== 'undefined' && value.config.modalidades !== null) ? value.config.modalidades : false;
            var modalidades_len = (modalidades) ? modalidades.length : 0;
            if (modalidades){
                $.each(value.config.modalidades, function(i, v){
                    htmlBox +=  '                        <tr data-index="'+i+'" data-key="modalidades">'+
                                '                            <td class="editCellSelect" data-key="tipo_modalidade" data-type="text" style="width: 350px; padding: 0 10px; text-align: left;">'+unicodeToChar(v.tipo_modalidade)+'</td>'+
                                '                            <td class="editCellNum" data-key="fator" data-type="text" style="width: 175px; text-align: left;">'+v.fator+'</td>'+ 
                                '                            <td data-key="id_tipo_modalidade" data-type="text" style="display:none;">'+v.id_tipo_modalidade+'</td>'+ 
                                '                            <td style="width: 80px; text-align: center;">'+
                                '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                           </td>'+  
                                '                        </tr>';
                });
            }
            htmlBox +=      '                        <tr data-index="'+modalidades_len+'" data-key="modalidades">'+
                            '                            <td class="editCellSelect" data-key="tipo_modalidade" data-type="text" style="width: 350px; padding: 0 10px; text-align: left;"></td>'+
                            '                            <td class="editCellNum" data-key="fator" data-type="text" style="width: 175px; text-align: left;"></td>'+
                            '                            <td data-key="id_tipo_modalidade" data-type="text" style="display:none;"></td>'+
                            '                            <td style="width: 80px; text-align: center;">'+
                            '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                            '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                            '                           </td>'+  
                            '                        </tr>'+
                            '                    </tbody>'+
                            '                    <tfoot>'+
                            '                       <tr>'+
                            '                           <th colspan="3" style="text-align: right;">'+
                            '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                            '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                   Adicionar novo item'+
                            '                               </a>'+
                            '                           </th>'+
                            '                       </tr>'+
                            '                    </tfoot>'+
                            '                </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-handshake cinzaColor"></i>Plano de Trabalho:</label>'+
                            '           </td>'+
                            '           <td>'+
                            '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-star-half-alt cinzaColor"></i> Mostrar notas atribu\u00EDdas nos planos de trabalho (m\u00E9dia geral)</td>'+
                            '                      <td>'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="planos_mostrar_notas" tabindex="0" '+(config && typeof config.planos !== 'undefined' && typeof config.planos.mostrar_notas !== 'undefined' && config.planos.mostrar_notas  ? 'checked' : '')+'>'+
                            '                              <label class="onoffswitch-label" for="planos_mostrar_notas"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-star cinzaColor"></i> Permitir a auto avalia\u00E7\u00E3o de '+__.demandas+'</td>'+
                            '                      <td>'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="planos_permite_autoavaliacao" tabindex="0" '+(config && typeof config.planos !== 'undefined' && typeof config.planos.permite_autoavaliacao !== 'undefined' && config.planos.permite_autoavaliacao  ? 'checked' : '')+'>'+
                            '                              <label class="onoffswitch-label" for="planos_permite_autoavaliacao"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-stopwatch cinzaColor"></i> Prazo de dura\u00E7\u00E3o padr\u00E3o para novos planos (meses)</td>'+
                            '                      <td>'+
                            '                            <input type="number" style="width: 50px !important;float: right;" id="planos_duracao_padrao" min="1" tabindex="0" value="'+(config && typeof config.planos !== 'undefined' && typeof config.planos.duracao_padrao !== 'undefined' && config.planos.duracao_padrao ? config.planos.duracao_padrao : '1')+'">'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-stopwatch cinzaColor"></i> Prazo de anteced\u00EAncia m\u00EDnima para convoca\u00E7\u00F5es \u00E0 unidade <br>(apenas para PGR Semipresencial ou Teletrabalho)</td>'+
                            '                      <td style="text-align: right;">'+
                            '                            <input type="number" style="width: 50px !important;" id="planos_prazo_comparecimento" min="1" tabindex="0" value="'+(config && typeof config.planos !== 'undefined' && typeof config.planos.prazo_comparecimento !== 'undefined' && config.planos.prazo_comparecimento  ? config.planos.prazo_comparecimento  : '1')+'">'+
                            '                            <select style="min-height: 35px !important; width: 70px;" id="planos_data_comparecimento" tabindex="0">'+
                            '                                <option '+(config && typeof config.planos !== 'undefined' && typeof config.planos.data_comparecimento !== 'undefined' && config.planos.data_comparecimento == 'dia'  ? 'selected' : '')+'>Dia</option>'+
                            '                                <option '+(config && typeof config.planos !== 'undefined' && typeof config.planos.data_comparecimento !== 'undefined' && config.planos.data_comparecimento == 'hora'  ? 'selected' : '')+'>Hora</option>'+
                            '                            </select>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '               </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '   </div>'+
                            '   <div id="tabs_'+idConfigBox+'_atividades">'+
                            '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-clipboard-list cinzaColor"></i>'+__.Atividades+'</label>'+
                            '           </td>'+
                            '           <td>'+
                            '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-sort-amount-up cinzaColor"></i> Relacionar lista de '+__.atividades+' da unidade superior (caso exista)</td>'+
                            '                      <td>'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="atividades_lista_superior" tabindex="0" '+(config && typeof config.atividades !== 'undefined' && typeof config.atividades.lista_superior !== 'undefined' && config.atividades.lista_superior  ? 'checked' : '')+'>'+
                            '                              <label class="onoffswitch-label" for="atividades_lista_superior"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-sort-amount-up cinzaColor"></i> Relacionar lista de '+__.atividades+' de unidade '+getNameGenre('atividade', 'espec\u00EDfico', 'espec\u00EDfica')+'</td>'+
                            '                      <td>'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="atividades_lista_unidade" onchange="changeConfigListaUnidade(this)" tabindex="0" '+(config && typeof config.atividades !== 'undefined' && typeof config.atividades.lista_unidade !== 'undefined' && config.atividades.lista_unidade  ? 'checked' : '')+'>'+
                            '                              <label class="onoffswitch-label" for="atividades_lista_unidade"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  <tr id="tr_lista_unidade" style="height: 40px; '+(config && typeof config.atividades !== 'undefined' && typeof config.atividades.lista_unidade !== 'undefined' && config.atividades.lista_unidade  ? '' : 'display: none;')+'">'+
                            '                      <td colspan="2">'+
                            '                          <div style="margin-top: 10px;">'+
                            '                               <select id="select_lista_unidade"><option value=""></option>'+getOptionSelectPerfil(arrayConfigAtividades.unidades_all, config.atividades.lista_unidade, false)+'</select>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-archive cinzaColor"></i> '+__.Arquivar+' '+__.demandas+' automaticamente ap\u00F3s a avalia\u00E7\u00E3o</td>'+
                            '                      <td>'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="atividades_envio_automatico" tabindex="0" '+(config && typeof config.atividades !== 'undefined' && typeof config.atividades.envio_automatico !== 'undefined' && !config.atividades.envio_automatico  ? '' : 'checked')+'>'+
                            '                              <label class="onoffswitch-label" for="atividades_envio_automatico"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '               </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '   </div>'+
                            '   <div id="tabs_'+idConfigBox+'_distribuicao">'+
                            '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-random cinzaColor"></i>Distribui\u00E7\u00E3o</label>'+
                            '           </td>'+
                            '           <td>'+
                            '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left; border: none;"><i class="iconPopup far fa-calendar-alt cinzaColor"></i> Contagem de prazos em dias \u00FAteis</td>'+
                            '                      <td style="border: none;">'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="distribuicao_count_dias_uteis" tabindex="0" '+(config && typeof config.distribuicao !== 'undefined' && typeof config.distribuicao.count_dias_uteis !== 'undefined' && config.distribuicao.count_dias_uteis  ? 'checked' : '')+'>'+
                            '                              <label class="onoffswitch-label" for="distribuicao_count_dias_uteis"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left; border: none;"><i class="iconPopup fas fa-stopwatch cinzaColor"></i> Contagem de prazos em horas \u00FAteis</td>'+
                            '                      <td style="border: none;">'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="distribuicao_count_horas" tabindex="0" '+(config && typeof config.distribuicao !== 'undefined' && typeof config.distribuicao.count_horas !== 'undefined' && config.distribuicao.count_horas  ? 'checked' : '')+'>'+
                            '                              <label class="onoffswitch-label" for="distribuicao_count_horas"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left; border: none;"><i class="iconPopup fas fa-business-time cinzaColor"></i> Hor\u00E1rio \u00FAtil de trabalho</td>'+
                            '                      <td style="border: none;">'+
                            '                           <input type="time" id="distribuicao_horario_util_inicio" style="width: 100px !important; float: left;" tabindex="0" value="'+(config && typeof config.distribuicao !== 'undefined' && typeof config.distribuicao.horario_util !== 'undefined' && typeof config.distribuicao.horario_util.inicio !== 'undefined' ? config.distribuicao.horario_util.inicio : '00:00')+'">'+
                            '                           <span style="line-height: 40px; display: inline-block;">\u00E0</span>'+
                            '                           <input type="time" id="distribuicao_horario_util_fim" style="width: 100px !important; float: right;" tabindex="0" value="'+(config && typeof config.distribuicao !== 'undefined' && typeof config.distribuicao.horario_util !== 'undefined' && typeof config.distribuicao.horario_util.fim !== 'undefined' ? config.distribuicao.horario_util.fim : '23:59')+'">'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td colspan="2">'+
                            '                           <table style="width: 100%;">'+
                            '                               <tr>'+
                            '                                 <td style="text-align: left; border: none;font-size: 10pt;"><i class="iconPopup fas fa-umbrella-beach cinzaColor"></i> Feriados <Br>da Unidade</td>'+
                            '                                 <td style="border: none;">'+
                            '                                     <span style="font-size: 8pt; white-space: nowrap;" class="alertaBoxDisplay">'+
                            '                                       <i class="fas fa-info-circle azulColor" style="margin: 0 5px; font-size: 10pt;"></i>'+
                            '                                       Feriados nacionais e pontos facultativos da entidade j\u00E1 est\u00E3o inclu\u00EDdos na lista de feriados do sistema'+
                            '                                     </span>'+
                            '                                     <table id="configBox_feriados" data-format="obj" data-key="feriados" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig seiProForm tableDialog tableInfo tableSortable tableZebra tableFollow tableAtividades">'+
                            '                                          <thead>'+
                            '                                              <tr class="tableHeader">'+
                            '                                                  <th class="tituloControle" style="width: 250px;">Nome do Feriado</th>'+
                            '                                                  <th class="tituloControle" style="width: 100px;">Recorrente?</th>'+
                            '                                                  <th class="tituloControle" style="width: 150px;">Data</th>'+
                            '                                                  <th class="tituloControle" style="width: 50px;"></th>'+
                            '                                              </tr>'+
                            '                                          </thead>'+
                            '                                          <tbody>';
            var feriados = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.feriados !== 'undefined' && value.config.feriados !== null) ? value.config.feriados : false;
            var feriados_len = (feriados) ? feriados.length : 0;
            if (feriados){
                $.each(value.config.feriados, function(i, v){
                    htmlBox +=  '                                              <tr data-index="'+i+'" data-key="feriados">'+
                                '                                                  <td class="editCell" data-key="nome_feriado" data-type="text" style="width: 250px; padding: 0 10px; text-align: left;">'+unicodeToChar(v.nome_feriado)+'</td>'+
                                '                                                  <td data-key="recorrente" data-type="switch" style="width: 100px; text-align: center;">'+
                                '                                                     <div class="onoffswitch" style="transform: scale(0.8);">'+
                                '                                                         <input type="checkbox" name="onoffswitch" onchange="changeConfigFeriadoRecorrente(this)" class="onoffswitch-checkbox switch_feriadoRecorrente switch_feriadoRecorrente_'+i+'" id="changeItemConfig_'+data.type+'_'+i+'" tabindex="0" '+(v.recorrente  ? 'checked' : '')+'>'+
                                '                                                         <label class="onoffswitch-label" for="changeItemConfig_'+data.type+'_'+i+'"></label>'+
                                '                                                     </div>'+
                                '                                                  </td>'+
                                '                                                  <td class="editCellMonth" data-key="feriado_data" data-type="text" style="width: 150px; text-align: left;">'+v.feriado_data+'</td>'+ 
                                '                                                  <td style="width: 50px; text-align: center;">'+
                                '                                                       <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                                                       <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                                                  </td>'+ 
                                '                                              </tr>';
                });
            }
            htmlBox +=      '                                              <tr data-index="'+feriados_len+'" data-key="feriados">'+
                            '                                                  <td class="editCell" data-key="nome_feriado" data-type="text" style="width: 250px; padding: 0 10px; text-align: left;"></td>'+
                            '                                                  <td data-key="recorrente" data-type="switch" style="width: 100px; text-align: center;">'+
                            '                                                     <div class="onoffswitch" style="transform: scale(0.8);">'+
                            '                                                         <input type="checkbox" onchange="changeConfigFeriadoRecorrente(this)" name="onoffswitch" class="onoffswitch-checkbox switch_feriadoRecorrente switch_feriadoRecorrente_'+feriados_len+'" id="changeItemConfig_'+data.type+'_'+feriados_len+'" tabindex="0" checked>'+
                            '                                                         <label class="onoffswitch-label" for="changeItemConfig_'+data.type+'_'+feriados_len+'"></label>'+
                            '                                                     </div>'+
                            '                                                  </td>'+
                            '                                                  <td class="editCellMonth" data-key="feriado_data" data-type="text" style="width: 150px; text-align: left;"></td>'+
                            '                                                  <td style="width: 50px; text-align: center;">'+
                            '                                                       <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                            '                                                  </td>'+ 
                            '                                              </tr>'+
                            '                                          </tbody>'+
                            '                                          <tfoot>'+
                            '                                             <tr>'+
                            '                                                 <th colspan="3" style="text-align: right;">'+
                            '                                                     <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                            '                                                         <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                            '                                                         Adicionar novo item'+
                            '                                                     </a>'+
                            '                                                 </th>'+
                            '                                             </tr>'+
                            '                                          </tfoot>'+
                            '                                      </table>'+
                            '                                   </td>'+
                            '                               </tr>'+
                            '                           </table>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '               </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '   </div>'+
                            '   <div id="tabs_'+idConfigBox+'_notificacao">'+
                            '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-bullhorn cinzaColor"></i>Notifica\u00E7\u00E3o</label>'+
                            '           </td>'+
                            '           <td>'+
                            '               <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left; width: 35%;">'+
                            '                           <div><i class="iconPopup fas fa-user-check cinzaColor"></i> Texto padr\u00E3o para  '+__.nova_demanda+'</div>'+
                            '                           <div style="margin: 10px 0">'+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_criacao', '{usuario}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_criacao', '{requisicao}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_criacao', '{atividade}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_criacao', '{processo}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_criacao', '{assunto}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_criacao', '{prazo}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_criacao', '{tempo_pactuado}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_criacao', '{tempo_planejado}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_criacao', '{data_entrega}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_criacao', '{observacoes_gerenciais}')+
                            '                           </div>'+
                            '                      </td>'+
                            '                      <td>'+
                            '                          <textarea id="notificacao_texto_criacao" style="width: 97%; height: 200px;">'+(config && typeof config.distribuicao !== 'undefined' && typeof config.distribuicao.notificacao !== 'undefined' && typeof config.distribuicao.notificacao.texto_criacao !== 'undefined' ? unicodeToChar(config.distribuicao.notificacao.texto_criacao).replace(/\\n/g, '\n') : '')+'</textarea>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;">'+
                            '                           <div><i class="iconPopup fas fa-check-circle cinzaColor"></i> Texto padr\u00E3o para conclus\u00E3o de '+__.demanda+''+
                            '                           <div style="margin: 10px 0">'+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_conclusao', '{usuario}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_conclusao', '{requisicao}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_conclusao', '{atividade}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_conclusao', '{processo}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_conclusao', '{assunto}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_conclusao', '{prazo}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_conclusao', '{tempo_pactuado}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_conclusao', '{tempo_planejado}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_conclusao', '{data_entrega}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_conclusao', '{observacoes}')+
                            '                               '+htmlOptionsAddTextarea('notificacao_texto_conclusao', '{documento_produto}')+
                            '                           </div>'+
                            '                      </td>'+
                            '                      <td>'+
                            '                          <textarea id="notificacao_texto_conclusao" style="width: 97%; height: 200px;">'+(config && typeof config.distribuicao !== 'undefined' && typeof config.distribuicao.notificacao !== 'undefined' && typeof config.distribuicao.notificacao.texto_conclusao !== 'undefined' ? unicodeToChar(config.distribuicao.notificacao.texto_conclusao).replace(/\\n/g, '\n') : '')+'</textarea>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-envelope-open-text cinzaColor"></i> E-mail da unidade</td>'+
                            '                      <td>'+
                            '                          <input type="email" onblur="checkInputEmail(this)" id="notificacao_email" value="'+(config && typeof config.distribuicao !== 'undefined' && typeof config.distribuicao.notificacao !== 'undefined' && typeof config.distribuicao.notificacao.email !== 'undefined' ? config.distribuicao.notificacao.email : '')+'">'+
                            '                      </td>'+
                            '                  </tr>'+
                            '               </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '   </div>'+
                            '   <div id="tabs_'+idConfigBox+'_administrativo">'+
                            '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                            '      <tr>'+
                            '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                            '               <label><i class="iconPopup iconSwitch fas fa-wrench cinzaColor"></i>Administrativo</label>'+
                            '           </td>'+
                            '           <td>'+
                            '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;"><i class="iconPopup fas fa-user-lock cinzaColor"></i> Permitir a autoedi\u00E7\u00E3o de informa\u00E7\u00F5es gerais pelas unidades subordinadas (nome, sigla e depend\u00EAncia)</td>'+
                            '                      <td>'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="atividades_autoedicao_subordinadas" tabindex="0" '+(config && typeof config.administrativo !== 'undefined' && typeof config.administrativo.autoedicao_subordinadas !== 'undefined' && config.administrativo.autoedicao_subordinadas  ? 'checked' : '')+'>'+
                            '                              <label class="onoffswitch-label" for="atividades_autoedicao_subordinadas"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '               </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '   </div>'+
                            '   </div>'+
                            '</div>';
    } else if (data.type == 'tipos_modalidades') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_tipo_modalidade==`"+id+"`] | [0]");
        var config = (typeof value.config !== 'undefined' && value.config !== null) ? value.config : false;
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = 'Tipos de Modalidades de Trabalho';
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_modalidade;

            htmlBox =   '<div id="'+idConfigBox+'" class="atividadeWork" data-unidade="'+(value && value.id_tipo_modalidade ? value.id_tipo_modalidade : 0)+'">'+
                        '<div id="'+idConfigBox+'_tabs" style="border: none; min-height: 300px; margin: 0;">'+
                        '   <ul style="font-size: 10px;">'+
                        '       <li><a href="#tabs_'+idConfigBox+'_planos_trabalho">Planos de Trabalho</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_avancado">Avan\u00E7ado</a></li>'+
                        '   </ul>'+
                        '   <div id="tabs_'+idConfigBox+'_planos_trabalho">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-handshake cinzaColor"></i>Planos de Trabalho</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-clock cinzaColor"></i> Carga hor\u00E1ria padr\u00E3o da modalidade</td>'+
                        '                      <td>'+
                        '                            <input type="number" class="singleOptionConfig" style="width: 50px !important;float: right;" id="carga_horaria_padrao" data-key="carga_horaria_padrao" min="0" step="1" tabindex="0" value="'+(config && typeof config.carga_horaria_padrao !== 'undefined' && config.carga_horaria_padrao ? config.carga_horaria_padrao : '8')+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-copy cinzaColor"></i> Utilizar os modelos de documentos da entidade</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="modelos" id="modelos" tabindex="0" '+(config &&  config.hasOwnProperty('modelos') && config.modelos !== null && config.modelos ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="modelos"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-file-signature cinzaColor"></i> Exigir assinatura de modelos de documentos da entidade</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="exige_assinatura" id="exige_assinatura" tabindex="0" '+(config &&  config.hasOwnProperty('exige_assinatura') && config.exige_assinatura !== null && config.exige_assinatura ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="exige_assinatura"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-gavel cinzaColor"></i> Exigir a ades\u00E3o a vincula\u00E7\u00E3o de ato administrativo autorizativo</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="exige_autorizacao" id="exige_autorizacao" tabindex="0" '+(config &&  config.hasOwnProperty('exige_autorizacao') && config.exige_autorizacao !== null && config.exige_autorizacao ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="exige_autorizacao"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-users-slash cinzaColor"></i> Excluir modalidade do c\u00E1lculo de quantitativo de vagas</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" onchange="configModalidadesLimitePlanos(this)" class="onoffswitch-checkbox singleOptionConfig" data-key="exclui_calculo_vagas" id="exclui_calculo_vagas" tabindex="0" '+(config &&  config.hasOwnProperty('exclui_calculo_vagas') && config.exclui_calculo_vagas !== null && config.exclui_calculo_vagas ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="exclui_calculo_vagas"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;'+(config &&  config.hasOwnProperty('exclui_calculo_vagas') && config.exclui_calculo_vagas !== null && config.exclui_calculo_vagas ? 'display:none;' : '')+'" id="configModalidades_limite_planos">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-user-times cinzaColor"></i> Limitar o n\u00FAmero de planos ao quantitativo geral (%)</td>'+
                        '                      <td>'+
                        '                            <input type="number" class="singleOptionConfig" style="width: 50px !important;float: right;" id="limite_planos" data-key="limite_planos" min="1" max="100" step="1" tabindex="0" value="'+(config && typeof config.limite_planos !== 'undefined' && config.limite_planos ? config.limite_planos : '100')+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-user-minus cinzaColor"></i> Limitar a ades\u00E3o \u00E0 modalidade ao n\u00FAmero m\u00EDnimo de participantes totais</td>'+
                        '                      <td>'+
                        '                            <input type="number" class="singleOptionConfig" style="width: 50px !important;float: right;" id="minimo_participantes" data-key="minimo_participantes" min="0" step="1" tabindex="0" value="'+(config && typeof config.minimo_participantes !== 'undefined' && config.minimo_participantes ? config.minimo_participantes : '0')+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-user-friends cinzaColor"></i> Modalidade de execu\u00E7\u00E3o</td>'+
                        '                      <td>'+
                        '                          <select class="singleOptionConfig" data-key="modalidade_execucao" id="modalidade_execucao">'+
                        '                              <option value="1" '+(config && (typeof config.modalidade_execucao === 'undefined' || config.modalidade_execucao == 1)  ? 'selected' : '')+'>Presencial</option>'+
                        '                              <option value="2" '+(config && typeof config.modalidade_execucao !== 'undefined' && config.modalidade_execucao == 2  ? 'selected' : '')+'>Semipresencial</option>'+
                        '                              <option value="3" '+(config && typeof config.modalidade_execucao !== 'undefined' && config.modalidade_execucao == 3  ? 'selected' : '')+'>Teletrabalho</option>'+
                        '                          </select>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '   <div id="tabs_'+idConfigBox+'_avancado">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-clipboard-list cinzaColor"></i>'+__.Atividades+'</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;border-bottom: none;"><i class="iconPopup fas fa-thumbs-up cinzaColor"></i> Permitir apenas '+__.atividades+' '+getNameGenre('atividade', 'homologados', 'homologadas')+'</td>'+
                        '                      <td style="border-bottom: none;">'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="atividades_homologadas" id="atividades_homologadas" tabindex="0" '+(config &&  config.hasOwnProperty('atividades_homologadas') && config.atividades_homologadas !== null && config.atividades_homologadas ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="atividades_homologadas"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-star cinzaColor"></i> Dispensar a avalia\u00E7\u00E3o de '+__.demandas+'</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="dispensa_avaliacao" id="dispensa_avaliacao" tabindex="0" '+(config &&  config.hasOwnProperty('dispensa_avaliacao') && config.dispensa_avaliacao !== null && config.dispensa_avaliacao ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="dispensa_avaliacao"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-luggage-cart cinzaColor"></i>Afastamentos</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;border-bottom: none;"><i class="iconPopup fas fa-cogs cinzaColor"></i> Permitir cadastro manual de afastamentos j\u00E1 integrados a sistemas internos</td>'+
                        '                      <td style="border-bottom: none;">'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="integracao_interna_manual" id="integracao_interna_manual" tabindex="0" '+(config &&  config.hasOwnProperty('integracao_interna_manual') && config.integracao_interna_manual !== null && config.integracao_interna_manual ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="integracao_interna_manual"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-plug cinzaColor"></i>Integra\u00E7\u00E3o</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;border-bottom: none;"><i class="iconPopup fas fa-building cinzaColor"></i> Modalidade integrante do Programa de Gest\u00E3o por Desempenho - PGD <br>(envia dados API)</td>'+
                        '                      <td style="border-bottom: none;">'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="pgd_api" id="pgd_api" tabindex="0" '+(config &&  config.hasOwnProperty('pgd_api') && config.pgd_api !== null && config.pgd_api ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="pgd_api"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-handshake-alt-slash cinzaColor"></i>Limitar Ades\u00E3o por Unidade:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <div style="overflow-y: scroll; height: 300px;">'+
                        '               <table id="configBox_exclui_unidades" data-format="obj" data-key="exclui_unidades" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                    <thead>'+
                        '                       <tr>'+
                        '                           <th colspan="2" style="text-align: right;">'+
                        '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                        '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                                   Adicionar novo item'+
                        '                               </a>'+
                        '                           </th>'+
                        '                       </tr>'+
                        '                        <tr class="tableHeader">'+
                        '                            <th class="tituloControle">Unidade</th>'+
                        '                            <th class="tituloControle" style="display:none">ID</th>'+
                        '                            <th class="tituloControle" style="width: 50px;"></th>'+
                        '                        </tr>'+
                        '                    </thead>'+
                        '                    <tbody>';
        var exclui_unidades = (value.config !== null && typeof value.config !== 'undefined' && value.config.exclui_unidades !== null && typeof value.config.exclui_unidades !== 'undefined') ? value.config.exclui_unidades : false;
        var exclui_unidades_len = (exclui_unidades) ? exclui_unidades.length : 0;
        if (exclui_unidades) {
            $.each(exclui_unidades, function(i, v){
                htmlBox +=  '                        <tr data-index="'+i+'" data-id="'+v.id_unidade+'" data-value="'+v.id_unidade+'" data-key="exclui_unidades" style="text-align: left;">'+
                            '                            <td class="editCellSelect" data-type="value" data-key="nome_unidade" style="padding: 0 10px;">'+unicodeToChar(v.nome_unidade)+'</td>'+
                            '                            <td class="" data-type="num" data-key="id_unidade" style="padding: 0 10px;display:none;">'+v.id_unidade+'</td>'+
                            '                            <td style="width: 50px; text-align: center;">'+
                            '                                 <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRowByID(this)"></i>'+
                            '                            </td>'+ 
                            '                        </tr>';
            });
        }
        htmlBox +=      '                        <tr data-index="'+exclui_unidades_len+'" data-id="new" data-value="" data-key="exclui_unidades" style="text-align: left;">'+
                        '                            <td class="editCellSelect" data-type="value" data-key="nome_unidade" style="padding: 0 10px;"></td>'+
                        '                            <td class="" data-type="num" data-key="id_unidade" style="padding: 0 10px;display:none;"></td>'+
                        '                            <td style="width: 50px; text-align: center;">'+
                        '                                 <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRowByID(this)"></i>'+
                        '                            </td>'+ 
                        '                        </tr>'+
                        '                    </tbody>'+
                        '                </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '</div>';
    } else if (data.type == 'tipos_motivos') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_tipo_motivo==`"+id+"`] | [0]");
        var config = (typeof value.config !== 'undefined' && value.config !== null) ? value.config : false;
        var colors = (config && typeof config.colortags !== 'undefined' && config.colortags !== null) ? config.colortags : false;
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = 'Tipos de Motivos de Afastamento';
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_motivo;

            htmlBox =   '<div id="'+idConfigBox+'" class="atividadeWork" data-id="'+(value && value.id_tipo_motivo ? value.id_tipo_motivo : 0)+'">'+
                        '   <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '      <tr style="height: 40px;">'+
                        '          <td style="text-align: left;border-bottom: none;" colspan="2">'+
                        '              <span class="info_tags_follow_txt">'+
                        '                   <div class="tagsinput" style="width: 100%;min-height: auto;height: auto;">'+
                        '                       <span class="tag tagTableText_afastamento singleOptionColor" data-icontag="'+(colors ? colors.icontag : 'tag')+'" data-colortag="'+(colors ? colors.colortag : 'rgb(191, 213, 232)')+'" data-textcolor="'+(colors ? colors.textcolor : 'black')+'" style="background-color: '+(colors ? colors.colortag : 'rgb(191, 213, 232)')+';color: '+(colors ? colors.textcolor : 'black')+';width: 100%;height: 30px;">'+
                        '                           <span class="tag-text" style="color: '+(colors ? colors.textcolor : 'black')+';padding-top: 6px;">'+value.nome_motivo+'</span>'+
                        '                           <input type="color" class="tagFavAddColorInput" value="'+(colors ? colors.colortag : '#bfd5e8')+'" onchange="parent.changeColorEtiqueta(this, \'options\')" style="width: 30px !important;padding: 0 !important;margin: 0 !important;">'+
                        '                           <i class="tagFavEditIcon fas fa-'+(colors ? colors.icontag : 'tag')+'" data-icontag="'+(colors ? colors.icontag : 'tag')+'" onclick="parent.openBoxIconsFA(\'selectIconEtiqueta\', \'afastamento\', \'options\')" onmouseover="return infraTooltipMostrar(\'Alterar \u00EDcone\');" onmouseout="return infraTooltipOcultar();" style="right: 30px;height: 30px;width: 30px;"></i>'+
                        '                           <i class="tagFavAddColor fas fa-fill-drip" onclick="parent.openColorEtiqueta(this)" onmouseover="return infraTooltipMostrar(\'Alterar cor\');" onmouseout="return infraTooltipOcultar();" style="right: 0;border-radius: 0 5px 5px 0;height: 30px;width: 30px;"></i>'+
                        '                       </span>'+
                        '                   </div>'+
                        '              </span>'+
                        '          </td>'+
                        '      </tr>'+
                        '      <tr style="height: 40px;">'+
                        '          <td style="text-align: left;border-bottom: none;"><i class="iconPopup fas fa-clock cinzaColor"></i> Permite cadastro de horas e minutos</td>'+
                        '          <td style="border-bottom: none;">'+
                        '              <div class="onoffswitch" style="float: right;">'+
                        '                  <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="horas_afastamento" id="horas_afastamento" tabindex="0" '+(config &&  config.hasOwnProperty('horas_afastamento') && config.horas_afastamento !== null && config.horas_afastamento ? 'checked' : '')+'>'+
                        '                  <label class="onoffswitch-label" for="horas_afastamento"></label>'+
                        '              </div>'+
                        '          </td>'+
                        '      </tr>'+
                        '      <tr style="height: 40px;">'+
                        '          <td style="text-align: left;border-bottom: none;"><i class="iconPopup fas fa-cogs cinzaColor"></i> Possui integra\u00E7\u00E3o interna com outros sistemas</td>'+
                        '          <td style="border-bottom: none;">'+
                        '              <div class="onoffswitch" style="float: right;">'+
                        '                  <input type="checkbox" name="onoffswitch" onchange="configMotivosAfastamentoIntegracao(this)" class="onoffswitch-checkbox singleOptionConfig" data-key="integracao_interna" id="integracao_interna" tabindex="0" '+(config &&  config.hasOwnProperty('integracao_interna') && config.integracao_interna !== null && config.integracao_interna ? 'checked' : '')+'>'+
                        '                  <label class="onoffswitch-label" for="integracao_interna"></label>'+
                        '              </div>'+
                        '          </td>'+
                        '      </tr>'+
                        '      <tr style="height: 40px;'+(config &&  config.hasOwnProperty('integracao_interna') && config.integracao_interna !== null && config.integracao_interna ? '' : 'display:none;')+'" class="configTiposAfast_editarintegracao"">'+
                        '          <td style="text-align: left;border-bottom: none;"><i class="iconPopup fas fa-pencil cinzaColor"></i> Permite a edi\u00E7\u00E3o do afastamento com integra\u00E7\u00E3o interna com outros sistemas</td>'+
                        '          <td style="border-bottom: none;">'+
                        '              <div class="onoffswitch" style="float: right;">'+
                        '                  <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="editar_integracao_interna" id="editar_integracao_interna" tabindex="0" '+(config &&  config.hasOwnProperty('editar_integracao_interna') && config.editar_integracao_interna !== null && config.editar_integracao_interna ? 'checked' : '')+'>'+
                        '                  <label class="onoffswitch-label" for="editar_integracao_interna"></label>'+
                        '              </div>'+
                        '          </td>'+
                        '      </tr>'+
                        '      <tr style="height: 40px;'+(config &&  config.hasOwnProperty('integracao_interna') && config.integracao_interna !== null && config.integracao_interna ? '' : 'display:none;')+'" class="configTiposAfast_editarintegracao"">'+
                        '          <td style="text-align: left;border-bottom: none;"><i class="iconPopup fas fa-recycle cinzaColor"></i> Permite a sobreposi\u00E7\u00E3o com outros afastamentos que cont\u00EAm o mesmo per\u00EDodo</td>'+
                        '          <td style="border-bottom: none;">'+
                        '              <div class="onoffswitch" style="float: right;">'+
                        '                  <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="permite_sobreposicao" id="permite_sobreposicao" tabindex="0" '+(config &&  config.hasOwnProperty('permite_sobreposicao') && config.permite_sobreposicao !== null && config.permite_sobreposicao ? 'checked' : '')+'>'+
                        '                  <label class="onoffswitch-label" for="permite_sobreposicao"></label>'+
                        '              </div>'+
                        '          </td>'+
                        '      </tr>'+
                        '      <tr style="height: 40px;">'+
                        '          <td style="text-align: left;border-bottom: none;"><i class="iconPopup fas fa-random cinzaColor"></i> Exige vincula\u00E7\u00E3o de documento SEI</td>'+
                        '          <td style="border-bottom: none;">'+
                        '              <div class="onoffswitch" style="float: right;">'+
                        '                  <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="exige_documentacao" id="exige_documentacao" tabindex="0" '+(config &&  config.hasOwnProperty('exige_documentacao') && config.exige_documentacao !== null && config.exige_documentacao ? 'checked' : '')+'>'+
                        '                  <label class="onoffswitch-label" for="exige_documentacao"></label>'+
                        '              </div>'+
                        '          </td>'+
                        '      </tr>'+
                        '      <tr style="text-align: right;">'+
                        '          <td style="text-align: left;"><i class="iconPopup fas fa-retweet cinzaColor"></i> Fator de Multiplica\u00E7\u00E3o (0 = inativo)</td>'+
                        '          <td style="text-align: right;">'+
                        '              <input type="number" style="width: 50px !important;" class="singleOptionConfig" data-key="fator_multiplicacao" id="fator_multiplicacao" value="'+(config && typeof config.fator_multiplicacao !== 'undefined' && isNumeric(config.fator_multiplicacao)  ? config.fator_multiplicacao : 1 )+'">'+
                        '          </td>'+
                        '      </tr>'+
                        '      <tr style="text-align: right;">'+
                        '          <td style="text-align: left;"><i class="iconPopup fas fa-procedures cinzaColor"></i> Possui dados sens\u00EDveis em rela\u00E7\u00E3o \u00E0 sa\u00FAde do usu\u00E1rio (LGPD)</td>'+
                        '          <td style="text-align: right;">'+
                        '              <div class="onoffswitch" style="float: right;">'+
                        '                  <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="dados_sensiveis" id="dados_sensiveis" tabindex="0" '+(config &&  config.hasOwnProperty('dados_sensiveis') && config.dados_sensiveis !== null && config.dados_sensiveis ? 'checked' : '')+'>'+
                        '                  <label class="onoffswitch-label" for="dados_sensiveis"></label>'+
                        '              </div>'+
                        '          </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '</div>';
    } else if (data.type == 'nomenclaturas') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_nomenclatura==`"+id+"`] | [0]");
        var config = (typeof value.config !== 'undefined' && value.config !== null) ? value.config : false;
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = 'Nomenclaturas';
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_nomenclatura;

            htmlBox =   '<div id="'+idConfigBox+'" class="atividadeWork" data-nomenclatura="'+(value && value.id_nomenclatura ? value.id_nomenclatura : 0)+'">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch far fa-comment-alt cinzaColor"></i>Descri\u00E7\u00E3o</label>'+
                        '           </td>'+
                        '           <td style="text-align: left;">'+
                        '               '+(value && typeof value.descricao !== 'undefined'  ? value.descricao  : '')+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch far fa-square cinzaColor"></i>Singular</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <input type="text" id="singular" class="singleOptionInput" data-key="singular" data-convert="lowercase" value="'+(config && typeof config.singular !== 'undefined'  ? config.singular  : '')+'">'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch far fa-clone cinzaColor"></i>Plural</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <input type="text" id="plural" class="singleOptionInput" data-key="plural" data-convert="lowercase" value="'+(config && typeof config.plural !== 'undefined'  ? config.plural  : '')+'">'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-mars cinzaColor"></i>Masculino</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <div class="onoffswitch" style="float: left;">'+
                        '                   <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="masculino" id="masculino" tabindex="0" '+(config &&  config.hasOwnProperty('masculino') && config.masculino !== null && config.masculino ? 'checked' : '')+'>'+
                        '                   <label class="onoffswitch-label" for="masculino"></label>'+
                        '               </div>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-spell-check cinzaColor"></i>Adicionar preposi\u00E7\u00E3o <br>(do, da, dos, das)</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <div class="onoffswitch" style="float: left;">'+
                        '                   <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox singleOptionConfig" data-key="preposicao" id="preposicao" tabindex="0" '+(config &&  config.hasOwnProperty('preposicao') && config.preposicao !== null && config.preposicao ? 'checked' : '')+'>'+
                        '                   <label class="onoffswitch-label" for="preposicao"></label>'+
                        '               </div>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '</div>';
    } else if (data.type == 'tipos_capacidades') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_tipo_capacidade==`"+id+"`] | [0]");
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = 'Tipos de Capacidades';
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_capacidade;

        htmlBox =   '<div id="'+idConfigBox+'" data-id="'+id+'" class="atividadeWork" data-entidade="'+(value && value.id_entidade ? value.id_entidade : 0)+'">'+
                    '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine tableConfigCapacidades">';

        if (typeof arrayConfigAtividades.perfis !== 'undefined'){
            $.each(arrayConfigAtividades.perfis, function(i, v){
                var capacidade = jmespath.search(value.lista_capacidades,"[?id_perfil==`"+v.id_perfil+"`] | [0]");
                var checked = (capacidade !== null) ? true : false;
                var id_capacidade = (capacidade !== null && typeof capacidade.id_capacidade !== 'undefined') ? capacidade.id_capacidade : 0;
                var idInput = 'changeItemConfig_'+data.type+'_'+i+'_'+randomString(4);
                htmlBox +=  '      <tr data-id_perfil="'+v.id_perfil+'" data-id="'+id+'">'+
                            '           <td style="width: 250px; padding: 0 10px; text-align: left;">'+v.nome_perfil+'</td>'+
                            '           <td data-key="perfil" data-type="switch" style="width: 100px; text-align: center;">'+
                            '              <div class="onoffswitch" style="transform: scale(0.8);">'+
                            '                  <input type="checkbox" name="onoffswitch" onchange="changeConfigPerfilCapacidade(this)" data-id="'+id+'" data-id_perfil="'+v.id_perfil+'" data-id_capacidade="'+id_capacidade+'" class="onoffswitch-checkbox" id="'+idInput+'" tabindex="0" '+(checked  ? 'checked' : '')+'>'+
                            '                  <label class="onoffswitch-label" for="'+idInput+'"></label>'+
                            '              </div>'+
                            '           </td>'+
                            '       </tr>';
            });
        }
        htmlBox +=  '</div>';

    } else if (data.type == 'perfis') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_perfil==`"+id+"`] | [0]");
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = 'Perfis';
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_perfil;

        htmlBox =   '<div id="'+idConfigBox+'" style="height: 80vh;overflow-y: auto;" data-id="'+id+'" class="atividadeWork" data-entidade="'+(value && value.id_entidade ? value.id_entidade : 0)+'">'+
                    '   <div id="accordion-'+data.type+'">';

        if (typeof arrayConfigAtividades.tipos_capacidades !== 'undefined'){
            function listConfigCapacidadesPerfil(arrayList) {
                var count = 0;
                var _htmlB = '<table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine tableConfigCapacidades">';
                $.each(arrayList, function(i, v){
                    var capacidade = jmespath.search(v.lista_capacidades,"[?id_perfil==`"+value.id_perfil+"`] | [0]");
                    var checked = (capacidade !== null) ? true : false;
                    var id_capacidade = (capacidade !== null && typeof capacidade.id_capacidade !== 'undefined') ? capacidade.id_capacidade : 0;
                    var idInput = 'changeItemConfig_'+data.type+'_'+i+'_'+randomString(4);
                    _htmlB  +=  '      <tr data-id_perfil="'+value.id_perfil+'" data-id="'+v.id_tipo_capacidade+'">'+
                                '           <td style="width: 250px; padding: 0 10px; text-align: left;">'+v.descricao+' ('+v.nome_capacidade+')</td>'+
                                '           <td data-key="perfil" data-type="switch" style="width: 100px; text-align: center;">'+
                                '              <div class="onoffswitch" style="transform: scale(0.8);">'+
                                '                  <input type="checkbox" name="onoffswitch" onchange="changeConfigPerfilCapacidade(this)" data-id="'+v.id_tipo_capacidade+'" data-id_perfil="'+id+'" data-id_capacidade="'+id_capacidade+'" class="onoffswitch-checkbox" id="'+idInput+'" tabindex="0" '+(checked  ? 'checked' : '')+'>'+
                                '                  <label class="onoffswitch-label" for="'+idInput+'"></label>'+
                                '              </div>'+
                                '           </td>'+
                                '       </tr>';
                    if (checked) count++;
                });
                _htmlB  +=  '</table>';

                return {count: count, html: _htmlB};
            }
            function accordionConfigCapacidadesPerfil(name, filter_name, filter_desc) {
                var arraList = jmespath.search(arrayConfigAtividades.tipos_capacidades,"[?contains(nome_capacidade, '"+filter_name+"') || contains(descricao, '"+filter_desc+"')]");
                var listCapacidades = listConfigCapacidadesPerfil(arraList);
                var _htmlB =    '   <h3>'+name+' <span class="counter">'+listCapacidades.count+'</span></h3>'+
                                '   <div>';
                    _htmlB +=  listCapacidades.html;
                    _htmlB +=   '   </div>';
                return _htmlB;
            }

            htmlBox +=  accordionConfigCapacidadesPerfil('Demandas', '_atividade', 'demanda');
            htmlBox +=  accordionConfigCapacidadesPerfil('Afastamentos', '_afastamento', 'afastamento');
            htmlBox +=  accordionConfigCapacidadesPerfil('Planos', '_plano', 'plano');
            htmlBox +=  accordionConfigCapacidadesPerfil('Atividades', '_atividades', 'atividades');
            htmlBox +=  accordionConfigCapacidadesPerfil('Unidades', '_unidade', 'unidade');
            htmlBox +=  accordionConfigCapacidadesPerfil('Relat\u00F3rios', 'report_', 'Relat\u00F3rio');
            htmlBox +=  accordionConfigCapacidadesPerfil('Configura\u00E7\u00F5es', 'config_', 'Configurar');
            htmlBox +=  accordionConfigCapacidadesPerfil('Gr\u00E1ficos', 'chart_', 'gr\u00E1fico');
            htmlBox +=  accordionConfigCapacidadesPerfil('Documentos', '_documento', 'documento');
            htmlBox +=  accordionConfigCapacidadesPerfil('Visualizar', 'view_', 'Visualizar');
            htmlBox +=  accordionConfigCapacidadesPerfil('Salvar', 'save_', 'Salvar');
            htmlBox +=  accordionConfigCapacidadesPerfil('Editar', 'edit_', 'Editar');
            htmlBox +=  accordionConfigCapacidadesPerfil('Deletar', 'delete_', 'Deletar');
            htmlBox +=  accordionConfigCapacidadesPerfil('Cancelar', '_cancel', 'Cancelar');
            htmlBox +=  accordionConfigCapacidadesPerfil('Atualizar', 'update_', 'Atualizar');
            htmlBox +=  accordionConfigCapacidadesPerfil('Avaliar', 'rate_', 'Avaliar');
            htmlBox +=  accordionConfigCapacidadesPerfil('Concluir', 'complete_', 'Concluir');
            htmlBox +=  accordionConfigCapacidadesPerfil('Iniciar', 'start_', 'Iniciar');
            htmlBox +=  accordionConfigCapacidadesPerfil('Arquivar', 'send_', 'Arquivar');
            htmlBox +=  accordionConfigCapacidadesPerfil('Apenas as suas', 'self_', 'sua ');
            htmlBox +=  accordionConfigCapacidadesPerfil('Cadastrar novo', 'new_', 'Cadastrar');
        }
        htmlBox +=  '   </div>'+
                    '</div>';

    } else if (data.type == 'entidades') {
        var value = jmespath.search(tableConfigList[data.type], "[?id_entidade==`"+id+"`] | [0]");
        var config = (typeof value.config !== 'undefined' && value.config !== null) ? value.config : false;
        var idConfigBox = 'boxConfiguracoes_'+data.type;
        var nameBox = 'Entidades';
        var titleBox = 'Op\u00E7\u00F5es de '+nameBox+': '+value.nome_entidade;
        var tipo_modalidade_padrao = (config && typeof config.tipo_modalidade_padrao !== 'undefined' && config.tipo_modalidade_padrao != '')  ? config.tipo_modalidade_padrao : 4;
        var selectModalidadesOptions = $.map(arrayConfigAtividades.tipos_modalidades, function(v){
                                            var selected = (v.id_tipo_modalidade == tipo_modalidade_padrao) ? 'selected' : '';
                                                return '<option value="'+v.id_tipo_modalidade+'" '+selected+'>'+v.nome_modalidade+'</option>';
                                        }).join('');

            htmlBox =   '<div id="'+idConfigBox+'" class="atividadeWork" data-entidade="'+(value && value.id_entidade ? value.id_entidade : 0)+'">'+
                        '<div id="'+idConfigBox+'_tabs" style="border: none; min-height: 300px; margin: 0;">'+
                        '   <ul style="font-size: 10px;">'+
                        '       <li><a href="#tabs_'+idConfigBox+'_distribuicao">Distribuicao</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_planos_trabalho">Planos de Trabalho</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_atividades">Atividades</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_avaliacoes">Avalia\u00E7\u00F5es</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_visualizacao">Visualiza\u00E7\u00E3o</a></li>'+
                        '       <li><a href="#tabs_'+idConfigBox+'_seguranca">Seguran\u00E7a</a></li>'+
                        '   </ul>'+
                        '   <div id="tabs_'+idConfigBox+'_distribuicao">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '                                 <td style="text-align: left; border: none;font-size: 10pt;"><i class="iconPopup fas fa-umbrella-beach cinzaColor"></i> Feriados da Entidade</td>'+
                        '                                 <td style="border: none;">'+
                        '                                     <span style="font-size: 8pt;" class="alertaBoxDisplay">'+
                        '                                       <i class="fas fa-info-circle azulColor" style="margin: 0 5px; font-size: 10pt;"></i>'+
                        '                                       Feriados nacionais j\u00E1 est\u00E3o inclu\u00EDdos na lista de feriados do sistema'+
                        '                                     </span>'+
                        '                                     <table id="configBox_feriados" data-format="obj" data-key="feriados" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig seiProForm tableDialog tableInfo tableSortable tableZebra tableFollow tableAtividades">'+
                        '                                          <thead>'+
                        '                                              <tr class="tableHeader">'+
                        '                                                  <th class="tituloControle" style="width: 250px;">Nome do Feriado</th>'+
                        '                                                  <th class="tituloControle" style="width: 100px;">Recorrente?</th>'+
                        '                                                  <th class="tituloControle" style="width: 150px;">Data</th>'+
                        '                                                  <th class="tituloControle" style="width: 50px;"></th>'+
                        '                                              </tr>'+
                        '                                          </thead>'+
                        '                                          <tbody>';
            var feriados = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.feriados !== 'undefined' && value.config.feriados !== null) ? value.config.feriados : false;
            var feriados_len = (feriados) ? feriados.length : 0;
            if (feriados){
                $.each(value.config.feriados, function(i, v){
                    htmlBox +=  '                                              <tr data-index="'+i+'" data-key="feriados">'+
                                '                                                  <td class="editCell" data-key="nome_feriado" data-type="text" style="width: 250px; padding: 0 10px; text-align: left;">'+unicodeToChar(v.nome_feriado)+'</td>'+
                                '                                                  <td data-key="recorrente" data-type="switch" style="width: 100px; text-align: center;">'+
                                '                                                     <div class="onoffswitch" style="transform: scale(0.8);">'+
                                '                                                         <input type="checkbox" name="onoffswitch" onchange="changeConfigFeriadoRecorrente(this)" class="onoffswitch-checkbox switch_feriadoRecorrente switch_feriadoRecorrente_'+i+'" id="changeItemConfig_'+data.type+'_'+i+'" tabindex="0" '+(v.recorrente  ? 'checked' : '')+'>'+
                                '                                                         <label class="onoffswitch-label" for="changeItemConfig_'+data.type+'_'+i+'"></label>'+
                                '                                                     </div>'+
                                '                                                  </td>'+
                                '                                                  <td class="editCellMonth" data-key="feriado_data" data-type="text" style="width: 150px; text-align: left;">'+v.feriado_data+'</td>'+ 
                                '                                                  <td style="width: 50px; text-align: center;">'+
                                '                                                       <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                                                       <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                                                  </td>'+ 
                                '                                              </tr>';
                });
            }
            htmlBox +=  '                                              <tr data-index="'+feriados_len+'" data-key="feriados">'+
                        '                                                  <td class="editCell" data-key="nome_feriado" data-type="text" style="width: 250px; padding: 0 10px; text-align: left;"></td>'+
                        '                                                  <td data-key="recorrente" data-type="switch" style="width: 100px; text-align: center;">'+
                        '                                                     <div class="onoffswitch" style="transform: scale(0.8);">'+
                        '                                                         <input type="checkbox" onchange="changeConfigFeriadoRecorrente(this)" name="onoffswitch" class="onoffswitch-checkbox switch_feriadoRecorrente switch_feriadoRecorrente_'+feriados_len+'" id="changeItemConfig_'+data.type+'_'+feriados_len+'" tabindex="0" checked>'+
                        '                                                         <label class="onoffswitch-label" for="changeItemConfig_'+data.type+'_'+feriados_len+'"></label>'+
                        '                                                     </div>'+
                        '                                                  </td>'+
                        '                                                  <td class="editCellMonth" data-key="feriado_data" data-type="text" style="width: 150px; text-align: left;"></td>'+
                        '                                                  <td style="width: 50px; text-align: center;">'+
                        '                                                       <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                        '                                                  </td>'+ 
                        '                                              </tr>'+
                        '                                          </tbody>'+
                        '                                          <tfoot>'+
                        '                                             <tr>'+
                        '                                                 <th colspan="3" style="text-align: right;">'+
                        '                                                     <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                        '                                                         <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                                                         Adicionar novo item'+
                        '                                                     </a>'+
                        '                                                 </th>'+
                        '                                             </tr>'+
                        '                                          </tfoot>'+
                        '                                      </table>'+
                        '                                   </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '   <div id="tabs_'+idConfigBox+'_planos_trabalho">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-handshake cinzaColor"></i>Planos de Trabalho</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-user-clock cinzaColor"></i> Carga hor\u00E1ria padr\u00E3o</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <input type="number" class="singleOptionConfig" data-key="carga_horaria_padrao" id="carga_horaria_padrao" value="'+(config && typeof config.carga_horaria_padrao !== 'undefined' && config.carga_horaria_padrao != ''  ? config.carga_horaria_padrao : 8 )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-wrench cinzaColor"></i> Tipo de modalidade padr\u00E3o</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <select class="singleOptionConfig" data-key="tipo_modalidade_padrao" data-type="number" id="tipo_modalidade_padrao">'+
                        '                          '+selectModalidadesOptions+
                        '                          </select>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-calendar cinzaColor"></i> Limitar os planos de trabalho e programas de gest\u00E3o ao ano civil</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="limitar_ano_civil" class="onoffswitch-checkbox singleOptionConfig" id="limitar_ano_civil" tabindex="0" '+(config && typeof config.limitar_ano_civil !== 'undefined' && config.limitar_ano_civil ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="limitar_ano_civil"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-calendar-alt cinzaColor"></i> Limite de meses para os planos de trabalho</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <input type="number" style="width: 70px !important;" min="1" max="12" step="1" class="singleOptionConfig" data-key="limite_meses_planos" id="limite_meses_planos" value="'+(config && typeof config.limite_meses_planos !== 'undefined' && config.limite_meses_planos != ''  ? config.limite_meses_planos : '6' )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-calendar cinzaColor"></i> Limite de meses para os programas de gest\u00E3o</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <input type="number" style="width: 70px !important;" min="1" max="24" step="1" class="singleOptionConfig" data-key="limite_meses_programas" id="limite_meses_programas" value="'+(config && typeof config.limite_meses_programas !== 'undefined' && config.limite_meses_programas != ''  ? config.limite_meses_programas : '12' )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-percentage cinzaColor"></i> Porcentagem  m\u00EDnima de cumprimento do plano para homologa\u00E7\u00E3o automatica<br>(\u00CDndice de tempo produtivo - ITP)</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <input type="number" style="width: 70px !important;" min="0" max="100" step="1" class="singleOptionConfig" data-key="indice_produtivo" id="indice_produtivo" value="'+(config && typeof config.indice_produtivo !== 'undefined' && config.indice_produtivo != ''  ? config.indice_produtivo : '100' )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-exclamation-triangle cinzaColor"></i> Alerta sobre plano com baixa pactua\u00E7\u00E3o: Porcentagem do tempo programado acima do tempo pactuado para  (0 = desativado)</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <input type="number" style="width: 70px !important;" min="0" max="100" step="1" class="singleOptionConfig" data-key="alerta_tempo_programado" id="alerta_tempo_programado" value="'+(config && typeof config.alerta_tempo_programado !== 'undefined' && config.alerta_tempo_programado != ''  ? config.alerta_tempo_programado : '50' )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-tasks cinzaColor"></i>Verifica\u00E7\u00F5es ao homologar planos</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-star cinzaColor"></i> Avalia\u00E7\u00F5es pendentes</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="pendencias_plano_avaliacao_pendente" class="onoffswitch-checkbox singleOptionConfig" id="pendencias_plano_avaliacao_pendente" tabindex="0" '+(config && typeof config.pendencias_plano_avaliacao_pendente !== 'undefined' && config.pendencias_plano_avaliacao_pendente ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="pendencias_plano_avaliacao_pendente"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-inbox cinzaColor"></i> Entregas insuficientes</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="pendencias_plano_entrega_insuficiente" class="onoffswitch-checkbox singleOptionConfig" id="pendencias_plano_entrega_insuficiente" tabindex="0" '+(config && typeof config.pendencias_plano_entrega_insuficiente !== 'undefined' && config.pendencias_plano_entrega_insuficiente ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="pendencias_plano_entrega_insuficiente"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-handshake cinzaColor"></i> Pactua\u00E7\u00E3o Insuficiente</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="pendencias_plano_pactuacao_insuficiente" class="onoffswitch-checkbox singleOptionConfig" id="pendencias_plano_pactuacao_insuficiente" tabindex="0" '+(config && typeof config.pendencias_plano_pactuacao_insuficiente !== 'undefined' && config.pendencias_plano_pactuacao_insuficiente ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="pendencias_plano_pactuacao_insuficiente"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-chart-line cinzaColor"></i> Produtividade Insuficiente</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="pendencias_plano_produtividade_insuficiente" class="onoffswitch-checkbox singleOptionConfig" id="pendencias_plano_produtividade_insuficiente" tabindex="0" '+(config && typeof config.pendencias_plano_produtividade_insuficiente !== 'undefined' && config.pendencias_plano_produtividade_insuficiente ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="pendencias_plano_produtividade_insuficiente"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-file-signature cinzaColor"></i>Modelos</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 8pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;font-size: 10pt;"><i class="iconPopup fas fa-file-signature cinzaColor"></i> Tipo de vincula\u00E7\u00E3o de termos de ades\u00E3o</td>'+
                        '                      <td style="text-align: right;">'+
                        '                          <select class="singleOptionConfig" data-key="tipo_vinculacao_termo" data-type="number" id="tipo_vinculacao_termo">'+
                        '                               <option value="1" '+(config && typeof config.tipo_vinculacao_termo !== 'undefined' && config.tipo_vinculacao_termo == 1 ? 'selected' : '')+'>ao Plano de Trabalho</option>'+
                        '                               <option value="2" '+(config && typeof config.tipo_vinculacao_termo !== 'undefined' && config.tipo_vinculacao_termo == 2 ? 'selected' : '')+'>ao Usu\u00E1rio</option>'+
                        '                          </select>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td>'+
                        '                           <a class="newLink editModelDoc" data-type="'+data.type+'" data-id_reference="'+value.id_entidade+'" data-action="edit" data-mode="modelo_termo_adesao" data-icon="pencil-alt" data-title="Editar Modelo: Termo de Ades\u00E3o" onclick="editModelConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                        '                               <i class="fas fa-pencil-alt cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                               Termo de Ades\u00E3o'+
                        '                           </a>'+
                        '                           <a class="newLink viewModelDoc" data-type="'+data.type+'" data-sign="false" data-user="false" data-id_reference="'+value.id_entidade+'" data-action="view" data-mode="modelo_termo_adesao" data-icon="eye" data-title="Visualizar Modelo: Termo de Ades\u00E3o" onclick="editModelConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                        '                               <i class="fas fa-eye cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                           </a>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '   <div id="tabs_'+idConfigBox+'_atividades">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-clipboard-list cinzaColor"></i>'+__.Atividades+'</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-history cinzaColor"></i> Gravar o hist\u00F3rico '+__.demandas_programadas+' no hist\u00F3rico do processo (somente '+__.demandas+' processuais)</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="gravar_historico_processo" class="onoffswitch-checkbox singleOptionConfig" id="gravar_historico_processo" tabindex="0" '+(config && typeof config.gravar_historico_processo !== 'undefined' && config.gravar_historico_processo  ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="gravar_historico_processo"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-random cinzaColor"></i> Limitar a vincula\u00E7\u00E3o de '+__.atividades+' da unidade apenas ao seus usu\u00E1rios lotados</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="limitar_vinculacao_atividades" class="onoffswitch-checkbox singleOptionConfig" id="limitar_vinculacao_atividades" tabindex="0" '+(config && typeof config.limitar_vinculacao_atividades !== 'undefined' && config.limitar_vinculacao_atividades  ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="limitar_vinculacao_atividades"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '   <div id="tabs_'+idConfigBox+'_avaliacoes">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-trophy cinzaColor"></i>Avalia\u00E7\u00F5es</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 10pt;width: 100%; margin: 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-star-half-alt cinzaColor"></i> Exigir a avalia\u00E7\u00E3o antes do cadastramento de '+getNameGenre('demanda', 'novos', 'novas')+' '+__.demandas+'</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="checar_avaliacao" class="onoffswitch-checkbox singleOptionConfig" id="checar_avaliacao" tabindex="0" '+(config && typeof config.checar_avaliacao !== 'undefined' && config.checar_avaliacao ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="checar_avaliacao"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-star cinzaColor"></i> Prazo para a avalia\u00E7\u00E3o de '+__.demandas+'</td>'+
                        '                      <td>'+
                        '                          <input type="number" style="width: 70px !important;" min="0" step="1" class="singleOptionConfig" data-key="prazo_avaliacao" id="prazo_avaliacao" value="'+(config && typeof config.prazo_avaliacao !== 'undefined' && config.prazo_avaliacao != ''  ? config.prazo_avaliacao : '40' )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup far fa-star cinzaColor"></i> Restringir a avalia\u00E7\u00E3o m\u00E1xima de produtividades menores que 100%</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="limitar_avaliacao_maxima" class="onoffswitch-checkbox singleOptionConfig" id="limitar_avaliacao_maxima" tabindex="0" '+(config && typeof config.limitar_avaliacao_maxima !== 'undefined' && config.limitar_avaliacao_maxima ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="limitar_avaliacao_maxima"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '   <div id="tabs_'+idConfigBox+'_visualizacao">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-magic cinzaColor"></i>Visualiza\u00E7\u00E3o</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 10pt;width: 100%; margin: 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;" colspan="2">'+
                        '                           <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                              <tr style="height: 40px;">'+
                        '                                  <td style="text-align: left;">'+
                        '                                       <i class="iconPopup fas fa-graduation-cap cinzaColor"></i> URL do Guia de Utiliza\u00E7\u00E3o'+
                        '                                  </td>'+
                        '                                  <td style="width: 250px;">'+
                        '                                      <input type="text" class="singleOptionConfig" data-key="guia_utilizacao" id="extensao_firefox" value="'+(config && typeof config.guia_utilizacao !== 'undefined' && config.guia_utilizacao != ''  ? config.guia_utilizacao : 'https://bit.ly/Guia-ANTAQPro' )+'">'+
                        '                                  </td>'+
                        '                              </tr>'+
                        '                           </table>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-window-restore cinzaColor"></i> Abrir as configura\u00E7\u00F5es do sistema em janela apartada (modal)</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="modal_configuracoes" class="onoffswitch-checkbox singleOptionConfig" id="modal_configuracoes" tabindex="0" '+(config && typeof config.modal_configuracoes !== 'undefined' && config.modal_configuracoes ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="modal_configuracoes"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-tasks cinzaColor"></i> Utilizar o cadastro simplificado de demandas como padr\u00E3o</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="cadastro_simplificado" class="onoffswitch-checkbox singleOptionConfig" id="cadastro_simplificado" tabindex="0" '+(config && typeof config.cadastro_simplificado !== 'undefined' && config.cadastro_simplificado  ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="cadastro_simplificado"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-file-alt cinzaColor"></i> Dispensar os campos de Tipo de Requisi\u00E7\u00E3o e Tipos de Documentos<br>nos formul\u00E1rios de '+__.demanda+'</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="dispensa_tipos_requisicao" class="onoffswitch-checkbox singleOptionConfig" id="dispensa_tipos_requisicao" tabindex="0" '+(config && typeof config.dispensa_tipos_requisicao !== 'undefined' && config.dispensa_tipos_requisicao  ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="dispensa_tipos_requisicao"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-redo-alt cinzaColor"></i> Desativar a cria\u00E7\u00E3o de '+__.demandas+' recorrentes</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="desativa_demandas_recorrentes" class="onoffswitch-checkbox singleOptionConfig" id="desativa_demandas_recorrentes" tabindex="0" '+(config && typeof config.desativa_demandas_recorrentes !== 'undefined' && config.desativa_demandas_recorrentes  ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="desativa_demandas_recorrentes"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-flag cinzaColor"></i> Gerar relat\u00F3rios gerenciais di\u00E1rios</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="gerar_relatorios_gerenciais" class="onoffswitch-checkbox singleOptionConfig" id="gerar_relatorios_gerenciais" tabindex="0" '+(config && typeof config.gerar_relatorios_gerenciais !== 'undefined' && config.gerar_relatorios_gerenciais  ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="gerar_relatorios_gerenciais"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-exchange-alt cinzaColor"></i> Sincronizar dados com sistemas externos</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="sincronizar_dados_externos" onchange="changeConfigOptions(this)" data-ref="configEntidade_acoes_dados_externos" class="onoffswitch-checkbox singleOptionConfig" id="sincronizar_dados_externos" tabindex="0" '+(config && typeof config.sincronizar_dados_externos !== 'undefined' && config.sincronizar_dados_externos  ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="sincronizar_dados_externos"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr id="configEntidade_acoes_dados_externos" style="'+(config && typeof config.sincronizar_dados_externos !== 'undefined' && config.sincronizar_dados_externos  ? '' : 'display:none;')+'">'+
                        '                      <td style="text-align: left;vertical-align: top;" colspan="2">'+
                        '                           <input type="text" style="margin: 0 !important;" class="singleOptionConfig" data-key="acoes_dados_externos" id="acoes_dados_externos" value="'+(config && typeof config.acoes_dados_externos !== 'undefined' && config.acoes_dados_externos != ''  ? config.acoes_dados_externos : '' )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-phone cinzaColor"></i> Visualizar telefones na lista de contatos</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="visualizar_telefones" class="onoffswitch-checkbox singleOptionConfig" id="visualizar_telefones" tabindex="0" '+(config && typeof config.visualizar_telefones !== 'undefined' && config.visualizar_telefones  ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="visualizar_telefones"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;" colspan="2">'+
                        '                           <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                              <tr style="height: 40px;">'+
                        '                                  <td style="text-align: left;">'+
                        '                                       <i class="iconPopup fas fa-database cinzaColor"></i> Dura\u00E7\u00E3o do mecanisco de armazenamento em cache das demandas'+
                        '                                  </td>'+
                        '                                  <td style="width: 250px;">'+
                        '                                      <input type="number" style="width: 40% !important;" class="singleOptionConfig" data-key="cache_demandas_value" id="cache_demandas_value" value="'+(config && typeof config.cache_demandas_value !== 'undefined' && config.cache_demandas_value != ''  ? config.cache_demandas_value : '1' )+'">'+
                        '                                      <select style="width: 40%;float: right;" class="singleOptionConfig" data-key="cache_demandas_time" id="cache_demandas_time">'+
                        '                                           <option value="day" '+(config && (typeof config.cache_demandas_time === 'undefined' || (typeof config.cache_demandas_time !== 'undefined' && config.cache_demandas_time == 'day'))  ? 'selected' : '' )+'">Dia</option>'+
                        '                                           <option value="hour" '+(config && typeof config.cache_demandas_time !== 'undefined' && config.cache_demandas_time == 'hour'  ? 'selected' : '' )+'">Hora</option>'+
                        '                                           <option value="minute" '+(config && typeof config.cache_demandas_time !== 'undefined' && config.cache_demandas_time == 'minute'  ? 'selected' : '' )+'">Minuto</option>'+
                        '                                      </select>'+
                        '                                  </td>'+
                        '                              </tr>'+
                        '                           </table>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;" colspan="2">'+
                        '                           <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                              <tr style="height: 40px;">'+
                        '                                  <td style="text-align: left;">'+
                        '                                       <i class="iconPopup fas fa-fast-forward cinzaColor"></i> Quantidade de resultados na pagina\u00E7\u00E3o de demandas, relat\u00F3rios e configura\u00E7\u00F5es (0 = desativado)'+
                        '                                  </td>'+
                        '                                  <td style="text-align: right;">'+
                        '                                      <input type="number" style="width: 40% !important;" class="singleOptionConfig" data-key="limit_paginacao" id="limit_paginacao" value="'+(config && typeof config.limit_paginacao !== 'undefined'  ? config.limit_paginacao : '100' )+'">'+
                        '                                  </td>'+
                        '                              </tr>'+
                        '                           </table>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-toolbox cinzaColor"></i> Desativar a visualiza\u00E7\u00E3o de \u00EDndices de produtividade em todo sistema</td>'+
                        '                      <td>'+
                        '                          <div class="onoffswitch" style="float: right;">'+
                        '                              <input type="checkbox" name="onoffswitch" data-key="desativa_produtividade_geral" class="onoffswitch-checkbox singleOptionConfig" id="desativa_produtividade_geral" tabindex="0" '+(config && typeof config.desativa_produtividade_geral !== 'undefined' && config.desativa_produtividade_geral  ? 'checked' : '')+'>'+
                        '                              <label class="onoffswitch-label" for="desativa_produtividade_geral"></label>'+
                        '                          </div>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '   <div id="tabs_'+idConfigBox+'_seguranca">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine">'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-shield-alt cinzaColor"></i>Seguran\u00E7a</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-link cinzaColor"></i> URL do SEI</td>'+
                        '                      <td>'+
                        '                          <input type="text" class="singleOptionConfig" data-key="sei_entidade" id="sei_entidade" value="'+(config && typeof config.sei_entidade !== 'undefined' && config.sei_entidade != ''  ? config.sei_entidade : url_host.replace('controlador.php','') )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-key cinzaColor"></i> M\u00E9todo de autentica\u00E7\u00E3o</td>'+
                        '                      <td>'+
                        '                          <select class="singleOptionConfig" data-key="metodo_autenticacao" id="metodo_autenticacao">'+
                        '                              <option value="apikey" '+(config && (typeof config.metodo_autenticacao === 'undefined' || config.metodo_autenticacao == 'apikey')  ? 'selected' : '')+'>Chave de acesso do sistema</option>'+
                        // '                              <option value="google" '+(config && typeof config.metodo_autenticacao !== 'undefined' && config.metodo_autenticacao == 'google'  ? 'selected' : '')+'>Login com o Google</option>'+
                        '                          </select>'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fab fa-chrome cinzaColor"></i> URL da extens\u00E3o (Google Chrome)</td>'+
                        '                      <td>'+
                        '                          <input type="text" class="singleOptionConfig" data-key="extensao_chrome" id="extensao_chrome" value="'+(config && typeof config.extensao_chrome !== 'undefined' && config.extensao_chrome != ''  ? config.extensao_chrome : '' )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fab fa-firefox cinzaColor"></i> URL da extens\u00E3o (Mozilla Firefox)</td>'+
                        '                      <td>'+
                        '                          <input type="text" class="singleOptionConfig" data-key="extensao_firefox" id="extensao_firefox" value="'+(config && typeof config.extensao_firefox !== 'undefined' && config.extensao_firefox != ''  ? config.extensao_firefox : '' )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-chart-line cinzaColor"></i> URL do Painel BI</td>'+
                        '                      <td>'+
                        '                          <input type="text" class="singleOptionConfig" data-key="painel_bi" id="painel_bi" value="'+(config && typeof config.painel_bi !== 'undefined' && config.painel_bi != ''  ? config.painel_bi : '' )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '                  <tr style="height: 40px;">'+
                        '                      <td style="text-align: left;"><i class="iconPopup fas fa-calendar cinzaColor"></i> URL do calend\u00E1rio (gmail) para afastamentos autom\u00E1ticos de reuni\u00F5es</td>'+
                        '                      <td>'+
                        '                          <input type="text" class="singleOptionConfig" data-key="sync_calendario" id="sync_calendario" value="'+(config && typeof config.sync_calendario !== 'undefined' && config.sync_calendario != ''  ? config.sync_calendario : '' )+'">'+
                        '                      </td>'+
                        '                  </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label><i class="iconPopup iconSwitch fas fa-flask cinzaColor"></i>Funcionalidades Beta:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <div style="overflow-y: scroll; height: 300px;">'+
                        '               <table id="configBox_unidades" data-format="obj" data-key="unidades" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                        '                    <thead>'+
                        '                       <tr>'+
                        '                           <th colspan="2" style="text-align: right;">'+
                        '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                        '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                                   Adicionar novo item'+
                        '                               </a>'+
                        '                           </th>'+
                        '                       </tr>'+
                        '                        <tr class="tableHeader">'+
                        '                            <th class="tituloControle">Unidade</th>'+
                        '                            <th class="tituloControle" style="display:none">ID</th>'+
                        '                            <th class="tituloControle" style="width: 50px;"></th>'+
                        '                        </tr>'+
                        '                    </thead>'+
                        '                    <tbody>';
        var unidades = (value.config !== null && typeof value.config !== 'undefined' && value.config.unidades !== null && typeof value.config.unidades !== 'undefined') ? value.config.unidades : false;
        var unidades_len = (unidades) ? unidades.length : 0;
        if (unidades) {
            $.each(unidades, function(i, v){
                htmlBox +=  '                        <tr data-index="'+i+'" data-id="'+v.id_unidade+'" data-value="'+v.id_unidade+'" data-key="unidades" style="text-align: left;">'+
                            '                            <td class="editCellSelect" data-type="value" data-key="nome_unidade" style="padding: 0 10px;">'+unicodeToChar(v.nome_unidade)+'</td>'+
                            '                            <td class="" data-type="num" data-key="id_unidade" style="padding: 0 10px;display:none;">'+v.id_unidade+'</td>'+
                            '                            <td style="width: 50px; text-align: center;">'+
                            '                                 <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRowByID(this)"></i>'+
                            '                            </td>'+ 
                            '                        </tr>';
            });
        }
        htmlBox +=      '                        <tr data-index="'+unidades_len+'" data-id="new" data-value="" data-key="unidades" style="text-align: left;">'+
                        '                            <td class="editCellSelect" data-type="value" data-key="nome_unidade" style="padding: 0 10px;"></td>'+
                        '                            <td class="" data-type="num" data-key="id_unidade" style="padding: 0 10px;display:none;"></td>'+
                        '                            <td style="width: 50px; text-align: center;">'+
                        '                                 <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRowByID(this)"></i>'+
                        '                            </td>'+ 
                        '                        </tr>'+
                        '                    </tbody>'+
                        '                </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   </div>'+
                        '</div>';
    }
    if (htmlBox != '') {
        resetDialogBoxPro('dialogBoxPro');
        dialogBoxPro = $('#dialogBoxPro')
            .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
            .dialog({
                title: titleBox,
                width: 780,
                open: function() { 
                    updateButtonConfirm(this, true);
                    if ($('#'+idConfigBox+'_tabs').length > 0) {
                        $('#'+idConfigBox+'_tabs').tabs();
                    }
                    setTimeout(function(){ 
                        centralizeDialogBox(dialogBoxPro);
                    }, 100);
                    if (data.type == 'entidades') {
                        $('#acoes_dados_externos').tagsInput({
                            interactive: true,
                            placeholder: 'Adicionar',
                            hide: true,
                            delimiter: [','],
                            unique: true,
                            removeWithBackspace: true,
                        });
                    }
                    if (data.type == 'planos') {
                        loadConfigAtivIntegral('#configBox_lista_atividades',id);
                    }
                    if ($('.tabelaConfigPanel_'+data.type+'_scroll').length > 0) {
                        $('.tabelaConfigPanel_'+data.type+'_scroll').each(function(){
                            // console.log(data.type, $(this).find('table tbody tr').length);
                            var _this = $(this);
                            if (_this.find('table tbody tr').length > 6) {
                                var idElem = _this.attr('id');
                                _this.addClass('tabelaPanelScroll').css('height', '300px;');
                                initPanelResize('#'+idElem, idElem);
                            }
                        })
                    }
                    initClassicEditor();
                    if ($('#accordion-'+data.type).length) $('#accordion-'+data.type).accordion({
                        active: false,
                        collapsible: true,
                        heightStyle: "content"
                    });
                    initChosenReplace('box_init', this, true);
                },
                close: function() { 
                    if (_this.closest('tr').hasClass('infraTrMarcada')) {
                        $('#tableConfiguracoesPanel_'+data.type).find('.lnkInfraCheck').data('index',1).trigger('click');
                    }
                    $('#'+idConfigBox).remove();
                    resetDialogBoxPro('dialogBoxPro');
                },
                buttons: (data.type == 'tipos_capacidades' || data.type == 'perfis') ? []
                    : [{
                        text: 'Salvar',
                        class: 'confirm',
                        click: function(event) { 
                            saveOptionConfigItem(this, data.type, id);
                        }
                    }]
        });
        setTimeout(function(){ 
            configBox = new SimpleTableCellEditor(idConfigBox);
            configBox.SetEditableClass("editCell");
            configBox.SetEditableClass("editCellSEI", { 
                validation: $.isNumeric,
                internals: {
                    renderEditor: (elem, oldVal) => {
                        $(elem).html('<input type="number" onchange="checkOptionConfigSEI(this)" style="max-width: 80%;" value="'+oldVal+'">').find('input').focus();
                    }
                }
            });
            configBox.SetEditableClass("editCellNum", { 
                validation: $.isNumeric,
                internals: {
                    renderEditor: (elem, oldVal) => {
                        $(elem).html('<input type="number" min="0.1" step=".1" style="max-width:none" value="'+oldVal+'">').find('input').focus();
                    }
                }
            });
            configBox.SetEditableClass("editCellDate", {
                internals: {
                    renderEditor: (elem, oldVal) => {
                        var oldVal_ = (oldVal == '') ? moment().format('YYYY-MM-DD') : moment(oldVal,'DD/MM/YYYY').format('YYYY-MM-DD');
                        $(elem).html('<input type="date" style="max-width:none" value="'+oldVal_+'">').find('input').focus();
                    },
                    renderValue: (elem, formattedNewVal) => { 
                        $(elem).text(formattedNewVal); 
                    },
                    extractEditorValue: (elem) => { 
                        return moment($(elem).find('input').val(),'YYYY-MM-DD').format('DD/MM/YYYY');
                    },
                }
            });
            configBox.SetEditableClass("editCellCPF", { 
                internals: {
                    renderEditor: (elem, oldVal) => {
                        $(elem).html('<input type="text" style="max-width: 80%;" value="'+oldVal+'">').find('input').mask("999.999.999-99").focus();
                    }
                }
            });
            configBox.SetEditableClass("editCellCNPJ", { 
                internals: {
                    renderEditor: (elem, oldVal) => {
                        $(elem).html('<input type="text" style="max-width: 80%;" value="'+oldVal+'">').find('input').mask("99.999.999/9999-99").focus();
                    }
                }
            });
            configBox.SetEditableClass("editCellPhone", { 
                internals: {
                    renderEditor: (elem, oldVal) => {
                        $(elem).html('<input type="text" style="max-width: 80%;" value="'+oldVal+'">').find('input').mask("(99) 99999-9999").focus();
                    }
                }
            });
            configBox.SetEditableClass("editCellPEN", { 
                internals: {
                    renderEditor: (elem, oldVal) => {
                        $(elem).html('<input type="text" style="max-width: 80%;" value="'+oldVal+'">').find('input').mask("99999.999999/9999-99").focus();
                    }
                }
            });
            configBox.SetEditableClass("editCellDatetime", {
                internals: {
                    renderEditor: (elem, oldVal) => {
                        $(elem).html('<input type="datetime-local" style="max-width:none" value="'+moment(oldVal,'DD/MM/YYYY HH:mm:ss').format('YYYY-MM-DD HH:mm:ss')+'">').find('input').focus();
                    },
                    renderValue: (elem, formattedNewVal) => { 
                        $(elem).text(formattedNewVal); 
                    },
                    extractEditorValue: (elem) => { 
                        return moment($(elem).find('input').val(),'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm:ss');
                    },
                }
            });
            configBox.SetEditableClass("editCellMonth", {
                internals: {
                    renderEditor: (elem, oldVal) => {
                        var oldVal_ = (oldVal == '') ? moment().format('YYYY-MM-DD') : moment(oldVal,'DD/MM').format('YYYY-MM-DD');
                        $(elem).html('<input type="date" style="max-width:none" value="'+oldVal_+'">').find('input').focus();
                    },
                    renderValue: (elem, formattedNewVal) => { 
                        $(elem).text(formattedNewVal); 
                    },
                    extractEditorValue: (elem) => { 
                        return moment($(elem).find('input').val(),'YYYY-MM-DD').format('DD/MM');
                    },
                }
            });
            configBox.SetEditableClass("editCellNumComplex", { 
                validation: $.isNumeric,
                internals: {
                    renderEditor: (elem, oldVal) => {
                        $(elem).html('<input type="number" min="0.1" step=".1" oninput="checkOptionConfigComplex(this)" onblur="checkOptionConfigComplex(this)" style="max-width:none" value="'+oldVal+'">').find('input').focus();
                    }
                }
            });
            configBox.SetEditableClass("editCellSelect", {  
                internals: {
                    renderEditor: (elem, oldVal) => {
                        var _this = $(elem);
                        var data_elem = _this.data();
                        var data_tr = _this.closest('tr').data();
                        var arrayList = (data_tr.key == 'documentos' || data_tr.key == 'tipo_documento') ? arrayListTypesSEI.selSeriePesquisa : [];
                            arrayList = (data_tr.key == 'tipo_processo') ? arrayListTypesSEI.selectTipoProc : arrayList;
                            // arrayList = (data_tr.key == 'lotacao') ? jmespath.search(arrayConfigAtividades.unidades_all,"[*].{name: join('',[nome_unidade,' (',sigla_unidade,')']), value: id_unidade}") : arrayList;
                            arrayList = (data_tr.key == 'perfil') ? jmespath.search(arrayConfigAtividades.perfis,"[*].{name: nome_perfil, nivel: nivel, value: id_perfil}") : arrayList;
                            arrayList = (data_tr.key == 'modalidades') ? jmespath.search(arrayConfigAtividades.tipos_modalidades,"[*].{name: nome_modalidade, value: id_tipo_modalidade}") : arrayList;
                            arrayList = (data_tr.key == 'metadados') ? jmespath.search(arrayConfigAtividades.tipos_metadados,"[*].{name: nome_metadado, value: id_tipo_metadado, config: {lgpd: lgpd, ref_metadado: ref_metadado, tipo_metadado: tipo_metadado}}") : arrayList;
                            arrayList = (data_tr.key == 'metadados' && data_elem.tipometa == 'boolean') ? [{name: 'N\u00E3o', value: 0},{name: 'Sim', value: 1}] : arrayList;

                        if (arrayList.length > 0) {
                            var selectArray = (data_tr.key == 'perfil') 
                                            ? jmespath.search(arrayList,"[*].{label: name, value: value, nivel: nivel}")
                                            : jmespath.search(arrayList,"[*].{label: name, value: value}");
                                selectArray = (data_tr.key == 'metadados') ? jmespath.search(arrayList,"[*].{label: name, value: value, config: config}") : selectArray;
                                selectArray = selectArray.filter((v,i,a)=>a.findIndex(t=>(t.value === v.value))===i);
                            var htmlOptions = $.map(selectArray, function(v){
                                                    var selected = (v.label == _this.text().trim()) ? 'selected' : ''; 
                                                    var dataConfig = (typeof v.config !== 'undefined') ? "data-config='"+JSON.stringify(v.config)+"'" : "";
                                                    var disable = (data_tr.key == 'perfil' && arrayConfigAtividades.perfil.nivel > v.nivel) ? 'disabled' : '';
                                                        return "<option value='"+v.value+"' "+selected+" "+disable+" "+dataConfig+">"+v.label+"</option>";
                                                }).join('');
                        } else if (data_tr.key == 'lotacao' || data_tr.key == 'exclui_unidades' || data_tr.key == 'unidades') {
                            var htmlOptions = getOptionSelectPerfil(arrayConfigAtividades.unidades_all, _this.text().trim(), false);
                        } else if (data_tr.key == 'cadeia_valor') {
                            var htmlOptions = getOptionSelectCadeiaValor(arrayConfigAtividades.cadeia_valor, _this.text().trim());
                        }
                            _this.html(`<select data-type="`+data.type+`" onchange="changeSelectConfigItem(this)" onblur="changeSelectConfigItem(this)"><option value=" "></option>`+htmlOptions+'</select>')
                                .find('select')
                                .chosen({
                                    placeholder_text_single: ' ',
                                    no_results_text: 'Nenhum resultado encontrado'
                                });
                    },
                    renderValue: (elem, formattedNewVal) => { 
                            $(elem).text(formattedNewVal); 
                    },
                    extractEditorValue: (elem) => { 
                        return $(elem).find('select').find('option:selected').text().trim(); 
                    },
                }
            });
            
            $(".tableOptionConfig.tableSortable tbody").sortable({
                items: 'tr',
                cursor: 'grabbing',
                handle: '.sorterTrConfig',
                forceHelperSize: true,
                opacity: 0.5,
                axis: 'y',
                dropOnEmpty: false,
                update: function(event, ui) {
                    $(this).find('tr').each(function(index, value){
                        $(this).attr('data-index',index).data('index',index);
                    })
                }
            });

            if (typeof complexidade_len !== 'undefined' && complexidade_len == 0) {
                $('#configBox_complexidade').find('tbody tr:last-child').find('td:first-child').trigger('click');
            }
            if (typeof tipo_processo_len !== 'undefined' && tipo_processo_len == 0) {
                $('#configBox_tipo_processo').find('tbody tr:last-child').find('td:first-child').trigger('click');
            }
            if (typeof documentos_len !== 'undefined' && documentos_len == 0) {
                $('#configBox_documentos').find('tbody tr:last-child').find('td:first-child').trigger('click');
            }
            
        }, 500);

    } else {
        alertaBoxPro('Error', 'exclamation-triangle', 'Em desenvolvimento!');
    }
}
function updateConfigPerfilCapacidade(param, ativData) {
    var key_id = tryParseJSONObject(param.key) ? JSON.parse(param.key) : false;
    var query_return = (typeof ativData['query_return'] !== 'undefined') ? ativData['query_return'][0] : false;
    var capacidade = (query_return) ? jmespath.search(query_return.lista_capacidades, "[?id_perfil==`"+key_id.id_perfil+"`] | [0]") : false;
    var id_capacidade = (capacidade) ? capacidade.id_capacidade : 0;
    loadingButtonConfirm(false);
    
    if (query_return && key_id) { 
        $('#tableConfiguracoesPanel_tipos_capacidades tr[data-id="'+param.id+'"] td[data-key="lista_perfis"]').text(query_return.lista_perfis);
        
        var tr = $('.tableConfigCapacidades tr[data-id_perfil="'+key_id.id_perfil+'"][data-id="'+param.id+'"]');
            tr.find('td:first-child').removeClass('editCellLoading');
            tr.find('input').attr('data-id_capacidade', id_capacidade).prop('checked',(param.value == 'add' ? true : false));

        if (typeof tableConfigList['tipos_capacidades'] !== 'undefined') {
            objIndex = tableConfigList['tipos_capacidades'].findIndex((obj => obj['id_tipo_capacidade'] == param.id));
            if (objIndex !== -1) {
                tableConfigList['tipos_capacidades'][objIndex] = query_return;
            }
        }
        if (typeof arrayConfigAtividades['tipos_capacidades'] !== 'undefined') {
            objIndex_ = arrayConfigAtividades['tipos_capacidades'].findIndex((obj => obj['id_tipo_capacidade'] == param.id));
            if (objIndex_ !== -1) {
                arrayConfigAtividades['tipos_capacidades'][objIndex_] = query_return;
            }
        }
        $('#accordion-perfis .ui-accordion-content').each(function(){
            var count = $(this).find('.onoffswitch-checkbox:checked').length;
            var ref = $(this).attr('aria-labelledby');
            $('h3#'+ref+' span').text(count);
        }) 
    }
}
function changeConfigPerfilCapacidade(this_) {
    var _this = $(this_);
    var _data = _this.data();
    var mode = 'update';
    var type = 'tipos_capacidades';
    var value = (_this.is(':checked')) ? 'add' : 'remove';
    var key = {
        id_perfil: _data.id_perfil,
        id_capacidade: _data.id_capacidade
    }

    var action = 'config_update_tipos_capacidades';
    var param = {
        action: action,
        mode: mode,
        type: type,
        key: JSON.stringify(convertJsonBools(key)),
        value: value,
        id: _data.id
    };
    getConfigServer(action, param);
    _this.closest('tr').find('td').eq(0).addClass('editCellLoading');
}
function configModalidadesLimitePlanos(this_) {
    var _this = $(this_);
    if (_this.is(':checked')) {
        $('#configModalidades_limite_planos').hide();
        $('#limite_planos').val(0);
    } else {
        $('#configModalidades_limite_planos').show();
        $('#limite_planos').val(100);
    }
}
function configMotivosAfastamentoIntegracao(this_) {
    var _this = $(this_);
    if (_this.is(':checked')) {
        $('#configTiposAfast_editarintegracao').show();
    } else {
        $('#configTiposAfast_editarintegracao').hide();
    }
}
function editModelConfigItem(this_) {
    var _this = $(this_);
    var data = _this.data();
    var _parent = _this.closest('.ui-dialog');
    var listConfig = (typeof tableConfigList[data.type] !== 'undefined' && tableConfigList[data.type].length) ? tableConfigList[data.type] : arrayConfigAtividades[data.type];
    var value = (typeof listConfig !== 'undefined' && listConfig !== null && listConfig.length) ? jmespath.search(listConfig, "[?id_"+data.type.slice(0, -1)+"==`"+data.id_reference+"`] | [0]") : false;
        value = (value !== null) ? value : false;
    var checkPlano = (data.type == 'planos') ? checkPlanoAntesAssinatura(value, data.type) : {check: true};
    
    if (!value && data.type == 'planos') {
        setTimeout(function(){ 
            alertaBoxPro('Error', 'exclamation-triangle', 'Nenhum plano de trabalho ativo!');
        }, 1500);
    } else if (value && !checkPlano.check && data.type == 'planos') {
        setTimeout(function(){ 
            alertaBoxPro('Error', 'exclamation-triangle', checkPlano.alert);
        }, 1500);
    } else if (checkPlano.check) {
        _this.append('<i class="fas fa-spinner fa-spin cinzaColor loadingDocModel"></i>');

        var action = 'view_documento';
        var param = {
            action: action,
            mode: data.mode,
            return_action: data.action,
            return_sign: data.sign,
            return_user: data.user,
            id_reference: data.id_reference,
            reference: 'modelo',
            title: data.title,
            type: data.type,
        };
        getConfigServer(action, param);
    }
}
function openModelConfigItem(data, paramData) {
    var _this = $('a.'+paramData.return_action+'ModelDoc[data-mode="'+paramData.mode+'"]');
        _this.find('i.loadingDocModel').remove();
    
    var param = {
        id_documento: data.id_documento,
        title_page: paramData.title,
        title: paramData.title,
        mode: paramData.mode,
        reference: paramData.reference,
        id_reference: paramData.id_reference,
        type: paramData.type,
        text: data.text
    };
    if (paramData.return_action == 'edit') {
        openEditorDoc(param, paramData);
    } else if (paramData.return_action == 'view') {
        openEditorViewDoc(param, paramData, data);
    }
    // console.log(data, param, paramData);
}
function setParamEditorAtiv(mode, text, id_user = false, id_reference = false, type = 'planos') {
    if (mode == 'modelo_termo_adesao') {
        var user = (id_user) ? jmespath.search(arrayConfigAtividades.usuarios, "[?id_user==`"+id_user+"`] | [0]") : arrayConfigAtividades.perfil;
            user = (user == null) ? arrayConfigAtividades.perfil : user;
            
        var listTermos = typeof tableConfigList[type] !== 'undefined' && tableConfigList[type] !== null && tableConfigList[type].length > 0 ? tableConfigList[type] : arrayConfigAtividades[type];
        var termo = id_reference ? jmespath.search(listTermos, "[?"+listTermos[0].primarykey+"==`"+id_reference+"`] | [0]") : jmespath.search(listTermos, "[?id_user==`"+user.id_user+"`] | [0]");
            termo = (termo !== null) ? termo : jmespath.search(tableConfigList[type], "[?id_user==`"+user.id_user+"`] | [0]");
        var unidade = (termo !== null) ? jmespath.search(arrayConfigAtividades.unidades, "[?id_unidade==`"+termo.id_unidade+"`] | [0]") : arrayConfigAtivUnidade;
        var vigencia_plano = (termo !== null) ? moment(termo.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(termo.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY') : '';
        var entidade = (termo !== null) ? jmespath.search(arrayConfigAtividades.entidades, "[?id_entidade==`"+termo.id_entidade+"`] | [0]") : null;

        console.log({mode:mode, id_user:id_user, id_reference:id_reference, type:type, termo:termo, unidade:unidade});

        var data_comparecimento = (unidade.config.hasOwnProperty('planos')) ? unidade.config.planos.data_comparecimento : 'Dia';
        var prazo_comparecimento = (unidade.config.hasOwnProperty('planos')) ? parseInt(unidade.config.planos.prazo_comparecimento) : 1;
            prazo_comparecimento = (prazo_comparecimento > 1) ? prazo_comparecimento+' '+data_comparecimento+'s' : prazo_comparecimento+' '+data_comparecimento;
        var rowListaAtividades = '';

        $.each(arrayConfigAtividades.atividades,function(index, value){
            var config_unidade = getConfigDadosUnidade(value.sigla_unidade);
            var complexidade = ((typeof value.config !== 'undefined' && value.config !== null && value.config.hasOwnProperty('complexidade') && value.config.complexidade.length > 0) ? jmespath.search(value.config.complexidade, "[?default==`true`].complexidade | [0]") : '');
            var parametros = ((typeof value.config !== 'undefined' && value.config !== null && value.config.hasOwnProperty('parametros') && value.config.parametros.length > 0) ? $.map(value.config.parametros,function(v){ return v[0] }).join('; ') : '');
            var entregas = ((typeof value.config !== 'undefined' && value.config !== null && value.config.hasOwnProperty('entregas') && value.config.entregas.length > 0) ? $.map(value.config.entregas,function(v){ return v[0] }).join('; ') : '');
            var arrayModalidades = (typeof value.config !== 'undefined' && value.config !== null && value.config.hasOwnProperty('modalidades') && value.config.modalidades && value.config.modalidades.length > 0) ? value.config.modalidades : config_unidade.modalidades;
            var ganho_tele = jmespath.search(arrayModalidades,"[?tipo_modalidade=='Teletrabalho'] | [0].fator");
                ganho_tele = (ganho_tele !== null) ? ganho_tele : 1;
            var ganho_presencial = jmespath.search(arrayModalidades,"[?tipo_modalidade=='Presencial'] | [0].fator");
                ganho_presencial = (ganho_presencial !== null) ? ganho_presencial : 1;
            var listUnidades = jmespath.search(arrayConfigAtividades.atividades,"[*].sigla_unidade");
                listUnidades = (listUnidades !== null) ? uniqPro(listUnidades) : [];
            var sigla_unidade = (listUnidades.length == 1 && listUnidades[0] == arrayConfigAtivUnidade.sigla_unidade) ? '' : value.sigla_unidade+': ';

            var check_lista_integral =  (termo && termo !== null && typeof termo.config !== 'undefined' && termo.config !== null && 
                                            termo.config.hasOwnProperty('atividades_lista_integral') && termo.config.atividades_lista_integral !== null && termo.config.atividades_lista_integral
                                        ) ? termo.config.atividades_lista_integral : true;

            var check_lista_atividades =    (termo && termo !== null && typeof termo.config !== 'undefined' && termo.config !== null && 
                                                check_lista_integral == false &&
                                                termo.config.hasOwnProperty('lista_atividades') && termo.config.lista_atividades !== null && termo.config.lista_atividades.length > 0 &&
                                                $.inArray(value.id_atividade.toString(), termo.config.lista_atividades) !== -1 
                                            ) ? true: false;

            if (check_lista_atividades || check_lista_integral) {
                rowListaAtividades +=   '           <tr>'+
                                        '                <td>'+sigla_unidade+value.nome_atividade+'</td>'+
                                        '                <td>'+unicodeToChar(complexidade)+'</td>'+
                                        '                <td>'+unicodeToChar(parametros)+'</td>'+
                                        '                <td>'+(value.tempo_pactuado*ganho_presencial).toFixed(2)+'</td>'+
                                        '                <td>'+(value.tempo_pactuado*ganho_tele).toFixed(2)+'</td>'+
                                        '                <td>'+((1-ganho_tele)*100).toFixed(2)+'%'+'</td>'+
                                        '                <td>'+unicodeToChar(entregas)+'</td>'+
                                        '           </tr>';
            }
        });
        
        var tableListaAtividades =  '<figure class="table" style="width:95%;">'+
                                    '    <table>'+
                                    '        <thead>'+
                                    '            <tr>'+
                                    '                <th class="trCinza">Descri\u00E7\u00E3o d'+__.a_atividade+'</th>'+
                                    '                <th class="trCinza">Faixa de Complexidade d'+__.a_Atividade+'</th>'+
                                    '                <th class="trCinza">Par\u00E2metros adotados para defini\u00E7\u00E3o da faixa de complexidade</th>'+
                                    '                <th class="trCinza">Tempo de execu\u00E7\u00E3o d'+__.a_atividade+' em regime presencial</th>'+
                                    '                <th class="trCinza">Tempo de execu\u00E7\u00E3o d'+__.a_atividade+' em teletrabalho</th>'+
                                    '                <th class="trCinza">Ganho percentual de produtividade estabelecido, quando aplic\u00E1vel</th>'+
                                    '                <th class="trCinza">Entregas esperadas</th>'+
                                    '            </tr>'+
                                    '        </thead>'+
                                    '        <tbody>'+
                                    '               '+rowListaAtividades+
                                    '        </tbody>'+
                                    '    </table>'+
                                    '</figure>';
        // console.log({id_user: id_user, user: user, termo: termo, unidade: unidade, vigencia: vigencia_plano});

        var style_field = 'font-weight: bold;padding: 5px 8px;margin: 5px 0px;display: inline-block;background: #f5f5f5;border-radius: 5px;';
        var textResult = text;
            textResult = !!termo.nome_completo ? textResult.replace(/{nome_completo}/gi,'<span style="'+style_field+'">'+termo.nome_completo+'</span>') : textResult;
            textResult = textResult.replace(/{matricula}/gi,'<span style="'+style_field+'">'+user.matricula+'</span>');
            textResult = textResult.replace(/{vigencia_plano}/gi,'<span style="'+style_field+'">'+vigencia_plano+'</span>');
            textResult = textResult.replace(/{nome_unidade}/gi,'<span style="'+style_field+'">'+unidade.nome_unidade+'</span>');
            textResult = !!termo.nome_modalidade ? textResult.replace(/{modalidade_plano}/gi,'<span style="'+style_field+'">'+termo.nome_modalidade+'</span>') : textResult;
            textResult = !!termo.carga_horaria ? textResult.replace(/{carga_horaria}/gi,'<span style="'+style_field+'">'+termo.carga_horaria+'</span>') : textResult;
            textResult = textResult.replace(/{tempo_pactuado_total}/gi,'<span style="'+style_field+'">'+termo.tempo_total+'</span>');
            textResult = textResult.replace(/{nome_entidade}/gi,'<span style="'+style_field+'">'+entidade.nome_entidade+'</span>');
            textResult = textResult.replace(/{sigla_entidade}/gi,'<span style="'+style_field+'">'+entidade.sigla_entidade+'</span>');
            textResult = textResult.replace(/{prazo_comparecimento}/gi,'<span style="'+style_field+'">'+prazo_comparecimento+'</span>');
            textResult = textResult.replace(/{lista_atividades}/gi,tableListaAtividades);
        if (textResult.indexOf('{only_semipresencial}') !== -1) {
            var textFind = $('<div>'+textResult+'</div>');
                textFind.find('tr').each(function(){
                    var checkFind = ($(this).text().trim().indexOf('{only_semipresencial}') !== -1) ? true : false;
                    if (checkFind && termo.nome_modalidade != 'Semipresencial' && termo.nome_modalidade.indexOf('Parcial') === -1) {
                        $(this).remove();
                    }
                });
            textResult = textFind[0].outerHTML;
        }
        textResult = textResult.replace(/{only_semipresencial}/gi,'');
        if (rowListaAtividades == '') alertaBoxPro('Error', 'exclamation-triangle', 'Nenhuma lista de '+__.atividades+' encontrada.');
        return textResult;
    }
}
function extractDataDocument(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    var arrayAtiv = {};
    _parent.find('input,textarea,select').each(function(){
        if (typeof $(this).data('key') !== 'undefined') { 
            var value = $(this).val();
            var date_format = (value && value.indexOf('T') !== -1) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
            var dataValue = ($(this).attr('type') == 'number' || (value != '' && $(this).data('key').indexOf('id_') !== -1)) ? parseInt(value) : value;
            var dataValue = ($(this).attr('type') == 'number' && parseFloat($('#ativ_tempo_despendido').attr('step')) >= 1) ? parseFloat(value) : value;
                dataValue = ($(this).attr('type') == 'date') ? (value == '' ? '' : (moment(value, date_format).format('YYYY-MM-DD')+' 00:00:00')) : dataValue;
                dataValue = ($(this).attr('type') == 'datetime-local') ? (value == '' ? '' : moment(value, date_format).format('YYYY-MM-DD HH:mm:ss')) : dataValue;
                dataValue = ($(this).attr('type') == 'checkbox') ? ($(this).is(':checked') ? 'on' : 'off') : dataValue;
                dataValue = ($(this).is('textarea') || ($(this).is('input') && $(this).attr('type') == 'text') ) ? (dataValue.replace(/["']/g, "")) : dataValue;
            arrayAtiv[$(this).data('key')] = dataValue;
        }
    });
    _parent.find('.todo-list').each(function(index, value){
        arrayAtiv['list-'+index] = [];
        $(this).find('.todo-list__label input[type="checkbox"]').each(function(i, v){
            if ($(this).attr('checked') == 'checked') {
                arrayAtiv['list-'+index].push($(this).closest('label').text().trim());
            }
        });
    });
    return arrayAtiv;
}
function changeConfigOptions(this_) {
    var _this = $(this_);
    var _data = _this.data();
    var _parent = _this.closest('.ui-dialog');
    if (_this.is(':checked')) {
        _parent.find('#'+_data.ref).show();
    } else {
        _parent.find('#'+_data.ref).hide();
    }
}
function changeConfigAtivIntegral(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    var idTableAtividades = '#configBox_lista_atividades';
    var trAtividades = _parent.find(idTableAtividades+'_tr');
    var tableAtividades = _parent.find(idTableAtividades);
    if (_this.is(':checked')) {
        trAtividades.hide();
        tableAtividades.find('tbody').html('');
    } else {
        trAtividades.show();
        loadConfigAtivIntegral(idTableAtividades);
    }
}
function loadConfigAtivIntegral(idTableAtividades, id_plano = false) {
    var trAtividades = $(idTableAtividades+'_tr');
    // console.log(trAtividades.is(':visible'));
    if (trAtividades.is(':visible')) {
        var tableAtividades = $(idTableAtividades);
        var listUnidades = jmespath.search(arrayConfigAtividades.atividades,"[*].sigla_unidade");
            listUnidades = (listUnidades !== null) ? uniqPro(listUnidades) : [];
        
        var plano = (id_plano) ? jmespath.search(arrayConfigAtividades.planos,"[?id_plano==`"+id_plano+"`] | [0]") : false; 
        var modalidade = (plano && plano !== null) ? jmespath.search(arrayConfigAtividades.tipos_modalidades,"[?id_tipo_modalidade==`"+plano.id_tipo_modalidade+"`] | [0]") : null;
        var atividades_homologadas = (modalidade && modalidade !== null && modalidade.hasOwnProperty('config') && modalidade.config !== null && modalidade.config.hasOwnProperty('atividades_homologadas') && modalidade.config.atividades_homologadas !== null && modalidade.config.atividades_homologadas == true ) ? true : false;
        var atividades = (atividades_homologadas) ? jmespath.search(arrayConfigAtividades.atividades,"[?homologado==`true`]") : arrayConfigAtividades.atividades;
        if (atividades !== null) {
            var htmlAtividades = $.map(atividades, function(value,index){
                var sigla_unidade = (listUnidades.length == 1 && listUnidades[0] == arrayConfigAtivUnidade.sigla_unidade) ? '' : value.sigla_unidade+': ';
                var input_checked = (plano && typeof plano.config !== 'undefined' && plano.config !== null && 
                                    typeof plano.config.atividades_lista_integral !== 'undefined' && plano.config.atividades_lista_integral == false && 
                                    typeof plano.config.lista_atividades !== 'undefined' && plano.config.lista_atividades !== null && plano.config.lista_atividades.length > 0 &&
                                    $.inArray(value.id_atividade.toString(), plano.config.lista_atividades) !== -1 
                                    ) ? 'checked' : false;
                var tr_checked = (input_checked) ? 'infraTrMarcada' : '';
                return  '<tr class="'+tr_checked+'">'+
                        '   <td data-key="id_atividade" data-type="switch">'+
                        '       <input type="checkbox" class="checkboxSelectConfiguracoes" onclick="followSelecionarItens(this)" id="configuracoesPro_'+value.id_atividade+'" name="configuracoesPro" value="'+value.id_atividade+'" '+input_checked+'>'+
                        '   </td>'+
                        '   </td>'+
                        '   <td style="text-align: left;">'+sigla_unidade+value.nome_atividade+'</td>'+
                        '   <td>'+value.tempo_pactuado+'</td>'+
                        '</tr>';
            }).join('');

            tableAtividades.find('tbody').html(htmlAtividades);
            tableAtividades.tablesorter({
                sortLocaleCompare : true,
                headers: {
                    0: { sorter: false, filter: false },
                    1: { filter: true },
                    2: { filter: true }
                }
            }).on("sortEnd", function (event, data) {
                checkboxRangerSelectShift(idTableAtividades);
            });
            checkboxRangerSelectShift(idTableAtividades);
        }
    }
}
function changeConfigGanhoUnidade(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    var tableModalidades = _parent.find('#configBox_modalidades_atividade');
    if (_this.is(':checked')) {
        tableModalidades.find('.addConfigItem').trigger('click');
        tableModalidades.find('tbody tr:not(:last-child)').remove();
        tableModalidades.hide();
    } else {
        tableModalidades.show();
    }
}
function changeConfigListaUnidade(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    if (_this.is(':checked')) {
        _parent.find('#tr_lista_unidade').show();
    } else {
        _parent.find('#select_lista_unidade').val('');
        _parent.find('#tr_lista_unidade').hide();
    }
}
function htmlOptionsAddTextarea(target, text) {
    return '<a class="newLink newLink_active" data-target="'+target+'" data-value="'+text+'" onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\'Clique para adicionar\')" onclick="optionAddTextToTextarea(this)" style="font-size: 8pt;cursor: pointer;margin: 3px;">'+text+'</a>';
}
function optionAddTextToTextarea(this_) {
    var _this = $(this_);
    var target = $('#'+_this.data('target'));
    var text = _this.data('value');
    addTextToTextarea(_this, target, text);
}
function removeConfigRowByID(this_) {
    var _this = $(this_);
    var _parent = _this.closest('tr');
    var _table = _this.closest('table');
    confirmaBoxPro('Tem certeza que deseja excluir este item?', function(){
        if (_table.find('tbody tr').length == 1) {
            _table.find('.addConfigItem').trigger('click');
        }
        _parent.find('td:visible').effect('highlight').delay(2).effect('highlight').delay(2).effect('highlight');
        _parent.delay(8).hide('fast', function() {
            $(this).attr('data-value','remove').data('value','remove').hide().find('td').eq(0).text('');
        });
    }, 'Excluir');
}
function removeConfigRow(this_) {
    var _this = $(this_);
    var _parent = _this.closest('tr');
    var _table = _this.closest('table');
    confirmaBoxPro('Tem certeza que deseja excluir este item?', function(){
        if (_table.find('tbody tr').length == 1) {
            _table.find('.addConfigItem').trigger('click');
        }
        _parent.find('td:visible').effect('highlight').delay(2).effect('highlight').delay(2).effect('highlight');
        _parent.delay(8).hide('fast', function() {
            $(this).remove();
            if ($('#ativ_checklist').length > 0) {
                changeAtivChecklistInput($('#trAtivChecklist .addConfigItem')[0]);
            }
        });
    }, 'Excluir');
}
function changeConfigFeriadoRecorrente(this_) {
    var _this = $(this_);
    var _parent = _this.closest('tr');
    var feriado_data = _parent.find('td[data-key="feriado_data"]');
    if (_this.is(':checked')) {
        feriado_data.attr('class','editCellMonth');
    } else {
        feriado_data.attr('class','editCellDate');
    }
    if (!feriado_data.hasClass('inEdit')) {
        var text_format = (_this.is(':checked')) 
            ? moment(feriado_data.text(),'DD/MM/YYYY').format('DD/MM')
            : moment(feriado_data.text(),'DD/MM').format('DD/MM/YYYY');
            text_format = (feriado_data.text().trim() != '') ? text_format : '';
            feriado_data.text(text_format);
    }
}
function configUpdateKey(this_, mode) {
    if (mode == 'disable_key') {
        confirmaFraseBoxPro('Tem certeza que deseja revogar a chave de acesso?', 'REVOGAR', 
            function(){
                configServerKey(this_, mode);
            }
        );
    } else if (mode == 'new_key') {
        if ($(this_).closest('table').find('.keyVigente').is(':visible')) {
            confirmaFraseBoxPro('Criar uma nova chave ir\u00E1 revogar as anteriores. Tem certeza que deseja prosseguir?', 'CRIAR', 
                function(){
                    configServerKey(this_, mode);
                }
            );
        } else {
            configServerKey(this_, mode);
        }
    } else if (mode == 'resend_key') {
        configServerKey(this_, mode);
    }
}
function changeConfigItemCell(this_) {
    var _this = $(this_);
    var tr = _this.closest('tr');
    var table = _this.closest('table');
    setTimeout(function(){ 
        /*table.find('tr').each(function(){
            var td = $(this).find('td').eq(0);
            if (td.text().trim() == '') {
                td.addClass('editCellBlank');
            } else {
                td.removeClass('editCellBlank');
            }
        });*/
        if (tr.find('td').length == 2 && tr.data('index') == table.find('tbody tr').length-1 && _this.text().trim() != '') {
            addConfigItem(this_);
        }
    }, 100);
}
function checkOptionConfigComplex(this_) {
    var _this = $(this_);
    var value = _this.val();
        value = (value == '' || parseFloat(result) < 0.1) ? 0.1 : value;
    var tempo_pactuado = _this.closest('table').data('tempo-pactuado');
    var td = _this.closest('td');
    var data = td.data();
    var tr = _this.closest('tr');
    var target = (data.key == 'fator') ? tr.find('td[data-key="tempo_pactuado"]') : tr.find('td[data-key="fator"]');
    var result = (data.key == 'fator') ? (parseFloat(value) * parseFloat(tempo_pactuado)) : (parseFloat(value) / parseFloat(tempo_pactuado));
        result = (parseFloat(result) < 0.1) ? 0.1 : result;
        target.text(roundToTwo(result));
}

function getResendKey(this_) {
    var _this = $(this_);
    _this.find('i').attr('class','fas fa-sync fa-spin cinzaColor');
    var action = 'config_resend_keys';
    var param = {
        action: action,
        user_sei: userSEI,
        host: url_host.replace('controlador.php',''),
    };
    $.ajax({
        type: "POST",
        url: urlServerAtiv,
        dataType: "json",
        data: param,
        success: function(ativData){
            loadingButtonConfirm(false);
            if (  ativData.status == 0 || ativData.length == 0 ) {
                alertaBoxPro('Error', 'exclamation-triangle', 'Nenhum usu\u00E1rio cadastrado com seu login ('+userSEI+'). Solicite seu cadastramento ao administrador.');
                _this.find('i').attr('class','fas fa-exclamation-triangle vermelhoColor');
            } else {
                alertaBoxPro('Sucess', 'check-circle', 'Link de acesso reenviado com sucesso para o email do usu\u00E1rio!');
                _this.find('i').attr('class','fas fa-key laranjaColor');
            }
        }
    }).fail(function(data, textStatus){
        failureScreen(data, textStatus, param);
    });
}
function configResendKey(userSEI) {
    loadingButtonConfirm(true);
    
    var configBasePro = localStorageRestorePro('configBasePro');
    var configBaseSelected = ( getOptionsPro('configBaseSelectedPro_atividades') ) ? getOptionsPro('configBaseSelectedPro_atividades') : 0;
    // var dataAPI = jmespath.search(configBasePro, "[?baseTipo=='atividades'] | [?conexaoTipo=='api'||conexaoTipo=='googleapi']");
    var dataAPI = jmespath.search(configBasePro, "[?baseTipo=='atividades'] | [?conexaoTipo=='api']");
    var perfilLoginAtiv = (dataAPI && dataAPI !== null && dataAPI.length > 0 && typeof dataAPI[configBaseSelected].KEY_USER !== 'undefined') 
                    ? dataAPI[configBaseSelected] 
                    : false;
                    
    if (perfilLoginAtiv) {
        urlServerAtiv = perfilLoginAtiv.URL_API;
        var action = 'config_resend_keys';
        var param = {
            action: action,
            user_sei: userSEI,
            host: url_host.replace('controlador.php',''),
        };
        $.ajax({
            type: "POST",
            url: urlServerAtiv,
            dataType: "json",
            data: param,
            success: function(ativData){
                loadingButtonConfirm(false);
                if (  ativData.status == 0 || ativData.length == 0 ) {
                    alertaBoxPro('Error', 'exclamation-triangle', 'Nenhum usu\u00E1rio cadastrado com seu login ('+userSEI+'). Solicite seu cadastramento ao administrador.');
                } else {
                    alertaBoxPro('Sucess', 'check-circle', 'Link de acesso reenviado com sucesso para o email do usu\u00E1rio!');
                }
            }
        }).fail(function(data, textStatus){
            failureScreen(data, textStatus, param);
        });
    }
}
function configServerKey(this_, mode) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    var data = _this.closest('tr').data();
    var data_table = _parent.data();
        _this.addClass('loading').find('i').attr('class','fas fa-spinner fa-spin');
    
    var action = 'config_update_keys';
    var param = {
        action: action,
        id_user: data_table.id,
        id: data.id,
        host: url_host.replace('controlador.php',''),
        mode: mode
    };
    // console.log(param);
    getConfigServer(action, param);
}
function checkDatesLoopArray(array, inicio, fim, id_user, id_target, labels, includes = false, search_target = false, add_loop = 'days') {
    var format = 'YYYY-MM-DDTHH:mm';
    // var format = (inicio.indexOf('T') !== -1) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
    var _inicio = moment(inicio, format);
    var _fim = moment(fim, format);
    var checkBetween = false;
    var checkInicio = checkDatesBetweenArray(array, _inicio.format(format), id_user, id_target, labels, includes, search_target, add_loop);
    var checkFim = checkDatesBetweenArray(array, _fim.format(format), id_user, id_target, labels, includes, search_target, add_loop);
        while(_inicio.add(1, add_loop).diff(_fim) < 0) {
            var check = checkDatesBetweenArray(array, _inicio.clone().format(format), id_user, id_target, labels, includes, search_target, add_loop);
            if (check) {
                checkBetween = check;
                break;
            }
        }
        // console.log(array, inicio, format, checkInicio, checkBetween, checkFim, id_user, id_target, labels, includes);

    return (checkInicio || checkBetween || checkFim) ? (checkInicio || checkBetween || checkFim) : false;
}
function checkDatesBetweenArray(array, date_target, id_user, id_target, labels, includes = false, search_target = false, add_loop = 'days') {
    var format = (date_target.indexOf('T') !== -1) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
    // var mode_between = (date_target.indexOf('T') !== -1) ? 'minutes' : 'days';
    var userDates = (search_target) 
                ? array
                : jmespath.search(array,"[?"+labels.id+"==`"+id_user+"`]");
    var checkDates = [];
    var target = moment(date_target,format);
        includes = (includes) ? '[]' : '()';
        
        // console.log({search_target: search_target, format: format, userDates: userDates, date_target: date_target, id_user: id_user, id_target: id_target});

    $.each(userDates,function(index, value){
        var start = moment(value[labels.inicio], 'YYYY-MM-DD HH:mm:ss');
        var finish = moment(value[labels.fim], 'YYYY-MM-DD HH:mm:ss');
        var check = target.isBetween(start, finish, add_loop, includes);

        // console.log('$$$ => ',target.format(format), start.format(format), finish.format(format), add_loop, includes);

        var check_array = (search_target) 
                ? (id_target != value[labels.idreftype]) ? true : false
                : (id_target != value[labels.id]) ? true : false;
        if (check && check_array) {
            // console.log('*',check, start.format(format), finish.format(format), id_target, date_target, value[labels.id]);
            checkDates.push(value[labels.idreftype]);
            //return false;
        }
    });
    return (checkDates && checkDates.length ? checkDates : false);
}
function checkOptionConfigSEI(this_) {
    var _this = $(this_);
    var protocoloSEI = _this.val();
    if (protocoloSEI != '') { 
        var td = _this.closest('td');
        var tr = _this.closest('tr');
        var table = _this.closest('table');
            td.addClass('editCellLoading');
            getIDProtocoloSEI(protocoloSEI,  
                function(html){
                    let $html = $(html);
                    var params = getParamsUrlPro($html.find('#ifrArvore').attr('src'));
                    var documento_text = tr.find('td[data-key="documento"]').text();
                    var nr_sei_text = protocoloSEI;
                    var previewDoc =    '<a class="newLink" style="cursor: pointer;" onclick="openDialogDoc({title: \''+unicodeToChar(documento_text)+' ('+nr_sei_text+')\', id_procedimento: \''+params.id_procedimento+'\', id_documento: \''+params.id_documento+'\'})" onmouseover="return infraTooltipMostrar(\'Visualiza\u00E7\u00E3o r\u00E1pida\');" onmouseout="return infraTooltipOcultar();">'+
                                        '   <i class="fas fa-eye" style="font-size: 80%;"></i>'+
                                        '</a>';
                        td.addClass('editCellConfirm').removeClass('editCellLoading').removeClass('editCellLoadingError');
                        tr.find('td[data-key="id_procedimento"]').text(params.id_procedimento);
                        tr.find('td[data-key="id_documento"]').text(params.id_documento);
                        tr.find('td[data-ref="previa"]').html(previewDoc);
                        tr.data('value', 'new').attr('data-value', 'new');
                    
                    if (tr.data('index') == table.find('tbody tr').length-1) {
                        addConfigItem(this_);
                    }
                }, 
                function(){
                    setTimeout(function(){ 
                        td.addClass('editCellLoadingError').removeClass('editCellLoading').removeClass('editCellConfirm');
                        alertaBoxPro('Error', 'exclamation-triangle', 'N\u00FAmero SEI n\u00E3o encontrado!');
                    }, 500);
                });
    }
}
function extractOptionConfigItem(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    var param = {};
    _parent.find('.singleOptionInput').each(function(ind){
        var _this_s = $(this);
        if (_this_s.attr('type') == 'text' && typeof _this_s.data('key') !== 'undefined' ) {
            var value = _this_s.val().trim();
                value = (_this_s.data('convert') == 'lowercase') ? value.toLowerCase() : value;
                value = (_this_s.data('convert') == 'uppercase') ? value.toUpperCase() : value;
            param[_this_s.data('key')] = _this_s.val().trim();
        } else if (_this_s.attr('type') == 'number' && typeof _this_s.data('key') !== 'undefined' ) {
            var value = _this_s.val().trim();
            param[_this_s.data('key')] = parseFloat(value);
        } else if (_this_s.is('textarea') && typeof _this_s.data('key') !== 'undefined' ) {
            param[_this_s.data('key')] = _this_s.val().trim();
        }
    });
    _parent.find('.singleOptionConfig').each(function(ind){
        var _this_s = $(this);
        if (_this_s.attr('type') == 'checkbox' && typeof _this_s.data('key') !== 'undefined' ) {
            param[_this_s.data('key')] = _this_s.is(':checked');
        } else if (
                (_this_s.attr('type') == 'text' && typeof _this_s.data('key') !== 'undefined') ||
                (_this_s.is('select') && typeof _this_s.data('key') !== 'undefined')
            ) {
            param[_this_s.data('key')] = (_this_s.data('type') == 'number' ? parseFloat(_this_s.val()) : _this_s.val());
        } else if (!_this_s.is('select') && _this_s.attr('type') == 'number' && typeof _this_s.data('key') !== 'undefined' ) {
            param[_this_s.data('key')] = parseFloat(_this_s.val());
        }
    });
    _parent.find('.hiddenOptionConfig').each(function(ind){
        var _this_s = $(this);
        if (_this_s.attr('type') == 'hidden' && typeof _this_s.data('key') !== 'undefined' ) {
            var value = (_this_s.data('type') == 'json') ? JSON.parse(_this_s.val()) : _this_s.val().toString();
            param[_this_s.data('key')] = value;
        }
    });

    var optionColor = _parent.find('.singleOptionColor');
    if (optionColor.length > 0) {
        var icontag = optionColor.data('icontag');
        var textcolor = optionColor.data('textcolor');
        var colortag = optionColor.data('colortag');
        var colortags = {
            icontag: icontag,
            colortag: colortag,
            textcolor: textcolor
        };
        param['colortags'] = colortags
    }

    var _table_checkboxConfig = _parent.find('.tableCheckboxConfig');
    if (_table_checkboxConfig.length > 0) {
        var arrayCheckboxConfig = _table_checkboxConfig.find('tbody tr').map(function(v, i){
            var checkbox = $(this).find('td').eq(0).find('input[type="checkbox"]');
            if (checkbox.is(':checked')) {
                return checkbox.val();
            }
        }).get();
        param[_table_checkboxConfig.data('key')] = arrayCheckboxConfig;
    }

    _parent.find('.tableOptionConfig').each(function(ind){
        var data_table = $(this).data();
        var arra_table = [];
        var checkboxRequired = $(this).find('tbody tr td[data-required="true"] input[type="checkbox"]');
        if (checkboxRequired.length > 0 && !checkboxRequired.is(':checked')) {
            checkboxRequired.eq(0).prop('checked',true);
        }
        $(this).find('tbody tr').each(function(index){
            var data_tr = $(this).data();
            var this_td = $(this).find('td');
            var obj_tr = {};
            var array_tr = [];
            if (this_td.eq(0).text() != '' || data_table.format == 'obj_mult') {
                this_td.each(function(i){
                    var data_td = $(this).data();
                    var value = (data_td.type == 'switch') 
                                ? $(this).find('input[type="checkbox"]').is(':checked') ? true : false
                                : encodeJSON_toHex($(this).text().trim());
                        value = (data_td.type == 'num' && data_table.format == 'obj_mult') 
                                ? {id: data_tr.id, value: data_tr.value}
                                : value;
                        value = (data_td.type == 'num_switch' && data_table.format == 'obj_mult') 
                                ? {id: data_tr.id, value: data_tr.value, config: {[this_td.find('input[type="checkbox"]').data('key')]: this_td.find('input[type="checkbox"]').is(':checked')}}
                                : value;
                        value = (data_td.type == 'select_meta' && data_table.format == 'obj_mult') 
                                ? 
                                    {
                                        id: data_tr.id, 
                                        id_tipo: isNumeric(data_tr.value) ? parseInt(data_tr.value) : data_tr.value, 
                                        value: this_td.closest('tr').find('td[data-ref="value"][data-tipometa="boolean"]').length ? parseInt(this_td.closest('tr').find('td[data-ref="value"]').data('value')) : this_td.closest('tr').find('td[data-ref="value"]').text()
                                    }
                                : value;
                        value = (data_td.type == 'value' && data_table.format == 'obj_mult' && typeof data_tr.id !== 'undefined' && typeof data_tr.value !== 'undefined') 
                                ? {id: data_tr.id.toString(), value: data_tr.value.toString()}
                                : value;
                        value = (data_td.type == 'num' && data_table.format != 'obj_mult') 
                                ? parseFloat($(this).text())
                                : value;
                        value = (data_td.type == 'value' && data_table.format != 'obj_mult') 
                                ? $(this).text().trim()
                                : value;

                    if (data_table.format == 'obj' && typeof data_td.key !== 'undefined' && (value != '' || data_td.type == 'switch')) { 
                        value = (data_td.type == 'text') ? value.replace(/["']/g, "") : value;
                        value = (data_td.type == 'num') ? parseFloat(value) : value;
                        obj_tr[data_td.key] = value;
                    } else if (data_table.format == 'obj_mult' && typeof data_td.key !== 'undefined' && data_tr.value != '' && (data_td.type == 'value' || data_td.type == 'num' || data_td.type == 'num_switch' || data_td.type == 'select_meta') && (data_tr.id != 'new' || (data_tr.id == 'new' && data_tr.value != '' && data_tr.value != 'remove'))) { 
                        value = data_td.type == 'select_meta' ? jmespath.search([value], "[?id=='new'||id_tipo=='remove'] | [0]") : value;
                        obj_tr = value;
                    } else if (data_table.format == 'array' && value != '') {
                        array_tr.push(value);
                    }
                });
                if (obj_tr !== null && Object.keys(obj_tr).length > 0) { arra_table.push(obj_tr); }
                if (array_tr.length > 0) { arra_table.push(array_tr); }
            }
        });
        if (arra_table.length > 0) { param[data_table.key] = arra_table; }
    });
    return param;
}
function extractOptionConfigUnidade(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    var _return = {
            modalidades: _parent.find('#configBox_modalidades tbody tr').map(function(){
                            var data = $(this).data();
                            var td = $(this).find('td');
                            var tipo_modalidade = encodeJSON_toHex(td.eq(0).text().trim());
                            if (tipo_modalidade !== '') {
                                return {tipo_modalidade: tipo_modalidade, id_tipo_modalidade: parseInt(td.eq(2).text().trim()), fator: td.eq(1).text().trim() };
                            }
                        }).get(),
            atividades: {
                lista_superior: _parent.find('#atividades_lista_superior').is(':checked').toString(),
                lista_unidade: (_parent.find('#atividades_lista_unidade').is(':checked') && checkValue(_parent.find('#select_lista_unidade'))) ? _parent.find('#select_lista_unidade').val() : "false",
                envio_automatico: _parent.find('#atividades_envio_automatico').is(':checked').toString()
            },
            planos:{
                permite_autoavaliacao: _parent.find('#planos_permite_autoavaliacao').is(':checked'),
                duracao_padrao: parseInt(_parent.find('#planos_duracao_padrao').val()),
                prazo_comparecimento: parseInt(_parent.find('#planos_prazo_comparecimento').val()),
                data_comparecimento: _parent.find('#planos_data_comparecimento').val(),
                mostrar_notas: _parent.find('#planos_mostrar_notas').is(':checked')
            },
            distribuicao:{
                horario_util:{
                    inicio: _parent.find('#distribuicao_horario_util_inicio').val(),
                    fim: _parent.find('#distribuicao_horario_util_fim').val()
                },
                count_dias_uteis: _parent.find('#distribuicao_count_dias_uteis').is(':checked'),
                count_horas: _parent.find('#distribuicao_count_horas').is(':checked').toString(),
                notificacao:{
                    texto_criacao: encodeJSON_toHex(JSON.stringify(_parent.find('#notificacao_texto_criacao').val())).replaceAll('"',''),
                    texto_conclusao: encodeJSON_toHex(JSON.stringify(_parent.find('#notificacao_texto_conclusao').val())).replaceAll('"',''),
                    email: _parent.find('#notificacao_email').val()
                }
            },
            administrativo:{
                autoedicao_subordinadas: _parent.find('#atividades_autoedicao_subordinadas').is(':checked')
            },
            feriados: _parent.find('#configBox_feriados tbody tr').map(function(){
                var td = $(this).find('td');
                var checkboxRecorrente = td.eq(1).find('input[type="checkbox"]').is(':checked');
                var nome_feriado = encodeJSON_toHex(td.eq(0).text().trim());
                var feriado_data = td.eq(2).text().trim();
                if (feriado_data != '') {
                    return {nome_feriado: nome_feriado, recorrente: checkboxRecorrente, feriado_data: feriado_data };
                }
            }).get()
        };

    return _return;
}
function saveOptionConfigItem(this_, type, id) {
    var action = 'config_update_'+type;
    var key = (type == 'unidades') ? extractOptionConfigUnidade(this_) : extractOptionConfigItem(this_);
    var param = {
        action: action,
        id: id,
        ids: [],
        type: type,
        // key: key,
        key: JSON.stringify(convertJsonBools(key)),
        mode: 'option'
    };
    getConfigServer(action, param);
}
// CRIA PAINEL DE CONFIGURACOES
function configPessoal() {
    var stateAtivData = getOptionsPro('panelAtividadesViewSend') ? 'checked' : '';
    var selfAtivData = getOptionsPro('panelAtividadesViewSelf') ? 'checked' : '';
    var stateAtivDataSub = ( getOptionsPro('panelAtividadesViewSubordinada') ) ? 'checked' : '';
    // var stateAtivDataSub = ( !verifyOptionsPro('panelAtividadesViewSubordinada') || getOptionsPro('panelAtividadesViewSubordinada') ) ? 'checked' : '';
    // var stateAtivDataSyncUnidade = ( getOptionsPro('panelAtividadesViewSyncUnidade') ) ? 'checked' : '';
    var statePanelSortPro = ( getOptionsPro('panelSortPro') ) ? 'checked' : '';
    var statePanelLabPro = ( getOptionsPro('panelLabPro') ) ? 'checked' : '';
    var statePanelLocalStorePro = ( getOptionsPro('panelLocalStorePro') ) ? 'checked' : '';
    var statePanelSortColumnsPro = ( getOptionsPro('panelSortColumnsPro') ) ? 'checked' : '';
    var configBaseSelected = ( getOptionsPro('configBaseSelectedPro_atividades') ) ? getOptionsPro('configBaseSelectedPro_atividades') : 0;
    var configBaseProAtiv = ( localStorageRestorePro('configBasePro') != null ) ? localStorageRestorePro('configBasePro') : false;
        // configBaseProAtiv = (configBaseProAtiv) ? jmespath.search(configBaseProAtiv, "[?baseTipo=='atividades'] | [?conexaoTipo=='api'||conexaoTipo=='googleapi']") : configBaseProAtiv;
        configBaseProAtiv = (configBaseProAtiv) ? jmespath.search(configBaseProAtiv, "[?baseTipo=='atividades'] | [?conexaoTipo=='api']") : configBaseProAtiv;
        configBaseProAtiv = (configBaseProAtiv !== null && configBaseProAtiv.length > 0 ) ? configBaseProAtiv : false;
    var optionSelectConfigBasePro = ( configBaseProAtiv && configBaseProAtiv.length > 0 ) ? $.map(configBaseProAtiv, function(v,k){ return ( configBaseSelected == k ) ? '<option value="'+k+'" selected>'+v.baseName+'</option>' : '<option value="'+k+'">'+v.baseName+'</option>' }).join('') : '';
    var configUser = (typeof arrayConfigAtividades.perfil !== 'undefined' && arrayConfigAtividades.perfil.hasOwnProperty('config') && typeof arrayConfigAtividades.perfil.config !== 'undefined' && arrayConfigAtividades.perfil.config !== null) ? arrayConfigAtividades.perfil.config : false;
    var telCelularPlano = (typeof arrayConfigAtividades.perfil !== 'undefined' && arrayConfigAtividades.perfil.hasOwnProperty('tel_celular_plano') && arrayConfigAtividades.perfil.tel_celular_plano) ? arrayConfigAtividades.perfil.tel_celular_plano : false;
    // console.log('configUser',configUser);

    var htmlSelectConfigBase = '<select style="width: 100%; margin: 0 !important; padding: 0 5px !important;width: 300px;" class="required infraText txtsheetsSelect" id="selectBaseDadosAtiv" onchange="changeBaseDadosAtiv(this)">'+optionSelectConfigBasePro+'</select>';
    
    var optionSelectConfigProgramas = $.map(arrayConfigAtividades.programas, function(v){
                                            var id_programa_selected = parseInt(getOptionsPro('programaAtividadesSelected'));
                                            var selected = (id_programa_selected == v.id_programa) ? 'selected' : '';
                                            return '<option value="'+v.id_programa+'" data-label="'+v.sigla_unidade+'" data-id_unidade="'+v.id_unidade+'" '+selected+'>'+moment(v.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(v.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</option>';
                                        }).join('');
    var htmlSelectConfigProgramas = '<select style="width: 100%; margin: 0 !important; padding: 0 5px !important;width: 240px;" class="required infraText txtsheetsSelect" data-placeholder="Filtrar por programa de gest\u00E3o" id="selectProgramaAtiv" onchange="changeProgramaAtiv(this)">'+optionSelectConfigProgramas+'</select>';



    var textBox =   '';

        textBox +=  '<table style="font-size: 10pt; float: left; margin-top: 30px;" class="seiProForm">'+
                    '   <tr style="height: 40px;">'+
                    '       <td style="width: 460px;"><i class="iconPopup far fa-hand-rock cinzaColor"></i> Ordenar pain\u00E9is de gest\u00E3o arrastando e soltando</td>'+
                    '       <td colspan="2">'+
                    '           <div class="onoffswitch" style="float: left;">'+
                    '               <input type="checkbox" onchange="changePanelSortPro(this);saveConfigPersonalUser(this);" name="onoffswitch" class="onoffswitch-checkbox" id="panelSortPro" tabindex="0" '+statePanelSortPro+'>'+
                    '               <label class="onoffswitch-label" for="panelSortPro"></label>'+
                    '           </div>'+
                    '       </td>'+
                    '   </tr>'+
                    '   <tr style="height: 40px;">'+
                    '       <td><i class="iconPopup fas fa-arrows-alt-h cinzaColor"></i> Ordenar colunas do painel de '+__.demandas+' arrastando e soltando</td>'+
                    '       <td colspan="2">'+
                    '           <div class="onoffswitch" style="float: left;">'+
                    '               <input type="checkbox" onchange="changePanelSortColumnsPro(this);saveConfigPersonalUser(this);" name="onoffswitch" class="onoffswitch-checkbox" id="panelSortColumnsPro" tabindex="0" '+statePanelSortColumnsPro+'>'+
                    '               <label class="onoffswitch-label" for="panelSortColumnsPro"></label>'+
                    '           </div>'+
                    '       </td>'+
                    '   </tr>'+
                    '   <tr style="height: 40px;">'+
                    '       <td><i class="iconPopup fas fa-street-view cinzaColor"></i> Visualizar apenas '+__.minhas_demandas+'</td>'+
                    '       <td colspan="2">'+
                    '           <div class="onoffswitch" style="float: left;">'+
                    '               <input type="checkbox" data-type="view_ativ_self" onchange="changeViewStatesAtiv(this);saveConfigPersonalUser(this);" name="onoffswitch" class="onoffswitch-checkbox" id="panelAtividadesViewSelf" tabindex="0" '+selfAtivData+'>'+
                    '               <label class="onoffswitch-label" for="panelAtividadesViewSelf"></label>'+
                    '           </div>'+
                    '       </td>'+
                    '   </tr>'+
                    '   <tr style="height: 40px;">'+
                    '       <td><i class="iconPopup fas fa-archive cinzaColor"></i> Visualizar '+__.demandas+' j\u00E1 '+__.arquivadas+'</td>'+
                    '       <td style="width: 50px;">'+
                    '           <div class="onoffswitch" style="float: left;">'+
                    '               <input type="checkbox" data-type="view_ativ_send" onchange="changeViewStatesAtiv(this);saveConfigPersonalUser(this);getConfigProgramas(this);" name="onoffswitch" class="onoffswitch-checkbox" id="panelAtividadesViewSend" tabindex="0" '+stateAtivData+'>'+
                    '               <label class="onoffswitch-label" for="panelAtividadesViewSend"></label>'+
                    '           </div>'+
                    '       </td>'+
                    '       <td style="'+(getOptionsPro('panelAtividadesViewSend') ? '' : 'display:none;')+'" class="selectProgramaAtiv">'+
                    htmlSelectConfigProgramas+
                    '       </td>'+
                    '   </tr>'+
                    '   <tr style="height: 40px;">'+
                    '       <td><i class="iconPopup fas fa-exchange-alt cinzaColor"></i> Visualizar '+__.demandas+' e afastamentos das unidades subordinadas</td>'+
                    '       <td colspan="2">'+
                    '           <div class="onoffswitch" style="float: left;">'+
                    '               <input type="checkbox" data-type="view_ativ_sub" onchange="changeViewStatesAtiv(this);saveConfigPersonalUser(this);" name="onoffswitch" class="onoffswitch-checkbox" id="panelAtividadesViewSub" tabindex="0" '+stateAtivDataSub+'>'+
                    '               <label class="onoffswitch-label" for="panelAtividadesViewSub"></label>'+
                    '           </div>'+
                    '       </td>'+
                    '   </tr>'+
                    '   <tr style="height: 40px;">'+
                    '       <td><i class="iconPopup fas fa-tractor cinzaColor"></i> Desativar sincroniza\u00E7\u00E3o de dados locais (reduz desempenho)</td>'+
                    '       <td style="width: 300px;" colspan="2">'+
                    '           <div class="onoffswitch" style="float: left;">'+
                    '               <input type="checkbox" data-type="view_disable_local" onchange="changeViewStatesAtiv(this);saveConfigPersonalUser(this);" name="onoffswitch" class="onoffswitch-checkbox" id="panelLocalStorePro" tabindex="0" '+statePanelLocalStorePro+'>'+
                    '               <label class="onoffswitch-label" for="panelLocalStorePro"></label>'+
                    '           </div>'+
                    '       </td>'+
                    '   </tr>'+
                    /*
                    '   <tr style="height: 40px;">'+
                    '       <td><i class="iconPopup fas fa-sign-out-alt cinzaColor"></i> Sincronizar a troca de unidade do sistema \u00E0 troca de unidade do SEI </td>'+
                    '       <td>'+
                    '           <div class="onoffswitch" style="float: right;">'+
                    '               <input type="checkbox" data-type="sync_unidades" onchange="changeViewStatesAtiv(this)" name="onoffswitch" class="onoffswitch-checkbox" id="changeViewStatesSyncUnidade" tabindex="0" '+stateAtivDataSyncUnidade+'>'+
                    '               <label class="onoffswitch-label" for="changeViewStatesSyncUnidade"></label>'+
                    '           </div>'+
                    '       </td>'+
                    '   </tr>'+
                    */
                    '   <tr style="height: 40px;">'+
                    '       <td style="vertical-align: bottom;position:relative;">'+
                    // '           <a class="newLink" onclick="signOutProfile()" id="ssoLoginConfig" style="position: absolute;right: 0;top: 5px;'+(getTokenGoogle() ? '' : 'display:none;')+'" onmouseover="return infraTooltipMostrar(\'Desconectar\');" onmouseout="return infraTooltipOcultar();">'+
                    '               <i class="iconPopup fas fa-sign-out-alt cinzaColor" style="height: auto;"></i>'+
                    '           </a>'+
                    '           Alternar base de dados'+
                    '           <i class="iconPopup fas fa-sync-alt cinzaColor"></i>'+
                    '       </td>'+
                    '       <td colspan="2">'+
                    htmlSelectConfigBase+
                    '       </td>'+
                    '   </tr>'+( (checkOptionEntidade('gerar_relatorios_gerenciais') || checkOptionEntidade('sincronizar_dados_externos') ) && typeof arrayConfigAtividades.perfil.nivel !== 'undefined' && arrayConfigAtividades.perfil.nivel !== null && arrayConfigAtividades.perfil.nivel == 1 ? 
                    '   <tr style="height: 40px;">'+
                    '       <td colspan="2">'+
                    (checkOptionEntidade('gerar_relatorios_gerenciais') ? 
                    '           <a class="newLink newLink_active" onclick="initUpdateReports()" style="font-size: 10pt;cursor: pointer;">'+
                    '               <i class="fas fa-file-alt" style="font-size: 100%;"></i> '+
                    '               Atualizar relat\u00F3rios gerenciais'+
                    '           </a>'+ 
                    '' : '')+
                    (checkOptionEntidade('sincronizar_dados_externos') ? 
                    '           <a class="newLink newLink_active" onclick="setSyncDadoExterno(this)" style="font-size: 10pt;cursor: pointer;">'+
                    '               <i class="fas fa-cogs" style="font-size: 100%;"></i> '+
                    '               Atualizar rotinas internas'+
                    '               <span class="info"></span>'+
                    '           </a>'+
                    '' : '')+
                    (debugScreen ?
                    '           <a class="newLink newLink_active debugScreen" onclick="dialogDebugScreen(this)" style="font-size: 10pt;cursor: pointer;">'+
                    '               <i class="fas fa-bug" style="font-size: 100%;"></i> '+
                    '               Notificar bug'+
                    '               <span class="info"></span>'+
                    '           </a>'+
                    '' : '')+
                    '       </td>'+
                    '   </tr>' : '')+
                    '   <tr style="height: 40px;">'+
                    '       <td colspan="2">'+
                    '           <span style="color:#ccc;font-size: 8pt;font-family: monospace;">'+
                    '               Vers\u00E3o '+VERSION_SPRO+
                    '               Server: '+urlServerAtiv+
                    '           </span>'+
                    '       </td>'+
                    '   </tr>'+
                    '</table>';

        textBox +=  '<table style="font-size: 10pt;float: left; margin-top: 30px;" class="seiProForm">'+
                    '   <tr style="height: 40px;">'+
                    '       <td><i class="iconPopup fas fa-business-time cinzaColor"></i> Hor\u00E1rio \u00FAtil de trabalho (para c\u00E1lculo de tempo despendido)</td>'+
                    '       <td style="text-align: center;" colspan="2">'+
                    '            <input type="time" id="distribuicao_horario_util_inicio" onchange="saveConfigPersonalUser(this)" style="width: 100px !important; float: left;" tabindex="0" value="'+(configUser && typeof configUser.distribuicao !== 'undefined' && typeof configUser.distribuicao.horario_util !== 'undefined' && typeof configUser.distribuicao.horario_util.inicio !== 'undefined' ? configUser.distribuicao.horario_util.inicio : '00:00')+'">'+
                    '            <span style="line-height: 40px;display: inline-block;margin: 0 10px;">\u00E0</span>'+
                    '            <input type="time" id="distribuicao_horario_util_fim" onchange="saveConfigPersonalUser(this)" style="width: 100px !important; float: right;" tabindex="0" value="'+(configUser && typeof configUser.distribuicao !== 'undefined' && typeof configUser.distribuicao.horario_util !== 'undefined' && typeof configUser.distribuicao.horario_util.fim !== 'undefined' ? configUser.distribuicao.horario_util.fim : '23:59')+'">'+
                    '       </td>'+
                    '   </tr>'+
                    '   <tr style="height: 40px;">'+
                    '       <td style="width: 300px;"><i class="iconPopup far fa-phone cinzaColor"></i> Telefone vis\u00EDvel na lista de contatos</td>'+
                    '       <td colspan="2">'+
                    (telCelularPlano ? 
                    '           <input type="text" id="tel_celular_plano" style="width:calc(100% - 15px) !important" tabindex="0" value="'+telCelularPlano+'" disabled> <i onmouseover="return infraTooltipMostrar(\'Conforme informado no termo de ades\u00E3o vigente\');" onmouseout="return infraTooltipOcultar();" class="fas fa-info-circle azulColor" style="cursor:pointer;"></i>' : 
                    '            <input type="text" id="tel_celular" onchange="saveConfigPersonalUser(this)" style="width:calc(100% - 15px) !important" tabindex="0" value="'+(configUser && typeof configUser.tel_celular !== 'undefined' ? configUser.tel_celular : '')+'">'+
                    '')+
                    '       </td>'+
                    '   </tr>'+
                    '</table>';
    return textBox;
}
function saveConfigPersonalUser(this_) {
    removeLocalDataAtiv();
    var _this = $(this_);
    var _parent = _this.closest('.ui-tabs-panel');
    var desabilita_localdata = _parent.find('#panelLocalStorePro').is(':checked');
    var funcoes_experimentais = _parent.find('#panelLabPro').is(':checked');
    var ordenar_paineis = _parent.find('#panelSortPro').is(':checked');
    var ordenar_colunas = _parent.find('#panelSortColumnsPro').is(':checked');
    var visualiza_enviadas = _parent.find('#panelAtividadesViewSend').is(':checked');
    var visualiza_somente_suas = _parent.find('#panelAtividadesViewSelf').is(':checked');
    var visualiza_subordinadas = _parent.find('#panelAtividadesViewSub').is(':checked');
    var horario_inicio = _parent.find('#distribuicao_horario_util_inicio').val();
    var horario_fim = _parent.find('#distribuicao_horario_util_fim').val();
    var tel_celular = _parent.find('#tel_celular').val();
    var config = {
        desabilita_localdata: desabilita_localdata,
        funcoes_experimentais: funcoes_experimentais,
        ordenar_paineis: ordenar_paineis,
        ordenar_colunas: ordenar_colunas,
        visualiza_enviadas: visualiza_enviadas,
        visualiza_somente_suas: visualiza_somente_suas,
        visualiza_subordinadas: visualiza_subordinadas,
        tel_celular: tel_celular,
        distribuicao: {
            horario_util: {
                inicio: horario_inicio, 
                fim: horario_fim
            }
        }
    };
    var action = 'config_update_user_personal';
    var param = {
        action: action,
        config: config
    };
    getServerAtividades(param, action);
    _this.closest('tr').find('td').eq(0).addClass('editCellLoading');
}
function getTableRelatorioPlano(id_plano) {
    resetDialogBoxPro('dialogBoxPro');
    dialogBoxPro = $('#dialogBoxPro')
        .html('<div id="view_doc" class="atividadeWork"><div id="tabs_report-demandas"><div class="dataFallback dataLoading" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></div></div>')
        .dialog({
            title: 'Lista de '+__.Demandas+' do Plano',
            width: $(window).width()-50,
            height: $(window).height()-100,
            open: function() { 
                var action = 'report_demandas';
                var param = {
                    action: action,
                    disabled: 'hide',
                    all_data: false,
                    id_programa: 0,
                    id_plano: id_plano,
                    offset: 0
                };
                getServerAtividades(param, action);
            },
            close: function() { 
                resetDialogBoxPro('dialogBoxPro');
            },
        buttons: [{
            text: 'Imprimir',
            icon: 'ui-icon-print',
            click: function(event) {
                printDocumento();
            }
        },{
            text: 'Ok',
            class: 'confirm',
            click: function(event) {
                $('#view_doc').remove();
                resetDialogBoxPro('dialogBoxPro');
            }
        }]
    });
}
function getTableRelatorioPanel(data, param) {
    var type = param.action.replace('report_','');
    var relatorioID = '#tabs_report-'+type;
    var tabelaRelatorio = $(relatorioID);
    var listRelatorios = data.result;
    var isInitOffset = (typeof data.offset === 'undefined' || data.offset == 0) ? true : false;
    var offset = (typeof data.offset !== 'undefined' && data.offset != 0) ? data.offset : false;
    // var arrayProcessosUnidade = getProcessoUnidadePro();
    var numRegistros = $('#tableRelatorio_'+type+' caption.infraCaption span.count');
        numRegistros = (numRegistros.length > 0) ? parseInt(numRegistros.text()) : 0;
    var novosRegistros = (typeof listRelatorios !== 'undefined' && listRelatorios.length > 0 && listRelatorios != 0) ? listRelatorios.length : 0;
    var totalRegistros = numRegistros+novosRegistros;
    var countRelatorios = (totalRegistros == 1) ? '<span class="count">'+totalRegistros+'</span> registro:' : '<span class="count">'+totalRegistros+'</span> registros:';
    var loadingRegistros = '<span class="progress" style="color: #777;font-size: 0.9em !important;padding: 5px;margin: 5px;"><i class="fas fa-sync fa-spin cinzaColor"></i> carregando dados... <a class="cancel" style="cursor:pointer" onclick="$(this).closest(\'table\').trigger(\'updateAll\');$(this).remove();"><i class="fas fa-times cinzaColor" style="font-size: 100%;"></i></a></span>';
    if (typeof listRelatorios !== 'undefined' && listRelatorios.length > 0 && listRelatorios != 0) {
        var htmlTableRelatorios = getColumnsPanelRelatorios(data, type, isInitOffset, countRelatorios+loadingRegistros);

        var tableRelatorioID = 'tabelaRelatorioPanel_'+type;
        if (isInitOffset) {
            tabelaRelatorio.html('<div id="'+tableRelatorioID+'" class="tabelaPanelScroll" style="margin-top: 5px;">'+htmlTableRelatorios+'<div>');
        } else {
            if ($('#tableRelatorio_'+type+' caption.infraCaption a.cancel').is(':visible')) {
                tabelaRelatorio.show();
            }
        }
        getRowsPanelRelatorios(listRelatorios, type, offset);

        if ($('#tableRelatorio_'+type+' caption.infraCaption a.cancel').is(':visible') && (typeof data.next_offset !== 'undefined' || !data.next_offset) &&  getOptionEntidade('limit_paginacao') != 0) {
            getTabReport(type, 'get', data, data.next_offset, param);
        } else {
            $('#tableRelatorio_'+type+' caption.infraCaption span.progress').remove();
        }
        
        var tableRelatorioElem = $('#'+tableRelatorioID);
        if (!getOptionsPro('panelHeight_relatoriosTabelaPro_'+type) && tableRelatorioElem.height() > 800 && !data.id_plano) { setOptionsPro('panelHeight_relatoriosTabelaPro_'+type, 800) }
        if (!data.id_plano) {
            initPanelResize('#'+tableRelatorioID, 'relatoriosTabelaPro_'+type);
        } else {
            tableRelatorioElem.css('max-height','700px');
        }
        initFunctionPanelRelatorios(data, type);
    } else {
        if (totalRegistros == 0) {
            removeOptionsPro('selectReport_'+type);
            var htmlTableRelatorios = getColumnsPanelRelatorios(data, type, isInitOffset, countRelatorios+loadingRegistros);
                tabelaRelatorio.html('<div id="'+tableRelatorioID+'" class="tabelaPanelScroll" style="margin-top: 5px;">'+htmlTableRelatorios+'<div>');
            var colspan = $('#tableRelatorio_'+type+' thead th').length;
            $('#tableRelatorio_'+type+' tbody').html('<tr><td colspan="'+colspan+'"><div class="dataFallback" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div></td></tr>');
            $('#tableRelatorio_'+type+' caption.infraCaption span.progress').remove();
            initFunctionPanelRelatorios(data, type);
        } else {
            $('#tableRelatorio_'+type+' caption.infraCaption span.progress').remove();
        }
    }
}
function initFunctionPanelRelatorios(data, type) {
    var relatorioTabela = $('#tableRelatorio_'+type);
        relatorioTabela.tablesorter({
            sortLocaleCompare : true,
            /**/
            textExtraction: {
                1 : function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                2 : function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                3 : function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                4 : function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                5 : function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                6 : function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                7 : function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                8 : function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                9 : function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                10: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                11: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                12: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                13: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                14: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                15: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                16: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                17: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                18: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                19: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                20: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                21: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                22: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                23: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                24: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                25: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) },
                26: function (elem, table, cellIndex) { return filterTextExtractDate(elem, table, cellIndex) }
            },
            /**/
            widgets: ["saveSort", "filter"],
            widgetOptions: {
                saveSort: false,
                filter_hideFilters: true,
                filter_columnFilters: true,
                filter_saveFilters: false,
                filter_hideEmpty: true,
                filter_excludeFilter: {}
            },
            sortReset: true
        }).on("filterEnd", function (event, data) {
            $(this).find('caption span.count').text(data.filteredRows);
            $(this).find("tbody > tr:visible > td > input").prop('disabled', false);
            $(this).find("tbody > tr:hidden > td > input").prop('disabled', true);
            calcFilterResume(relatorioTabela);
        });

    if (typeof data.programas !== 'undefined' && data.programas !== null && data.programas.length > 0) {
        var filterRelatorio = relatorioTabela.find('.tablesorter-filter-row').addClass('notCopy').get(0);
        if (typeof filterRelatorio !== 'undefined') {
            var observerFilterRelatorio = new MutationObserver(function(mutations) {
                var _this = $(mutations[0].target);
                var _parent = _this.closest('table');
                var iconFilter = _parent.find('.filterTablePro button');
                var checkIconFilter = iconFilter.hasClass('active');
                var hideme = _this.hasClass('hideme');
                if (hideme && checkIconFilter) {
                    iconFilter.removeClass('active');
                }
            });
            setTimeout(function(){ 

                var btnAllData =    ((!data.id_plano && checkCapacidade('report_alldata')) || (!data.id_plano && typeof arrayConfigAtividades.perfil.nivel !== 'undefined' && arrayConfigAtividades.perfil.nivel !== null && arrayConfigAtividades.perfil.nivel == 1) ? 
                                    '   <div class="viewTableToggle editTableToggle" style="right: 600px;">'+
                                    '           <label class="label" for="changeViewTableRelatorio_'+type+'"><i class="fas fa-university cinzaColor" style="margin: 0px 6px 0 4px;"></i> Toda entidade</label>'+
                                    '           <div class="onoffswitch">'+
                                    '               <input type="checkbox" name="onoffswitch" data-type="'+type+'" onchange="changeViewTableReport(this)" class="onoffswitch-checkbox" id="changeViewTableRelatorio_'+type+'" tabindex="0" '+(getOptionsPro('changeViewTableReport_'+type) == 'show' ? 'checked' : false )+'>'+
                                    '               <label class="onoffswitch-label" for="changeViewTableRelatorio_'+type+'"></label>'+
                                    '           </div>'+
                                    '   </div>'
                                    : '');

                var btnViewDisabled =    (type == 'atividades' ? 
                                    '   <div class="editTableToggle hideDisabledItens" style="right: 440px;top: 50px;">'+
                                    '           <label class="label" for="changeDisabledTableReport_'+type+'"><i class="fas fa-eye-slash '+(getOptionsPro('changeDisabledTableReport_'+type) && getOptionsPro('changeDisabledTableReport_'+type) == 'show' ? 'azulColor' : 'cinzaColor')+'" style="margin: 0px 6px 0 4px;"></i> Inativos</label>'+
                                    '           <div class="onoffswitch">'+
                                    '               <input type="checkbox" name="onoffswitch" data-type="'+type+'" onchange="changeDisabledTableReport(this)" class="onoffswitch-checkbox" id="changeDisabledTableReport_'+type+'" tabindex="0" '+(getOptionsPro('changeDisabledTableReport_'+type) && getOptionsPro('changeDisabledTableReport_'+type) == 'show' ? 'checked' : '')+'>'+
                                    '               <label class="onoffswitch-label" for="changeDisabledTableReport_'+type+'"></label>'+
                                    '           </div>'+
                                    '   </div>'
                                    : '');

                var selectListProgramas = (type != 'atividades' && !data.id_plano) ? '<select id="selectReportProgramas_'+type+'" data-type="'+type+'" onchange="changeReportPrograma(this)" data-placeholder="Filtrar por programa de gest\u00E3o" style="max-width: 260px; width: 300px; float: right;" class="selectPro chosen-min"><option value="0" data-label="">&nbsp;</option></select>' : '';

                var htmlFilterRelatorio =   '<div class="btn-group filterTablePro notCopy" role="group" style="right: 55px;top: 50px;z-index: 999;position: absolute;">'+
                                            '   '+selectListProgramas+
                                            '   <button type="button" onclick="downloadTablePro(this)" data-icon="fas fa-download" style="padding: 0.1rem .5rem; font-size: 9pt; margin-left: 20px;" data-value="Baixar" class="btn btn-sm btn-light">'+
                                            '       <i class="fas fa-download" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                            '       <span class="text">Baixar</span>'+
                                            '   </button>'+
                                            '   <button type="button" onclick="copyTablePro(this)" data-icon="fas fa-copy" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="Copiar" class="btn btn-sm btn-light">'+
                                            '       <i class="fas fa-copy" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                            '       <span class="text">Copiar</span>'+
                                            '   </button>'+
                                            '   <button type="button" onclick="filterTablePro(this)" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="Pesquisar" class="btn btn-sm btn-light '+(relatorioTabela.find('tr.tablesorter-filter-row').hasClass('hideme') ? '' : 'active')+'">'+
                                            '       <i class="fas fa-search" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                            '       Pesquisar'+
                                            '   </button>'+
                                            '</div>';
                    relatorioTabela.find('thead .filterTablePro').remove();
                    relatorioTabela.find('thead').prepend(btnAllData+btnViewDisabled+htmlFilterRelatorio);
                    observerFilterRelatorio.observe(filterRelatorio, {
                        attributes: true
                    });
                    calcFilterResume(relatorioTabela);
                    setSelectProgramas(data.programas, 'selectReportProgramas_'+type, 'selectReport_'+type);

                    $('div[id*="selectReport"]').on('click', function(){
                        if ($(this).find('.chosen-drop').is(':visible')) {
                            $(this).closest('.btn-group').css('z-index', '9999');
                        } else {
                            $(this).closest('.btn-group').css('z-index', '999');
                        }
                    });
            }, 500);
            $.getScript(URL_SPRO+"js/lib/jquery-visible.min.js");
        }
    }
    relatorioTabela.find('.tablesorter-filter-row input.tablesorter-filter[aria-label*="Data"]').attr('type','date');
    if (data.id_plano) {
        setTimeout(function(){ 
            relatorioTabela.before('<div id="statusUserPlano" style="width:700px;display: inline-block;"><canvas id="chartStatusUserPlano" width="700" height="100"></canvas></div>');

            var element = $('#chartStatusUserPlano');
            var plano = jmespath.search(data.planos, "[?id_plano==`"+data.id_plano+"`] | [0]");
                plano = (plano === null) ? jmespath.search(tableConfigList.planos, "[?id_plano==`"+data.id_plano+"`] | [0]") : null;
                plano = (plano === null) ? jmespath.search(arrayConfigAtividades.planos, "[?id_plano==`"+data.id_plano+"`] | [0]") : null;
                plano = (plano !== null) ? plano : false;
            var mostrar_notas = plano ? jmespath.search(arrayConfigAtividades.unidades, "[?id_unidade==`"+plano.id_unidade+"`] | [0].config.planos.mostrar_notas") : false;
            var apelido_display = (mostrar_notas !== null && mostrar_notas) ? 'apelido_avaliacao' : 'apelido';
            var chartStatusUser = getSingleChartTempoPlano(element, plano, plano[apelido_display]);
                chartStatusUser.options.scales.xAxes[0].ticks.display = false;
                chartStatusUser.update();
        }, 1000);
    }
}
function getColumnsPanelRelatorios(data, type, isInitOffset, captionReport) {
    var htmlTableRelatorios = '';
    if (type == 'demandas' || type == 'demandas_excluidas') {
        htmlTableRelatorios =   (isInitOffset) ? 
                                '<table id="tableRelatorio_'+type+'" data-name-table="Relatorio_'+type+'" style="width: max-content !important; margin-top: '+(!data.id_plano ? '20px': '-30px')+';" class="tableInfo tableZebra tableFollow tableAtividades tableRelatorioView" data-tabletype="relatorios">'+
                                '   <caption class="infraCaption" style="text-align: left; margin-top: 20px;">'+captionReport+'</caption>'+
                                '   <thead>'+
                                '       <tr class="tableHeader" style="height: 30px;">'+  
                                '           <th class="tituloControle" style="width: 50px;">ID</th>'+
                                (type == 'demandas_excluidas' && checkCapacidade('restory_atividade') ?
                                '           <th class="tituloControle" style="width: 100px;">A\u00E7\u00E3o</th>'+
                                '' : '')+
                                '           <th class="tituloControle" style="width: 80px;">Unidade <div class="filterResume" data-resumemod="dist" data-resumetype="sigla_unidade"></div></th>'+
                                '           <th class="tituloControle" style="width: 210px;">Processo <div class="filterResume" data-resumemod="dist" data-resumetype="processo"></div></th>'+
                                (checkOptionEntidade('dispensa_tipos_requisicao') ? '' : 
                                '           <th class="tituloControle" style="width: 180px;">Requisi\u00E7\u00E3o <div class="filterResume" data-resumemod="dist" data-resumetype="requisicao"></div></th>'+
                                '' )+
                                '           <th class="tituloControle" style="width: 400px;">'+__.Assunto+'</th>'+
                                '           <th class="tituloControle" style="width: 400px;">'+__.Atividade+' <div class="filterResume" data-resumemod="dist" data-resumetype="nome_atividade"></div></th>'+
                                '           <th class="tituloControle" style="width: 400px;">Macro'+__.atividade+' <div class="filterResume" data-resumemod="dist" data-resumetype="macroatividade"></div></th>'+
                                '           <th class="tituloControle" style="width: 180px;">Etiquetas</th>'+
                                '           <th class="tituloControle" style="width: 180px;">Plano de Trabalho <div class="filterResume" data-resumemod="dist" data-resumetype="plano"></div></th>'+
                                '           <th class="tituloControle" style="width: 180px;">Respons\u00E1vel <div class="filterResume" data-resumemod="dist" data-resumetype="responsavel"></div></th>'+
                                '           <th class="tituloControle" style="width: 140px;">Tempo Planejado (horas) <div class="filterResume" data-resumemod="sum" data-resumetype="tempo_planejado"></div></th>'+
                                '           <th class="tituloControle" style="width: 120px;">Dias de Planejamento <div class="filterResume" data-resumemod="avg" data-resumetype="dias_planejado"></div></th>'+
                                '           <th class="tituloControle tituloFilter sorter-date-range-dmy" style="width: 100px;">Data de Distribui\u00E7\u00E3o</th>'+
                                '           <th class="tituloControle tituloFilter sorter-date-range-dmy" style="width: 100px;">Prazo de Entrega</th>'+
                                '           <th class="tituloControle" style="width: 140px;">Tempo Pactuado (horas) <div class="filterResume" data-resumemod="sum" data-resumetype="tempo_pactuado"></div></th>'+
                                '           <th class="tituloControle" style="width: 120px;">Fator de '+__.Complexidade+' <div class="filterResume" data-resumemod="avg" data-resumetype="fator_complexidade"></div></th>'+
                                '           <th class="tituloControle tituloFilter sorter-date-range-dmy" style="width: 100px;">Data de In\u00EDcio</th>'+
                                '           <th class="tituloControle tituloFilter sorter-date-range-dmy" style="width: 100px;">Data de Conclus\u00E3o</th>'+
                                '           <th class="tituloControle" style="width: 210px;">Status Entrega</th>'+
                                '           <th class="tituloControle" style="width: 210px;">Documento Entregue <div class="filterResume" data-resumemod="dist" data-resumetype="documento_entregue"></div></th>'+
                                '           <th class="tituloControle" style="width: 140px;">Tempo Despendido (horas) <div class="filterResume" data-resumemod="sum" data-resumetype="tempo_despendido"></div></th>'+
                                (!checkOptionEntidade('desativa_produtividade_geral') ? 
                                '           <th class="tituloControle" style="width: 120px;">Produtividade por agilidade<div class="filterResume" data-resumemod="avg" data-resumetype="produtividade"></div></th>'+
                                '           <th class="tituloControle" style="width: 120px;">Produtividade por antecipa\u00E7\u00E3o <div class="filterResume" data-resumemod="avg" data-resumetype="produtividade_executada"></div></th>'+
                                '' : '')+
                                '           <th class="tituloControle" style="width: 140px;">Tempo Homologado (horas) <div class="filterResume" data-resumemod="sum" data-resumetype="tempo_homologado"></div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Nota Atribu\u00EDda <div class="filterResume" data-resumemod="avg" data-resumetype="nota_atribuida"></div></th>'+
                                '           <th class="tituloControle" style="width: 120px;">Coment\u00E1rios</th>'+
                                '           <th class="tituloControle" style="width: 120px;">Justificativas</th>'+
                                '           <th class="tituloControle tituloFilter sorter-date-range-dmy" style="width: 100px;">Data de Avalia\u00E7\u00E3o</th>'+
                                '           <th class="tituloControle tituloFilter sorter-date-range-dmy" style="width: 100px;">Data de '+__.Arquivamento+'</th>'+
                                '           <th class="tituloControle tituloFilter sorter-date-range-dmy" style="width: 100px;">\u00DAltima Atualiza\u00E7\u00E3o</th>'+
                                '       </tr>'+
                                '   </thead>'+
                                '   <tbody>'
                                : '';
    } else if (type == 'planos') {
        htmlTableRelatorios =   (isInitOffset) ? 
                                '<table id="tableRelatorio_'+type+'" data-name-table="Relatorio_'+type+'" style="width: max-content !important; margin-top: 20px;" class="tableInfo tableZebra tableFollow tableAtividades tableRelatorioView" data-tabletype="relatorios">'+
                                '   <caption class="infraCaption" style="text-align: left; margin-top: 20px;">'+captionReport+'</caption>'+
                                '   <thead>'+
                                '       <tr class="tableHeader" style="height: 30px;">'+  
                                '           <th class="tituloControle" style="width: 50px;">ID</th>'+
                                '           <th class="tituloControle" style="width: 80px;">Status</th>'+
                                '           <th class="tituloControle" style="width: 100px;">Unidade <div class="filterResume" data-resumemod="dist" data-resumetype="sigla_unidade"></div></th>'+
                                '           <th class="tituloControle" style="width: 210px;">Nome Completo <div class="filterResume" data-resumemod="dist" data-resumetype="nome_completo"></div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Apelido <div class="filterResume" data-resumemod="dist" data-resumetype="apelido"></div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Matr\u00EDcula <div class="filterResume" data-resumemod="dist" data-resumetype="matricula"></div></th>'+
                                '           <th class="tituloControle">Tipo de Modalidade <div class="filterResume" data-resumemod="dist" data-resumetype="nome_modalidade"></div></th>'+
                                '           <th class="tituloControle" style="width: 100px;">Carga Hor\u00E1ria <div class="filterResume" data-resumemod="avg" data-resumetype="carga_horaria"><div></th>'+
                                '           <th class="tituloControle" style="width: 150px;">Data de In\u00EDcio</th>'+
                                '           <th class="tituloControle" style="width: 150px;">Data de Encerramento</th>'+
                                '           <th class="tituloControle" style="width: 80px;">Meta Total do Plano (horas) <div class="filterResume" data-resumemod="sum" data-resumetype="tempo_total"><div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Meta Parcial do Plano (horas) <div class="filterResume" data-resumemod="sum" data-resumetype="tempo_proporcional"><div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Tempo Pactuado (horas) <div class="filterResume" data-resumemod="sum" data-resumetype="tempo_entregue"><div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Tempo Entregue (horas) <div class="filterResume" data-resumemod="sum" data-resumetype="tempo_entregue"><div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Tempo Homologado (horas) <div class="filterResume" data-resumemod="sum" data-resumetype="tempo_homologado"><div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Tempo Despendido (horas) <div class="filterResume" data-resumemod="sum" data-resumetype="tempo_despendido"><div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Quantidade de demandas <div class="filterResume" data-resumemod="sum" data-resumetype="quantidade_demandas"><div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Execu\u00E7\u00E3o do Plano <div class="filterResume" data-resumemod="avg" data-resumetype="execucao_plano"><div></th>'+
                                (!checkOptionEntidade('desativa_produtividade_geral') ? 
                                '           <th class="tituloControle" style="width: 80px;">Produtividade do Plano <div class="filterResume" data-resumemod="avg" data-resumetype="produtividade_plano"><div></th>'+
                                '' : '')+
                                '           <th class="tituloControle" style="width: 80px;">Nota M\u00E9dia Atribu\u00EDda <div class="filterResume" data-resumemod="avg" data-resumetype="nota_media"><div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Total de Avalia\u00E7\u00F5es <div class="filterResume" data-resumemod="sum" data-resumetype="total_avaliacoes"><div></th>'+
                                '           <th class="tituloControle" style="">Assinatura</th>'+
                                '           <th class="tituloControle" style="">Status Assinatura</th>'+
                                '       </tr>'+
                                '   </thead>'+
                                '   <tbody>'
                                : '';
    } else if (type == 'atividades') {
        htmlTableRelatorios =   (isInitOffset) ? 
                                '<table id="tableRelatorio_'+type+'" data-name-table="Relatorio_'+type+'" style="width: max-content !important; margin-top: 20px;" class="tableInfo tableZebra tableFollow tableAtividades tableRelatorioView" data-tabletype="relatorios">'+
                                '   <caption class="infraCaption" style="text-align: left; margin-top: 20px;">'+captionReport+'</caption>'+
                                '   <thead>'+
                                '       <tr class="tableHeader" style="height: 30px;">'+  
                                '           <th class="tituloControle" style="width: 50px;">ID</th>'+
                                '           <th class="tituloControle" style="width: 80px;">Status</th>'+
                                '           <th class="tituloControle" style="width: 210px;">Nome da Atividade</th>'+
                                '           <th class="tituloControle" style="width: 120px;">Macroatividade</th>'+
                                '           <th class="tituloControle" style="width: 100px;">Sigla da Unidade</th>'+
                                '           <th class="tituloControle" style="width: 120px;">Processo da Cadeia de Valor</th>'+
                                '           <th class="tituloControle" style="width: 80px;">Tempo Pactuado <div class="filterResume" data-resumemod="avg" data-resumetype="tempo_pactuado"><div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Dias de Planejamento <div class="filterResume" data-resumemod="avg" data-resumetype="dias_planejado"><div></th>'+
                                '           <th class="tituloControle" style="width: 100px;">Entregas</th>'+
                                '           <th class="tituloControle" style="width: 150px;">Par\u00E2metros</th>'+
                                '           <th class="tituloControle" style="width: 150px;">'+__.Complexidade+'</th>'+
                                '           <th class="tituloControle" style="width: 80px;">Data In\u00EDcio de Vig\u00EAncia</th>'+
                                '           <th class="tituloControle" style="width: 80px;">Data Fim de Vig\u00EAncia</th>'+
                                '           <th class="tituloControle" style="width: 80px;">Recalcula Prazo</th>'+
                                '           <th class="tituloControle" style="width: 80px;">Tempo M\u00EDnimo <div class="filterResume" data-resumemod="avg" data-resumetype="tempo_minimo"><div></th>'+
                                '           <th class="tituloControle" style="width: 80px;">Tipos de Processos</th>'+
                                '           <th class="tituloControle" style="width: 80px;">Homologado</th>'+
                                '       </tr>'+
                                '   </thead>'+
                                '   <tbody>'
                                : '';
    } else if (type == 'afastamentos') {
        htmlTableRelatorios =   (isInitOffset) ? 
                                '<table id="tableRelatorio_'+type+'" data-name-table="Relatorio_'+type+'" style="width: max-content !important; margin-top: 20px;" class="tableInfo tableZebra tableFollow tableAtividades tableRelatorioView" data-tabletype="relatorios">'+
                                '   <caption class="infraCaption" style="text-align: left; margin-top: 20px;">'+captionReport+'</caption>'+
                                '   <thead>'+
                                '       <tr class="tableHeader" style="height: 30px;">'+  
                                '           <th class="tituloControle" style="width: 50px;">ID</th>'+
                                '           <th class="tituloControle" style="width: 80px;">Status</th>'+
                                '           <th class="tituloControle">Nome Completo</th>'+
                                '           <th class="tituloControle" style="width: 210px;">Matr\u00EDcula</th>'+
                                '           <th class="tituloControle">Tipo de Afastamento</th>'+
                                '           <th class="tituloControle">Observa\u00E7\u00F5es</th>'+
                                '           <th class="tituloControle" style="width: 120px;">Data In\u00EDcio</th>'+
                                '           <th class="tituloControle" style="width: 120px;">Data Fim</th>'+
                                '       </tr>'+
                                '   </thead>'+
                                '   <tbody>'
                                : '';
    } else if (type == 'produtividade') {
        htmlTableRelatorios =   (isInitOffset) ? 
                                '<table id="tableRelatorio_'+type+'" data-name-table="Relatorio_'+type+'" style="width: max-content !important; margin-top: 20px;" class="tableInfo tableZebra tableFollow tableAtividades tableRelatorioView" data-tabletype="relatorios">'+
                                '   <caption class="infraCaption" style="text-align: left; margin-top: 20px;">'+captionReport+'</caption>'+
                                '   <thead>'+
                                '       <tr class="tableHeader" style="height: 30px;">'+  
                                '           <th class="tituloControle">Nome Completo</th>'+
                                '           <th class="tituloControle" style="width: 210px;">Matr\u00EDcula</th>'+
                                '           <th class="tituloControle" style="width: 210px;">Unidade</th>'+
                                '           <th class="tituloControle">Per\u00EDodo</th>'+
                                '           <th class="tituloControle">M\u00E9dia de Avalia\u00E7\u00F5es</th>'+
                                '           <th class="tituloControle">Total de Avalia\u00E7\u00F5es</th>'+
                                '           <th class="tituloControle">Produtividade por agilidade<br>(% M\u00E9dia)</th>'+
                                '           <th class="tituloControle">Produtividade por antecipa\u00E7\u00E3o <br>(% M\u00E9dia)</th>'+
                                '       </tr>'+
                                '   </thead>'+
                                '   <tbody>'
                                : '';
    } else if (type == 'prescricoes') {
        htmlTableRelatorios =   (isInitOffset) ? 
                                '<table id="tableRelatorio_'+type+'" data-name-table="Relatorio_'+type+'" style="width: max-content !important; margin-top: 20px;" class="tableInfo tableZebra tableFollow tableAtividades tableRelatorioView" data-tabletype="relatorios">'+
                                '   <caption class="infraCaption" style="text-align: left; margin-top: 20px;">'+captionReport+'</caption>'+
                                '   <thead>'+
                                '       <tr class="tableHeader" style="height: 30px;">'+  
                                '           <th class="tituloControle" style="width: 210px;">Processo</th>'+
                                '           <th class="tituloControle" style="width: 400px;">Tipo de '+__.Prescricao+'</th>'+
                                '           <th class="tituloControle">Status</th>'+
                                '           <th class="tituloControle">Prazo (Dias)</th>'+
                                '           <th class="tituloControle">Dias Decorridos</th>'+
                                '           <th class="tituloControle">% Decorrida</th>'+
                                '           <th class="tituloControle" style="width: 400px;">\u00DAltimo Documento Vinculado</th>'+
                                '           <th class="tituloControle">Data</th>'+
                                '       </tr>'+
                                '   </thead>'+
                                '   <tbody>'
                                : '';
    }
    htmlTableRelatorios +=  (isInitOffset) ? 
                                '   </tbody>'+
                                '</table>'
                            : '';
    return htmlTableRelatorios;
}
function getRowsPanelRelatorios(storeRelatorios, type, offset) {
    var tableReport = $('#tableRelatorio_'+type);
    var tableReportBody = $('#tableRelatorio_'+type+' tbody');

    function setRowsPanelRelatorios(value, index) {
        if (type == 'demandas' || type == 'demandas_excluidas') {
            var linkProc = (parseInt(value.id_procedimento) == 0) ? '' : url_host+'?acao=procedimento_trabalhar&id_procedimento='+value.id_procedimento;
            var linkReq = (parseInt(value.id_documento_requisicao) == 0) ? '' : url_host+'?acao=procedimento_trabalhar&id_procedimento='+value.id_procedimento+'&id_documento='+value.id_documento_requisicao;
            var linkDoc = (parseInt(value.id_documento_entregue) == 0) ? '' : url_host+'?acao=procedimento_trabalhar&id_procedimento='+value.id_procedimento+'&id_documento='+value.id_documento_requisicao;
            var documentoTips = (typeof value.documento_sei !== 'undefined' && value.documento_sei !== null && value.documento_sei != '' && parseInt(value.documento_sei) != 0) ? value.nome_documento+' ('+value.documento_sei+')' : value.nome_documento;
                documentoTips = (documentoTips === null) ? false : documentoTips;
            var requisicaoTips = (typeof value.requisicao_sei !== 'undefined' && value.requisicao_sei !== null && value.requisicao_sei != '' && parseInt(value.requisicao_sei) != 0) ? value.nome_requisicao+' ('+value.requisicao_sei+')' : value.nome_requisicao;
                requisicaoTips = (requisicaoTips === null) ? false : requisicaoTips;
            var iconProcesso = ( $.inArray(value.processo_sei, arrayProcessosUnidade) == -1 ) ? 'fas fa-folder' : 'far fa-folder-open';
            var tipsProcesso = ( $.inArray(value.processo_sei, arrayProcessosUnidade) == -1 ) ? 'Processo fechado nesta unidade' : 'Processo aberto nesta unidade';
            var nameUser = (value.id_user != 0 ? value.nome_completo : 'N\u00E3o atribu\u00EDdo');
            var planoUser = (typeof value.id_user !== 'undefined' && typeof value.id_plano !== 'undefined' && value.id_user != 0 && value.id_plano != 0 && typeof value.plano !== 'undefined' &&  typeof value.plano.data_inicio_vigencia !== 'undefined' && typeof value.plano.data_fim_vigencia !== 'undefined') 
                        ? '#'+value.id_plano+' '+moment(value.plano.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(value.plano.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY') 
                        : 'N\u00E3o vinculado';
            var iconRequisicao = (value.data_entrega == '0000-00-00 00:00:00') ? 'far fa-list-alt' : 'fas fa-list-alt'; 

            var processoHtml = (value.processo_sei !== null && value.processo_sei != '')
                        ? '               <a '+(linkProc == '' ? 'style="cursor: auto;"' : 'style="text-decoration: underline;" class="bLink" href="'+linkProc+'" target="_blank"')+'>'+
                        '                   <i class="'+iconProcesso+' '+(linkProc == '' ? '' : 'bLink')+'" '+(linkProc == '' ? 'style="color: #a2a2a2;"' : 'style="text-decoration: underline;"')+'></i> '+
                        '                   <span '+(linkProc == '' ? '' : 'class="bLink"')+'></i> '+
                        '                       '+value.processo_sei+
                        '                   </span>'+
                        '               </a>'
                        : '';

            var requisicaoHtml =    (!requisicaoTips) ? '' : 
                                    '               <a '+(linkReq == '' ? 'style="cursor: auto;"' : 'style="text-decoration: underline;" class="bLink" href="'+linkReq+'" target="_blank"')+'>'+
                                    '                   <i class="'+iconRequisicao+' '+(linkReq == '' ? '' : 'bLink')+'" '+(linkReq == '' ? 'style="color: #a2a2a2;"' : 'style="text-decoration: underline;"')+' onmouseover="return infraTooltipMostrar(\''+requisicaoTips+'\');" onmouseout="return infraTooltipOcultar();"></i> '+
                                    '                   <span '+(linkReq == '' ? '' : 'class="bLink"')+'></i> '+
                                    '                       '+requisicaoTips+
                                    '                   </span>'+
                                    '               </a>';

            var documentoHtml =     (!documentoTips || value.data_entrega == '0000-00-00 00:00:00') ? '' : 
                                    '               <a '+(linkDoc == '' ? 'style="cursor: auto;"' : 'style="text-decoration: underline;" class="bLink" href="'+linkDoc+'" target="_blank"')+'>'+
                                    '                   <i class="'+iconRequisicao+' '+(linkDoc == '' ? '' : 'bLink')+'" '+(linkDoc == '' ? 'style="color: #a2a2a2;"' : 'style="text-decoration: underline;"')+' onmouseover="return infraTooltipMostrar(\''+documentoTips+'\');" onmouseout="return infraTooltipOcultar();"></i> '+
                                    '                   <span '+(linkDoc == '' ? '' : 'class="bLink"')+'></i> '+
                                    '                       '+documentoTips+
                                    '                   </span>'+
                                    '               </a>';

            var statusAtividade = (moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss') < moment()) ? 'Atrasado' : 'No prazo';
                statusAtividade = (value.data_entrega != '0000-00-00 00:00:00' && moment(value.data_entrega,'YYYY-MM-DD HH:mm:ss') <= moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss')) ? 'Entregue no prazo' : statusAtividade;
                statusAtividade = (value.data_entrega != '0000-00-00 00:00:00' && moment(value.data_entrega,'YYYY-MM-DD HH:mm:ss') > moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss')) ? 'Entregue fora do prazo' : statusAtividade;
                            

            var htmlTableRelatorios =   '       <tr data-tagname="SemGrupo" data-index="'+index+'" data-id="'+value.id_demanda+'">'+
                                        '           <td align="center">'+value.id_demanda+'</td>'+
                                        (type == 'demandas_excluidas' && checkCapacidade('restory_atividade') ?
                                        '           <td align="center"><a class="newLink info_noclick" style="font-size: 9pt;" onclick="parent.recoveryDemanda(this, '+value.id_demanda+')">'+
                                        '               <i class="fas fa-undo" style="padding-right: 3px;"></i>Restaurar</a>'+
                                        '           </td>'+
                                        '' : '')+
                                        '           <td align="left" class="filterResume_sigla_unidade">'+value.sigla_unidade+'</td>'+
                                        '           <td align="left" class="filterResume_processo">'+processoHtml+'</td>'+
                                        (checkOptionEntidade('dispensa_tipos_requisicao') ? '' : 
                                        '           <td align="left" class="filterResume_requisicao">'+requisicaoHtml+'</td>'+
                                        '' )+
                                        '           <td align="left">'+value.assunto+'</td>'+
                                        '           <td align="left" class="filterResume_nome_atividade">'+(value.nome_atividade === null ? '': value.nome_atividade)+'</td>'+
                                        '           <td align="left" class="filterResume_macroatividade">'+(value.macroatividade === null ? '' : value.macroatividade)+'</td>'+
                                        '           <td align="left">'+(value.etiquetas ? value.etiquetas.join('; ') : '')+'</td>'+
                                        '           <td align="left" class="filterResume_plano">'+planoUser+'</td>'+
                                        '           <td align="left" class="filterResume_responsavel">'+nameUser+'</td>'+
                                        '           <td align="center" class="filterResume_tempo_planejado">'+value.tempo_planejado+'</td>'+
                                        '           <td align="center" class="filterResume_dias_planejado">'+value.dias_planejado+'</td>'+
                                        '           <td align="center">'+
                                        '               <span class="info_dates_fav" data-time-sorter="'+value.data_distribuicao+'">'+
                                        '                   '+(value.data_distribuicao == '0000-00-00 00:00:00' ? '' : moment(value.data_distribuicao, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm'))+
                                        '               </span>'+
                                        '           </td>'+
                                        '           <td align="center">'+
                                        '               <span class="info_dates_fav" data-time-sorter="'+value.prazo_entrega+'">'+
                                        '                   '+(value.prazo_entrega == '0000-00-00 00:00:00' ? '' : moment(value.prazo_entrega, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm'))+
                                        '               </span>'+
                                        '           </td>'+
                                        '           <td align="center" class="filterResume_tempo_pactuado">'+value.tempo_pactuado+'</td>'+
                                        '           <td align="center" class="filterResume_fator_complexidade">'+value.fator_complexidade+'</td>'+
                                        '           <td align="center">'+
                                        '               <span class="info_dates_fav" data-time-sorter="'+value.data_inicio+'">'+
                                        '                   '+(value.data_inicio == '0000-00-00 00:00:00' ? '' : moment(value.data_inicio, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm'))+
                                        '               </span>'+
                                        '           </td>'+
                                        '           <td align="center">'+
                                        '               <span class="info_dates_fav" data-time-sorter="'+value.data_entrega+'">'+
                                        '                   '+(value.data_entrega == '0000-00-00 00:00:00' ? '' : moment(value.data_entrega, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm'))+
                                        '               </span>'+
                                        '           </td>'+
                                        '           <td align="left">'+statusAtividade+'</td>'+
                                        '           <td align="left" class="filterResume_documento_entregue">'+documentoHtml+'</td>'+
                                        '           <td align="center" class="filterResume_tempo_despendido">'+value.tempo_despendido+'</td>'+
                                        (!checkOptionEntidade('desativa_produtividade_geral') ? 
                                        '           <td align="left" class="filterResume_produtividade">'+(value.produtividade == 0 ? '' : ((value.produtividade*100).toFixed(2)+'%'))+'</td>'+
                                        '           <td align="left" class="filterResume_produtividade_executada">'+(value.produtividade_executada == 0 ? '' : ((value.produtividade_executada*100).toFixed(2)+'%'))+'</td>'+
                                        '' : '')+
                                        '           <td align="center" class="filterResume_tempo_homologado">'+value.tempo_homologado+'</td>'+
                                        '           <td align="center" class="filterResume_nota_atribuida">'+(value.avaliacao == 0 ? '' : value.avaliacao.nota_atribuida)+'</td>'+
                                        '           <td align="left">'+(value.avaliacao == 0 ? '' : value.avaliacao.comentarios)+'</td>'+
                                        '           <td align="left">'+(value.avaliacao == 0 ? '' : $.map(value.avaliacao.justificativas, function(v){ return v.nome_justificativa }).join(', '))+'</td>'+
                                        '           <td align="center">'+
                                        '               <span class="info_dates_fav" data-time-sorter="'+value.data_avaliacao+'">'+
                                        '                   '+(value.data_avaliacao == '0000-00-00 00:00:00' ? '' : moment(value.data_avaliacao, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm'))+
                                        '               </span>'+
                                        '           </td>'+
                                        '           <td align="center">'+
                                        '               <span class="info_dates_fav" data-time-sorter="'+value.data_envio+'">'+
                                        '                   '+(value.data_envio == '0000-00-00 00:00:00' ? '' : moment(value.data_envio, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm'))+
                                        '               </span>'+
                                        '           </td>'+
                                        '           <td align="center">'+
                                        '               <span class="info_dates_fav" data-time-sorter="'+value.datetime+'">'+
                                        '                   '+(value.datetime == '0000-00-00 00:00:00' ? '' : moment(value.datetime, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm'))+
                                        '               </span>'+
                                        '           </td>'+
                                        '       </tr>';
        } else if (type == 'planos') {
            var status = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? 'DESATIVADO' : 'ATIVO';
                status = (moment(value.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss') < moment()) ? 'ENCERRADO' : status;
                status = (moment(value.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss') > moment()) ? 'FUTURO' : status;

            var modalidade = jmespath.search(arrayConfigAtividades.tipos_modalidades,"[?id_tipo_modalidade==`"+value.id_tipo_modalidade+"`] | [0]");
            var view_modelos = (modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('modelos')) ? modalidade.config.modelos : false;        
            var assinatura = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.assinatura !== 'undefined' && value.config.hasOwnProperty('assinatura')) ? value.config.assinatura : false;
            var statusAssinatura = (view_modelos) ? (assinatura ? 'Documento assinado eletronicamente por '+assinatura[0].nome_completo+', em '+moment(assinatura[0].datetime,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm') : 'Termo de Ades\u00E3o pendente de assinatura') : 'Assinatura indispon\u00EDvel';
                statusAssinatura = (status == 'FUTURO' && !assinatura) 
                                ? 'Dispon\u00EDvel para assinatura ap\u00F3s iniciada a vig\u00EAncia do plano' 
                                : statusAssinatura;
            var btnAssinatura = (view_modelos) ? '<a class="newLink viewModelDoc" data-type="'+type+'" data-sign="true" data-user="'+value.id_user+'" data-id_reference="'+value.id_plano+'" data-icon="pencil-alt" data-action="view" data-mode="modelo_termo_adesao" data-title="Termo de Ades\u00E3o" onclick="editModelConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;" onmouseover="return infraTooltipMostrar(\''+statusAssinatura+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature '+(assinatura ? 'azulColor' : 'cinzaColor')+'" style="font-size: 100%;"></i> <i class="fas fa-'+(assinatura ? 'user-edit azulColor' : 'pencil-alt cinzaColor')+'" style="font-size: 100%; margin-left: -10px;"></i></a>' : '';
                btnAssinatura = (status == 'FUTURO' && !assinatura) 
                                ? '<a class="newLink viewModelDoc" style="cursor: pointer; margin: 5px;display: inline-block;" onmouseover="return infraTooltipMostrar(\''+statusAssinatura+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-signature cinzaColor" style="font-size: 100%;"></i> <i class="fas fa-pencil-alt cinzaColor" style="font-size: 100%; margin-left: -10px;"></i></a>' 
                                : btnAssinatura;
            var execucao_plano = (value.tempo_proporcional > 0) ? ((value.tempo_homologado/value.tempo_proporcional)*100).toFixed(2)+'%' : '0%';
            var produtividade_plano = (value.tempo_despendido > 0) ? ((value.tempo_pactuado/value.tempo_despendido)*100).toFixed(2)+'%' : '0%';
            var nota_media = (typeof value.avaliacao !== 'undefined' && value.avaliacao !== null && typeof value.avaliacao.nota_atribuida !== 'undefined' && value.avaliacao.hasOwnProperty('nota_atribuida') && value.avaliacao.nota_atribuida !== null) ? value.avaliacao.nota_atribuida : '-';
            var total_avaliacoes = (typeof value.avaliacao !== 'undefined' && value.avaliacao !== null && typeof value.avaliacao.total_avaliacoes !== 'undefined' && value.avaliacao.hasOwnProperty('total_avaliacoes') && value.avaliacao.total_avaliacoes !== null) ? value.avaliacao.total_avaliacoes : '-';
            var htmlTableRelatorios =   '       <tr data-tagname="SemGrupo" data-index="'+index+'">'+
                                        '           <td align="center">'+value.id_plano+'</td>'+
                                        '           <td align="center">'+status+'</td>'+
                                        '           <td align="center" class="filterResume_sigla_unidade">'+value.sigla_unidade+'</td>'+
                                        '           <td align="left" class="filterResume_nome_completo">'+value.nome_completo+'</td>'+
                                        '           <td align="left" class="filterResume_apelido">'+value.apelido+'</td>'+
                                        '           <td align="left" class="filterResume_matricula">'+value.matricula+'</td>'+
                                        '           <td align="left" class="filterResume_nome_modalidade">'+value.nome_modalidade+'</td>'+
                                        '           <td align="left" class="filterResume_carga_horaria">'+value.carga_horaria+'</td>'+
                                        '           <td align="left" style="text-align:center;" data-time-sorter="'+moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD')+'">'+moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</td>'+
                                        '           <td align="left" style="text-align:center;" data-time-sorter="'+moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD')+'">'+moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+'</td>'+
                                        '           <td align="left" class="filterResume_tempo_total" style="text-align: center;">'+parseFloat(value.tempo_total.toFixed(2))+'</td>'+
                                        '           <td align="left" class="filterResume_tempo_proporcional" style="text-align: center;">'+parseFloat(value.tempo_proporcional.toFixed(2))+'</td>'+
                                        '           <td align="left" class="filterResume_tempo_pactuado" style="text-align: center;">'+parseFloat(value.tempo_pactuado.toFixed(2))+'</td>'+
                                        '           <td align="left" class="filterResume_tempo_entregue" style="text-align: center;">'+parseFloat(value.tempo_entregue.toFixed(2))+'</td>'+
                                        '           <td align="left" class="filterResume_tempo_homologado" style="text-align: center;">'+parseFloat(value.tempo_homologado.toFixed(2))+'</td>'+
                                        '           <td align="left" class="filterResume_tempo_despendido" style="text-align: center;">'+parseFloat(value.tempo_despendido.toFixed(2))+'</td>'+
                                        '           <td align="left" class="filterResume_quantidade_demandas" style="text-align: center;">'+value.quantidade_demandas+'</td>'+
                                        '           <td align="left" class="filterResume_execucao_plano" style="text-align: center;">'+execucao_plano+'</td>'+
                                        (!checkOptionEntidade('desativa_produtividade_geral') ? 
                                        '           <td align="left" class="filterResume_produtividade_plano" style="text-align: center;">'+produtividade_plano+'</td>'+
                                        '' : '')+
                                        '           <td align="left" class="filterResume_nota_media" style="text-align: center;">'+nota_media+'</td>'+
                                        '           <td align="left" class="filterResume_total_avaliacoes" style="text-align: center;">'+total_avaliacoes+'</td>'+
                                        '           <td align="left" style="text-align: center;">'+btnAssinatura+'</td>'+
                                        '           <td align="left" style="">'+statusAssinatura+'</td>'+
                                        '       </tr>';
        } else if (type == 'atividades') {
            var status = (moment(value.data_fim,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_fim != '0000-00-00 00:00:00') ? 'DESATIVADO' : 'ATIVO';
                status = (moment(value.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss') < moment()) ? 'ENCERRADO' : status;
                status = (moment(value.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss') > moment()) ? 'FUTURO' : status;

            var data_inicio = (value.data_inicio != '0000-00-00 00:00:00' ? moment(value.data_inicio, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD') : '0000-00-00');
            var data_inicio_br = (value.data_inicio != '0000-00-00 00:00:00' ? moment(value.data_inicio, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY') : '-');
            var data_fim = (value.data_fim != '0000-00-00 00:00:00' ? moment(value.data_fim, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD') : '0000-00-00');
            var data_fim_br = (value.data_fim != '0000-00-00 00:00:00' ? moment(value.data_fim, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY') : '-');
            var entregas = (value.config !== null && typeof value.config.entregas !== 'undefined' && value.config.entregas !== null) ? value.config.entregas : false;
                entregas = entregas && entregas.length ? $.map(entregas, function(v){ return unicodeToChar(v[0]) }).join(', ') : entregas;
            var parametros = (value.config !== null && typeof value.config.parametros !== 'undefined' && value.config.parametros !== null) ? value.config.parametros : false;
                parametros = parametros && parametros.length ? $.map(parametros, function(v){ return unicodeToChar(v[0]) }).join(', ') : parametros;
            var tipo_processo = (value.config !== null && typeof value.config.tipo_processo !== 'undefined' && value.config.tipo_processo !== null) ? value.config.tipo_processo : false;
                tipo_processo = tipo_processo && tipo_processo.length ? $.map(tipo_processo, function(v){ return unicodeToChar(v[0]) }).join(', ') : tipo_processo;
            var complexidade = (value.config !== null && typeof value.config.complexidade !== 'undefined' && value.config.complexidade !== null) ? value.config.complexidade : false;
                complexidade = complexidade ? $.map(complexidade,function(v, i){ 
                    return unicodeToChar(v.complexidade)+': '+parseFloat((v.fator*value.tempo_pactuado).toFixed(2))+' hora(s)'+(v.default ? ' (Padr\u00E3o)' : '')+'<br>';
                }).join('') : complexidade;
            var tempo_minimo = (value.config !== null && typeof value.config.tempo_minimo !== 'undefined' && value.config.tempo_minimo !== null) ? value.config.tempo_minimo : false;

            var htmlTableRelatorios =   '       <tr data-tagname="SemGrupo" data-index="'+index+'">'+
                                        '           <td align="center">'+value.id_atividade+'</td>'+
                                        '           <td align="center">'+status+'</td>'+
                                        '           <td align="left">'+value.nome_atividade+'</td>'+
                                        '           <td align="left">'+value.macroatividade+'</td>'+
                                        '           <td align="left">'+value.sigla_unidade+'</td>'+
                                        '           <td align="left">'+value.nome_processo+'</td>'+
                                        '           <td align="center" class="filterResume_tempo_pactuado">'+value.tempo_pactuado+'</td>'+
                                        '           <td align="center" class="filterResume_dias_planejado">'+value.dias_planejado+'</td>'+
                                        '           <td align="left">'+(entregas ? entregas : '')+'</td>'+
                                        '           <td align="left">'+(parametros ? parametros : '')+'</td>'+
                                        '           <td align="left">'+(complexidade ? complexidade : '')+'</td>'+
                                        '           <td align="left" style="text-align:center;" data-time-sorter="'+data_inicio+'">'+data_inicio_br+'</td>'+
                                        '           <td align="left" style="text-align:center;" data-time-sorter="'+data_fim+'">'+data_fim_br+'</td>'+
                                        '           <td align="center">'+(value.recalcula_prazo ? 'Sim' : '')+'</td>'+
                                        '           <td align="center" class="filterResume_tempo_minimo">'+(tempo_minimo ? tempo_minimo : '')+'</td>'+
                                        '           <td align="left">'+(tipo_processo ? tipo_processo : '')+'</td>'+
                                        '           <td align="center">'+(value.homologado ? 'Sim' : '')+'</td>'+
                                        '       </tr>';
        } else if (type == 'afastamentos') {
            var status = (moment(value.fim_afastamento,'YYYY-MM-DD HH:mm:ss') < moment()) ? 'ENCERRADO' : status;
                status = (moment(value.inicio_afastamento,'YYYY-MM-DD HH:mm:ss') > moment()) ? 'FUTURO' : status;

            var data_inicio = (value.inicio_afastamento != '0000-00-00 00:00:00' ? moment(value.inicio_afastamento, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD HH:mm') : '0000-00-00');
            var data_inicio_br = (value.inicio_afastamento != '0000-00-00 00:00:00' ? moment(value.inicio_afastamento, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm') : '-');
            var data_fim = (value.fim_afastamento != '0000-00-00 00:00:00' ? moment(value.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD HH:mm') : '0000-00-00');
            var data_fim_br = (value.fim_afastamento != '0000-00-00 00:00:00' ? moment(value.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm') : '-');

            var htmlTableRelatorios =   '       <tr data-tagname="SemGrupo" data-index="'+index+'">'+
                                        '           <td align="center">'+value.id_afastamento+'</td>'+
                                        '           <td align="center">'+status+'</td>'+
                                        '           <td align="left">'+value.nome_completo+'</td>'+
                                        '           <td align="left">'+value.matricula+'</td>'+
                                        '           <td align="left">'+value.nome_motivo+'</td>'+
                                        '           <td align="left">'+value.observacoes+'</td>'+
                                        '           <td align="left" style="text-align:center;" data-time-sorter="'+data_inicio+'">'+data_inicio_br+'</td>'+
                                        '           <td align="left" style="text-align:center;" data-time-sorter="'+data_fim+'">'+data_fim_br+'</td>'+
                                        '       </tr>';
        } else if (type == 'produtividade') {
            var htmlTableRelatorios =   '       <tr data-tagname="SemGrupo" data-index="'+index+'">'+
                                        '           <td align="left">'+value.nome_completo+'</td>'+
                                        '           <td align="center">'+value.matricula+'</td>'+
                                        '           <td align="left">'+value.nome_unidade+' - '+value.sigla_unidade+'</td>'+
                                        '           <td align="left">'+getDatesFormatBR(value.data_distribuicao)+' \u00E0 '+getDatesFormatBR(value.data_entrega)+'</td>'+
                                        '           <td align="center">'+(value.nota_atribuida ? parseFloat(value.nota_atribuida).toLocaleString('pt-br', {minimumFractionDigits: 2}) : '' )+'</td>'+
                                        '           <td align="center">'+(value.total_avaliacoes ? parseInt(value.total_avaliacoes).toLocaleString('pt-br') : '' )+'</td>'+
                                        '           <td align="center">'+(value.produtividade_despendida ? parseFloat((value.produtividade_despendida*100).toFixed(2)).toLocaleString('pt-br', {minimumFractionDigits: 2})+'%' : '')+'</td>'+
                                        '           <td align="center">'+(value.produtividade_executada ? parseFloat((value.produtividade_executada*100).toFixed(2)).toLocaleString('pt-br', {minimumFractionDigits: 2})+'%' : '')+'</td>'+
                                        '       </tr>';
        } else if (type == 'prescricoes') {
            var linkProc = !value.id_procedimento ? '' : url_host+'?acao=procedimento_trabalhar&id_procedimento='+value.id_procedimento;
                linkProc = value.processo_sei && linkProc == '' ? url_host.replace('controlador.php','')+'#'+value.processo_sei : linkProc;
            var iconProcesso = ( $.inArray(value.processo_sei, arrayProcessosUnidade) == -1 ) ? 'fas fa-folder' : 'far fa-folder-open';
            var processoHtml = (value.processo_sei !== null && value.processo_sei != '')
                        ? '               <a '+(linkProc == '' ? 'style="cursor: auto;"' : 'style="text-decoration: underline;" class="bLink" href="'+linkProc+'" target="_blank"')+'>'+
                        '                   <i class="'+iconProcesso+' '+(linkProc == '' ? '' : 'bLink')+'" '+(linkProc == '' ? 'style="color: #a2a2a2;"' : 'style="text-decoration: underline;"')+'></i> '+
                        '                   <span '+(linkProc == '' ? '' : 'class="bLink"')+'></i> '+
                        '                       '+value.processo_sei+
                        '                   </span>'+
                        '               </a>'
                        : '';

            var linkDoc = !value.id_documento_sei ? '' : url_host+'?acao=procedimento_trabalhar&id_procedimento='+value.id_procedimento+'&id_documento='+value.id_documento_sei;
            var documentoHtml =     !value.documento_relacionado ? '' : 
                                    '               <a '+(linkDoc == '' ? 'style="cursor: auto;"' : 'style="text-decoration: underline;" class="bLink" href="'+linkDoc+'" target="_blank"')+'>'+
                                    '                   <i class="fas fa-list-alt '+(linkDoc == '' ? '' : 'bLink')+'" '+(linkDoc == '' ? 'style="color: #a2a2a2;"' : 'style="text-decoration: underline;"')+' onmouseover="return infraTooltipMostrar(\''+value.documento_relacionado+'\');" onmouseout="return infraTooltipOcultar();"></i> '+
                                    '                   <span '+(linkDoc == '' ? '' : 'class="bLink"')+'></i> '+
                                    '                       '+value.documento_relacionado+
                                    '                   </span>'+
                                    '               </a>';

            var porcentagem = parseFloat(((value.tempo_decorrido/value.prazo)*100).toFixed(2));

            var htmlTableRelatorios =   '       <tr data-tagname="SemGrupo" data-index="'+index+'">'+
                                        '           <td align="center">'+processoHtml+'</td>'+
                                        '           <td align="left">'+value.nome_prescricao+'</td>'+
                                        '           <td align="left">'+(value.suspensao ? 'Suspenso' : (value.data_fim == '0000-00-00 00:00:00' ? 'Em decurso' : 'Encerrado') )+'</td>'+
                                        '           <td align="center">'+value.prazo+'</td>'+
                                        '           <td align="center">'+value.tempo_decorrido+'</td>'+
                                        '           <td align="center">'+porcentagem.toLocaleString('pt-BR')+'</td>'+
                                        '           <td align="center">'+documentoHtml+'</td>'+
                                        '           <td align="center">'+getDatesFormatBR(value.data_inicio)+'</td>'+
                                        '       </tr>';
        }
        
        var label_id = (type == 'tipos_modalidades') ? 'id_tipo_modalidade' : 'id_'+type.slice(0, -1);
            label_id = (type == 'tipos_metadados') ? 'id_tipo_metadado' : label_id;
            label_id = (type == 'tipos_prescricoes') ? 'id_tipo_prescricao' : label_id;
        var tr_report = tableReportBody.find('tr[data-id="'+value['id_'+label_id]+'"]');
        if (tr_report.length > 0) {
            tr_report.before(htmlTableRelatorios).remove();
        } else {
            tableReportBody.append(htmlTableRelatorios);
        }
    }
    function initRowsPanelRelatorios(index) {
        loadRowsPanelReport = true;
        var totaldados = storeRelatorios.length;
        var caption = tableReport.find('caption.infraCaption');
        var numRegistros = caption.find('span.count');
            numRegistros = (numRegistros.length > 0) ? parseInt(numRegistros.text())+totaldados : 0;
            if (offset) caption.find('span.count').text(numRegistros);
        setTimeout(() => {
            if (totaldados-1 <= index && !caption.find('a.cancel').is(':visible')) {
                loadRowsPanelReport = false;
                setTimeout(() => { if (!loadRowsPanelReport) { tableReport.trigger('updateAll') } }, 1000);
            }
        }, 1000);
    }
    var limit = 100;
    var time = offset+200;
    storeRelatorios.forEach(function (value, index) {
        if (index >= limit) {
            setTimeout(function(){
                setRowsPanelRelatorios(value, index);
                if (storeRelatorios.length-1 == index || index % 100 == 0) { 
                    initRowsPanelRelatorios(index);
                }
            }, time*index);
        } else {
            setRowsPanelRelatorios(value, index);
            loadRowsPanelReport = false;
        }
    });
    if (storeRelatorios.length <= limit) { initRowsPanelRelatorios(100) }
}
function getChartAfastamentoPanel(this_) {
    var _this = $(this_);
    $('#reportAfastamentoPanel').show();
}
function initTableAfastamentoPanel(this_, TimeOut = 9000) {
    if (TimeOut <= 0) { return; }
    if (typeof $().tablesorter !== 'undefined') { 
        getTableAfastamentoPanel(this_);
    } else {
        setTimeout(function(){ 
            if (typeof $().tablesorter === 'undefined' && TimeOut == 9000) { $.getScript((URL_SPRO+"js/lib/jquery.tablesorter.combined.min.js")) }
            initTableAfastamentoPanel(this_, TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initTableAfastamentoPanel'); 
        }, 500);
    }
}
function getTableAfastamentoPanel(this_) {
    var _this = $(this_);
    var afastID = '#tableAfastamentoPanel';
    var tabelaAfast = $(afastID);
        tabelaAfast.show();
    var listAfastamentos = arrayConfigAtividades.afastamentos.lista;
    var countAfastamentos = (listAfastamentos.length == 1) ? listAfastamentos.length+' registro:' : listAfastamentos.length+' registros:';
    if (typeof listAfastamentos !== 'undefined' && listAfastamentos.length > 0 && listAfastamentos != 0) {
        htmlTableAfastamentos =    '<table id="tableAfastamento" class="tableInfo tableZebra tableFollow tableAtividades tableAfastamentos" data-tabletype="afastamentos">'+
                                '   <caption class="infraCaption" style="text-align: left; margin-top: 10px;">'+countAfastamentos+'</caption>'+
                                '   <thead>'+
                                '       <tr class="tableHeader">'+
                                '           <th class="tituloControle" data-sorter="false" style="width: 50px;" align="center"><label class="lblInfraCheck_label" for="lnkInfraCheck_afastamentos" accesskey=";"></label><a id="lnkInfraCheck_afastamentos" class="lnkInfraCheck" onclick="setSelectAllTr(this);" onmouseover="updateTipSelectAll(this)" onmouseenter="return infraTooltipMostrar(\'Selecionar Tudo\')" onmouseout="return infraTooltipOcultar();"><img src="/infra_css/'+(isNewSEI ? 'svg/check.svg': 'imagens/check.gif')+'" id="imgRecebidosCheck"></a></th>'+
                                '           <th class="tituloControle tituloFilter" data-filter-type="user">Usu\u00E1rio</th>'+
                                '           <th class="tituloControle tituloFilter" data-filter-type="date" style="width: 25%;">Motivo do Afastamento</th>'+
                                '           <th class="tituloControle tituloFilter sorter-date-range-dmy" data-filter-type="inicio" style="width: 160px;">In\u00EDcio do Afastamento</th>'+
                                '           <th class="tituloControle tituloFilter sorter-date-range-dmy" data-filter-type="fim" style="width: 160px;">Fim do Afastamento</th>'+
                                '           <th class="tituloControle" data-filter-type="desc">'+__.Observacoes+'</th>'+
                                '           <th class="tituloControle" data-sorter="false" style="min-width: 120px;">A\u00E7\u00F5es</th>'+
                                '       </tr>'+
                                '   </thead>'+
                                '   <tbody>';
        $.each(listAfastamentos,function(index, value){
            var dateConfig =    {
                date: moment(value.fim_afastamento).format('YYYY-MM-DD HH:mm:ss'),
                nametag: ( moment(value.fim_afastamento) < moment()
                    ? { name: 'Conclu\u00EDdo', value: 'date_concluido', color: '#eef4f9' }
                    : { name: 'Programado', value: 'date_programado', color: '#eef4f9' }
                    )
            };
            var tagName_thisUser = normalizeNameTag(value.apelido);
            var tagName_thisMotivo = normalizeNameTag(value.nome_motivo);
            var tagName_thisDate = normalizeNameTag(dateConfig.nametag.name);
            var tagColor = jmespath.search(arrayConfigAtividades.afastamentos.tipos_motivos,"[?id_tipo_motivo==`"+value.id_tipo_motivo+"`] | [0].config.colortags");
                tagColor = (tagColor !== null) ? tagColor : { "icontag": "luggage-cart", "colortag": "#bfd5e11", "textcolor": "black"};
            var horas_afastamento = jmespath.search(arrayConfigAtividades.afastamentos.tipos_motivos,"[?id_tipo_motivo==`"+value.id_tipo_motivo+"`] | [0].config.horas_afastamento");
                horas_afastamento = (horas_afastamento) ? true : false;
            var integracao_interna = jmespath.search(arrayConfigAtividades.afastamentos.tipos_motivos,"[?id_tipo_motivo==`"+value.id_tipo_motivo+"`] | [0].config.integracao_interna");
                integracao_interna = (integracao_interna) ? true : false;
            var editar_integracao_interna = jmespath.search(arrayConfigAtividades.afastamentos.tipos_motivos,"[?id_tipo_motivo==`"+value.id_tipo_motivo+"`] | [0].config.editar_integracao_interna");
                editar_integracao_interna = (editar_integracao_interna) ? true : false;
            var dia_inteiro = (moment(value.inicio_afastamento, 'YYYY-MM-DD HH:mm:ss').format('HH:mm:ss') == '00:00:00' && (moment(value.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format('HH:mm:ss') == '23:59:59' || moment(value.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format('HH:mm:ss') == '00:00:00')) ? true : false;
            var format_sys = (horas_afastamento) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
            var format_display = (!dia_inteiro) ? 'DD/MM/YYYY HH:mm' : 'DD/MM/YYYY';
            var type_input = (horas_afastamento) ? 'datetime-local' : 'date';
            var icon_integracao = (typeof value.key_afastamento !== 'undefined' && value.key_afastamento !== null) ? '<span onclick="filterTagView(this)" onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\'Afastamento inserido automaticamente pelo sistema\')" data-colortag="#e7edf2" data-tagname="integracao" data-textcolor="black" data-icontag="cog" data-type="date" style="background-color: #e7edf2; color: #666" class="tag_text tagTableText_integracao"><i class="tagicon fas fa-cog" style="font-size: 90%;margin: 0 2px; color: #666"></i></span>': '';
            var tagName_integracao = (typeof value.key_afastamento !== 'undefined' && value.key_afastamento !== null) ? 'tagTableName_integracao': '';

            var tagDate = getDatesPreview(dateConfig);
            htmlTableAfastamentos +=    '       <tr data-tagname="SemGrupo" data-index="'+value.id_afastamento+'" class="tagTableName_'+tagName_thisUser+' tagTableName_'+tagName_thisMotivo+' tagTableName_date_'+tagName_thisDate+' '+tagName_integracao+'">'+
                                        '           <td align="center">'+
                                        '               <input type="checkbox" '+(checkPermissionAfast(value, 'delete_afastamento') ? '' : 'disabled')+' class="checkboxSelectAfastamento" onclick="followSelecionarItens(this)" id="afastamentoPro_'+value.id_afastamento+'" name="afastamentoPro" value="'+value.id_afastamento+'">'+
                                        '           </td>'+
                                        '           <td align="left">'+
                                        '               <span class="info_tags_follow info_tags_user">'+
                                        '                   <span data-colortag="#bfd5e8" data-type="user" data-tagname="'+tagName_thisUser+'" data-textcolor="black" data-icontag="user" style="background-color: #bfd5e8;" class="tag_text tagTableText_'+tagName_thisUser+'" onclick="filterTagView(this)">'+
                                        '                       <i data-colortag="#406987" class="fas fa-user" style="font-size: 90%; margin: 0px 2px; color: #406987;"></i> '+value.apelido+
                                        '                   </span>'+
                                        '               </span>'+
                                        '           '+value.nome_completo+
                                        '           </td>'+
                                        '           <td align="left">'+
                                        '               <span class="info_tags_follow">'+
                                        '                   <span data-colortag="'+tagColor.colortag+'" data-tagname="'+tagName_thisMotivo+'" data-textcolor="'+tagColor.textcolor+'" data-icontag="'+tagColor.icontag+'" data-type="date" style="background-color: '+tagColor.colortag+'; color: '+tagColor.textcolor+'"class="tag_text tagTableText_'+tagName_thisMotivo+'" onclick="filterTagView(this)">'+
                                        '                       <i class="tagicon fas fa-'+tagColor.icontag+'" style="font-size: 90%;margin: 0 2px; color: '+tagColor.textcolor+'"></i>'+
                                        '                       '+value.nome_motivo+
                                        '                   </span>'+icon_integracao+
                                        '                   <span class="info_dates_fav">'+tagDate+'</span>'+
                                        '               </span>'+
                                        '           </td>'+
                                        '           <td align="center" data-time-sorter="'+moment(value.inicio_afastamento, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD HH:mm:ss')+'">'+
                                        '               <span class="info_dates_fav">'+
                                        '                   '+moment(value.inicio_afastamento, 'YYYY-MM-DD HH:mm:ss').format(format_display)+
                                        '               </span>'+
                                        '           </td>'+
                                        '           <td align="center" data-time-sorter="'+moment(value.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD HH:mm:ss')+'">'+
                                        '               <span class="info_dates_fav">'+
                                        '                   '+moment(value.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format(format_display)+
                                        '               </span>'+
                                        '           </td>'+
                                        '           <td class="content_desc">'+
                                        '               <div>'+
                                        '                   <span class="info" style="font-weight: bold; display: inline-block; padding-top: 5px;">'+value.observacoes+'</span>'+
                                        '               </div>'+
                                        '           </td>'+
                                        '           <td align="right">'+
                                        (checkPermissionAfast(value, 'edit_afastamento') && (!integracao_interna || (integracao_interna && checkCapacidade('edit_afastamento_integrado') && editar_integracao_interna ))  ?
                                        '               <a class="newLink followLinkTr" onclick="saveAfastamento(this,'+value.id_afastamento+')" onmouseover="return infraTooltipMostrar(\'Editar afastamento\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-pencil-alt" style="font-size: 100%;"></i></a>'+
                                        '' : '')+
                                        (checkPermissionAfast(value, 'delete_afastamento') && (!integracao_interna || arrayConfigAtividades.perfil.nivel == 1) ?
                                        '               <a class="newLink followLinkTr" onclick="removeAfastamento(this, '+value.id_afastamento+')" onmouseover="return infraTooltipMostrar(\'Excluir afastamento\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-trash" style="font-size: 100%;"></i></a>'+
                                        '' : '')+
                                        '           </td>'+
                                        '       </tr>';
        });
        htmlTableAfastamentos +=   '   </tbody>'+
                                '</table>';

        tabelaAfast.html(htmlTableAfastamentos);
        initPanelResize(afastID+'.tabelaPanelScroll', 'afastamentoTabelaPro');
        
        var afastTabela = $('#tableAfastamento');
            afastTabela.tablesorter({
                sortLocaleCompare : true,
                textExtraction: {
                    3: function (elem, table, cellIndex) {
                        var text_date = $(elem).data('time-sorter');
                        return text_date;
                    },
                    4: function (elem, table, cellIndex) {
                      var text_date = $(elem).data('time-sorter');
                      return text_date;
                    }
                },
                widgets: ["saveSort", "filter"],
                widgetOptions: {
                    saveSort: true,
                    filter_hideFilters: true,
                    filter_columnFilters: true,
                    filter_saveFilters: true,
                    filter_hideEmpty: true,
                    filter_excludeFilter: {}
                },
                sortReset: true,
                headers: {
                    0: { sorter: false, filter: false },
                    1: { filter: true },
                    2: { filter: true },
                    3: { filter: true },
                    4: { filter: true },
                    5: { filter: true }
                }
            }).on("sortEnd", function (event, data) {
                checkboxRangerSelectShift();
            }).on("filterEnd", function (event, data) {
                checkboxRangerSelectShift();
                var caption = $(this).find("caption").eq(0);
                var tx = caption.text();
                    caption.text(tx.replace(/\d+/g, data.filteredRows));
                    $(this).find("tbody > tr:visible > td > input").prop('disabled', false);
                    $(this).find("tbody > tr:hidden > td > input").prop('disabled', true);
            });
        
        var filterAfast = afastTabela.find('.tablesorter-filter-row').get(0);
        if (typeof filterAfast !== 'undefined') {
            var observerFilterAfast = new MutationObserver(function(mutations) {
                var _this = $(mutations[0].target);
                var _parent = _this.closest('table');
                var iconFilter = _parent.find('.filterTablePro button');
                var checkIconFilter = iconFilter.hasClass('active');
                var hideme = _this.hasClass('hideme');
                if (hideme && checkIconFilter) {
                    iconFilter.removeClass('active');
                }
            });
            setTimeout(function(){ 
                var htmlFilterAfast =   '<div class="btn-group filterTablePro" role="group" style="right: 55px;top: 52px;z-index: 99;position: absolute;">'+
                                        '   <button type="button" onclick="downloadTablePro(this)" data-icon="fas fa-download" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="Baixar" class="btn btn-sm btn-light">'+
                                        '       <i class="fas fa-download" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                        '       <span class="text">Baixar</span>'+
                                        '   </button>'+
                                        '   <button type="button" onclick="copyTablePro(this)" data-icon="fas fa-copy" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="Copiar" class="btn btn-sm btn-light">'+
                                        '       <i class="fas fa-copy" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                        '       <span class="text">Copiar</span>'+
                                        '   </button>'+
                                        '   <button type="button" onclick="filterTablePro(this)" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="Pesquisar" class="btn btn-sm btn-light '+(afastTabela.find('tr.tablesorter-filter-row').hasClass('hideme') ? '' : 'active')+'">'+
                                        '       <i class="fas fa-search" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                        '       Pesquisar'+
                                        '   </button>'+
                                        '</div>';
                    afastTabela.find('thead .filterTablePro').remove();
                    afastTabela.find('thead').prepend(htmlFilterAfast);
                    observerFilterAfast.observe(filterAfast, {
                        attributes: true
                    });
            }, 500);
            $.getScript(URL_SPRO+"js/lib/jquery-visible.min.js");
        }
        
        var observerTableAfast = new MutationObserver(function(mutations) {
            var _this = $(mutations[0].target);
            var _parent = _this.closest('table');
            var count = _parent.find('tr.infraTrMarcada').length;
            if (count > 0) {
                $('#afastamentosProActions').find('.iconAfastamento_remove').show().find('.fa-layers-counter').text(count);
            } else {
                $('#afastamentosProActions').find('.iconAfastamento_remove').hide();
            }
        });
        setTimeout(function(){ 
            afastTabela.find('tbody tr').each(function(){
                observerTableAfast.observe(this, {
                        attributes: true
                });
            });
            checkboxRangerSelectShift();
        }, 500);

        var tagName = getOptionsPro('filterTag_afastamentos');
        if (typeof tagName !== 'undefined' && tagName != '') {
            setTimeout(function(){ 
                $('.tableAfastamentos .tagTableText_'+tagName).eq(0).trigger('click');
            }, 500);
        }
    }
}
function getTableContatoPanel() {
    var dataContato = sessionStorageRestorePro('configDataContatosArray');
    if (dataContato !== null) {
        setTableContatoPanel(dataContato);
    } else {
        var action = 'view_contato';
        var param = {
            action: action
        };
        getServerAtividades(param, action);
        $('#tableContatoPanel').show().find('.dataFallback').addClass('dataLoading');
    }
}
function toggleContatos(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.contatoPanelPro')
    var id_unidade = _this.data('unidade');
    if (_this.find('i').hasClass('fa-angle-down')) {
        _parent.find('.unidade.dependencia_'+id_unidade).slideUp('slow');
        _parent.find('.contatos.dependencia_'+id_unidade).slideUp('slow');
        _parent.find('.contatos.subordinada_'+id_unidade).slideUp('slow');
        _parent.find('.unidade.subordinada_'+id_unidade).slideUp('slow').find('a.toggle i').attr('class','fas fa-angle-right cinzaColor');
        _this.find('i').attr('class','fas fa-angle-right cinzaColor');
    } else {
        _parent.find('.unidade.dependencia_'+id_unidade).slideDown('slow');
        _parent.find('.contatos.dependencia_'+id_unidade).slideDown('slow').find('a.toggle i').attr('class','fas fa-angle-right cinzaColor');
        _this.find('i').attr('class','fas fa-angle-down cinzaColor');
    }
}
function setTableContatoPanel(data) {
    var contatoID = '#tableContatoPanel';
    var tabelaContato = $(contatoID);
        tabelaContato.show();
    var listContatos = data.contatos;
    var listUnidades = data.unidades;
    var listUsuarios = data.usuarios_sem_plano;
    var htmlList = '';

    function getSubordinacao(arrayU, loop = 8, class_dependencia = '') {
        var mapU = false;
        if (typeof arrayU !== 'undefined' && arrayU !== null && arrayU.length > 0) {
            mapU = $.map(arrayU, function(v){
                var contatos = jmespath.search(listContatos, "[?id_unidade==`"+v.id_unidade+"`]");
                    contatos = (contatos !== null) ? contatos : false;
                var usuarios_sp = jmespath.search(listUsuarios, "[?id_unidade==`"+v.id_unidade+"`]");
                    usuarios_sp = (usuarios_sp !== null) ? usuarios_sp : false;
                    contatos = (usuarios_sp) ? contatos.concat(usuarios_sp) : contatos;
                    contatos = (contatos) ? contatos.sort((a,b) => a.nivel - b.nivel) : contatos;
                    
                var separator = '<span class="separator"></span>';
                var repeat = 8-loop;
                var subordinacao = false;
                var htmlContatos = (contatos) 
                    ? $.map(contatos, function(c){
                        var horario_util = c.horario_util ? ' ('+c.horario_util.inicio+' \u00E0s '+c.horario_util.fim+')' : '';
                        var tel_celular = c.tel_celular ? '<a href="https://api.whatsapp.com/send?phone='+c.tel_celular.replace(/\D+/ig, '')+'" target="_blank" class="newLink" onmouseover="return infraTooltipMostrar(\'Clique para abrir chat no Whatsapp\');" onmouseout="return infraTooltipOcultar();"><i class="fab fa-whatsapp verdeColor"></i>  '+c.tel_celular+'</a> ' : c.tel_residencial;
                        var email = c.email ? '<a href="https://teams.microsoft.com/l/chat/0/0?users='+c.email+'" target="_blank" class="newLink" onmouseover="return infraTooltipMostrar(\'Clique para abrir chat no Microsoft Teams\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-user-friends roxoColor"></i>  '+c.email+'</a> ' : '';
                        var modalidade = (c.nome_modalidade) ? '<a class="newLink"><i class="fas fa-handshake cinzaColor"></i>'+c.nome_modalidade+horario_util+'</a>' : '';
                        return  '<span class="contato">'+
                                '   <span class="nome">'+c.nome_completo+'</span>'+
                                '   <span class="modalidade">'+modalidade+'</span>'+
                                '   <span class="motivo_afastamento">'+(c.motivo_afastamento ? '<a class="newLink"><i class="fas fa-luggage-cart vermelhoColor"></i>'+c.motivo_afastamento+'</a>' : '')+'</span>'+
                                '   <span class="email">'+(email ? email : '')+'</span>'+
                                '   <span class="celular">'+(tel_celular ? tel_celular : '')+'</span>'+
                                '</span>'
                    }).join('')
                    : '';

                var arraySubordinacao = jmespath.search(listUnidades, "[?dependencia==`"+v.id_unidade+"`].{id_unidade: id_unidade, nome_unidade: nome_unidade, sigla_unidade: sigla_unidade, dependencia: dependencia}");
                    arraySubordinacao = (arraySubordinacao !== null) ? arraySubordinacao : false;
                
                htmlList += '<div class="unidade dependencia_'+v.dependencia+' '+class_dependencia+'" data-unidade="'+v.id_unidade+'" data-count="'+(contatos && contatos.length > 0 ? contatos.length : 0)+'" style="'+(v.dependencia != 0 ? 'display:none;' : '')+'">'+
                            (separator.repeat(repeat))+v.nome_unidade+' ('+v.sigla_unidade+') '+((arraySubordinacao && arraySubordinacao.length > 0) || (contatos && contatos.length > 0) 
                                ?   (contatos && contatos.length > 0 ? '<span class="count">'+contatos.length+'</span>' : '<span class="count" style="display:none;"></span>')+
                                    '<a onclick="toggleContatos(this)" class="newLink toggle" data-unidade="'+v.id_unidade+'"><i class="fas fa-angle-right cinzaColor"></i></a>'
                                :   '');
                htmlList += (contatos && contatos.length > 0) ? '<div class="contatos dependencia_'+v.id_unidade+' '+class_dependencia+' separator_'+repeat+'">'+htmlContatos+'</div>' : '';
                htmlList += '</div>';
                

                if (loop > 0 && arraySubordinacao) {
                    subordinacao = getSubordinacao(arraySubordinacao, loop-1, class_dependencia+' subordinada_'+v.id_unidade);
                }
                
                return {id: v.id_unidade, contatos: contatos, nome_unidade: v.nome_unidade, sigla_unidade: v.sigla_unidade, arraySubordinacao: arraySubordinacao, subordinacao: subordinacao};
            });
        }
        return mapU;
    }

    var htmlSearch =    '<div style="text-align: right; margin: 9px; padding: 10px;">'+
                        '   <input class="iconSearch" onkeyup="searchContatos(this)" style="padding: 10px; width: 20%; min-width: 200px;" placeholder="Pesquisar um contato">'+
                        '</div>';

    var unidades_super = jmespath.search(listUnidades,"[?dependencia==`0`]");
    var arrayHierarquia = getSubordinacao(unidades_super);
    $('#tableContatoPanel').html(htmlSearch+htmlList);
    updateCountContatos();
}
function searchContatos(this_) {
    var _this = $(this_);
    var value = _this.val();
        value = typeof value !== 'undefined' ? removeAcentos(value).toLowerCase() : '';
    if (value == '') {
        $('#tableContatoPanel').find('.contatos, .unidade').hide();
        $('#tableContatoPanel').find('.dependencia_0, .contato').show().find('a.newLink.toggle i').attr('class','fas fa-angle-right cinzaColor');
    } else {
        $('#tableContatoPanel').find('.contatos, .unidade').hide();
        $('#tableContatoPanel').find('.contato').hide().each(function(){
            var text = $(this).text();
            if (removeAcentos(text).toLowerCase().indexOf(value) !== -1) {
                var subordinada = $(this).closest('.unidade').attr('class');
                    subordinada = typeof subordinada !== 'undefined' ? subordinada.split(' ').filter(function(v){ return v.indexOf('subordinada') !== -1 }) : false;
                 $(this).show().closest('.contatos').show().closest('.unidade').show();
                if (subordinada && subordinada.length) {
                    $.each(subordinada, function(i,v){
                        var unidade = v.replace('subordinada_', '');
                        $('.unidade[data-unidade="'+unidade+'"]').show();
                    });
                }
            }
        });
    }
}
function updateCountContatos() {
    $('.contatoPanelPro .unidade').each(function(){
        var id_unidade = $(this).data('unidade')
        var count_u = $('.unidade.subordinada_'+id_unidade).map(function(){
            return $(this).data('count')
        }).get().reduce(function(a, b) { return a + b; }, 0);
        
        var count_d = $('.contatos.dependencia_'+id_unidade).map(function(){
            return $(this).find('.contato').length
        }).get().reduce(function(a, b) { return a + b; }, 0);
    
        var count = count_u+count_d;
        
        $(this).attr('data-count',count).find('.count').text(count).show();
    });
}
function getGanttAfastamento(bar_class = false) {
    var task = [];
    var dataFall = '';
    $('#ganttAfastamentoPanel').show();
    var listAfastamentos = arrayConfigAtividades.afastamentos.lista;
    if (typeof listAfastamentos !== 'undefined' && listAfastamentos.length > 0 && listAfastamentos != 0) {
        listAfastamentos = jmespath.search(listAfastamentos, "reverse(@)");
        var viewModeGantt = (getOptionsPro('ganttAfastamentoView')) ? getOptionsPro('ganttAfastamentoView') : 'Month';
        $.each(listAfastamentos, function (index, value) {
            var inicio_afastamento = moment(value.inicio_afastamento, "YYYY-MM-DD HH:mm:ss");
            var fim_afastamento = moment(value.fim_afastamento, "YYYY-MM-DD HH:mm:ss");
            var customClass = ( moment() > fim_afastamento ) ? 'bar-concluido-noprazo' : 'bar-em-execucao';   
                customClass = (moment() <= fim_afastamento && moment() >= inicio_afastamento) ? 'bar-iniciado' : customClass;
                // customClass = ( fim_afastamento < moment() ) ? 'bar-nao-iniciado' : customClass;
            var addClass = (customClass == 'bar-iniciado' || customClass == 'bar-em-execucao') ? ' bar-ativos' : '';
            var taskClass = customClass+addClass;
            var assunto = value.apelido+': '+value.nome_motivo;
            var taskAfastamentos = {
                                id: value.id_afastamento.toString(),
                                name: assunto,
                                start: inicio_afastamento.format("YYYY-MM-DD"),
                                end: fim_afastamento.format("YYYY-MM-DD"),
                                progress: (customClass == 'bar-concluido-noprazo') ? 100 
                                            : (customClass == 'bar-iniciado') 
                                                ? ganttAutoProgressPercent(inicio_afastamento, fim_afastamento) : 0,
                                dependencies: '',
                                custom_class: taskClass
                            };
            if (!bar_class || (bar_class && taskClass.indexOf(bar_class) !== -1 )) {
                task.push(taskAfastamentos);
            }
        });
        $('#ganttAfastamentoPanel').html('');
        if (task.length > 0) {
            var gantt = new Gantt("#ganttAfastamentoPanel", task,{
                header_height: 50,
                column_width: 10,
                step: 24,
                language: 'en',
                language: 'ptBr',
                view_modes: ['Day', 'Week', 'Month'],
                bar_height: 15,
                bar_corner_radius: 3,
                arrow_curve: 5,
                padding: 18,
                edit_task: false,
                view_mode: viewModeGantt,   
                date_format: 'YYYY-MM-DD',
                custom_popup_html: function(task) {
                    var value = jmespath.search(arrayConfigAtividades.afastamentos.lista, "[?id_afastamento==`"+task.id+"`] | [0]");
                    var optionSelectMotivo = $.map(arrayConfigAtividades.afastamentos.tipos_motivos, function(v){ 
                                                var selected = ( value && v.id_tipo_motivo == value.id_tipo_motivo ) ? 'selected' : '';
                                                return "<option value='"+v.id_tipo_motivo+"' "+selected+" data-config='"+JSON.stringify(v.config)+"'>"+v.nome_motivo+"</option>";
                                            }).join('');
                    var optionSelectUser = $.map(arrayConfigAtividades.usuarios, function(v){ if (v.id_user == value.id_user) { return '<option value="'+v.id_user+'" selected>'+v.apelido+'</option>' } else { return '<option value="'+v.id_user+'">'+v.apelido+'</option>' } }).join('');
                    var horas_afastamento = jmespath.search(arrayConfigAtividades.afastamentos.tipos_motivos,"[?id_tipo_motivo==`"+value.id_tipo_motivo+"`] | [0].config.horas_afastamento");
                        horas_afastamento = (horas_afastamento) ? true : false;
                    var integracao_interna = jmespath.search(arrayConfigAtividades.afastamentos.tipos_motivos,"[?id_tipo_motivo==`"+value.id_tipo_motivo+"`] | [0].config.integracao_interna");
                        integracao_interna = (integracao_interna) ? true : false;
                    var format_sys = (horas_afastamento) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
                    var dia_inteiro = (moment(value.inicio_afastamento, 'YYYY-MM-DD HH:mm:ss').format('HH:mm:ss') == '00:00:00' && (moment(value.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format('HH:mm:ss') == '23:59:59' || moment(value.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format('HH:mm:ss') == '00:00:00')) ? true : false;
                    var format_display = (!dia_inteiro) ? 'DD/MM/YYYY HH:mm' : 'DD/MM/YYYY';
                    var type_input = (horas_afastamento) ? 'datetime-local' : 'date';
                    var editar_integracao_interna = jmespath.search(arrayConfigAtividades.afastamentos.tipos_motivos,"[?id_tipo_motivo==`"+value.id_tipo_motivo+"`] | [0].config.editar_integracao_interna");
                        editar_integracao_interna = (editar_integracao_interna) ? true : false;

                    var html = '<div class="details-container seiProForm">'+
                                '   <table class="tableInfo tableLine">'+
                                '      <tr>'+
                                '           <td colspan="2" class="td_view">'+
                                '               <h5><i class="iconPopup fas fa-luggage-cart cinzaColor"></i> '+
                                '                   <span class="boxInfo" style="font-size: 11pt;font-weight: bold;width: 85%;display: inline-block;">'+value.nome_completo+': '+value.nome_motivo+'</span>'+
                                '                   <input type="hidden" data-type="id" value="'+value.id_afastamento+'">'+
                                '                   <a style="float: right; margin: -4px -4px 0 0; padding: 5px;" onclick="ganttAfastamentos.hide_popup()"><i class="far fa-times-circle cinzaColor"></i></a>'+
                                '               </h5>'+
                                '           </td>'+
                                '          <td class="td_edit" style="display:none; vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-user-circle cinzaColor"></i>Usu\u00E1rio:</td>'+
                                '          <td class="td_edit required" style="display:none">'+
                                '               <select onchange="changeDatesAfast(this)" data-type="user" class="data_extract" style="font-size: 1em; width: 86%;" data-key="id_user" required>'+optionSelectUser+'</select>'+
                                '               <a style="float: right; margin: -4px -4px 0 0; padding: 5px;" onclick="ganttAfastamentos.hide_popup()"><i class="far fa-times-circle cinzaColor"></i></a>'+
                                '          </td>'+
                                '      </tr>'+
                                '      <tr style="height: 40px;">'+
                                '          <td style="vertical-align: bottom; width: 180px;"><i class="iconPopup iconSwitch fas fa-stopwatch cinzaColor"></i>In\u00EDcio do Afastamento:</td>'+
                                '          <td class="td_view">'+moment(value.inicio_afastamento, 'YYYY-MM-DD HH:mm:ss').format(format_display)+'</td>'+
                                '          <td class="td_edit required date" style="display:none">'+
                                '               <input onchange="changeDatesAfast(this)" id="afast_inicio_afastamento" data-name="data de in\u00EDcio do afastamento" class="data_extract" style="font-size: 1em; width: 80%;" type="'+type_input+'" data-type="inicio" data-key="inicio_afastamento" value="'+moment(value.inicio_afastamento, 'YYYY-MM-DD HH:mm:ss').format(format_sys)+'" required>'+
                                '          </td>'+
                                '      </tr>'+
                                '      <tr style="height: 40px;">'+
                                '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-history cinzaColor"></i>Fim do Afastamento:</td>'+
                                '          <td class="td_view">'+moment(value.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format(format_display)+'</td>'+
                                '          <td class="td_edit required date" style="display:none">'+
                                '               <input onchange="changeDatesAfast(this)" id="afast_fim_afastamento" data-name="data final do afastamento" class="data_extract" style="font-size: 1em; width: 80%;" data-type="fim" type="'+type_input+'" data-key="fim_afastamento" value="'+moment(value.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format(format_sys)+'" required>'+
                                '          </td>'+
                                '      </tr>'+
                                '      <tr style="height: 40px;">'+
                                '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-business-time cinzaColor"></i>Motivo do Afastamento:</td>'+
                                '          <td class="td_view">'+value.nome_motivo+'</td>'+
                                '          <td class="td_edit required" style="display:none">'+
                                '               <select class="data_extract" onchange="changeInputAfast(this)" style="font-size: 1em; width: 86%;" data-key="id_tipo_motivo" required>'+optionSelectMotivo+'</select>'+
                                '          </td>'+
                                '      </tr>'+
                                '      <tr style="height: 40px;">'+
                                '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-comment-alt cinzaColor"></i>'+__.Observacoes+':</td>'+
                                '          <td class="td_view">'+value.observacoes+'</td>'+
                                '          <td class="td_edit" style="display:none">'+
                                '               <textarea class="data_extract" style="font-size: 1em; width: 80%;" data-key="observacoes">'+value.observacoes+'</textarea>'+
                                '          </td>'+
                                '      </tr>'+
                                '      <tr class="trCinza">'+
                                '           <td class="td_view" style="vertical-align: middle; padding: 0 10px;" colspan="2">'+
                                '               <p>'+
                                '                   <span class="boxInfo">'+
                                (checkPermissionAfast(value, 'delete_afastamento') && (!integracao_interna || arrayConfigAtividades.perfil.nivel == 1) ?
                                '                       <a class="ui-button ui-corner-all ui-widget" style="color: #2b2b2b; text-decoration: none; float: left;" onclick="removeAfastamento(this, '+value.id_afastamento+')">'+
                                '                           <i style="margin-right: 3px; color: #e46e64;" class="fas fa-trash"></i>'+
                                '                           Excluir'+
                                '                       </a>'+
                                '' : '')+
                                (checkPermissionAfast(value, 'edit_afastamento') && (!integracao_interna || (integracao_interna && checkCapacidade('edit_afastamento_integrado') && editar_integracao_interna )) ?
                                '                       <a class="ui-button ui-corner-all ui-widget" style="color: #2b2b2b; text-decoration: none; float: right;" onclick="editAfastamento(this)">'+
                                '                           <i style="margin-right: 3px; color: #8a8a8a;" class="fas fa-pencil-alt"></i>'+
                                '                           Editar'+
                                '                       </a>'+
                                '' : '')+
                                '                   </span>'+
                                '               </p>'+
                                '           </td>'+
                                '           <td class="td_edit" style="vertical-align: middle; padding: 0 10px; display:none" colspan="2">'+
                                '               <p>'+
                                '                   <span class="boxInfo">'+
                                '                       <a class="ui-button ui-corner-all ui-widget" style="color: #2b2b2b; text-decoration: none; float: left;" onclick="editAfastamento(this, -1)">'+
                                '                           <i style="margin-right: 3px; color: #8a8a8a;" class="fas fa-times"></i>'+
                                '                           Cancelar'+
                                '                       </a>'+
                                (checkCapacidade('edit_afastamento') && (!integracao_interna || (integracao_interna && checkCapacidade('edit_afastamento_integrado') && editar_integracao_interna )) ?
                                '                       <a class="ui-button ui-corner-all ui-widget confirm" style="color: #2b2b2b; text-decoration: none; float: right;" onclick="editAfastamento(this, '+value.id_afastamento+')">'+
                                '                           <i style="margin-right: 3px; color: #8a8a8a;" class="fas fa-save"></i>'+
                                '                           Salvar'+
                                '' : '')+
                                '                       </a>'+
                                '                   </span>'+
                                '               </p>'+
                                '           </td>'+
                                '      </tr>'+
                                '   </table>'+
                                '</div>';
                return html;
                },
                on_click: function (task) {
                }
            });
            ganttAfastamentos = gantt;
            if (!getOptionsPro('panelHeight_afastamentosGanttPro') && $('#ganttAfastamentoPanel').height() > 800) { setOptionsPro('panelHeight_afastamentosGanttPro', 800) }
            $('.gantt-container').addClass('tabelaPanelScroll');
            initPanelResize('.gantt-container', 'ganttAfastamentoPanelPro');
        } else {
            dataFall = '<div class="gantt-container dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div>';
        }
        
        var btnGroupView =  '<div style="position: absolute; right: 0; z-index: 99;">'+
                            '   <div class="btn-group" role="group" style="float: right;">'+
                            '       <button type="button" data-value="Day" class="btn btn-sm btn-light '+(getOptionsPro('ganttAfastamentoView') == 'Day' ? 'active' : '')+'">Dia</button>'+
                            '       <button type="button" data-value="Week" class="btn btn-sm btn-light '+(getOptionsPro('ganttAfastamentoView') == 'Week' ? 'active' : '')+'">Semana</button>'+
                            '       <button type="button" data-value="Month" class="btn btn-sm btn-light '+(getOptionsPro('ganttAfastamentoView') == 'Month' || !getOptionsPro('ganttAfastamentoView') ? 'active' : '')+'">M\u00EAs</button>'+
                            '   </div>'+
                            '</div>';


        var legendFilter =  '<div class="filterGanttTag">'+
                            '   '+getFilterGanttTag(ganttAfastamentos, 'bar-ativos', 'Ativo', bar_class, 'afastamento')+
                            '   '+getFilterGanttTag(ganttAfastamentos, 'bar-em-execucao', 'Planejado', bar_class, 'afastamento')+
                            '   '+getFilterGanttTag(ganttAfastamentos, 'bar-iniciado', 'Em curso', bar_class, 'afastamento')+
                            '   '+getFilterGanttTag(ganttAfastamentos, 'bar-concluido-noprazo', 'Conclu\u00EDdo', bar_class, 'afastamento')+
                            '</div>';
            $('#ganttAfastamentoPanel').css('max-width',($('#atividadesProDiv').width()-20)).prepend(legendFilter+btnGroupView+dataFall);

        if (ganttAfastamentos && ganttAfastamentos.bars.length > 0) {
            var scrollLeft = ganttAfastamentos.bars[0].x-20;
            var windowDiv = $('#ganttAfastamentoPanel').find('.gantt-container');
            windowDiv.animate({scrollLeft: scrollLeft}, 500);

            var popupAfast = $('#ganttAfastamentoPanel').find('.popup-wrapper');
            if (popupAfast.length > 0) {
                var observerPopupAfast = new MutationObserver(function(mutations) {
                    var _this = $(mutations[0].target);
                    var _parent = _this.closest('.gantt-container');
                    if (_this.is(':visible')) {
                        _parent.attr('style', function(i,s) { return (s || '') + 'position: relative !important;' });
                        _parent.find('.ui-resizable-handle').hide();
                    } else {
                        _parent.attr('style', function(i,s) { return (s || '') + 'position: initial !important;' });
                        _parent.find('.ui-resizable-handle').show();
                    }
                });
                    observerPopupAfast.observe(popupAfast.get(0), {
                            attributes: true
                        });
            }
        }
        $("#ganttAfastamentoPanel .btn-group").on("click", "button", function() {
            $btn = $(this);
            var mode = $btn.data('value');
            $btn.parent().find('button').removeClass('active'); 
            $btn.addClass('active');
            ganttAfastamentos.change_view_mode(mode);
            setOptionsPro('ganttAfastamentoView', mode);
        });
    }
}
function getOptionSelectMotivo(this_, id_afastamento) {
    var value = (id_afastamento != 0) ? jmespath.search(arrayConfigAtividades.afastamentos.lista, "[?id_afastamento==`"+id_afastamento+"`] | [0]") : false;
    var _this = $(this_);
    var _parent = _this.closest('.dialogBoxDiv');
    var _select = (!!_parent && _parent.find('select[data-key="id_tipo_motivo"]').length) ? _parent.find('select[data-key="id_tipo_motivo"]') : false;
    var _select_user = (!!_parent && _parent.find('select[data-key="id_tipo_motivo"]').length) ? _parent.find('select[data-key="id_user"]') : false;
    var integracao_interna_manual = (!!_select_user && _select_user.length) ? jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+_select_user.val()+"`] | [0].id_tipo_modalidade") : null;
        integracao_interna_manual = (integracao_interna_manual !== null) ? jmespath.search(arrayConfigAtividades.tipos_modalidades, "[?id_tipo_modalidade==`"+integracao_interna_manual+"`] | [0].config.integracao_interna_manual") : null;
        integracao_interna_manual = (integracao_interna_manual !== null) ? integracao_interna_manual : false;

    var optionSelectMotivo = $.map(arrayConfigAtividades.afastamentos.tipos_motivos, function(v){ 
        var selected = ( value && v.id_tipo_motivo == value.id_tipo_motivo ) ? 'selected' : '';
            selected = (!!_select && _select.val() == v.id_tipo_motivo ) ? 'selected' : selected;
        var integracao_interna = (typeof v.config !== 'undefined' && v.config !== null && v.config.hasOwnProperty('integracao_interna') && v.config.integracao_interna) ? true : false;
            integracao_interna = (!!_select_user && integracao_interna_manual) ? false : integracao_interna;
        var editar_integracao_interna = (typeof v.config !== 'undefined' && v.config !== null && v.config.hasOwnProperty('editar_integracao_interna') && v.config.editar_integracao_interna) ? true : false;
        return (integracao_interna && !checkCapacidade('edit_afastamento_integrado') && !editar_integracao_interna) 
                ? "" 
                : (!integracao_interna || (id_afastamento != 0 && checkCapacidade('edit_afastamento_integrado') && editar_integracao_interna)) 
                    ? "<option value='"+v.id_tipo_motivo+"' "+selected+" data-config='"+JSON.stringify(v.config)+"'>"+v.nome_motivo+"</option>" 
                    : "";
    }).join('');
    return optionSelectMotivo;
}
function updateOptionSelectMotivo(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.dialogBoxDiv');
    var id_afastamento = _parent.find('input[data-key="id_afastamento"]').val();
    var optionSelectMotivo = getOptionSelectMotivo(this_, id_afastamento);
        _parent.find('select[data-key="id_tipo_motivo"]').html(optionSelectMotivo).chosen("destroy").chosen({
            placeholder_text_single: ' ',
            no_results_text: 'Nenhum resultado encontrado'
        });
}
function saveAfastamento(this_, id_afastamento = 0) {
    var _this = $(this_);
    var value = (id_afastamento != 0) ? jmespath.search(arrayConfigAtividades.afastamentos.lista, "[?id_afastamento==`"+id_afastamento+"`] | [0]") : false;
    var optionSelectUser = (checkCapacidade('only_self_atividades')) 
                            ? '<option value="'+arrayConfigAtividades.perfil.id_user+'" selected>'+arrayConfigAtividades.perfil.apelido+'</option>'
                            : $.map(arrayConfigAtividades.usuarios, function(v){ if (value && v.id_user == value.id_user) { return '<option value="'+v.id_user+'" selected>'+v.apelido+'</option>' } else { return '<option value="'+v.id_user+'">'+v.apelido+'</option>' } }).join('');
    var optionSelectMotivo = getOptionSelectMotivo(this_, id_afastamento);
    var tipo_motivo = (value) ? jmespath.search(arrayConfigAtividades.afastamentos.tipos_motivos,"[?id_tipo_motivo==`"+value.id_tipo_motivo+"`] | [0]") : null;
        tipo_motivo = (tipo_motivo !== null) ? tipo_motivo : false;
    var horas_afastamento = (value && tipo_motivo && typeof tipo_motivo.config !== 'undefined' && tipo_motivo.config &&  tipo_motivo.config.hasOwnProperty('horas_afastamento') && tipo_motivo.config.horas_afastamento !== null && tipo_motivo.config.horas_afastamento) ? true : false;
    var exige_documentacao = (value && tipo_motivo && typeof tipo_motivo.config !== 'undefined' && tipo_motivo.config &&  tipo_motivo.config.hasOwnProperty('exige_documentacao') && tipo_motivo.config.exige_documentacao !== null && tipo_motivo.config.exige_documentacao) ? true : false;
    var exige_documentacao = (value && tipo_motivo && typeof tipo_motivo.config !== 'undefined' && tipo_motivo.config &&  tipo_motivo.config.hasOwnProperty('exige_documentacao') && tipo_motivo.config.exige_documentacao !== null && tipo_motivo.config.exige_documentacao) ? true : false;
    var format_sys = (horas_afastamento) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
    var format_display = (horas_afastamento) ? 'DD/MM/YYYY HH:mm' : 'DD/MM/YYYY';
    var type_input = (horas_afastamento) ? 'datetime-local' : 'date';
    var htmlDocs    =   '';

    var documentos = (typeof value.config !== 'undefined' && value.config !== null && typeof value.config.documentos !== 'undefined' && value.config !== null) ? value.config.documentos : false;
    var documentos_len = (documentos) ? documentos.length : 0;
    if (documentos && exige_documentacao){
        $.each(value.config.documentos, function(i, v){
            var previewDoc =    '<a class="newLink" style="cursor: pointer;" onclick="openDialogDoc({title: \''+unicodeToChar(v.documento)+' ('+v.nr_sei+')\', id_procedimento: \''+v.id_procedimento+'\', id_documento: \''+v.id_documento+'\'})" onmouseover="return infraTooltipMostrar(\'Visualiza\u00E7\u00E3o r\u00E1pida\');" onmouseout="return infraTooltipOcultar();">'+
                                '   <i class="fas fa-eye" style="font-size: 80%;"></i>'+
                                '</a>';
                htmlDocs    +=  '                        <tr data-index="'+i+'" data-key="documentos" data-value="'+i+'" data-id="'+i+'">'+
                                '                            <td class="editCellSelect" data-key="documento" data-type="value" style="width: 350px; padding: 0 10px; text-align: left;">'+unicodeToChar(v.documento)+'</td>'+
                                '                            <td class="editCellSEI" data-key="nr_sei" data-type="num" style="width: 175px; text-align: left;">'+v.nr_sei+'</td>'+
                                '                            <td data-key="id_procedimento" data-type="num" style="text-align: left; display:none">'+v.id_procedimento+'</td>'+
                                '                            <td data-key="id_documento" data-type="num" style="text-align: left; display:none">'+v.id_documento+'</td>'+
                                '                            <td data-ref="previa" style="text-align: center; width: 50px;">'+previewDoc+'</td>'+
                                '                            <td style="width: 80px; text-align: center;">'+
                                '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                                '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                                '                           </td>'+  
                                '                        </tr>';
        });
    }

    var htmlBox =   '<div id="boxAfastamento" class="atividadeWork" data-demanda="'+(value && value.id_afastamento ? value.id_afastamento : 0)+'">'+
                    '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                    '      <tr>'+
                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                    '               <label for="afast_id_user"><i class="iconPopup iconSwitch fas fa-user-circle cinzaColor"></i>Usu\u00E1rio:</label>'+
                    '           </td>'+
                    '           <td class="required date" style="width: 230px;">'+
                    '               <select onchange="changeDatesAfast(this); updateOptionSelectMotivo(this);" class="data_extract" style="font-size: 1em;" data-key="id_user" id="afast_id_user" data-type="user">'+optionSelectUser+'</select>'+
                    '               <input type="hidden" class="data_extract" data-key="id_afastamento" data-type="id" value="'+(value && value.id_afastamento ? value.id_afastamento : 0)+'">'+
                    '           </td>'+
                    '           <td style="vertical-align: bottom;" class="label">'+
                    '               <label class="last" for="afast_id_tipo_motivo"><i class="iconPopup iconSwitch fas fa-luggage-cart cinzaColor" style="float: initial;"></i>Motivo do Afastamento:</label>'+
                    '           </td>'+
                    '           <td class="required">'+
                    '               <select class="data_extract" onchange="checkInputAfast(this)" style="font-size: 1em;" data-key="id_tipo_motivo" id="afast_id_tipo_motivo">'+optionSelectMotivo+'</select>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr style="height: 20px;">'+
                    '          <td colspan="3"></td>'+
                    '          <td>'+
                    '               <div class="onoffswitch" style="float: left;transform: scale(0.8);">'+
                    '                   <input type="checkbox" data-key="afast_all_day" onchange="changeInputAfast(this)" name="onoffswitch" class="onoffswitch-checkbox" id="afast_all_day" tabindex="0" checked>'+
                    '                   <label class="onoffswitch-label" for="afast_all_day"></label>'+
                    '               </div>'+
                    '               <label for="afast_all_day" style="float: left;display: inline-block;margin: 5px;">O dia inteiro</label>'+
                    '          </td>'+
                    '      </tr>'+
                    '      <tr>'+
                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                    '               <label for="afast_inicio_afastamento"><i class="iconPopup iconSwitch fas fa-user-check cinzaColor"></i>In\u00EDcio do Afastamento:</label>'+
                    '           </td>'+
                    '           <td class="required date">'+
                    '               <input type="'+type_input+'" onchange="changeDatesAfast(this)" data-key="inicio_afastamento" id="afast_inicio_afastamento" data-type="inicio" class="data_extract" data-name="data de in\u00EDcio do afastamento" value="'+(value && value.inicio_afastamento ? moment(value.inicio_afastamento,'YYYY-MM-DD HH:mm:ss').format(format_sys) : moment().format(format_sys))+'" required>'+
                    '           </td>'+
                    '           <td style="vertical-align: bottom;" class="label">'+
                    '               <label class="last" for="afast_fim_afastamento"><i class="iconPopup iconSwitch fas fa-user-clock cinzaColor" style="float: initial;"></i>Fim do Afastamento:</label>'+
                    '           </td>'+
                    '           <td class="required date">'+
                    '               <input type="'+type_input+'" onchange="changeDatesAfast(this)" data-key="fim_afastamento" id="afast_fim_afastamento" data-type="fim" class="data_extract" data-name="data final do afastamento" value="'+(value && value.fim_afastamento ? moment(value.fim_afastamento,'YYYY-MM-DD HH:mm:ss').format(format_sys) : moment().add(1, 'days').format(format_sys))+'" required>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr style="height: 40px;'+(!exige_documentacao ? '': 'display:none;')+'" class="afastBox_observacao">'+
                    '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-comment-alt cinzaColor"></i>'+__.Observacoes+':</td>'+
                    '          <td colspan="3" class="required"><textarea class="data_extract" style="font-size: 1em; width: 97%;" data-key="observacoes" required>'+(value && value.observacoes ? value.observacoes : '')+'</textarea></td>'+
                    '      </tr>'+
                    '      <tr style="'+(exige_documentacao ? '': 'display:none;')+'" class="afastBox_documentacao">'+
                    '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                    '               <label><i class="iconPopup iconSwitch fas fa-file-signature cinzaColor"></i>Documentos Vinculados:</label>'+
                    '           </td>'+
                    '           <td colspan="3">'+
                    '               <table id="configBox_documentos" data-format="obj" data-key="documentos" style="font-size: 8pt !important;width: 100%;" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebra tableFollow tableAtividades">'+
                    '                    <thead>'+
                    '                        <tr class="tableHeader">'+
                    '                            <th class="tituloControle" style="width: 350px;">Tipo de Documento</th>'+
                    '                            <th class="tituloControle" style="width: 175px;">N\u00FAmero SEI</th>'+
                    '                            <th class="tituloControle" style="display:none">id_procedimento</th>'+
                    '                            <th class="tituloControle" style="display:none">id_documento</th>'+
                    '                            <th class="tituloControle" style="width: 50px;">Pr\u00E9via</th>'+
                    '                            <th class="tituloControle" style="width: 80px;">Ordem</th>'+
                    '                        </tr>'+
                    '                    </thead>'+
                    '                    <tbody>'+
                    htmlDocs+
                    '                        <tr data-index="'+documentos_len+'" data-key="documentos" data-value="'+documentos_len+'" data-id="'+documentos_len+'">'+
                    '                            <td class="editCellSelect" data-key="documento" data-type="value" style="width: 350px; padding: 0 10px; text-align: left;"></td>'+
                    '                            <td class="editCellSEI" data-key="nr_sei" data-type="num" style="width: 175px; text-align: left;"></td>'+
                    '                            <td data-key="id_procedimento" data-type="num" style="text-align: left; display:none">0</td>'+
                    '                            <td data-key="id_documento" data-type="num" style="text-align: left; display:none">0</td>'+
                    '                            <td data-ref="previa" style="text-align: center; width: 50px;"></td>'+
                    '                            <td style="width: 80px; text-align: center;">'+
                    '                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                    '                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                    '                           </td>'+  
                    '                        </tr>'+
                    '                    </tbody>'+
                    '                    <tfoot>'+
                    '                       <tr>'+
                    '                           <th colspan="6" style="text-align: right;">'+
                    '                               <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                    '                                   <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                    '                                   Adicionar novo item'+
                    '                               </a>'+
                    '                           </th>'+
                    '                       </tr>'+
                    '                    </tfoot>'+
                    '                </table>'+
                    '           </td>'+
                    '      </tr>'+
                    '      <tr style="height: auto;">'+
                    '          <td style="vertical-align: bottom; text-align: left;" class="label" colspan="4" id="infoBox_dateAfast">'+
                    '               '+
                    '           </td>'+
                    '      </tr>'+
                    '   </table>'+
                    '</div>';
    if (value && id_afastamento != 0) {
        if ($('#tableAfastamento tr.infraTrMarcada').length > 0) {
            $('#tableAfastamento').find('.lnkInfraCheck').data('index',1).trigger('click');
        }
        _this.closest('tr').find('td').eq(0).find('input[type="checkbox"]').trigger('click');
    }

    if (checkCapacidade('save_afastamento')) {
        resetDialogBoxPro('dialogBoxPro');
        dialogBoxPro = $('#dialogBoxPro')
            .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
            .dialog({
                title: (value && id_afastamento != 0 ? 'Editar Afatamento: '+value.apelido+': '+value.nome_motivo : 'Adicionar Afastamento'),
                width: 780,
                open: function() { 
                    updateButtonConfirm(this, true);
                    prepareFieldsReplace(this);
                    if($.isEmptyObject(arrayListTypesSEI)) getListTypesSEI();
                
                    configBox = new SimpleTableCellEditor('configBox_documentos');
                    configBox.SetEditableClass("editCellSEI", { 
                        validation: $.isNumeric,
                        internals: {
                            renderEditor: (elem, oldVal) => {
                                $(elem).html('<input type="number" onchange="checkOptionConfigSEI(this)" style="max-width: 80%;" value="'+oldVal+'">').find('input').focus();
                            }
                        }
                    });
                    configBox.SetEditableClass("editCellSelect", {  
                        internals: {
                            renderEditor: (elem, oldVal) => {
                                var _this = $(elem);
                                var data_elem = _this.data();
                                var data_tr = _this.closest('tr').data();
                                var arrayList = (data_tr.key == 'documentos') ? arrayListTypesSEI.selSeriePesquisa : [];
                                if (arrayList && arrayList.length > 0) {
                                    var selectArray = (data_tr.key == 'perfil') 
                                                    ? jmespath.search(arrayList,"[*].{label: name, value: value, nivel: nivel}")
                                                    : jmespath.search(arrayList,"[*].{label: name, value: value}");
                                        selectArray = selectArray.filter((v,i,a)=>a.findIndex(t=>(t.value === v.value))===i);
                                    var htmlOptions = $.map(selectArray, function(v){
                                                            var selected = (v.label == _this.text().trim()) ? 'selected' : ''; 
                                                            var disable = (data_tr.key == 'perfil' && arrayConfigAtividades.perfil.nivel > v.nivel) ? 'disabled' : '';
                                                                return '<option value="'+v.value+'" '+selected+' '+disable+'>'+v.label+'</option>';
                                                        }).join('');
                                }
                                _this.html(`<select data-type="documentos" onchange="changeSelectConfigItem(this)" onblur="changeSelectConfigItem(this)"><option value=" "></option>`+htmlOptions+'</select>')
                                    .find('select')
                                    .chosen({
                                        placeholder_text_single: ' ',
                                        no_results_text: 'Nenhum resultado encontrado'
                                    });
                            },
                            renderValue: (elem, formattedNewVal) => { 
                                    $(elem).text(formattedNewVal); 
                            },
                            extractEditorValue: (elem) => { 
                                return $(elem).find('select').find('option:selected').text().trim(); 
                            },
                        }
                    });
                    
                    $(".tableOptionConfig.tableSortable tbody").sortable({
                        items: 'tr',
                        cursor: 'grabbing',
                        handle: '.sorterTrConfig',
                        forceHelperSize: true,
                        opacity: 0.5,
                        axis: 'y',
                        dropOnEmpty: false,
                        update: function(event, ui) {
                            $(this).find('tr').each(function(index, value){
                                $(this).attr('data-index',index).data('index',index);
                            })
                        }
                    });
                },
                close: function() { 
                    if (_this.closest('tr').hasClass('infraTrMarcada')) {
                        $('#tableAfastamento').find('.lnkInfraCheck').data('index',1).trigger('click');
                    }
                    $('#boxAfastamento').remove();
                    resetDialogBoxPro('dialogBoxPro');
                },
                buttons: [{
                    text: (value && id_afastamento != 0 ? 'Editar' : 'Adicionar'),
                    class: 'confirm',
                    click: function(event) { 
                        var _parent = $(this).closest('.ui-dialog');
                        var target = _parent.find('input[data-type="inicio"]').get(0);
                        if (checkDatesAfast(target) && checkAtivRequiredFields(target, 'mark') && checkAtivRequiredDocuments(target)) {
                            var param = extractDataAfast(_parent);
                            var action = (value && id_afastamento != 0 ? 'edit_afastamento' : 'save_afastamento');
                                param.action = action;
                                getServerAtividades(param, action);
                        }
                    }
                }]
        });
    }
}
function checkDatesPlanoAfast(value, arrayAfastamentos = arrayConfigAtividades.afastamentos) {
    var config_unidade = getConfigDadosUnidade(value.sigla_unidade);
    var config_feriados = (typeof config_unidade.feriados !== 'undefined' && config_unidade.feriados !== null) ? config_unidade.feriados : false;
    var arrayFeriados = (config_unidade.count_dias_uteis && value.data_inicio_vigencia != '' && value.data_fim_vigencia != '') 
                        ? jmespath.search(getHolidayBetweenDates(moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss').format('Y')+'-01-01', moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').add(1, 'Y').format('Y')+'-01-01', config_feriados), "[*].d_")
                        : [];
    var inicio = moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss');
    var fim = moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss');
    var valueDias = (config_unidade.count_dias_uteis) 
                ? moment().isoWeekdayCalc({  
                    rangeStart: value.data_inicio_vigencia,  
                    rangeEnd: value.data_fim_vigencia,  
                    weekdays: [1,2,3,4,5],  
                    exclusions: arrayFeriados
                })
                : moment(value.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss').diff(moment(value.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss'), 'days');
        valueDias = (valueDias < 0) ? 0 : valueDias;

    function getLoopDatesPlano(checkLoopDatesPlanoAfastLoop, carga_horaria, data_afast) {
        var result_ = 0;
        checkLoopDatesPlanoAfastLoop.forEach(function (id, index) {
            var afastResult = jmespath.search(arrayAfastamentos.lista,"[?id_afastamento==`"+id+"`] | [0]");
            var checkHorasAfastamento = (afastResult && afastResult !== null) 
                        ? jmespath.search(arrayAfastamentos.tipos_motivos, "[?id_tipo_motivo==`"+afastResult.id_tipo_motivo+"`] | [0].config.horas_afastamento") : false;
            var fatorMultiplicacao = (afastResult && afastResult !== null) 
                        ? jmespath.search(arrayAfastamentos.tipos_motivos, "[?id_tipo_motivo==`"+afastResult.id_tipo_motivo+"`] | [0].config.fator_multiplicacao") : 1;
            var horasAfastamento = (checkHorasAfastamento) 
                        ? moment(afastResult.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').diff(moment(afastResult.inicio_afastamento, 'YYYY-MM-DD HH:mm:ss'), 'hours', true) 
                        : value.carga_horaria;
                horasAfastamento = (horasAfastamento > value.carga_horaria) ? value.carga_horaria : horasAfastamento;
                horasAfastamento = (isNumeric(fatorMultiplicacao) && fatorMultiplicacao > 0) ? horasAfastamento * fatorMultiplicacao : horasAfastamento;
                horasAfastamento = (isNumeric(fatorMultiplicacao) && fatorMultiplicacao == 0) ? 0 : horasAfastamento;
                horasAfastamento = (result_ >= carga_horaria) 
                                ? 0 
                                : (result_ < carga_horaria && result_+horasAfastamento >= carga_horaria) ? carga_horaria-result_ : horasAfastamento;
                result_ = result_+horasAfastamento;
            
                // console.log({afastResult: afastResult, fatorMultiplicacao: fatorMultiplicacao, horasAfastamento: horasAfastamento});

            calcRelatorioMetaProporcional('afastamentos', {afastamento: afastResult, check_horas_afastamento: checkHorasAfastamento, horas_afastamento: horasAfastamento, data_afastamento: data_afast.format('DD/MM/YYYY')});
        });
        return result_;
    }

    var valueExclusion = 0;
    var horaExclusion = 0;

    var init_datesPlanoAfastLoop = checkDatesPlanoAfastLoop(inicio, value.id_user, arrayFeriados);
    if (init_datesPlanoAfastLoop && init_datesPlanoAfastLoop.length > 0) { 
        var horaExclusion_init = getLoopDatesPlano(init_datesPlanoAfastLoop, value.carga_horaria, inicio);
            horaExclusion_init = (horaExclusion_init > value.carga_horaria) ? value.carga_horaria : horaExclusion_init;
            horaExclusion = (horaExclusion_init) ? horaExclusion+horaExclusion_init : horaExclusion;
            valueExclusion++ 
    }

    while(inicio.add(1, 'days').diff(fim) < 0) {
        var dt_inicio = inicio.clone();
        var loop_datesPlanoAfastLoop = checkDatesPlanoAfastLoop(dt_inicio, value.id_user, arrayFeriados);
        if (loop_datesPlanoAfastLoop && loop_datesPlanoAfastLoop.length > 0) {
            var horaExclusion_loop = getLoopDatesPlano(loop_datesPlanoAfastLoop, value.carga_horaria, dt_inicio);
                horaExclusion_loop = (horaExclusion_loop > value.carga_horaria) ? value.carga_horaria : horaExclusion_loop;
                horaExclusion = (horaExclusion_loop) ? horaExclusion+horaExclusion_loop : horaExclusion;
                valueExclusion++;
        }
    }
    /*
    var last_datesPlanoAfastLoop = checkDatesPlanoAfastLoop(fim, value.id_user, arrayFeriados);
    if (last_datesPlanoAfastLoop && last_datesPlanoAfastLoop.length > 0) { 
        var horaExclusion_last = getLoopDatesPlano(last_datesPlanoAfastLoop);
            horaExclusion_last = (horaExclusion_last > value.carga_horaria) ? value.carga_horaria : horaExclusion_last;
            horaExclusion = (horaExclusion_last) ? horaExclusion+horaExclusion_last : horaExclusion;
            valueExclusion++ 
    }
    console.log('horaExclusion_last', fim.format('DD/MM/YYYY'));
    */

    // console.log({horaExclusion: horaExclusion, id_plano: value.id_plano, id_user: value.id_user, valueDias: valueDias, check: isNaN(parseFloat(valueDias)), valueExclusion: valueExclusion, carga_horaria: value.carga_horaria});

    return {
            id_user: value.id_user,
            id_plano: value.id_plano,
            dias_afastamento: valueExclusion, 
            dias_plano: valueDias, 
            tempo_afastamento: horaExclusion,
            // tempo_afastamento: valueExclusion*value.carga_horaria,
            tempo_plano: valueDias*value.carga_horaria,
            dias_proporcional: (valueDias-valueExclusion),
            tempo_proporcional: value.tempo_total-horaExclusion
            // tempo_proporcional: (valueDias-valueExclusion)*value.carga_horaria
           };
}
function checkDatesPlanoAfastLoop(dt_inicio, id_user, arrayFeriados) {
    var dt_inicio_format = dt_inicio.format('YYYY-MM-DD');
    // var check = checkDatesBetweenAfast(dt_inicio_format, id_user, 0, true);
    var array = jmespath.search(arrayConfigAtividades.afastamentos.lista,"[?id_user==`"+id_user+"`]");
    var check = checkDatesBetweenArray(array, dt_inicio_format, 0, 0, {inicio: 'inicio_afastamento', fim: 'fim_afastamento', id: 'id_user', idreftype: 'id_afastamento'}, true, true);
    
    // console.log({check: check, afastamentos: arrayConfigAtividades.afastamentos.lista, dt_inicio_format: dt_inicio_format, id_user: id_user, ref: 0, param: {inicio: 'inicio_afastamento', fim: 'fim_afastamento', id: 'id_user'}, exclude: true});

    if (check.length > 0  && dt_inicio.weekday() != 6 && dt_inicio.weekday() != 0 && arrayFeriados.indexOf(dt_inicio_format) === -1) {
        return check;
    } else {
        return false;
    }
}
function getChartProdutividadeMes(id_plano, mode = 'get', data, openDialog = true) {
    var arrayPlano = jmespath.search(tableConfigList.planos,"[?id_plano==`"+id_plano+"`] | [0]");
    var arrayPlano = arrayPlano === null ? jmespath.search(arrayConfigAtividades.planos,"[?id_plano==`"+id_plano+"`] | [0]") : arrayPlano;
    var titleDialog = arrayPlano === null ? '' : arrayPlano.apelido+' - '+arrayPlano.apelido_avaliacao_duracao[1];
    // console.log(arrayPlano);

    var idElem = 'dataChartPlanos';
    if (mode == 'get') {
        var action = 'chart_produtividade_mensal';
        var param = {
            action: action,
            id_plano: id_plano
        };
        getServerAtividades(param, action);
        if (openDialog) {
            var htmlBox =   '<div id="view_doc" class="reportWork">'+
                            '   <div id="'+idElem+'" class="dataFallback dataLoading" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div>'+
                            '</div>';

                    resetDialogBoxPro('dialogBoxPro');
                        dialogBoxPro = $('#dialogBoxPro')
                        .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
                        .dialog({
                            title: 'Produtividade Mensal do Plano: '+titleDialog,
                            width: 1200,
                        open: function() { 
                        },
                        close: function() { 
                            $('#dialogBoxDiv').remove();
                            resetDialogBoxPro('dialogBoxPro');
                        },
                        buttons: [{
                            text: 'Ok',
                            class: 'confirm',
                            click: function(event) {
                                $('#dialogBoxDiv').remove();
                                resetDialogBoxPro('dialogBoxPro');
                            }
                        }]
                    });
        }
    } else {
        var plano = data.result;
        var dias_af = [];

        if (data.status == 1 && plano.length > 0) {
            var height = 23*(plano.length+1);
            var elemChart = $('#'+idElem);
                elemChart.removeClass('dataLoading').removeClass('dataFallback');
                elemChart.html('<canvas id="'+idElem+'_canvas" width="380" height="'+height+'"></canvas><canvas id="'+idElem+'_produtividade_canvas" width="380" height="'+height+'"></canvas>');
            var element = $('#'+idElem+'_canvas');
            var arrayProgramado = $.map(plano, function(v){
                var dataFim = moment(v.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss') > moment() && moment(v.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss') <= moment() ? moment().format('YYYY-MM-DD HH:mm:ss') : v.data_fim_vigencia;
                var dias_uteis = getWorkDaysBetweenDates(v.data_inicio_vigencia, dataFim, v.sigla_unidade).dias;
                var horas_plano = dias_uteis * v.carga_horaria;
                var horas_afastamento = checkDatesPlanoAfast(v, arrayAfastamentos = v.afastamentos);
                var tempo_planjeado = horas_plano - horas_afastamento.tempo_afastamento;
                return moment(v.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss') > moment() ? 0 : tempo_planjeado;
            });

            var dataPlanos = window.chart_data_planos;
            var planoIndex = typeof dataPlanos !== 'undefined' ? dataPlanos.findIndex((obj => obj.id_plano == id_plano)) : -1;
            if (planoIndex !== -1) dataPlanos[planoIndex].tempo_programado = arrayProgramado.reduce(function(a, b) { return a + b; }, 0);

            var planoIndexAtiv = typeof arrayConfigAtividades.planos !== 'undefined' ? arrayConfigAtividades.planos.findIndex((obj => obj.id_plano == id_plano)) : -1;
            if (planoIndexAtiv !== -1) arrayConfigAtividades.planos[planoIndexAtiv].tempo_programado = arrayProgramado.reduce(function(a, b) { return a + b; }, 0);

            var planoIndexConfig = typeof tableConfigList !== 'undefined' && typeof tableConfigList.planos !== 'undefined' ? tableConfigList.planos.findIndex((obj => obj.id_plano == id_plano)) : -1;
            if (planoIndexConfig !== -1) tableConfigList.planos[planoIndexConfig].tempo_programado = arrayProgramado.reduce(function(a, b) { return a + b; }, 0);

            if (!$('#dialogBoxDiv').length) getTempoProgamadoPlanos();

            if (element.length > 0) {
                new Chart(element).destroy();
                var dataset = [{
                        label: 'Homologado',
                        backgroundColor: chartColors.green,
                        data: [arrayPlano.tempo_homologado].concat(jmespath.search(plano, "[].tempo_homologado"))
                    },{
                        label: 'Entregue',
                        backgroundColor: chartColors.dark_blue,
                        data: [arrayPlano.tempo_entregue].concat(jmespath.search(plano, "[].tempo_entregue"))
                    }, {
                        label: 'Despendido',
                        backgroundColor: chartColors.yellow,
                        data: [arrayPlano.tempo_despendido].concat(jmespath.search(plano, "[].tempo_despendido")),
                        hidden: checkOptionEntidade('desativa_produtividade_geral')
                    }, {
                        label: 'Pactuado',
                        backgroundColor: chartColors.blue,
                        data: [arrayPlano.tempo_pactuado].concat(jmespath.search(plano, "[].tempo_pactuado"))
                    }, {
                        label: 'Programado',
                        backgroundColor: chartColors.silver,
                        data: [arrayProgramado.reduce(function(a, b) { return a + b; }, 0)].concat(arrayProgramado)
                    }, {
                        label: 'Plano',
                        backgroundColor: chartColors.light_grey,
                        data: [arrayPlano.tempo_proporcional].concat($.map(plano, function(v){
                            var dias_uteis = getWorkDaysBetweenDates(v.data_inicio_vigencia, v.data_fim_vigencia, v.sigla_unidade).dias;
                            var horas_plano = dias_uteis * v.carga_horaria;
                                v.tempo_total = horas_plano;
                            var horas_afastamento = checkDatesPlanoAfast(v, arrayAfastamentos = v.afastamentos);
                            var tempo_proporcional = horas_afastamento.tempo_proporcional;
                            var dias_afastamento = parseFloat((horas_afastamento.tempo_afastamento/v.carga_horaria).toFixed(2));
                                dias_af.push(dias_afastamento);
                            // console.log('***',{dias_af: dias_af, data_inicio_vigencia:v.data_inicio_vigencia, data_fim_vigencia: v.data_fim_vigencia, horas_afastamento: horas_afastamento, dias_uteis:dias_uteis, dias_afastamento:v.dias_afastamento, carga_horaria:v.carga_horaria, horas_plano:horas_plano});
                            return parseFloat(tempo_proporcional.toFixed(2));
                        }))
                    }];
    
                var chartTempoPlano = new Chart(element, {
                    type: 'horizontalBar',
                    data: {
                            labels: [arrayPlano.apelido_avaliacao_duracao].concat(jmespath.search(plano, "[].mes_ano")),
                            datasets: dataset
    
                        },
                    options: {
                        scales: {
                            xAxes: [{
                                //stacked: true,
                                gridLines: { display: false },
                                ticks: {
                                    fontSize: 10,
                                    min: 0,
                                    padding: -10
                                }
                            }],
                            yAxes: [{
                                stacked: true,
                                gridLines: { display: false }
                            }]
                        },
                        legend: {
                            display: true,
                            align: 'end',
                            labels: {
                                boxWidth: 10,
                                fontColor: (localStorage.getItem('darkModePro') ? chartColors.light_grey : chartColors.dark_grey),
                                fontSize: 10
                            },
                            onClick: setChartLabelItemStore
                        },
                        title: {
                            display: true,
                            text: 'Distribui\u00E7\u00E3o Mensal do Plano de Trabalho'
                        },
                        tooltips: {
                            caretPadding: -10,
                            caretSize: 0,
                            titleFontSize: 0,
                            titleSpacing: 0,
                            titleMarginBottom: 0,
                            callbacks: {
                                label: function(tooltipItem, data) {
                                    let label = data.datasets[tooltipItem.datasetIndex].label;
                                    let value = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                                    var planoIndex = data.datasets.findIndex(function(id_key) {
                                                        return id_key.label == "Plano"
                                                    });
                                    let valuePlano = (planoIndex === -1) ? false : data.datasets[planoIndex].data[tooltipItem.index];
                                    var valuePercent = !valuePlano 
                                                    ? '' 
                                                    : (tooltipItem.datasetIndex != planoIndex) ? ' ('+((value/valuePlano)*100).toFixed(2)+'%)' : '';
                                    return ' ' + label + ': '+value+' horas'+valuePercent;
                
                                }
                            }
                        }
                    }
                });
                getChartLabelItemStore(idElem, chartTempoPlano);
            }
            if (!checkOptionEntidade('desativa_produtividade_geral')) {
                var elementP = $('#'+idElem+'_produtividade_canvas');
                if (elementP.length > 0) {
                    var title = 'Produtividade Mensal do Plano de Trabalho';
                    var xTitle = 'M\u00EAs';
                    var y1Title = 'Produtividade';
                    var y2Title = 'Nota Demandas e Afastamentos';
                    var dataset = [{
                            label: 'Produtividade por agilidade',
                            backgroundColor: chartColors.orange,
                            borderColor: chartColors.orange,
                            fill: false,
                            yAxisID: 'y',
                            data: jmespath.search(plano, "[].produtividade")
                        },{
                            label: 'Produtividade por antecipa\u00E7\u00E3o',
                            backgroundColor: chartColors.magenta,
                            borderColor: chartColors.magenta,
                            fill: false,
                            yAxisID: 'y',
                            data: jmespath.search(plano, "[].produtividade_executada")
                        }, {
                            label: 'Nota atribu\u00EDda',
                            backgroundColor: chartColors.blue,
                            borderColor: chartColors.blue,
                            fill: false,
                            yAxisID: 'y1',
                            data: jmespath.search(plano, "[].nota_atribuida")
                        }, {
                            label: 'Dias de afastamento',
                            backgroundColor: chartColors.gray,
                            borderColor: chartColors.gray,
                            fill: false,
                            yAxisID: 'y1',
                            data: dias_af
                            // data: jmespath.search(plano, "[].dias_afastamento")
                        }, {
                            label: 'Quantidade de demandas',
                            backgroundColor: chartColors.green,
                            borderColor: chartColors.green,
                            fill: false,
                            yAxisID: 'y1',
                            data: jmespath.search(plano, "[].quantidade_demandas")
                        }];
                    var chartData = {
                                        labels: jmespath.search(plano, "[].mes_ano"),
                                        datasets: dataset
                                    };
                    setChartLines2Y(idElem+'_produtividade', chartData, title, xTitle, y1Title, y2Title);
                }
            }
            centralizeDialogBox(dialogBoxPro);
        } else {
            $('.reportWork .dataFallback').removeClass('dataLoading');
        }
    }
}
function getRelatorioMetaProporcional(id_plano) {

    var htmlBox =   '<div id="view_doc" class="atividadeWork">'+
                    '      <table style="font-size: 10pt;width: 100%;" class="seiProForm calculoPlanoProp tableLine tableInfo tableDialog">'+
                    '              <tr>'+
                    '                  <td style="text-align: left;">Participante</td>'+
                    '                  <td class="tituloPlanoParticipante" style="text-align: left;" colspan="3"></td>'+
                    '              </tr>'+
                    '              <tr>'+
                    '                  <td style="text-align: left;">Modalidade</td>'+
                    '                  <td class="tituloPlanoModalidade" style="text-align: left;" colspan="3"></td>'+
                    '              </tr>'+
                    '              <tr>'+
                    '                  <td style="text-align: left;">Dura\u00E7\u00E3o</td>'+
                    '                  <td class="tituloPlanoDuracao" style="text-align: left;" colspan="3"></td>'+
                    '              </tr>'+
                    '              <tr>'+
                    '                  <td style="text-align: left;">Carga Hor&aacute;ria</td>'+
                    '                  <td class="totalCargaDias" style="text-align: left;">di\u00E1rio</td>'+
                    '                  <td class="totalCargaHoras" colspan="2" style="text-align: left;"></td>'+
                    '              </tr>'+
                    '              <tr>'+
                    '                  <td style="text-align: left;">Total do plano</td>'+
                    '                  <td class="totalPlanoDias" style="text-align: left;"></td>'+
                    '                  <td class="totalPlanoHoras" colspan="2" style="text-align: left;"></td>'+
                    '              </tr>'+
                    '              <tr>'+
                    '                  <td style="text-align: left;">Finais de semana</td>'+
                    '                  <td class="totalWeekendDias" style="text-align: left;"></td>'+
                    '                  <td class="totalWeekendHoras" colspan="2" style="text-align: left;"></td>'+
                    '              </tr>'+
                    '              <tr>'+
                    '                  <td style="text-align: left;">Feriados</td>'+
                    '                  <td class="totalHolidayDias" style="text-align: left;"></td>'+
                    '                  <td class="totalHolidayHoras" style="text-align: left;"></td>'+
                    '                  <td class="detalheHoliday" style="text-align: left; width: 90px;">'+
                    '                     <a class="newLink" onclick="toogleByID(this)" data-ref="detalheCalcFeriado" style="text-decoration: underline;font-size: 10pt;cursor: pointer;color: blue;">'+
                    '                       Detalhar '+
                    '                       <i class="fas fa-angle-double-right" style="font-size: 10pt;text-decoration: underline;margin: 0;color: blue;"></i>'+
                    '                     </a>'+
                    '                   </td>'+
                    '              </tr>'+
                    '              <tr style="display:none;" id="detalheCalcFeriado">'+
                    '                  <td colspan="4">'+
                    '                     <div class="tabelaPanelScroll" style="margin-top: 10px;height: 300px;">'+
                    '                        <table style="font-size: 10pt;width: 100%;" class="seiProForm calculoFeriado tableLine tableInfo tableZebra tableDialog">'+
                    '                           <thead>'+
                    '                                <tr class="tableHeader">'+
                    '                                    <th class="tituloControle">Feriados</td>'+
                    '                                    <th class="tituloControle">Data</td>'+
                    '                                    <th class="tituloControle">Horas</td>'+
                    '                                </tr>'+
                    '                           </thead>'+
                    '                           <tbody>'+
                    '                           </tbody>'+
                    '                           <tfoot>'+
                    '                                <tr class="tableHeader">'+
                    '                                    <th class="tituloControle" colspan="2">Total</td>'+
                    '                                    <th class="tituloControle totalHoras"></td>'+
                    '                                </tr>'+
                    '                           </tfoot>'+
                    '                        </table>'+
                    '                     </div>'+
                    '                  </td>'+
                    '              </tr>'+
                    '              <tr>'+
                    '                  <td style="text-align: left;"><strong>Meta Total do Plano (horas)</strong></td>'+
                    '                  <td class="totalMetaPlanoDias" style="text-align: left;"></td>'+
                    '                  <td class="totalMetaPlanoHoras" colspan="2" style="text-align: left;"></td>'+
                    '              </tr>'+
                    '              <tr>'+
                    '                  <td style="text-align: left;">Afastamentos</td>'+
                    '                  <td class="totalAfastCount" style="text-align: left;"></td>'+
                    '                  <td class="totalAfastHoras" style="text-align: left;"></td>'+
                    '                  <td class="detalheAfast" style="text-align: left;">'+
                    '                     <a class="newLink" onclick="toogleByID(this)" data-ref="detalheCalcAfast" style="text-decoration: underline;font-size: 10pt;cursor: pointer;color: blue;">'+
                    '                       Detalhar '+
                    '                       <i class="fas fa-angle-double-right" style="font-size: 10pt;text-decoration: underline;margin: 0;color: blue;"></i>'+
                    '                     </a>'+
                    '                   </td>'+
                    '              </tr>'+
                    '              <tr style="display:none;" id="detalheCalcAfast">'+
                    '                  <td colspan="4">'+
                    '                      <div class="tabelaPanelScroll" style="margin-top: 10px;height: 400px;">'+
                    '                         <table style="font-size: 10pt;width: 100%;" class="seiProForm calculoAfastamento tableLine tableInfo tableZebra tableDialog ">'+
                    '                            <thead>'+
                    '                                 <tr class="tableHeader">'+
                    '                                     <th class="tituloControle">Motivo do Afastamento</td>'+
                    '                                     <th class="tituloControle" style="width: 260px;">Observa\u00E7\u00F5es</td>'+
                    '                                     <th class="tituloControle">Data</td>'+
                    '                                     <th class="tituloControle">Per\u00EDodo</td>'+
                    '                                     <th class="tituloControle">Horas</td>'+
                    '                                 </tr>'+
                    '                            </thead>'+
                    '                            <tbody>'+
                    '                            </tbody>'+
                    '                            <tfoot>'+
                    '                                 <tr class="tableHeader">'+
                    '                                     <th class="tituloControle" colspan="4">Total</td>'+
                    '                                     <th class="tituloControle totalHoras"></td>'+
                    '                                 </tr>'+
                    '                            </tfoot>'+
                    '                         </table>'+
                    '                      </div>'+
                    '                  </td>'+
                    '              </tr>'+
                    '              <tr>'+
                    '                  <td colspan="2" style="text-align: left;"><strong>Meta proporcional do Plano</strong></td>'+
                    '                  <td class="totalMetaProporcional" colspan="2" style="text-align: left;"></td>'+
                    '              </tr>'+
                    '      </table>'+
                    '</div>';

    resetDialogBoxPro('dialogBoxPro');
    dialogBoxPro = $('#dialogBoxPro')
        .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
        .dialog({
            title: 'Mem\u00F3ria de C\u00E1lculo de Meta Proporcional',
            width: 990,
            open: function() { 
                window.calculoMetaPropAfast = false;
                window.calculoMetaPropAfastCount = false;
                window.calculoMetaPropPlano = false;
                window.calculoMetaPropFeriado = false;
                window.calculoMetaPropFeriadoCount = false;
                var value = jmespath.search(tableConfigList.planos,"[?id_plano==`"+id_plano+"`] | [0]");
                    value = (typeof value !== 'undefined' && value !== null) ? value : false;
                    if (value) {
                        window.calculoMetaPropPlano = value;
                        updateConfigTempoPactuadoById(value.id_plano);
                    }
            },
            close: function() { 
                $('#dialogBoxDiv').remove();
                resetDialogBoxPro('dialogBoxPro');
            },
            buttons: [{
                text: 'Imprimir',
                icon: 'ui-icon-print',
                click: function(event) {
                    printDocumento();
                }
            },{
                text: 'Ok',
                class: 'confirm',
                click: function(event) {
                    $('#dialogBoxDiv').remove();
                    resetDialogBoxPro('dialogBoxPro');
                }
            }]
    });
}
function calcRelatorioMetaProporcional(mode, data) {
    if (mode == 'afastamentos' && data.afastamento !== null) {
        var htmlTableRelatorio =    '<tr>'+
                                    '    <td style="text-align: left;">'+(data.afastamento.nome_motivo || '')+'</td>'+
                                    '    <td style="text-align: left;">'+(data.afastamento.observacoes || '')+'</td>'+
                                    '    <td style="text-align: left;">'+(data.data_afastamento || '')+'</td>'+
                                    '    <td style="text-align: left;">'+moment(data.afastamento.inicio_afastamento,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm')+' \u00E0 '+moment(data.afastamento.fim_afastamento,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm')+'</td>'+
                                    '    <td>'+decimalHourToMinute(data.horas_afastamento)+'</td>'+
                                    '</tr>';
        $('.calculoAfastamento tbody').append(htmlTableRelatorio);
        var fatorMultiplicacao = (data.afastamento && data.afastamento !== null) 
                                ? jmespath.search(arrayConfigAtividades.afastamentos.tipos_motivos, "[?id_tipo_motivo==`"+data.afastamento.id_tipo_motivo+"`] | [0].config.fator_multiplicacao") : 1;
        var calculoMetaPropAfast = window.calculoMetaPropAfast;
            calculoMetaPropAfast = (typeof calculoMetaPropAfast !== 'undefined' && calculoMetaPropAfast) ? calculoMetaPropAfast+data.horas_afastamento : data.horas_afastamento;
            calculoMetaPropAfast = (isNumeric(fatorMultiplicacao) && fatorMultiplicacao > 0) ? calculoMetaPropAfast*fatorMultiplicacao : calculoMetaPropAfast;
            window.calculoMetaPropAfast = calculoMetaPropAfast;

        var calculoMetaPropAfastCount = window.calculoMetaPropAfastCount;
            calculoMetaPropAfastCount = (typeof calculoMetaPropAfastCount !== 'undefined' && calculoMetaPropAfastCount) ? calculoMetaPropAfastCount+1 : 1;
            window.calculoMetaPropAfastCount = calculoMetaPropAfastCount;
            
        $('.calculoAfastamento tfoot .totalHoras').text(decimalHourToMinute(calculoMetaPropAfast));
        $('.calculoPlanoProp .totalAfastHoras').text('(-) '+decimalHourToMinute(calculoMetaPropAfast));
        $('.calculoPlanoProp .totalAfastCount').text(calculoMetaPropAfastCount+' registros');
        // console.log({array: data, nome: data.afastamento.nome_motivo, obs: data.afastamento.observacoes, data: data.data_afastamento, hora: decimalHourToMinute(data.horas_afastamento), count: calculoMetaPropAfastCount, total: decimalHourToMinute(calculoMetaPropAfast) });

    } else if (mode == 'feriados') {
        if (window.calculoMetaPropPlano && typeof window.calculoMetaPropPlano !== 'undefined') {
            var start = moment(window.calculoMetaPropPlano.data_inicio_vigencia, 'YYYY-MM-DD HH:mm:ss');
            var finish = moment(window.calculoMetaPropPlano.data_fim_vigencia, 'YYYY-MM-DD HH:mm:ss');

                data.feriados = data.feriados.sort((a, b) => a.d_.localeCompare(b.d_));

            var feriados = $.map(data.feriados, function(f){
                var check = moment(f.m).isBetween(start, finish, 'days', '[]');
                if (check && f.m.weekday() != 0 && f.m.weekday() != 6) {
                    var htmlTableRelatorio =    '<tr>'+
                                                '    <td style="text-align: left;">'+unicodeToChar(f.dia)+'</td>'+
                                                '    <td style="text-align: left;">'+f.d+'</td>'+
                                                '    <td>'+decimalHourToMinute(window.calculoMetaPropPlano.carga_horaria)+'</td>'+
                                                '</tr>';
                            $('.calculoFeriado tbody').append(htmlTableRelatorio);

                        var calculoMetaPropFeriado = window.calculoMetaPropFeriado;
                            calculoMetaPropFeriado = (typeof calculoMetaPropFeriado !== 'undefined' && calculoMetaPropFeriado) ? calculoMetaPropFeriado+window.calculoMetaPropPlano.carga_horaria : window.calculoMetaPropPlano.carga_horaria;
                            window.calculoMetaPropFeriado = calculoMetaPropFeriado;
                            
                        var calculoMetaPropFeriadoCount = window.calculoMetaPropFeriadoCount;
                            calculoMetaPropFeriadoCount = (typeof calculoMetaPropFeriadoCount !== 'undefined' && calculoMetaPropFeriadoCount) ? calculoMetaPropFeriadoCount+1 : 1;
                            window.calculoMetaPropFeriadoCount = calculoMetaPropFeriadoCount;

                        $('.calculoFeriado tfoot .totalHoras').text(decimalHourToMinute(calculoMetaPropFeriado));
                        $('.calculoPlanoProp .totalHolidayHoras').text('(-) '+decimalHourToMinute(calculoMetaPropFeriado));
                        $('.calculoPlanoProp .totalHolidayDias').text(calculoMetaPropFeriadoCount+' dias');

                    return f;
                }
            });
            var totalPlanoDias = Math.abs(finish.diff(start,'days'))+1;
            var totalPlanoHoras = totalPlanoDias*window.calculoMetaPropPlano.carga_horaria;
            $('.calculoPlanoProp .totalPlanoDias').text(totalPlanoDias+' dias');
            $('.calculoPlanoProp .totalPlanoHoras').text(decimalHourToMinute(totalPlanoHoras));

            $('.calculoPlanoProp .totalCargaHoras').text(decimalHourToMinute(window.calculoMetaPropPlano.carga_horaria));

            var totalDiasUteis = moment().isoWeekdayCalc({  
                rangeStart: start.format('YYYY-MM-DD'),  
                rangeEnd: finish.format('YYYY-MM-DD'),  
                weekdays: [1,2,3,4,5],  
                exclusions: []
            });
            var totalWeekendDias = totalPlanoDias-totalDiasUteis;
            var totalWeekendHoras = totalWeekendDias*window.calculoMetaPropPlano.carga_horaria;
            $('.calculoPlanoProp .totalWeekendDias').text(totalWeekendDias+' dias');
            $('.calculoPlanoProp .totalWeekendHoras').text('(-) '+decimalHourToMinute(totalWeekendHoras));

            var totalMetaPlanoDias = totalPlanoDias-totalWeekendDias-calculoMetaPropFeriadoCount;
            var totalMetaPlanoHoras = totalMetaPlanoDias*window.calculoMetaPropPlano.carga_horaria;
            $('.calculoPlanoProp .totalMetaPlanoDias').text(totalMetaPlanoDias+' dias');
            $('.calculoPlanoProp .totalMetaPlanoHoras').text('(=) '+decimalHourToMinute(totalMetaPlanoHoras));

            setTimeout(function(){  
                var totalMetaProporcional = totalMetaPlanoHoras-window.calculoMetaPropAfast;
                $('.calculoPlanoProp .totalMetaProporcional').text('(=) '+decimalHourToMinute(totalMetaProporcional));
                loadingButtonConfirm(false);
            }, 500);
            
            $('.calculoPlanoProp .tituloPlanoParticipante').html(window.calculoMetaPropPlano.apelido_avaliacao);
            $('.calculoPlanoProp .tituloPlanoModalidade').html(window.calculoMetaPropPlano.nome_modalidade);
            $('.calculoPlanoProp .tituloPlanoDuracao').html(moment(window.calculoMetaPropPlano.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(window.calculoMetaPropPlano.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY'));
        }
    }
}
function updateTempoProporcionalPlanos() {
    var updatePlanos = []
    $.each(arrayConfigAtividades.planos, function(index, value){
        var arrayTempoProporcional = checkDatesPlanoAfast(value);
        if (arrayTempoProporcional.tempo_proporcional != value.tempo_proporcional) {
            updatePlanos.push({
                                id_plano: arrayTempoProporcional.id_plano,
                                tempo_proporcional: arrayTempoProporcional.tempo_proporcional,
                            });
        }
    });
    if (updatePlanos.length > 0) {
        var action = checkCapacidade('update_self_planos') ? 'update_self_planos' : 'update_planos';
        var param = {
            action: action,
            planos: updatePlanos
        };
        getServerAtividades(param, action);
    }
}
function updateArrayPlanos(planos) {
    $.each(planos, function(index, value){
        $.each(arrayConfigAtividades.planos, function(i, v){
            if (value.id_plano == v.id_plano) {
                arrayConfigAtividades.planos[i].tempo_proporcional = parseInt(value.tempo_proporcional);
            }
        });
    });
}
/*
function checkDatesLoopAfast(inicio, fim, id_user, id_afastamento) {
    var inicio_afastamento = moment(inicio, 'YYYY-MM-DD');
    var fim_afastamento = moment(fim, 'YYYY-MM-DD');
    var checkBetween = false;
    var checkInicio = checkDatesBetweenAfast(inicio_afastamento.format('YYYY-MM-DD'), id_user, id_afastamento);
    var checkFim = checkDatesBetweenAfast(fim_afastamento.format('YYYY-MM-DD'), id_user, id_afastamento);
        while(inicio_afastamento.add(1, 'days').diff(fim_afastamento) < 0) {
            var check = checkDatesBetweenAfast(inicio_afastamento.clone().format('YYYY-MM-DD'), id_user, id_afastamento);
            if (check) {
                checkBetween = true;
            }
        }
        // console.log(checkInicio, checkBetween, checkFim);
    return (checkInicio || checkBetween || checkFim) ? true : false;
}
function checkDatesBetweenAfast(date_target, id_user, id_afastamento, includes = false) {
    var userDates = jmespath.search(arrayConfigAtividades.afastamentos.lista,"[?id_user==`"+id_user+"`]");
    var checkDates = false;
    var target = moment(date_target,'YYYY-MM-DD');
        includes = (includes) ? '[]' : '()';
    // console.log('date_target->',date_target, 'id_user->',id_user, 'id_afastamento->',id_afastamento);
    $.each(userDates,function(index, value){
        var start = moment(value.inicio_afastamento, 'YYYY-MM-DD HH:mm:ss');
        var finish = moment(value.fim_afastamento, 'YYYY-MM-DD HH:mm:ss');
        var check = target.isBetween(start, finish, 'days', includes);
        if (check && id_afastamento != value.id_afastamento) {
            // console.log('*',check, start.format('DD/MM/YYYY'), finish.format('DD/MM/YYYY'), value.id_afastamento);
            checkDates = true;
            return false;
        }
    });
    return checkDates;
}
*/
function checkDatesAfast(element, formAfast = true) {
    var _this = $(element);
    var data = _this.data();
    var _parent = _this.closest('table');
    var inicio = _parent.find('input[data-type="inicio"]');
    var inicio_val = (inicio.val().indexOf('T') !== -1) ? inicio.val() : inicio.val()+'T00:00';
    var fim = _parent.find('input[data-type="fim"]');
    var fim_val = (fim.val().indexOf('T') !== -1) ? fim.val() : fim.val()+'T23:59';
    var id_user = (_parent.find('input[data-type="user"]').length > 0) ? _parent.find('input[data-type="user"]') : false;
        id_user = (_parent.find('select[data-type="user"]').length > 0) ? _parent.find('select[data-type="user"]') : id_user;
        id_user = ($('#ativ_id_user').length > 0) ? $('#ativ_id_user') : id_user;
    var id_user_val = (typeof id_user !== 'undefined' && id_user) ? parseInt(id_user.val()) : false;
    var id_afastamento = _parent.find('input[data-type="id"]');
        id_afastamento = (id_afastamento.length == 0) ? 0 : id_afastamento.val();
    var alert = '';
    var format = (inicio.val().indexOf('T') !== -1) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
    var format_display = (inicio.val().indexOf('T') !== -1) ? 'DD/MM/YYYY HH:mm' : 'DD/MM/YYYY';
    var type_datetime = (inicio.val().indexOf('T') !== -1) ? true : false;

    if ( moment(inicio_val, format) > moment(fim_val, format) ) { 
        element.setCustomValidity('*'); 
        alert = 'A '+inicio.data('name')+' deve ser maior ou igual que a '+fim.data('name');
    } else if (id_user_val) { 
        var userAfastList = jmespath.search(arrayConfigAtividades.afastamentos.lista,"[?id_user==`"+id_user_val+"`]");
        var check = (userAfastList !== null) 
                    ? checkDatesLoopArray(userAfastList, inicio_val, fim_val, id_user_val, id_afastamento, {inicio: 'inicio_afastamento', fim: 'fim_afastamento', id: 'id_user', idreftype: 'id_afastamento'}, true, true)
                    : false;
            /* 
            console.log({
                id_user_len: id_user.length, 
                afastamentos_lista: userAfastList, 
                inicio_val: inicio_val, 
                id_user_val: id_user_val, 
                id_afastamento: id_afastamento, 
                param: {inicio: 'inicio_afastamento', fim: 'fim_afastamento', id: 'id_afastamento', idreftype: 'id_afastamento'}, 
                check: check
            });
             */

        if (check && check.length > 0) {
            var v = jmespath.search(arrayConfigAtividades.afastamentos.lista,"[?id_afastamento==`"+check[0]+"`] | [0]");            
            var horas_afastamento = (v !== null) ? jmespath.search(arrayConfigAtividades.afastamentos.tipos_motivos,"[?id_tipo_motivo==`"+v.id_tipo_motivo+"`] | [0].config.horas_afastamento") : null;
                horas_afastamento = (horas_afastamento !== null) ? horas_afastamento : false;          
            var permite_sobreposicao = (v !== null) ? jmespath.search(arrayConfigAtividades.afastamentos.tipos_motivos,"[?id_tipo_motivo==`"+v.id_tipo_motivo+"`] | [0].config.permite_sobreposicao") : null;
                permite_sobreposicao = (permite_sobreposicao !== null) ? permite_sobreposicao : false;

            if (!permite_sobreposicao && (formAfast || (!formAfast && horas_afastamento == false))) {

                var format_display_afast = (moment(v.inicio_afastamento, 'YYYY-MM-DD HH:mm:ss').format('HH:mm:ss') == '00:00:00' && (moment(v.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format('HH:mm:ss') == '23:59:59' || moment(v.fim_afastamento, 'YYYY-MM-DD HH:mm:ss').format('HH:mm:ss') == '00:00:00')) ? 'DD/MM/YYYY' : 'DD/MM/YYYY HH:mm';
                var text_conflict = v.apelido+' ('+v.nome_motivo+') '+moment(v.inicio_afastamento,'YYYY-MM-DD HH:mm:ss').format(format_display_afast)+' \u00E0 '+moment(v.fim_afastamento,'YYYY-MM-DD HH:mm:ss').format(format_display_afast);
                    element.setCustomValidity('*'); 
                    alert = (formAfast) 
                            ? 'O afastamento n\u00E3o pode estar inclu\u00EDda em outra data j\u00E1 cadastrada \n\n'+text_conflict
                            : 'O afastamento est\u00E1 inclu\u00EDda em uma data de afastamento \n\n'+text_conflict;

                var inicioAfastMinute = moment(v.inicio_afastamento,'YYYY-MM-DD HH:mm:ss') > moment(inicio_val, format) ? moment(v.inicio_afastamento,'YYYY-MM-DD HH:mm:ss').startOf('day') : moment(inicio_val, format);
                var fimAfastMinute = moment(v.fim_afastamento,'YYYY-MM-DD HH:mm:ss') < moment(fim_val, format) ? (moment(inicio_val, format) > moment(v.fim_afastamento,'YYYY-MM-DD HH:mm:ss') ? moment(inicio_val, format) : moment(v.fim_afastamento,'YYYY-MM-DD HH:mm:ss')) : (type_datetime ? moment(fim_val, format) : moment(fim_val, format).endOf('day'));

                var checkDatesMinutes = checkDatesLoopArray([v], inicioAfastMinute.format('YYYY-MM-DDTHH:mm'), fimAfastMinute.format('YYYY-MM-DDTHH:mm'), id_user_val, id_afastamento, {inicio: 'inicio_afastamento', fim: 'fim_afastamento', id: 'id_user', idreftype: 'id_afastamento'}, true, true, 'minutes');
                // console.log('checkDatesMinutes', checkDatesMinutes, [v], inicioAfastMinute.format('YYYY-MM-DDTHH:mm'), fimAfastMinute.format('YYYY-MM-DDTHH:mm'), id_user_val, id_afastamento, {inicio: 'inicio_afastamento', fim: 'fim_afastamento', id: 'id_user', idreftype: 'id_afastamento'}, true, true, 'minutes');

                if (!checkDatesMinutes || checkDatesMinutes.length == 0 || permite_sobreposicao) {
                    element.setCustomValidity(''); 
                    alert = '';
                }
            }
        } else {
            element.setCustomValidity(''); 
        }
    } else { 
        element.setCustomValidity(''); 
    }
    var userValidation = element.checkValidity();

    function checkDatesAfastValidation() {
        if (userValidation) {
            _this.removeClass('requiredNull');
            _parent.find('#infoBox_dateAfast').hide().html(''); 
            return true;
        } else {
            _this.addClass('requiredNull');
            element.setCustomValidity(alert);

            var ativAfastHtml = '<span style="margin: 10px 0;display: block;" class="alertaBoxDisplay">'+
                                '   <i class="fas fa-info-circle azulColor" style="margin: 0 5px;"></i>'+
                                '   '+alert+
                                '</div>';
            _parent.find('#infoBox_dateAfast').show().html(ativAfastHtml);  

            var isValid = element.reportValidity();
            return false;
        }
    }
    checkDatesAfastValidation();
    if (!userValidation) { setTimeout(function(){ checkDatesAfastValidation() }, 500) }
    return userValidation;
}
function changeInputAfast(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    var _inicio = _parent.find('input[data-type="inicio"]');
    var inicio = _inicio.val();
    var _fim = _parent.find('input[data-type="fim"]');
    var fim = _fim.val();
    var format = (inicio.indexOf('T') !== -1) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
    var check_allday = _parent.find('#afast_all_day');
    if (!check_allday.is(':checked')) {
        if (inicio.indexOf('T') !== -1) {
            var inicio_format = inicio+'T'+moment().format('HH:mm');
            var fim_format = fim+'T'+moment().add(1,'hours').format('HH:mm');
        } else {
            var inicio_format = (inicio != '') ? moment(inicio, format).format('YYYY-MM-DDTHH:mm') : moment().format('YYYY-MM-DDTHH:mm');
            var fim_format = (fim != '') ? moment(fim, format).format('YYYY-MM-DDTHH:mm') : moment().format('YYYY-MM-DDTHH:mm');
        }
        // console.log(inicio_format, fim_format);
        _inicio.attr('type','datetime-local').val(inicio_format).show();
        _fim.attr('type','datetime-local').val(fim_format).show();
    } else {
        var inicio_format = (inicio != '') ? moment(inicio, format).format('YYYY-MM-DD') : moment().format('YYYY-MM-DD');
        var fim_format = (fim != '') ? moment(fim, format).format('YYYY-MM-DD') : moment().format('YYYY-MM-DD');
        _inicio.attr('type','date').val(inicio_format).show();
        _fim.attr('type','date').val(fim_format).show();
    }
    prepareFieldsReplace(this_);
    changeDatesAfast(this_);
}
function checkInputAfast(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    var data = _this.find('option:selected').data();
    var config = (typeof data !== 'undefined') ? data.config : false;
    var check_allday = _parent.find('#afast_all_day');
    if (config && typeof data !== 'undefined') { 
        if (typeof config.exige_documentacao !== 'undefined' && config.exige_documentacao) {
            _parent.find('.afastBox_documentacao').show();
            _parent.find('.afastBox_observacao').hide();
        } else {
            _parent.find('.afastBox_documentacao').hide();
            _parent.find('.afastBox_observacao').show();
        }
        if (config.horas_afastamento) {
            if (check_allday.is(':checked')) {
                check_allday.trigger('click');
            }
        } else {
            if (!check_allday.is(':checked')) {
                check_allday.trigger('click');
            }
        }
        // changeInputAfast(this_);
    } 
}
function changeDatesAfast(this_) {
    clearTimeout(dly);
    dly = setTimeout(function() {
        changeDatesAfast_(this_);
    }, 1000);
}
function changeDatesAfast_(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    var data = _this.data();
    var inicio = _parent.find('input[data-type="inicio"]');
    var fim = _parent.find('input[data-type="fim"]');
    /*
    if (data.type == 'fim') {
        inicio.attr('max', _this.val());
    } else if (data.type == 'inicio') {
        fim.attr('min', _this.val());
    }
    */
    _parent.find('input.requiredNull').removeClass('requiredNull');
    checkDatesAfast(_this.data('type') == 'user' ? inicio.get(0) : this_);
    checkAtividadesInAfastamentos(this_);
}
function checkAtividadesInAfastamentos(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    var data = _this.data();
    var inicio = _parent.find('input[data-type="inicio"]').val();
    var fim = _parent.find('input[data-type="fim"]').val();
    var user = _parent.find('select[data-type="user"]');
    var id_user = user.val();
    var listAtivInAfast = [];
    var ativUser = jmespath.search(arrayAtividadesPro,"[?data_entrega=='0000-00-00 00:00:00'] | [?id_user==`"+id_user+"`]");
    var _inicio = moment(inicio, 'YYYY-MM-DD');
    var _fim = moment(fim, 'YYYY-MM-DD');
    var labels = {inicio: 'data_distribuicao', fim: 'prazo_entrega', id: 'id_user'};
    var format = (inicio.indexOf('T') !== -1) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
    var format_display = (inicio.indexOf('T') !== -1) ? 'DD/MM/YYYY HH:mm' : 'DD/MM/YYYY';
    
    checkDatesBetweenArrayAtiv(ativUser, _inicio.format(format), labels, true);
    checkDatesBetweenArrayAtiv(ativUser, _fim.format(format), labels, true);

    while(_inicio.add(1, 'days').diff(_fim) < 0) {
        checkDatesBetweenArrayAtiv(ativUser, _inicio.clone().format(format), labels, true);
    }

    function checkDatesBetweenArrayAtiv(array, date_target, labels, includes = false) {
        var target = moment(date_target,format);
            includes = (includes) ? '[]' : '()';
        $.each(array,function(index, value){
            var start = moment(value[labels.inicio], 'YYYY-MM-DD HH:mm:ss');
            var finish = moment(value[labels.fim], 'YYYY-MM-DD HH:mm:ss');
            var check = target.isBetween(start, finish, 'days', '[]');
            if (check && jmespath.search(listAtivInAfast, "[?id_demanda==`"+value.id_demanda+"`]").length == 0) {
                listAtivInAfast.push(value);
            }
        });
    }
    
    if (listAtivInAfast.length > 0) {
        var htmlTableAtividades = $.map(listAtivInAfast, function(v,k){ 
                var datesAtivHtml = getDatesPreview(getConfigDateAtiv(v));
                    datesAtivHtml = (datesAtivHtml != '') ? $(datesAtivHtml).find('.dateBoxIcon')[0].outerHTML : '';
                    datesAtivHtml = (datesAtivHtml != '') ? '<span class="dateboxDisplay" onclick="actionsAtividade('+v.id_demanda+')">'+datesAtivHtml+'</span>' : '';
                    return '<div style="margin: 5px 0; display: inline-block; width: 100%;" data-value="'+v.id_demanda+'" title="'+getTitleDialogBox(v, true)+'">'+datesAtivHtml+statusIconsAtividade(v)+getTitleDialogBox(v)+'</div>'
            }).join('');
        var ativAfastHtml = '<span style="margin: 10px 0;display: block;" class="alertaBoxDisplay">'+
                            '   <i class="fas fa-info-circle azulColor" style="margin: 0 5px;"></i>'+
                            '   '+(listAtivInAfast.length > 1 ? 'Existem '+listAtivInAfast.length+' '+__.demandas : 'Existe 1 '+__.demanda+'')+' em aberto dentro do per\u00EDodo de afastamento selecionado para o usu\u00E1rio <strong>'+user.find('option:selected').text()+'</strong>'+
                            '   <a class="newLink" onclick="ativInAfastDetalhe(this)" style="text-decoration: underline;font-size: 10pt;cursor: pointer;color: blue;">'+
                            '       Detalhar '+
                            '       <i class="fas fa-angle-double-right" style="font-size: 10pt;text-decoration: underline;margin: 0;color: blue;"></i>'+
                            '   </a>'+
                            '</span>'+
                            '<div id="infoBox_dateAfastDetalhe" style="display:none; font-size: 9pt;">'+
                            '   '+htmlTableAtividades+
                            '</div>';
        _parent.find('#infoBox_dateAfast').show().html(ativAfastHtml);
    } else {
        _parent.find('#infoBox_dateAfast').hide().html('');
    }
}
function ativInAfastDetalhe(this_) {
    var _this = $(this_);
    var _parent = _this.closest('tr');
    _parent.find('#infoBox_dateAfastDetalhe').toggle();
}
function editAfastamento(this_, id_afastamento = 0) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    var inicio = _parent.find('input[data-type="inicio"]');
    if (id_afastamento == 0) {
        _parent.find('.td_edit').show();
        _parent.find('.td_view').hide();
    } else if (id_afastamento == -1) {
        _parent.find('.td_edit').hide();
        _parent.find('.td_view').show();
    } else if (checkDatesAfast(inicio.get(0)) && checkAtivRequiredFields(inicio.get(0), 'mark')) {
        var param = extractDataAfast(_parent);
        var action = 'edit_afastamento';
            param.action = action;
            param.id_afastamento = id_afastamento;
            getServerAtividades(param, action);
            _parent.find('.confirm i').attr('class', 'fas fa-sync-alt fa-spin');
    }
    // console.log(id_afastamento, param);
    prepareFieldsReplace(this_);
}
function extractDataAfast(_parent) {
    var param = {};
        _parent.find('.data_extract').each(function(){
            var _this = $(this);
            if (typeof _this.data('key') !== 'undefined') {
                var value = (_this.attr('type') == 'date') ? (_this.data('key') == 'fim_afastamento' ? _this.val()+' 23:59:59' : _this.val()+' 00:00:00') : _this.val();
                    value = (_this.attr('type') == 'datetime-local') ? (_this.val() == '' ? '' : moment(_this.val(), 'YYYY-MM-DDTHH:mm').format('YYYY-MM-DD HH:mm:ss')) : value;
                    value = (_this.is('textarea') || (_this.is('input') && _this.attr('type') == 'text') ) ? value.replace(/["']/g, "") : value;
                param[_this.data('key')] = value;
            }
        });
    if ($('#configBox_documentos').is(':visible')) {
        var doc = extractOptionConfigItem(_parent);
            doc = doc && typeof doc.documentos !== 'undefined' ? jmespath.search(doc.documentos,"[?documento!='undefined'] | [?id_procedimento!='0']") : null;
        if (typeof doc !== 'undefined' && doc !== null && doc.length) {
            param.config = {documentos: doc};
        }
    }
    return param;
}
function removeAfastamento(this_, id_afastamento = 0) {
    var _this = $(this_);
    var id_afastamentos = [];
    var countSelected = $('#tableAfastamento tr.infraTrMarcada').length;
    if (id_afastamento != 0) {
        if ($('#tableAfastamento').is(':visible') && countSelected > 0) {
            $('#tableAfastamento').find('.lnkInfraCheck').data('index',1).trigger('click');
        }
        _this.closest('tr').find('td').eq(0).find('input[type="checkbox"]').trigger('click');
    } else {
        id_afastamentos = $('#tableAfastamento').find('.checkboxSelectAfastamento:checked').map(function(){ return $(this).val() }).get();
    }

    confirmaFraseBoxPro('Tem certeza que deseja excluir '+(countSelected > 1 ? 'os afastamentos' : 'o afastamento')+(id_afastamento == 0 ? (countSelected > 1 ? ' selecionados' : ' selecionado') : '')+'?', 'EXCLUIR', 
        function(){
            var action = 'delete_afastamento';
            var param = {
                action: action, 
                id_afastamento: id_afastamento,
                id_afastamentos: id_afastamentos
            };
            getServerAtividades(param, action);
        }, function() {
            if (id_afastamento != 0) {
                if ($('#tableAfastamento').is(':visible') && _this.closest('tr').hasClass('infraTrMarcada')) {
                    $('#tableAfastamento').find('.lnkInfraCheck').data('index',1).trigger('click');
                }
            }
        }
    );
}
function getKanbanAtividades(this_) {
    if (arrayAtividadesPro) {
        var kanbanElem = '#kanbanAtivPanel';
        var kanbanDiv = $(kanbanElem);
            kanbanDiv.html('').show();
        var listAtividadesNIniciadas = jmespath.search(arrayAtividadesPro, "[?data_inicio=='0000-00-00 00:00:00']");
            listAtividadesNIniciadas = getSortKanbanItens(listAtividadesNIniciadas, '_niniciadas');
        var listAtividadesIniciadas = jmespath.search(arrayAtividadesPro, "[?data_inicio!='0000-00-00 00:00:00'] | [?data_retomada!='0000-00-00 00:00:00'] | [?data_entrega=='0000-00-00 00:00:00']");
            listAtividadesIniciadas = getSortKanbanItens(listAtividadesIniciadas, '_iniciadas');
        var listAtividadesPausadas = jmespath.search(arrayAtividadesPro, "[?data_inicio!='0000-00-00 00:00:00'] | [?data_pausa] | [?data_pausa!='0000-00-00 00:00:00'] | [?data_retomada=='0000-00-00 00:00:00'] | [?data_entrega=='0000-00-00 00:00:00']");
            listAtividadesPausadas = (listAtividadesPausadas !== null && listAtividadesPausadas.length > 0) ? getSortKanbanItens(listAtividadesPausadas, '_pausadas') : false;
        var listAtividadesConcluidas = jmespath.search(arrayAtividadesPro, "[?data_entrega!='0000-00-00 00:00:00'] | [?data_avaliacao=='0000-00-00 00:00:00']");
            listAtividadesConcluidas = getSortKanbanItens(listAtividadesConcluidas, '_concluidas');
        var listAtividadesAvaliadas = jmespath.search(arrayAtividadesPro, "[?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00']");
            listAtividadesAvaliadas = getSortKanbanItens(listAtividadesAvaliadas, '_avaliadas');

        var listAtividadesArquivadas = getOptionsPro('panelAtividadesViewSend') ? jmespath.search(arrayAtividadesPro, "[?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio!='0000-00-00 00:00:00']") : null;
            listAtividadesArquivadas = (listAtividadesArquivadas !== null) ? getSortKanbanItens(listAtividadesArquivadas, '_arquivadas') : false;

        var bords_list = [
            {
                id: "_niniciadas",
                title: "N\u00E3o Iniciadas",
                class: "",
                dragTo: (checkCapacidade('start_atividade') ? ["_iniciadas"] : []),
                item: getKanbanItensAtividade(listAtividadesNIniciadas)
            },
            {
                id: "_iniciadas",
                title: "Iniciadas",
                dragTo: ((checkCapacidade('complete_atividade') && checkCapacidade('start_cancel_atividade'))
                            ? ["_niniciadas", "_concluidas"]
                            : (checkCapacidade('complete_atividade') && !checkCapacidade('start_cancel_atividade'))
                                ? ["_concluidas"] 
                                : (!checkCapacidade('complete_atividade') && checkCapacidade('start_cancel_atividade')) 
                                    ? ["_niniciadas"] 
                                    : []
                        ),
                class: "start",
                item: getKanbanItensAtividade(listAtividadesIniciadas)
            }
        ];

        if (listAtividadesPausadas) {
            bords_list.push({
                    id: "_pausadas",
                    title: "Pausadas",
                    class: "paused",
                    dragTo: ((checkCapacidade('pause_atividade'))
                                ? ["_iniciadas", "_concluidas"]
                                : []
                            ),
                    item: getKanbanItensAtividade(listAtividadesPausadas)
                });
        }

        bords_list.push({
                id: "_concluidas",
                title: "Conclu\u00EDdas",
                class: "complete",
                dragTo: ((checkCapacidade('rate_atividade') && checkCapacidade('complete_cancel_atividade'))
                            ? ["_iniciadas", "_avaliadas"]
                            : (checkCapacidade('rate_atividade') && !checkCapacidade('complete_cancel_atividade'))
                                ? ["_avaliadas"] 
                                : (!checkCapacidade('rate_atividade') && checkCapacidade('complete_cancel_atividade')) 
                                    ? ["_iniciadas"] 
                                    : []
                        ),
                item: getKanbanItensAtividade(listAtividadesConcluidas)
            },
            {
                id: "_avaliadas",
                title: "Avaliadas",
                class: "rate",
                dragTo: (checkCapacidade('rate_cancel_atividade') ? ["_concluidas"] : []),
                item: getKanbanItensAtividade(listAtividadesAvaliadas)
            }
        );

        if (listAtividadesArquivadas) {
            bords_list.push({
                id: "_arquivadas",
                title: __.Arquivadas,
                class: "send",
                dragTo: (checkCapacidade('send_cancel_atividade') ? ["_avaliadas"] : []),
                item: getKanbanItensAtividade(listAtividadesArquivadas)
            });
        }
        var widthBoard = (listAtividadesArquivadas || listAtividadesPausadas ? "calc(20% - 20px)" : "calc(25% - 20px)");
            widthBoard = (listAtividadesArquivadas && listAtividadesPausadas) ? "calc(16.66% - 20px)" : widthBoard;

        var kanban = (bords_list === null) ? false : new jKanban({
                element: kanbanElem,
                gutter: '10px',
                widthBoard: widthBoard,
                // responsivePercentage: true,
                itemHandleOptions:{
                    enabled: true,
                },
                dropEl: function(el, target, source, sibling){
                    var targetEl = target.parentElement.getAttribute('data-id');
                    var sourceEl = source.parentElement.getAttribute('data-id');
                    var idEl = (el.dataset.eid.indexOf('_id_') !== -1) ? parseInt(el.dataset.eid.replace('_id_', '')) : el.dataset.eid;
                    if (targetEl == '_iniciadas' && sourceEl == '_niniciadas') {
                        startAtividade(idEl);
                    } else if (targetEl == '_niniciadas' && sourceEl == '_iniciadas') {
                        startCancelAtividade(idEl);
                    } else if (targetEl == '_concluidas' && sourceEl == '_iniciadas') {
                        completeAtividade(idEl);
                    } else if (targetEl == '_pausadas' || sourceEl == '_pausadas') {
                        pauseAtividade(idEl);
                    } else if (targetEl == '_iniciadas' && sourceEl == '_concluidas') {
                        completeCancelAtividade(idEl);
                    } else if (targetEl == '_avaliadas' && sourceEl == '_concluidas') {
                        rateAtividade(idEl);
                    } else if (targetEl == '_concluidas' && sourceEl == '_avaliadas') {
                        rateCancelAtividade(idEl);
                    } else if (targetEl == '_arquivadas' && sourceEl == '_avaliadas') {
                        archiveAtividade(idEl);
                    } else if (targetEl == '_avaliadas' && sourceEl == '_arquivadas') {
                        sendCancelAtividade(idEl);
                    }
                    kanbanAtividadesMoving = {target: targetEl, source: sourceEl, id: el.dataset.eid, id_demanda: idEl};
                    setStoreOrderKanbanItens();
                    if (targetEl == '_niniciadas' && sourceEl == '_niniciadas' && $('#filterTagKanban_user').length > 0 && checkCapacidade('update_prioridades')) {
                        setStorePriorityKanbanItens('_niniciadas');
                    }
                },
                boards: bords_list
            });

        kanbanAtividades = kanban;

        // adiciona altura maxima ao painel e redimenssionamento dinamico
        if (!getOptionsPro('panelHeight_atividadesKanbanPro') && kanbanDiv.height() > 800) { setOptionsPro('panelHeight_atividadesKanbanPro', 800) }
        $('.kanban-container').addClass('tabelaPanelScroll');
        initPanelResize('.kanban-container', 'atividadesKanbanPro');

        // corrige a altura de todos os quadros pelo maior deles
        var maxHeightBoard = Math.max.apply(null, kanbanDiv.find('.kanban-board').map(function(){ return $(this).height() }).get());
            kanbanDiv.find('.kanban-board').css('min-height', maxHeightBoard+'px');
            kanbanDiv.find('.kanban-board .kanban-drag').css('min-height', (maxHeightBoard-48)+'px');

        var tagName = getOptionsPro('filterTag_kanban');
        if (typeof tagName !== 'undefined' && tagName != '') {
            setTimeout(function(){ 
                $('.kanbanAtividade .tagTableText_'+tagName).eq(0).trigger('click');
            }, 100);
        } else if ((!tagName || tagName == '') && (checkCapacidade('only_self_atividades')) && !setOptionsPro('filterTag_removed') ) {
            var tagName_thisUser = normalizeNameTag(arrayConfigAtividades.perfil.apelido);
            setTimeout(function(){ 
                $('.kanbanAtividade .tagTableText_'+tagName_thisUser).eq(0).trigger('click');
            }, 500);
        }

        var target = ($('#ifrArvore').length > 0) ? $('#ifrArvore').contents() : $('body');
        var progress = target.find('.kanban-item .checklist_progress');
        if (typeof $().progressbar !== 'undefined') {
            progress.each(function(){
                $(this).progressbar({
                    value: $(this).data('valuenow'),
                    max: $(this).data('max')
                });
                if ($(this).find('.ui-progressbar-value').length > 1) { $(this).find('.ui-progressbar-value').eq(0).remove() }
            });
        }
        var selectFilterKanban = getSelectViewControl('kanbanAtivPanel');

        var htmlViewControl =   '<div class="viewControlPro" style="right: 10px;top: 10px;z-index: 100;position: absolute;">'+
                                '   '+selectFilterKanban+
                                '   <div class="btn-group" role="group" style="margin-left: 20px;">'+
                                '      <button type="button" onclick="changeViewControl(this)" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="compacto" class="btn btn-sm btn-light '+(getOptionsPro('panelKanbanView') == 'compacto' ? 'active' : '')+'">'+
                                '          <i class="fas fa-minus" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                '          Compacto'+
                                '      </button>'+
                                '      <button type="button" onclick="changeViewControl(this)" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="padrao" class="btn btn-sm btn-light '+(!getOptionsPro('panelKanbanView') || getOptionsPro('panelKanbanView') == 'padrao' ? 'active' : '')+'">'+
                                '          <i class="far fa-minus-square" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                '          Padr\u00E3o'+
                                '      </button>'+
                                '      <button type="button" onclick="changeViewControl(this)" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="expandido" class="btn btn-sm btn-light '+(getOptionsPro('panelKanbanView') == 'expandido' ? 'active' : '')+'">'+
                                '          <i class="far fa-plus-square" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                '          Expandido'+
                                '      </button>'+
                                '   </div>'+
                                '</div>';
        kanbanDiv.find('.viewControlPro').remove();
        kanbanDiv.prepend(htmlViewControl);
        if (typeof $().chosen === 'function') {
            $('#selectViewControl_kanbanAtivPanel').chosen({
                placeholder_text_single: ' ',
                no_results_text: 'Nenhum resultado encontrado'
            });
            forcePlaceHoldChosen();
        }
        if (getOptionsPro('panelKanbanView')) {
            kanbanDiv.find('.viewControlPro button[data-value="'+getOptionsPro('panelKanbanView')+'"]').trigger('click');
        }
        updateCountKanbanBoard();
        loopRepairKanbanPinMoveCard();
    }
}
function changeViewControl(this_) {
    var _this = $(this_);
    var value = _this.data('value');
    var container = _this.closest('.kanbanAtividade').find('.kanban-container');
    if (value == 'expandido') {
        container.addClass('view_full').removeClass('view_min');
    } else if (value == 'padrao') {
        container.removeClass('view_full').removeClass('view_min');
    } else if (value == 'compacto') {
        container.removeClass('view_full').addClass('view_min');
    }

    _this.parent().find('button').removeClass('active');
    _this.addClass('active'); 
    setOptionsPro('panelKanbanView', value);
}
function updateCountKanbanBoard() {
    $.each(kanbanAtividades.options.boards, function(i, v){
        var countBoard = $('#kanbanAtivPanel .kanban-board[data-id="'+v.id+'"] .kanban-item:visible').length;
        $('#kanbanAtivPanel .kanban-board[data-id="'+v.id+'"] .kanban-title-board').attr('data-count',countBoard);
    });
}
function getStoreOrderKanbanItens(nameBoard) {
    var itemStore = getOptionsPro('kanbanAtividadesOrder');
    var itens = jmespath.search(itemStore, "[?name=='"+nameBoard+"'].order | [0]");
    return (itens !== null) ? itens : false;
}
function getPinKanbanItem(id_demanda) {
    var pin = false;
    if (getOptionsPro('kanbanAtividadesOrder')) {
        var item = $.map(getOptionsPro('kanbanAtividadesOrder'), function(v){
            var order = jmespath.search(v.order, "[?id_demanda==`"+id_demanda+"`] | [0]");
            if (order && order !== null) return order;
        });
        pin = (typeof item[0] !== 'undefined' && item[0].pin) ? true : false;
    }
    return pin;
}
function updatePriorityKanbanItens(board, mode) {
    $('#kanbanAtivPanel').find('.kanban-board[data-id="'+board+'"]').find('.kanban-item:visible').each(function(i){
        var priority = $(this).find('.kanban-item-priority');
        var data = priority.data();
        var index = (mode == 'update') ? i+1 : data.priority;
        priority.data('priority', index).html('<span>'+index+'</span>');
    });
}
function setStorePriorityKanbanItens(board) {
    var priority = [];
    $('#kanbanAtivPanel').find('.kanban-board[data-id="'+board+'"]').find('.kanban-item:visible').each(function(i){
        var data = $(this).data();
        var id = parseInt(data.eid.replace('_id_',''));
        var index = i+1;
            priority.push({id_demanda: id, prioridade: index});
    });
    if (priority.length > 0) {
        $('#kanbanAtivPanel').find('.kanban-board[data-id="'+board+'"]').find('.kanban-item:visible .kanban-item-priority').html('<span><i class="fas fa-sync fa-spin" style="color: #fff;"></i></span>');
        var action = 'update_prioridades';
        var param = {
            action: action, 
            prioridades: priority,
            board: board
        };
        getServerAtividades(param, action);
    }
}
function setStoreOrderKanbanItens() {
    var itens = [{
                    name: '_niniciadas',
                    order: getOrderKanbanItens('_niniciadas')
                },{
                    name: '_iniciadas',
                    order: getOrderKanbanItens('_iniciadas')
                },{
                    name: '_concluidas',
                    order: getOrderKanbanItens('_concluidas')
                },{
                    name: '_avaliadas',
                    order: getOrderKanbanItens('_avaliadas')
                }];
        setOptionsPro('kanbanAtividadesOrder', itens);
}
function getOrderKanbanItens(board) {
    var order = [];
    $('.kanban-board[data-id="'+board+'"] .kanban-item').each(function(index, value){
        var id = $(this).data('eid');
        var id_demanda = (id.indexOf('_id_') !== -1) ? parseInt(id.replace('_id_', '')) : id;
        var pin = $(this).find('.kanban-pinboard a').hasClass('newLink_active');
        order.push({id_demanda: id_demanda, order: index, pin: pin});
    });
    return order;
}
function getSortKanbanItens(listAtividades, nameBoard) {
    var order = getStoreOrderKanbanItens(nameBoard);
    var type = getOptionsPro('filterTagType_kanban');
    if (type == 'user') {
        listAtividades = jmespath.search(listAtividades, "sort_by([*],&prioridade)");
    } else if (order.length > 0) {
        var checkPin = jmespath.search(order,"[?pin==`true`]");
            checkPin = (checkPin !== null && checkPin.length > 0) ? true : false; 
        if (checkPin) {
            $.each(listAtividades, function(i, value){
                listAtividades[i]['id_order'] = (jmespath.search(order, "[?id_demanda==`"+value.id_demanda+"`] | length(@)") > 0) 
                    ? jmespath.search(order, "[?id_demanda==`"+value.id_demanda+"`].order | [0]") 
                    : moment(value.prazo_entrega, 'YYYY-MM-DD HH:mm:ss').unix();
            });
            listAtividades = jmespath.search(listAtividades, "sort_by([*],&id_order)");
        } else {
            listAtividades = jmespath.search(listAtividades, "sort_by([*],&prazo_entrega)");
        }
    } else {
        listAtividades = jmespath.search(listAtividades, "sort_by([*],&prazo_entrega)");
    }
    return listAtividades;
}
function cancelSelectedItensAtiv(id_demanda) {
    var tableDemanda = $('#tabelaAtivPanel table');
    var tr = tableDemanda.find('tr[data-index="'+id_demanda+'"]');
    // console.log(tr.is(':visible'), tr.hasClass('infraTrMarcada'));
    if (tr.is(':visible') && tr.hasClass('infraTrMarcada')) {
        tableDemanda.find('.lnkInfraCheck').data('index',1).trigger('click');
        // console.log(tr.find('.lnkInfraCheck').data('index'));
    }
}
function pinKanbanItens(this_, id_demanda) {
    var _this = $(this_);
    var _parent = _this.closest('.kanban-board');
    var _hasActive = _this.hasClass('newLink_active');
    var source = _parent.data('id');
    var value = getAtividadeData(id_demanda);
    var item = getKanbanItem(value);
    var order = (_hasActive) ? -1 : 0;

    kanbanAtividades.removeElement(item.id);
    kanbanAtividades.addElement(source, item, order);

    if (!_hasActive) {
        $('.kanban-container').animate({scrollTop: 0}, 500, function() {
            $('.kanban-item[data-eid="_id_'+id_demanda+'"] .kanban-pinboard a').addClass('newLink_active').attr('onmouseover', 'return infraTooltipMostrar(\'Remover do topo\')');
            setStoreOrderKanbanItens();
        });
    } else {
        $('.kanban-item[data-eid="_id_'+id_demanda+'"] .kanban-pinboard a').removeClass('newLink_active').attr('onmouseover', 'return infraTooltipMostrar(\'Fixar no topo\')');
        setStoreOrderKanbanItens();
    }
    infraTooltipOcultar();
}
function cancelMoveKanbanItens() {
    var item = kanbanAtividadesMoving;
    if (item && $('#kanbanAtivPanel').is(':visible')) {
        var value = jmespath.search(arrayAtividadesPro, "[?id_demanda==`"+item.id_demanda+"`] | [0]");
        kanbanAtividades.removeElement(item.id);
        kanbanAtividades.addElement(item.source, getKanbanItem(value), 0);
    }
}
function getKanbanItem(value) {
    var classes = [];
    if (typeof value.etiquetas !== 'undefined' && value.etiquetas !== null) {
        $.each(value.etiquetas, function (i, v) { 
            var tag = 'tagKanName_'+normalizeNameTag(v); 
                classes.push(tag);
        });
    }
    var tagUser = (value.id_user != 0) ? 'tagKanName_'+normalizeNameTag(value.apelido) : 'tagKanName_naoatribuido'; 
        classes.push(tagUser);
        classes.push('tagKanName_'+normalizeNameTag(value.sigla_unidade));
    if (value.id_user != 0 && value.id_user != parseInt(arrayConfigAtividades.perfil.id_user) && checkCapacidade('only_self_atividades')) {
        classes.push('tagKanban_notmove');
    }
    var tagDate = getDatesPreview(getConfigDateAtiv(value));

    var check_ispaused = (typeof value.data_retomada !== 'undefined' && value.data_retomada !== null && value.data_retomada == '0000-00-00 00:00:00') ? true : false;
    var checkConfigAtiv = jmespath.search(arrayConfigAtividades.atividades, "[?id_atividade==`"+value.id_atividade+"`] | [0].config.desativa_produtividade");

    var btnPause = (!checkConfigAtiv && value.data_inicio != '0000-00-00 00:00:00' && value.data_entrega == '0000-00-00 00:00:00' && checkCapacidade('pause_atividade') && checkPermissionAtiv(value) )
                ?   '<span class="info_dates_pause" style="display:block; padding: 0;opacity: 1;">'+
                    '   <a class="newLink datePausado info_noclick" onclick="parent.pauseAtividade('+value.id_demanda+')">'+
                    '       <i class="fas fa-'+(check_ispaused ? 'play' : 'pause')+'-circle '+(check_ispaused ? 'azulColor' : 'laranjaColor')+'" style="padding-right: 3px;"></i>'+
                    '       '+(check_ispaused ? __.Retomar+' '+__.demanda : 'Inserir '+__.paralisacao)+
                    '   </a> '+
                    '</span>'
                : '';

    var timerAtiv = (value.data_inicio != '0000-00-00 00:00:00' && value.data_entrega == '0000-00-00 00:00:00')
                ? getTagTempoDecorridoAtiv(value)
                : (value.data_entrega != '0000-00-00 00:00:00' && value.data_avaliacao == '0000-00-00 00:00:00') 
                    ? getTagTempoDespendidoAtiv(value)
                    : '';
        timerAtiv = (!checkOptionEntidade('desativa_produtividade_geral')) ? timerAtiv : '';

    var btnActionAtiv = getBtnActionsAtividade(value);

    var btnExtend = (value.data_inicio != '0000-00-00 00:00:00' && value.data_entrega == '0000-00-00 00:00:00' && checkCapacidade('extend_atividade') && checkPermissionAtiv(value) )
                ?   '<span class="info_dates_extend" style="display:block; padding: 0;opacity: 1;">'+
                    '   <a class="newLink dateExtend info_noclick" onclick="parent.extendAtividade('+value.id_demanda+')">'+
                    '      <i class="fas fa-retweet azulColor" style="padding-right: 3px;"></i>'+
                    '      '+__.Prorrogar+' '+__.demanda+
                    '   </a>'+
                    '</span>'
                : '';

    var btnVariation = (value.data_inicio != '0000-00-00 00:00:00' && value.data_avaliacao == '0000-00-00 00:00:00' && (checkCapacidade('variation_atividade') || checkCapacidade('type_atividade')) && checkPermissionAtiv(value) )
                ?   '<span class="info_dates_extend" style="display:block; padding: 0;opacity: 1;">'+
                    '   <a class="newLink dateExtend info_noclick" onclick="parent.variationAtividade('+value.id_demanda+')">'+
                    '      <i class="fas fa-'+(value.tempo_pactuado == 0 ? 'clipboard-list' : 'graduation-cap')+' azulColor" style="padding-right: 3px;"></i>'+
                    '      '+(value.tempo_pactuado == 0 ? 'Atribuir '+__.atividade : 'Alterar '+__.complexidade)+
                    '   </a>'+
                    '</span>'
                : '';

    var tempoPactuado = (value.tempo_pactuado == 0) ? 'N\u00E3o pactuado' : decimalHourToMinute(value.tempo_pactuado)+' '+(value.tempo_pactuado > 1 ? 'horas' : 'hora');
    var tagPacto =  '<span class="info_tags_follow info_tags_pacto">'+
                    '   <span data-colortag="#bfd5e8" style="background-color: #eef4f9;" class="tag_text" title="'+value.tempo_pactuado+' '+(value.tempo_pactuado > 1 ? 'horas' : 'hora')+'">'+
                    '       <i data-colortag="#406987" class="fas fa-handshake" style="font-size: 90%; margin: 0px 2px; color: #406987;"></i>'+
                    '       '+tempoPactuado+
                    '   </span>'+
                    '</span>';

    var infoAtiv =  ($(btnActionAtiv).find('.fa-info-circle').length > 0) 
                    ? ' ' 
                    :   '<span class="info_ativ" style="display:block; padding: 0;opacity: 1;">'+
                        '   <a class="newLink info_noclick" onclick="parent.infoAtividade('+value.id_demanda+')">'+
                        '      <i class="fas fa-info-circle azulColor" style="padding-right: 3px;"></i>'+
                        '      Informa\u00E7\u00F5es '+__.da_demanda+''+
                        '   </a>'+
                        '</span>';

    var obsGerencial = (value && value.observacao_gerencial !== null && value.observacao_gerencial != '') 
                    ?   '<span class="inlineAlert content_edit" data-field="observacao_gerencial" style="position:relative" data-id="'+value.id_demanda+'">'+
                        '   <i class="fas fa-comment-alt" style="color: #7baaf7;position: absolute;"></i>'+
                        '   <span class="info" style="text-indent: 20px;display: block;">'+replaceTextToProcessoSEI(replaceTextToUrl(value.observacao_gerencial))+'</span>'+
                        '   '+(checkCapacidade('edit_field') && checkPermissionAtiv(value) && checkCapacidade('edit_observacao_gerencial') ? '<a class="newLink newLink_active followLink followLinkDesc content_btnsave kanban-actions-edit info_noclick" style="right: -15px;top: 5px;" onclick="parent.editFieldAtiv(this)" onmouseover="return infraTooltipMostrar(\'Editar '+__.Observacao+' '+__.Gerencial+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-edit azulColor" style="font-size: 100%;"></i></a>' : '')+
                        '</span>'
                    : '';

    var obsTecnica = (value && value.observacao_tecnica !== null && value.observacao_tecnica != '') 
                    ?   '<span class="inlineAlert content_edit" data-field="observacao_tecnica" style="position:relative" data-id="'+value.id_demanda+'">'+
                        '   <i class="fas fa-reply-all" style="color: #7baaf7;position: absolute;"></i>'+
                        '   <span class="info" style="text-indent: 20px;display: block;">'+replaceTextToProcessoSEI(replaceTextToUrl(value.observacao_tecnica))+'</span>'+
                        '   '+(checkCapacidade('edit_field') && checkPermissionAtiv(value) && checkCapacidade('edit_observacao_tecnica') ? '<a class="newLink newLink_active followLink followLinkDesc content_btnsave kanban-actions-edit info_noclick" style="right: -15px;top: 5px;" onclick="parent.editFieldAtiv(this)" onmouseover="return infraTooltipMostrar(\'Editar '+__.Observacao+' '+__.Tecnica+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-edit azulColor" style="font-size: 100%;"></i></a>' : '')+
                        '</span>'
                    : '';

    var pinBoard = '<span style="float: right;margin: -5px -10px 0 0;" class="kanban-pinboard info_noclick"><a class="newLink info_noclick '+(getPinKanbanItem(value.id_demanda) ? 'newLink_active' : '')+'" onclick="pinKanbanItens(this, '+value.id_demanda+')" onmouseover="return infraTooltipMostrar(\''+(getPinKanbanItem(value.id_demanda) ? 'Remover do topo' : 'Fixar no topo')+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-thumbtack cinzaColor"></i></a></span>';
                    
    var checklist = getInfoAtividadeChecklist(value, 'actions');
    var titleReumeDemanda = (typeof value.assunto !== 'undefined' && value.assunto.length > 50 ? value.assunto.replace(/^(.{50}[^\s]*).*/, "$1")+'...' : value.assunto);

    if (tagDate != '') { classes.push('tagKanName_'+$(tagDate).data('tagname')) }
    var item = {
        id: "_id_"+value.id_demanda,
        title:  pinBoard+
                '<div class="kanban-content">'+
                '   <div class="kanban-title-card content_edit" data-field="assunto" data-id="'+value.id_demanda+'">'+
                '       <span class="info" style="width: 75%;">'+value.assunto+'</span>'+
                '       '+(checkCapacidade('edit_field') && checkPermissionAtiv(value) && checkCapacidade('edit_assunto') ? '<a style="margin: -6px -10px 0 -20px;" class="newLink newLink_active followLink content_btnsave kanban-actions-edit info_noclick" onclick="parent.editFieldAtiv(this)" onmouseover="return infraTooltipMostrar(\'Editar '+__.assunto+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-edit azulColor" style="font-size: 100%;"></i></a>' : '')+
                '   </div>'+
                '   <div class="kanban-description">'+
                '       <sub title="'+getTitleDialogBox(value, true)+'">'+
                '       <div style="margin: 0 0 8px 0;" class="info_noclick">'+getHtmlLinkRequisicao(value, true)+'</div>'+
                '       '+getTitleDialogBox(value)+
                '       </sub>'+
                '       '+obsGerencial+
                '       '+obsTecnica+
                '       <span class="info_tags_follow info_tags_follow_etiquetas" style="float: right;display: block;">'+
                '           '+(typeof value.etiquetas !== 'undefined' && value.etiquetas !== null && value.etiquetas.length > 0 ? $.map(value.etiquetas, function (i) { return $(getHtmlEtiqueta(i, 'ativ'))[0].outerHTML }).join('') : '')+
                '       </span>'+
                '       <span class="info_tags_follow">'+getHtmlEtiquetaUnidade(value)+tagPacto+'</span>'+
                '       <span class="info_dates_fav" style="display: block; margin: 10px 0;">'+timerAtiv+tagDate+'</span>'+
                '   </div>'+
                '   <div class="kanban-actions">'+
                '       '+btnActionAtiv+
                '       '+btnPause+
                '       '+btnExtend+
                '       '+btnVariation+
                '       '+infoAtiv+
                '       '+checklist+
                '   </div>'+
                '</div>',
        click: function(el) {
            var checkOver = ($(el).find('.info_noclick:hover').length > 0) ? $(el).find('.info_noclick:hover') : false;
            if (!dialogBoxPro && !checkOver) {
                infoAtividade(value.id_demanda);
            }
        },
        class: classes
    };
    return item;
}
function checklistOpen(this_) {
    var _this = $(this_);
    var type_container = (_this.closest('.kanban-item').length > 0) ? 'kanban' : 'table';
    var _container = (type_container == 'kanban') ? _this.closest('.kanban-item') : _this.closest('td');
        _this.closest('.info_checklist_btn').hide();
        _container.find('.info_checklist').show().find('.checklist_edit').trigger('click');

}
function checklistToggle(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.info_checklist');
    var itens = _parent.find('.info_checklist_itens');
        itens.toggle();
        _this.find('i').toggleClass('fa-chevron-down fa-chevron-right');
}
function checklistEdit(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.info_checklist');
        _parent.toggleClass('edit');
    var itens = _parent.find('.info_checklist_itens');
    if (!_parent.hasClass('edit')) {
        itens.sortable('destroy');
        itens.find('.label_name').prop('contenteditable',false);
    } else {
        itens.sortable({
            items: '.info_checklist_item',
            cursor: 'grabbing',
            handle: '.checklist_order',
            forceHelperSize: true,
            opacity: 0.5,
            axis: 'y',
            dropOnEmpty: false,
            update: function(event, ui) {
                var list_ordem = [];
                $(this).find('.info_checklist_item').each(function(i){
                    $(this).attr('data-ordem',i);
                    list_ordem.push({id_checklist: $(this).data('id-checklist'), ordem: i});
                });
                updateChecklistOrder(list_ordem, $(this).data('id-demanda'));
                $(this).closest('.info_checklist').find('.checklist_edit i').attr('class','fas fa-sync-alt fa-spin azulColor');
            }
        });
    }
}
function updateChecklistOrder(list_ordem, id_demanda) {
    if (checkCapacidade('update_checklist_all') || checkCapacidade('update_checklist')) {
        var action = 'update_checklist';
        var param = {
            action: action,
            mode: 'order',
            list_ordem: list_ordem,
            id_demanda: id_demanda
        };
        getServerAtividades(param, action);
    }
}
function updateProgressChecklist(id_checklist) {
    var target = ($('#ifrArvore').length > 0) ? $('#ifrArvore').contents() : $('body');
    var item = (target.find('.info_checklist_item[data-id-checklist="'+id_checklist+'"]').length > 0) 
                ? target.find('.info_checklist_item[data-id-checklist="'+id_checklist+'"]')
                : target.find('.info_checklist_item').first();
    var _parent = item.closest('.kanban-item');
        _parent = (_parent.length == 0) ? item.closest('.tableInfo') : _parent;
    var value = _parent.find('.info_checklist_item.checklist_checked').length;
    var max = _parent.find('.info_checklist_item').length;
    var progress = _parent.find('.checklist_progress');
        progress.attr('data-valuenow',value).attr('data-max',max);
        progress.progressbar({
            value: value,
            max: max
        });
        if (progress.find('.ui-progressbar-value').length > 1) { progress.find('.ui-progressbar-value').eq(0).remove() }
}
function checklistUpdate(this_, mode, data = false, param = false) {
    if (mode == 'send') {
        var _this = $(this_);
        var _parent = _this.closest('.info_checklist_item');
        var data_this = _parent.data();
        var value = jmespath.search(arrayAtividadesPro, "[?id_demanda==`"+data_this.idDemanda+"`] | [0]");
        var _parent_list = _this.closest('.info_checklist');
        if (_parent_list.hasClass('edit')) {
            _this.find('.label_name').prop('contenteditable',true).focus();
        } else {
            if (value.data_inicio == '0000-00-00 00:00:00' && !checkCapacidade('update_checklist_all')) {
                confirmaBoxPro( __.A_demanda+' ainda n\u00E3o foi '+getNameGenre('demanda', 'iniciado', 'iniciada')+'. Deseja iniciar agora?', function(){ startAtividade(data_this.idDemanda) }, 'Iniciar');
            } else {
                var checked = _parent.hasClass('checklist_checked');
                var action = 'update_checklist';
                var param = {
                    action: action,
                    mode: 'check',
                    checked: checked,
                    id_checklist: data_this.idChecklist,
                    id_demanda: data_this.idDemanda
                };
                getServerAtividades(param, action);
                _parent.find('.label_item i').attr('class','fas fa-sync-alt fa-spin');
            }
        }
    } else if (mode == 'update') {
        var target = ($('#ifrArvore').length > 0) ? $('#ifrArvore').contents() : $('body');
        var value = jmespath.search(arrayAtividadesPro, "[?id_demanda==`"+param.id_demanda+"`] | [0]");
        loadingButtonConfirm(false);
        if (param.mode == 'check') {
            var item = target.find('.info_checklist_item[data-id-checklist="'+param.id_checklist+'"]');
            if (item.hasClass('checklist_checked')) {
                item.removeClass('checklist_checked').find('.label_item i').attr('class','far fa-square').end().find('.checklist_date').text('').attr('data-date-fim','0000-00-00 00:00:00');
            } else {
                item.addClass('checklist_checked').find('.label_item i').attr('class','fas fa-check-square').end().find('.checklist_date').text(getDateSemantic({date: data.data_fim}).dateref).attr('data-date-fim',data.data_fim);
            }
            updateProgressChecklist(param.id_checklist);
        } else if (param.mode == 'order') {
            var checklist = target.find('.info_checklist[data-id-demanda="'+param.id_demanda+'"]');
            if (data.update_all) {
                checklist.find('.checklist_edit i').attr('class', 'fas fa-edit azulColor');
            } else {
                checklist.find('.checklist_edit i').attr('class', 'fas fa-exclamation-circle vermelhoColor');
            }
        } else if (param.mode == 'remove') {
            var item = target.find('.info_checklist_item[data-id-checklist="'+param.id_checklist+'"]');
                item.slideUp('slow', function() {
                    $(this).remove();
                    setTimeout(function() {
                        updateProgressChecklist(param.id_checklist);
                    }, 500);
                });
        } else if (param.mode == 'rename') {
            var item = target.find('.info_checklist_item[data-id-checklist="'+param.id_checklist+'"]');
            if (item.hasClass('checklist_checked')) {
                item.find('.label_item i').attr('class','fas fa-check-square');
            } else {
                item.find('.label_item i').attr('class','far fa-square');
            }
            var itens = item.closest('.info_checklist').find('.info_checklist_item');
            var iten_num = itens.index(item)+1;
                iten_num = (iten_num > itens.length-1) ? 0 : iten_num;
            itens.eq(iten_num).find('.label_name').prop('contenteditable',true).focus();
        } else if (param.mode == 'new') {
            var checklist = target.find('.info_checklist[data-id-demanda="'+param.id_demanda+'"]');
            var verifyCheck = ((checkCapacidade('update_checklist') && value.id_user == arrayConfigAtividades.perfil.id_user) || checkCapacidade('update_checklist_all')) ? true : false;
                checklist.find('.checklist_new i').attr('class', 'fas fa-plus-circle azulColor');

            var htmlItem =  '   <span class="info_checklist_item" data-id-checklist="'+data.id_checklist+'" data-id-demanda="'+param.id_demanda+'" data-ordem="999" data-old-value="Novo Item">'+
                            '       <span class="label_item" onkeypress="if (event.which == 13) { parent.checklistUpdate(this, \'rename\'); return false; }" onclick="parent.checklistUpdate(this, \'send\')" style="cursor:pointer" >'+
                            '           <i class="far fa-square" style="color: #406987; margin-right: 3px; cursor: pointer; font-size: 12pt;"></i> '+
                            '           <span class="label_name" '+(verifyCheck ? 'onblur="parent.checklistUpdate(this, \'rename\');"' : '')+' contenteditable="true">Novo Item</span>'+
                            '       </span>'+
                            '       <span class="label_options">'+
                            '           <span class="checklist_remove" onclick="parent.checklistUpdate(this, \'remove\')" style="cursor:pointer"><i class="far fa-trash-alt cinzaColor" style="font-size: 10pt;"></i></span>'+
                            '           <span class="checklist_order" ><i class="fas fa-bars cinzaColor" style="font-size: 12pt;"></i></span>'+
                            '           <span class="checklist_date" data-date-fim="0000-00-00 00:00:00" onmouseover="" onmouseout="return infraTooltipOcultar();"></span>'+
                            '       </span>'+
                            '   </span>';
                checklist.find('.info_checklist_itens').append(htmlItem);
                var label = checklist.find('.info_checklist_item').last().find('.label_name');
                setTimeout(function() {
                    label.focus();
                    selectTextPro(label[0]);
                }, 100);
        }
    } else if (mode == 'remove') {
        var _this = $(this_);
        var _parent = _this.closest('.info_checklist_item');
        var data_this = _parent.data();
        confirmaBoxPro('Tem certeza que deseja excluir este item?', function(){
            var action = 'update_checklist';
            var param = {
                action: action,
                mode: 'remove',
                id_checklist: data_this.idChecklist,
                id_demanda: data_this.idDemanda
            };
            getServerAtividades(param, action);
            _this.find('i').attr('class','fas fa-sync-alt fa-spin cinzaColor');
        }, 'Excluir');
    } else if (mode == 'rename') {
        var _this = $(this_);
        var _parent = _this.closest('.info_checklist_item');
        var _parent_list = _this.closest('.info_checklist');
        var data_this = _parent.data();
        var text = _this.text().trim();
        if (_parent_list.hasClass('edit') && (data_this.oldValue != text)) {
            var action = 'update_checklist';
            var param = {
                action: action,
                mode: 'rename',
                nome_checklist: text,
                id_checklist: data_this.idChecklist,
                id_demanda: data_this.idDemanda
            };
            getServerAtividades(param, action);
            _parent.find('.label_item i').attr('class','fas fa-sync-alt fa-spin');
            _parent.find('.label_name').text(text)
            _parent.data('old-value', text);
        }
    } else if (mode == 'new') {
        var _this = $(this_);
        var _parent = _this.closest('.info_checklist');
        var data_this = _parent.data();
        var action = 'update_checklist';
        var param = {
            action: action,
            mode: 'new',
            id_demanda: data_this.idDemanda
        };
        getServerAtividades(param, action);
        _this.find('i').attr('class','fas fa-sync-alt fa-spin');
    }
    checklistUpdateArray(param.id_demanda, data.checklist);
}
function checklistUpdateArray(targetID_demanda, dataChecklist) {
    checklistUpdateArrayAtiv(targetID_demanda, dataChecklist);
    var value = getAtividadeData(targetID_demanda);
    var checklistHtml = (value.checklist && value.checklist.length > 0) ? getInfoAtividadeChecklist(value, 'icon') : '';
    var tr = $('#tabelaAtivPanel tr[data-index="'+targetID_demanda+'"] td[data-type="user"]');
    if (checklistHtml != '') {
        tr.find('.info_checklist_icon').remove();
        tr.append(checklistHtml);
        getHtmlTableAtiv();
    }
}
function checklistUpdateArrayAtiv(targetID_demanda, dataChecklist) {
    var demandaIndex = (!arrayAtividades) ? -1 : arrayAtividades.findIndex((obj => obj.id_demanda == targetID_demanda));
        if (demandaIndex !== -1 && typeof dataChecklist !== 'undefined') arrayAtividades[demandaIndex].checklist = dataChecklist;

    var demandaIndexPro = (!arrayAtividadesPro) ? -1 : arrayAtividadesPro.findIndex((obj => obj.id_demanda == targetID_demanda));
        if (demandaIndexPro !== -1 && typeof dataChecklist !== 'undefined') arrayAtividadesPro[demandaIndexPro].checklist = dataChecklist;

    var demandaIndexProc = (!arrayAtividadesProcPro) ? -1 : arrayAtividadesProcPro.findIndex((obj => obj.id_demanda == targetID_demanda));
        if (demandaIndexProc !== -1 && typeof dataChecklist !== 'undefined') arrayAtividadesProcPro[demandaIndexProc].checklist = dataChecklist;

    hybridStorageStorePro('configDataAtividadesPro', arrayAtividadesPro);
        
    return arrayAtividades;
}
function checkAtivProdutividade(this_, value) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    if (!checkOptionEntidade('desativa_produtividade_geral') && _parent.find('.info_alerta_produtividade').length > 0) {
        confirmaFraseBoxPro('O tempo despendido para '+__.esta_demanda+' est\u00E1 abaixo do esperado para '+__.a_atividade+'. <br><br> Tempos despendidos anormais, fora do m\u00EDnimo esperado, poder\u00E3o motivar a <b style="font-weight: bold;">REVIS\u00C3O</b> dos atuais tempos pactuados desta unidade. <br><br> Deseja continuar?', 'SIM', function(){ 
            if (checkAtivChecklist(this_, value)) {
                sendCompleteAtividade(this_, value);
            }
        });
        return false;
    } else {
        return true;
    }
}
function checkAtivChecklist(this_, value) {
    var checklist = value.checklist;
    if (checklist && checklist.length > 0) {
        var _this = $(this_);
        var checklist_div = _this.find('.info_checklist');
        var totalItens = checklist_div.find('.info_checklist_itens .info_checklist_item').length;
        var checkedItens = checklist_div.find('.info_checklist_itens .info_checklist_item.checklist_checked').length;
        var decimalItensCheckeds = (typeof totalItens !== 'undefined' && isNumeric(totalItens) && totalItens > 0) ? checkedItens/totalItens : 1;
        var tempoPactuadoProporcional = parseInt((value.tempo_pactuado*decimalItensCheckeds).toFixed(2));
        var tempoPactuadoRestante = parseInt((value.tempo_pactuado-(value.tempo_pactuado*decimalItensCheckeds)).toFixed(2));
        if (totalItens == checkedItens) {
            return true;
        } else {
            confirmaFraseBoxPro('Existem itens do <b style="font-weight: bold;">CHECKLIST</b> pendentes de conclus\u00E3o. <br><br><i class="fas fa-exclamation-triangle vermelhoColor" style="margin: 0 5px;"></i><strong style="color: red;">Aten\u00E7\u00E3o:</strong> O tempo pactuado para a demanda ('+decimalHourToMinute(value.tempo_pactuado)+' horas) ser\u00E1 reduzido proporcionalmente ao n\u00FAmero de itens cumpridos do checklist ('+decimalHourToMinute(tempoPactuadoProporcional)+' horas). <br><br>Deseja continuar?', 'SIM', function(){ sendCompleteAtividade(this_, value, tempoPactuadoRestante) });
            return false;
        }
    } else {
        return true;
    }
}
function getKanbanUserPriority(this_, mode) {
    var _this = $(this_);
    var _parent = _this.closest('#kanbanAtivPanel');
    if (mode == 'add') {
        _parent.find('.kanban-board').addClass('kanban-priority').each(function(){
            var data = $(this).data();
            if (data.id == '_niniciadas') {
                $(this).find('.kanban-item:visible').each(function(index, value){
                    var priority = index+1;
                    var htmlPriority = '<div class="kanban-item-priority '+(!checkCapacidade('update_prioridades') ? 'disabled' : '')+'" data-priority="'+priority+'"><span>'+priority+'</span></div>';
                    $(this).find('.kanban-item-priority').remove();
                    $(this).prepend(htmlPriority);
                });
            }
        });
    } else if (mode == 'remove') {
        $('#kanbanAtivPanel').find('.kanban-board').removeClass('kanban-priority');
        _parent.find('.kanban-item-priority').remove();
    }
}
function getHtmlKanbanUserPriority() {
    var html =  '<div id="filterTagKanban_user" style="margin-top: 10px;">'+
                '   <span class="alertaBoxDisplay"> '+
                '       <i class="fas fa-info-circle azulColor" style="margin: 0 5px;"></i> '+
                '       Dica: Priorize '+__.as_demandas+' a serem '+getNameGenre('demanda', 'executados', 'executadas')+'! Utilize o \u00EDcone <i class="fas fa-bars cinzaColor" style="margin: 0 5px;"></i> para arrastar os cart\u00F5es para cima ou para baixo'+
                '   </span>'+
                '</div>';
    return html;
}
function getKanbanItensAtividade(listAtividades) {
    var boards = [];
    $.each(listAtividades, function (index, value) {
        var itens = getKanbanItem(value);
        boards.push(itens);
    });
    return boards;
}
function getGanttAtividades(bar_class = false) {
    $('#ganttAtivPanel').html('').show();
    var task = [];
    var dataFall = '';
    var listAtividades = jmespath.search(arrayAtividadesPro, "reverse(@)");
    if (listAtividades.length > 0) {
        var viewModeGantt = (getOptionsPro('ganttAtividadesView')) ? getOptionsPro('ganttAtividadesView') : 'Week';
        $.each(listAtividades, function (index, value) {
            var distribuicao = moment(value.data_distribuicao, "YYYY-MM-DD HH:mm:ss");
            var prazo = moment(value.prazo_entrega, "YYYY-MM-DD HH:mm:ss");
            var entrega = moment(value.data_entrega, "YYYY-MM-DD HH:mm:ss");
            var customClass = ( moment() <= prazo && moment() >= distribuicao ) ? 'bar-em-execucao' : 'bar-fora-execucao';   
                customClass = ( value.data_inicio != '0000-00-00 00:00:00' && prazo > moment() ) ? 'bar-iniciado' : customClass;
                customClass = ( value.data_inicio != '0000-00-00 00:00:00' && prazo < moment() ) ? 'bar-ematraso' : customClass;
                customClass = ( value.data_inicio == '0000-00-00 00:00:00' && prazo < moment() ) ? 'bar-nao-iniciado' : customClass;
                customClass = ( value.data_entrega != '0000-00-00 00:00:00' && entrega <= prazo ) ? 'bar-concluido-noprazo' : customClass;
                customClass = ( value.data_entrega != '0000-00-00 00:00:00' && entrega > prazo ) ? 'bar-concluido-foraprazo' : customClass;
                customClass = ( value.data_entrega == '0000-00-00 00:00:00' && prazo < moment() ) ? 'bar-ematraso' : customClass;
                customClass = ( value.data_entrega != '0000-00-00 00:00:00' && value.data_avaliacao == '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00' ) ? customClass+' date_entregue' : customClass;
                customClass = ( value.data_entrega != '0000-00-00 00:00:00' && value.data_avaliacao != '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00' ) ? customClass+' date_avaliado' : customClass;
                customClass = ( value.data_entrega == '0000-00-00 00:00:00' && prazo > moment() ) ? customClass+' date_noprazo' : customClass;
                customClass = ( value.data_entrega == '0000-00-00 00:00:00' && prazo < moment() ) ? customClass+' date_atrasado' : customClass;
                customClass = (typeof value.apelido !== 'undefined') ? customClass + ' ' +normalizeNameTag(value.apelido) : customClass;
                customClass = (typeof value.etiquetas !== 'undefined' && value.etiquetas !== null) ? customClass+' '+$.map(value.etiquetas, function (i) { return normalizeNameTag(i); }).join(' ') : customClass;

            var dependencia_array = (typeof value.id_vinculacao !== 'undefined' && value.id_vinculacao !== null && value.id_vinculacao.indexOf('_') !== -1) ? value.id_vinculacao.split('_') : false;
            var dependencia = (dependencia_array) 
                            ? (parseInt(dependencia_array[1]) != 0) ? (dependencia_array[0]+'_'+(parseInt(dependencia_array[1])-1).toString()) : false
                            : false;
                dependencia = (dependencia) ? jmespath.search(listAtividades,"[?id_vinculacao=='"+dependencia+"'] | [0].id_demanda") : false;
                dependencia = (dependencia && dependencia !== null) ? dependencia.toString() : '';
            var task_title_asunto = (value.assunto.length > 50 ? value.assunto.replace(/^(.{50}[^\s]*).*/, "$1")+'...' : value.assunto);
            var task_title = (typeof value.apelido !== 'undefined' ? '('+value.apelido+') ' : '')+task_title_asunto;

            // console.log(value.id_vinculacao, dependencia_array, dependencia, dependencia_array[0], parseInt(dependencia_array[1])-1, (parseInt(dependencia_array[1])-1).toString());
            var taskAtividade = {
                                id: value.id_demanda.toString(),
                                name: task_title,
                                start: distribuicao.format("YYYY-MM-DD"),
                                end: prazo.format("YYYY-MM-DD"),
                                progress: (value.data_entrega != '0000-00-00 00:00:00') 
                                            ? 100 
                                            : (value.data_inicio != '0000-00-00 00:00:00') ? (value.checklist ? getInfoAtividadeChecklist(value, 'percent') : 50) : 0,
                                dependencies: dependencia,
                                custom_class: customClass
                            };
            if (!bar_class || (bar_class && customClass.indexOf(bar_class) !== -1)) {
                task.push(taskAtividade);
            }
        });
        if (task.length > 0) {
            var gantt = new Gantt("#ganttAtivPanel", task,{
                header_height: 50,
                column_width: 10,
                step: 24,
                language: 'en',
                language: 'ptBr',
                view_modes: ['Day', 'Week', 'Month'],
                bar_height: 15,
                bar_corner_radius: 3,
                arrow_curve: 5,
                padding: 18,
                edit_task: false,
                view_mode: viewModeGantt,   
                date_format: 'YYYY-MM-DD',
                custom_popup_html: function(task) {
                    var value = jmespath.search(arrayAtividadesPro, "[?id_demanda==`"+task.id+"`] | [0]");
                    var htmlActionsAtividade = actionsAtividade(value.id_demanda, 'icon');
                    var html = '<div class="details-container seiProForm">'+
                    '   <table class="tableInfo tableLine">'+
                    '      <tr>'+
                    '           <td colspan="2">'+
                    '               <h5><i class="iconPopup fas fa-comment-dots cinzaColor"></i> '+
                    '                   <span class="boxInfo" style="font-size: 11pt;font-weight: bold;width: 85%;display: inline-block;">'+value.assunto+'</span>'+
                    '                   <a style="float: right; margin: -4px -4px 0 0; padding: 5px;" onclick="ganttAtividades.hide_popup()"><i class="far fa-times-circle cinzaColor"></i></a>'+
                    '               </h5>'+
                    '           </td>'+
                    '      </tr>'+
                    '   '+getInfoAtividade(value)+
                    '      <tr class="trCinza">'+
                    '           <td style="vertical-align: middle; padding: 0 10px;" colspan="2">'+
                    '               <p>'+
                    '                   <span class="boxInfo">'+
                    '                       <a class="ui-button ui-corner-all ui-widget" style="color: #2b2b2b; text-decoration: none; float: right;" onclick="actionsAtividade('+value.id_demanda+')">'+
                    '                           <i style="margin-right: 3px; color: #8a8a8a;" class="'+htmlActionsAtividade.icon+'"></i>'+
                    '                           '+htmlActionsAtividade.name+
                    '                       </a>'+
                    '                   </span>'+
                    '               </p>'+
                    '           </td>'+
                    '      </tr>'+
                    '   </table>'+
                    '</div>';
                return html;
                },
                on_click: function (task) {
                }
            });
            ganttAtividades = gantt;
            if (!getOptionsPro('panelHeight_atividadesGanttPro') && $('#ganttAtivPanel').height() > 800) { setOptionsPro('panelHeight_atividadesGanttPro', 800) }
            $('.gantt-container').addClass('tabelaPanelScroll');
            initPanelResize('.gantt-container', 'atividadesGanttPro');
        } else {
            dataFall = '<div class="gantt-container dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div>';
        }
        var btnGroupView =  '<div style="position: absolute; right: 0; z-index: 99;">'+
                            '   <div class="btn-group" role="group" style="float: right;">'+
                            '       <button type="button" data-value="Day" class="btn btn-sm btn-light '+(getOptionsPro('ganttAtividadesView') == 'Day' ? 'active' : '')+'">Dia</button>'+
                            '       <button type="button" data-value="Week" class="btn btn-sm btn-light '+(getOptionsPro('ganttAtividadesView') == 'Week' || !getOptionsPro('ganttAtividadesView') ? 'active' : '')+'">Semana</button>'+
                            '       <button type="button" data-value="Month" class="btn btn-sm btn-light '+(getOptionsPro('ganttAtividadesView') == 'Month' ? 'active' : '')+'">M\u00EAs</button>'+
                            '   </div>'+
                            '</div>';

        var selectFilterGantt = getSelectViewControl('ganttAtivPanel');

        var legendFilter =  '<div class="filterGanttTag">'+selectFilterGantt+
                            '   <span class="filterCustom" style="display:none">'+getFilterGanttTag(ganttAtividades, 'bar-custom', '-', bar_class, 'atividade')+'</span>'+
                            '   '+getFilterGanttTag(ganttAtividades, 'bar-nao-iniciado', 'Fora do prazo', bar_class, 'atividade')+
                            '   '+getFilterGanttTag(ganttAtividades, 'bar-em-execucao', 'No prazo', bar_class, 'atividade')+
                            '   '+getFilterGanttTag(ganttAtividades, 'bar-iniciado', 'Iniciada', bar_class, 'atividade')+
                            '   '+getFilterGanttTag(ganttAtividades, 'bar-ematraso', 'Iniciada em atraso', bar_class, 'atividade')+
                            '   '+getFilterGanttTag(ganttAtividades, 'bar-concluido-noprazo', 'Conclu\u00EDda no prazo', bar_class, 'atividade')+
                            '   '+getFilterGanttTag(ganttAtividades, 'bar-concluido-foraprazo', 'Conclu\u00EDda fora do prazo', bar_class, 'atividade')+
                            '</div>';
            $('#ganttAtivPanel').css('max-width',($('#atividadesProDiv').width()-20)).prepend(legendFilter+btnGroupView+dataFall);

        if (ganttAtividades && ganttAtividades.bars.length > 0) {
            var scrollLeft = ganttAtividades.bars[0].x-20;
            var windowDiv = $('#ganttAtivPanel').find('.gantt-container');
            windowDiv.animate({scrollLeft: scrollLeft}, 500);

            var popupAtiv = $('#ganttAtivPanel').find('.popup-wrapper');
            if (popupAtiv.length > 0) {
                var observerPopupAtiv = new MutationObserver(function(mutations) {
                    var _this = $(mutations[0].target);
                    var _parent = _this.closest('.gantt-container');
                    if (_this.is(':visible')) {
                        _parent.attr('style', function(i,s) { return (s || '') + 'position: relative !important;' });
                        _parent.find('.ui-resizable-handle').hide();
                    } else {
                        _parent.attr('style', function(i,s) { return (s || '') + 'position: initial !important;' });
                        _parent.find('.ui-resizable-handle').show();
                    }
                });
                    observerPopupAtiv.observe(popupAtiv.get(0), {
                            attributes: true
                        });
            }
        }
        $("#ganttAtivPanel .btn-group").on("click", "button", function() {
            $btn = $(this);
            var mode = $btn.data('value');
            $btn.parent().find('button').removeClass('active'); 
            $btn.addClass('active');
            ganttAtividades.change_view_mode(mode);
            setOptionsPro('ganttAtividadesView', mode);
        });
        if (typeof $().chosen === 'function') {
            $('#selectViewControl_ganttAtivPanel').chosen({
                placeholder_text_single: ' ',
                no_results_text: 'Nenhum resultado encontrado'
            });
            forcePlaceHoldChosen();
        }
    } else {
        $('#ganttAtivPanel').html('<div class="dataFallback" data-text="Nenhum dado dispon\u00EDvel"></div>').show();
    }
}
function getFilterGanttTag(gantt, bar_class, text, actived, mode) {
    var checkTasks = jmespath.search(gantt.tasks, "[?contains(custom_class, '"+bar_class+"')]");
    var counter = (checkTasks !== null && checkTasks.length > 0 && !actived) ? '<span class="counter">'+checkTasks.length+'</span>' : '';
    var html =  '    <span title="'+text+' ('+(checkTasks !== null ? checkTasks.length : '')+')" class="bar-wrapper '+bar_class+' '+(bar_class == actived ? 'active' : (actived) ? 'inative' : '')+'" data-bar="'+bar_class+'" data-mode="'+mode+'" onclick="setFilterGanttTag(this)">'+
                '        <span class="bar">'+
                '           '+counter+
                '            <g class="bar-progress"></g>'+
                '        </span><span class="text">'+text+'</span>'+
                '    </span>';
    return ((checkTasks !== null && checkTasks.length > 0 && !actived) || actived) ? html : '';
    // return (checkTasks !== null && checkTasks.length > 0) ? html : '';
}
function setFilterGanttTag(this_) {
    var _this = $(this_);
    var active = _this.hasClass('active');
    var data = _this.data();
    if (!active) {
        if (data.mode == 'atividade') {
            getGanttAtividades(data.bar);
            setOptionsPro('ganttAtividadesFilter', data.bar);
        } else if (data.mode == 'afastamento') {
            getGanttAfastamento(data.bar);
            setOptionsPro('ganttAfastamentosFilter', data.bar);
        }
    } else {
        if (data.mode == 'atividade') {
            getGanttAtividades();
            removeOptionsPro('ganttAtividadesFilter');
        } else if (data.mode == 'afastamento') {
            getGanttAfastamento();
            removeOptionsPro('ganttAfastamentosFilter');
        }
    }
}
function getChartAtividades(bar_class = false) {
    var panelChart = $('#chartAtivPanel');
        panelChart.show();
        if (typeof $().chosen === 'function') {
            panelChart.find('select').chosen({
                placeholder_text_single: ' ',
                no_results_text: 'Nenhum resultado encontrado'
            });
        }
    if (panelChart.is(':visible')) { setTimeout(function(){ initGetChartDemandas() }, 500); }
}
function initGetChartDemandas(TimeOut = 9000) {
    if (TimeOut <= 0) { return; }
    if ($('.chartAtivPanelDiv').is(':visible')) {
        var selectChart = getOptionsPro('selectChartAtiv');
        var selectPrograma = $('#selectChartProgramasAtiv');
        var selectUnidadeID = selectPrograma.find('option:selected').data('id_unidade');
            selectUnidadeID = (typeof selectUnidadeID !== 'undefined' && selectUnidadeID !== null) ? selectUnidadeID : 0;
        var selectProgramaID = selectPrograma.val();
            selectProgramaID = (typeof selectProgramaID !== 'undefined' && selectProgramaID !== null) ? selectProgramaID : 0;
        var param = {
                        id_user: (typeof selectChart !== 'undefined' && selectChart.id_user !== null && typeof selectChart.id_user !== 'undefined') ? selectChart.id_user : $('#selectChartUserAtiv').val(), 
                        id_unidade: (typeof selectChart !== 'undefined' && selectChart.id_unidade !== null && typeof selectChart.id_unidade !== 'undefined') ? selectChart.id_unidade : selectUnidadeID,
                        id_programa: (typeof selectChart !== 'undefined' && selectChart.id_programa !== null && typeof selectChart.id_programa !== 'undefined') ? selectChart.id_programa : selectProgramaID
                    };
        getChartDemandas(param);
    } else {
        setTimeout(function(){ 
            initGetChartDemandas(TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initGetChartDemandas'); 
        }, 500);
    }
}
function initToolbarFunc(this_, TimeOut = 9000) {
    if (TimeOut <= 0) { return; }
    if (typeof $().toolbar !== 'undefined') { 
        setToolbarFunc(this_);
    } else {
        if (TimeOut == 9000) $.getScript((URL_SPRO+"js/lib/jquery.toolbar.min.js"));
        setTimeout(function(){ 
            initToolbarFunc(this_, TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initToolbarFunc'); 
        }, 500);
    }
}
function setToolbarFunc(this_) {
    var _this = $(this_);

    if ($('#toolbar_atividades').length == 0) {
        $('#atividadesProDiv').append(setToolbarAtiv());
    }
    if (!_this.hasClass('toolbar_control')) {
        _this.addClass('toolbar_control');
        $('.toolbar_control').toolbar({
            content: '#toolbar_atividades',
            position: 'bottom',
            event: 'click', 
            hideOnClick: true,
            adjustment: 5,
            style: 'menu'
        }).on('toolbarShown', function( event ) {
            var id = $(event.currentTarget).data('index');
            var toolbar = $('.tool-container.tool-bottom.toolbar-menu.animate-standard:visible');
            setTimeout(function () { 
                if (typeof id !== 'undefined' && id !== null && toolbar.length > 0) {
                    var value = jmespath.search(arrayAtividadesPro, "[?id_demanda==`"+id+"`] | [0]");
                        value = (value !== null) ? value : false;

                    toolbar.find('.tool-item').hide().each(function(){
                        var action = $(this).data('action');
                        var mode = $(this).data('mode');
                        var show = false;
                            if (checkPermissionAtiv(value)) {
                                if (mode.indexOf('rate_atividade') !== -1 && (action == 'none' || checkCapacidade(action)) && value.data_avaliacao == '0000-00-00 00:00:00' && value.data_entrega != '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00') { // rate_atividade
                                    show = true;
                                } else if (mode.indexOf('complete_atividade') !== -1 && (action == 'none' || checkCapacidade(action)) && value.data_inicio != '0000-00-00 00:00:00' && value.data_entrega == '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00') { // complete_atividade
                                    show = true;
                                    if (mode.indexOf('pause_atividade') !== -1 && typeof value.data_retomada !== 'undefined' && value.data_retomada !== null && value.data_retomada == '0000-00-00 00:00:00') {
                                        show = false;
                                    } else if (mode.indexOf('play_atividade') !== -1 && (typeof value.data_retomada === 'undefined' || value.data_retomada === null || value.data_retomada != '0000-00-00 00:00:00')) {
                                        show = false;
                                    }
                                } else if (mode.indexOf('send_atividade') !== -1 && (action == 'none' || checkCapacidade(action)) && value.data_avaliacao != '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00') { // send_atividade
                                    show = true;
                                } else if (mode.indexOf('start_atividade') !== -1 && (action == 'none' || checkCapacidade(action)) && value.data_inicio == '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00' && value.data_avaliacao == '0000-00-00 00:00:00') { // start_atividade
                                    show = true;
                                } else if (mode.indexOf('delete_atividade') !== -1 && checkCapacidade(action+'_all') ) { // delete_atividade_all
                                    show = true;
                                } else if (mode.indexOf('archive_atividade') !== -1 && (action == 'none' || checkCapacidade(action)) && value.data_avaliacao != '0000-00-00 00:00:00' && value.data_envio != '0000-00-00 00:00:00') { // archive_atividade
                                    show = true;
                                } else if (mode == 'none' && (value.data_envio == '0000-00-00 00:00:00' || action == 'history_atividade')) {
                                    show = true;
                                } else if (action == 'rate_default_atividade' && moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss') < moment() && value.data_entrega == '0000-00-00 00:00:00' && value.data_avaliacao == '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00') {
                                    show = true;
                                }
                                if (action == 'type_atividade' && value.tempo_pactuado != 0) {
                                    show = false;
                                } else if (action == 'variation_atividade' && value.tempo_pactuado == 0) {
                                    show = false;
                                }
                                // console.log(this, show, action, value, moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss') < moment(), value.data_entrega == '0000-00-00 00:00:00', value.data_avaliacao == '0000-00-00 00:00:00', value.data_envio == '0000-00-00 00:00:00')
                            }
                        if (show) {
                            $(this).show();
                        }
                    });
                }
            }, 300);
        }).on('toolbarItemClick', function( event, triggerButton ) {
            event.preventDefault();
            event.stopPropagation();
            var id = $(this).data('index');
            var action = $(triggerButton).data('action');
            var subaction = $(triggerButton).data('subaction');

            if (typeof id !== 'undefined' && id !== null) {
                var value = jmespath.search(arrayAtividadesPro, "[?id_demanda==`"+id+"`] | [0]");
                    value = (value !== null) ? value : false;
                if (action == 'info_atividade') {
                    parent.infoAtividade(value.id_demanda);
                } else if (action == 'history_atividade') {
                    parent.historyAtividade(value.id_demanda);
                } else if (action == 'variation_atividade' || action == 'type_atividade') {
                    parent.variationAtividade(value.id_demanda);
                } else if (action == 'start_cancel_atividade') {
                    parent.startCancelAtividade(value.id_demanda);
                } else if (action == 'pause_atividade') {
                    parent.pauseAtividade(value.id_demanda);
                } else if (action == 'edit_atividade') {
                    if (subaction == 'notify_atividade') {
                        parent.notifyAtividade(value.id_demanda, event);
                    } else {
                        parent.saveAtividade(value.id_demanda);
                    }
                } else if (action == 'delete_atividade' || action == 'delete_atividade_all') {
                    parent.deleteAtividade_(value);
                } else if (action == 'extend_atividade') {
                    parent.extendAtividade(value.id_demanda);
                } else if (action == 'complete_edit_atividade') {
                    parent.completeAtividade(value.id_demanda);
                } else if (action == 'complete_cancel_atividade') {
                    parent.completeCancelAtividade(value.id_demanda);
                } else if (action == 'rate_edit_atividade') {
                    parent.rateAtividade(value.id_demanda);
                } else if (action == 'rate_default_atividade') {
                    parent.rateAtividade(value.id_demanda, true);
                } else if (action == 'rate_cancel_atividade') {
                    parent.rateCancelAtividade(value.id_demanda);
                } else if (action == 'send_cancel_atividade') {
                    parent.sendCancelAtividade(value.id_demanda);
                }
            }
        }).on('toolbarHidden', function( event ) {
            event.preventDefault();
            event.stopPropagation();
            // $('.tool-container.tool-bottom.toolbar-menu.animate-standard').remove();
            // $(event.currentTarget).removeClass('toolbar_control');
            // console.log(event.currentTarget);
        });  
        _this.trigger('click');
    }
}
// INICIA FUNCOES DO PAINEL DE GESTAO DE ATIVIDADES
function initFunctionsPanelAtiv(TimeOut = 9000) {
    if (TimeOut <= 0) { return; }
    if (typeof $('.atividadeTagsPro').tagsInput !== 'undefined' && 
        typeof $('.tabelaPanelScroll').resizable !== 'undefined' && 
        typeof $().tablesorter !== 'undefined' && 
        typeof $('.ui-autocomplete-input').autocomplete !== 'undefined') {

        var tabelaAtiv = $('#tabelaAtivPanel table.tableAtividades');
        
        if (tabelaAtiv.length) {
            initChosenReplace('panel');
            getAtividadeTagsPro(); 
            initNewTabProcesso();

            function getFilterTableAtiv(elem) {
                var _this = $(elem);
                var data = _this.data();
                var _return = $(elem).text();
                if (data.type == 'proc') {
                    var id = $(elem).find('.type-id').text().replace('#', '');
                    var target = $(elem).find('a').not('.followLink').eq(0);
                    var texttip_span = target.find('span').attr('onmouseover');
                        texttip_span = (typeof texttip_span !== 'undefined') ? extractTooltip(texttip_span) : ''; 
                    var texttip_i = target.find('i').attr('onmouseover');
                        texttip_i = (typeof texttip_i !== 'undefined') ? extractTooltip(texttip_i) : ''; 
                        _return = id+' '+target.text().trim()+' '+texttip_span+' '+texttip_i;
                } else if (data.type == 'date') {
                    var target = $(elem).find('.dateboxDisplay').eq(0);
                    var text_date = target.data('time-sorter');
                        _return = text_date;
                }
                return _return;
            }
            
            tabelaAtiv.tablesorter({
                sortLocaleCompare : true,
                textExtraction: {
                1: function (elem, table, cellIndex) {
                    return getFilterTableAtiv(elem);
                },
                2: function (elem, table, cellIndex) {
                    return getFilterTableAtiv(elem);
                },
                3: function (elem, table, cellIndex) {
                    return getFilterTableAtiv(elem);
                },
                4: function (elem, table, cellIndex) {
                    return getFilterTableAtiv(elem);
                },
                5: function (elem, table, cellIndex) {
                    return getFilterTableAtiv(elem);
                },
                6: function (elem, table, cellIndex) {
                    return getFilterTableAtiv(elem);
                }
                },
                widgets: ["saveSort", "filter"],
                widgetOptions: {
                    saveSort: true,
                    filter_hideFilters: true,
                    filter_columnFilters: true,
                    filter_saveFilters: true,
                    filter_hideEmpty: true,
                    filter_excludeFilter: {}
                },
                sortReset: true,
                headers: {
                    0: { sorter: false, filter: false },
                    1: { filter: true },
                    2: { filter: true },
                    3: { filter: true },
                    4: { filter: true }
                }
            }).on("sortEnd", function (event, data) {
                checkboxRangerSelectShift();
                repareStickColumnsSortable(tabelaAtiv, true);
            }).on("filterEnd", function (event, data) {
                var caption = $(this).find("caption").eq(0);
                var tx = caption.text();
                    caption.text(tx.replace(/\d+/g, data.filteredRows));
                    $(this).find("tbody > tr:visible > td > input").prop('disabled', false);
                    $(this).find("tbody > tr:hidden > td > input").prop('disabled', true);
            });

            var filterAtiv = tabelaAtiv.find('.tablesorter-filter-row').get(0);
            if (typeof filterAtiv !== 'undefined') {
                var observerFilterAtiv = new MutationObserver(function(mutations) {
                    var _this = $(mutations[0].target);
                    var _parent = _this.closest('table');
                    var iconFilter = _parent.find('.filterTablePro button');
                    var checkIconFilter = iconFilter.hasClass('active');
                    var hideme = _this.hasClass('hideme');
                    if (hideme && checkIconFilter) {
                        iconFilter.removeClass('active');
                    }
                });
                setTimeout(function(){ 
                    var selectFilterTable = getSelectViewControl('tabelaAtivPanel');
                    var topPosition = (typeof arrayConfigAtividades.perfil.id_user !== 'undefined' && jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+arrayConfigAtividades.perfil.id_user+"`] | [0]") !== null) ? '140px' : '52px';
                    var htmlFlashFilterTable =  '<div class="filterTablePro filterTableAtivStatus" onmouseout="return infraTooltipOcultar();" style="position: absolute;top: '+topPosition+';text-align: right;right: 320px;z-index: 9999;">'+
                                                '   <span class="info_dates_fav" style="margin: 0; margin-right: 20px;">'+
                                                '       <span class="dateboxDisplay tag-remove filterTagClean" onmouseover="return _infraTooltipMostrar(this, \'Limpar Filtros\');" onmouseout="return infraTooltipOcultar();" onclick="parent.filterTagView(this); $(this).closest(\'table\').trigger(\'filterReset\');" style="display:none; font-size: 9pt;padding: 3px 10px;background-color: #f9fafa;">'+
                                                '           <span class="dateBoxIcon">'+
                                                '               <i class="fas fa-eraser" style="color: #9d9d9d; padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                                                '           </span>'+
                                                '           <span class="text">Limpar Filtros</span>'+
                                                '       </span>'+
                                                '       <span class="dateboxDisplay tagTableText_date_noprazo" onmouseover="return _infraTooltipMostrar(this, \'Filtrar demandas no prazo\');" onmouseout="return infraTooltipOcultar();" data-colortag="#eef4f9" data-tagname="date_noprazo" data-nametag="No prazo" data-type="date" onclick="parent.filterTagView(this)" style="font-size: 9pt;padding: 3px 10px;background-color: #f9fafa;">'+
                                                '           <span class="dateBoxIcon">'+
                                                '               <i class="far fa-clock" style="color: #4285f4; padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                                                '           </span>'+
                                                '           <span class="text">No prazo ('+tabelaAtiv.find('tbody tr.tagTableName_date_noprazo').length+')</span>'+
                                                '       </span>'+
                                                '       <span class="dateboxDisplay tagTableText_date_atrasado" onmouseover="return _infraTooltipMostrar(this, \'Filtrar demandas atrasadas\');" data-colortag="#f9e2e0" data-tagname="date_atrasado" data-nametag="Atrasada" data-type="date" onclick="parent.filterTagView(this)" style="font-size: 9pt;padding: 3px 10px;background-color: #f9fafa;">'+
                                                '           <span class="dateBoxIcon">'+
                                                '               <i class="fas fa-exclamation-triangle vermelhoColor" style="color: #4285f4; padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                                                '           </span>'+
                                                '           <span class="text">Atrasadas ('+tabelaAtiv.find('tbody tr.tagTableName_date_atrasado').length+')</span>'+
                                                '       </span>'+
                                                '       <span class="dateboxDisplay tagTableText_date_entregue" onmouseover="return _infraTooltipMostrar(this, \'Filtrar demandas entregues\');" data-colortag="#ddf1dd" data-tagname="date_entregue" data-nametag="Entregue" data-type="date" onclick="parent.filterTagView(this)" style="font-size: 9pt;padding: 3px 10px;background-color: #f9fafa;">'+
                                                '           <span class="dateBoxIcon">'+
                                                '               <i class="fas fa-check-circle verdeColor" style="color: #4285f4; padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                                                '           </span>'+
                                                '           <span class="text">Entregues ('+tabelaAtiv.find('tbody tr.tagTableName_date_entregue').length+')</span>'+
                                                '       </span>'+
                                                '       <span class="dateboxDisplay tagTableText_date_avaliado" onmouseover="return _infraTooltipMostrar(this, \'Filtrar demandas avaliadas\');" data-colortag="#f1ecdd" data-tagname="date_avaliado" data-nametag="Avaliada" data-type="date" onclick="parent.filterTagView(this)" style="font-size: 9pt;padding: 3px 10px;background-color: #f9fafa;">'+
                                                '           <span class="dateBoxIcon">'+
                                                '               <i class="fas fa-star starGold" style="color: #4285f4; padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                                                '           </span>'+
                                                '           <span class="text">Avaliadas ('+tabelaAtiv.find('tbody tr.tagTableName_date_avaliado').length+')</span>'+
                                                '       </span>'+
                                                '   </span>'+
                                                '   '+selectFilterTable+
                                                '</div>';

                    var htmlFilterAtiv =    '<div class="btn-group filterTablePro" role="group" style="right: 55px;top: '+topPosition+';z-index: 9999;position: absolute;">'+
                                            '   <button type="button" onmouseover="return _infraTooltipMostrar(this, \'Baixar\');" onmouseout="return infraTooltipOcultar();" onclick="downloadTablePro(this)" data-icon="fas fa-download" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="Baixar" class="btn btn-sm btn-light">'+
                                            '       <i class="fas fa-download" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                            '       <span class="text">Baixar</span>'+
                                            '   </button>'+
                                            '   <button type="button" onmouseover="return _infraTooltipMostrar(this, \'Copiar\');" onmouseout="return infraTooltipOcultar();" onclick="copyTablePro(this)" data-icon="fas fa-copy" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="Copiar" class="btn btn-sm btn-light">'+
                                            '       <i class="fas fa-copy" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                            '       <span class="text">Copiar</span>'+
                                            '   </button>'+
                                            '   <button type="button" onmouseover="return _infraTooltipMostrar(this, \'Pesquisar\');" onmouseout="return infraTooltipOcultar();" onclick="filterTablePro(this)" style="padding: 0.1rem .5rem; font-size: 9pt;" data-value="Pesquisar" class="btn btn-sm btn-light '+(tabelaAtiv.find('tr.tablesorter-filter-row').hasClass('hideme') ? '' : 'active')+'">'+
                                            '       <i class="fas fa-search" style="padding-right: 3px; cursor: pointer; font-size: 10pt; color: #888;"></i>'+
                                            '       <span class="text">Pesquisar</span>'+
                                            '   </button>'+
                                            '</div>';
                        tabelaAtiv.find('thead .filterTablePro').remove();
                        tabelaAtiv.find('thead').prepend(htmlFlashFilterTable+htmlFilterAtiv);
                        observerFilterAtiv.observe(filterAtiv, {
                            attributes: true
                        });
                    if (typeof $().chosen !== 'undefined') {
                        $('#selectViewControl_tabelaAtivPanel').chosen({
                            placeholder_text_single: ' ',
                            no_results_text: 'Nenhum resultado encontrado'
                        });
                        forcePlaceHoldChosen();
                        setResizeAreaTelaD();
                    }
                }, 300);
                $.getScript(URL_SPRO+"js/lib/jquery-visible.min.js");
            }

            var tagName = getOptionsPro('filterTag_atividades');
            if (typeof tagName !== 'undefined' && tagName != '') {
                setTimeout(function(){ 
                    $('.tableAtividades .tagTableText_'+tagName).eq(0).trigger('click');
                }, 500);
            } else if (tagName == '' && (checkCapacidade('only_self_atividades') && !setOptionsPro('filterTag_removed') )) {
                var tagName_thisUser = normalizeNameTag(arrayConfigAtividades.perfil.apelido);
                setTimeout(function(){ 
                    $('.tableAtividades .tagTableText_'+tagName_thisUser).eq(0).trigger('click');
                }, 500);
            }

            var observerTableAtiv = new MutationObserver(function(mutations, observer) {
                // observer.disconnect();
                var _this = $(mutations[0].target);
                var _parent = _this.closest('table');
                var idsSelected = _parent.find('tr.infraTrMarcada').map(function(){ return $(this).data('index') }).get();
                var iconsCount = {start: [], complete: [], rate: [], send: []};
                
                $.each(arrayAtividadesPro, function(index, value){
                    if ($.inArray(value.id_demanda, idsSelected) !== -1 ) {
                        if (checkPermissionAtiv(value) && value.data_inicio == '0000-00-00 00:00:00') {
                            iconsCount.start.push({id:value.id_demanda, id_unidade: value.id_unidade});
                        } else if (checkPermissionAtiv(value) && value.data_inicio != '0000-00-00 00:00:00' && value.data_entrega == '0000-00-00 00:00:00') {
                            iconsCount.complete.push({id:value.id_demanda, id_unidade: value.id_unidade});
                        } else if (checkPermissionAtiv(value) && value.data_inicio != '0000-00-00 00:00:00' && value.data_entrega != '0000-00-00 00:00:00' && value.data_avaliacao == '0000-00-00 00:00:00') {
                            iconsCount.rate.push({id:value.id_demanda, id_unidade: value.id_unidade});
                        } else if (checkPermissionAtiv(value) && value.data_inicio != '0000-00-00 00:00:00' && value.data_entrega != '0000-00-00 00:00:00' && value.data_avaliacao != '0000-00-00 00:00:00') {
                            iconsCount.send.push({id:value.id_demanda, id_unidade: value.id_unidade});
                        }
                    }
                });
                // console.log(iconsCount);

                $('#atividadesProActions').find('.iconBoxAtividade').data('list',false).find('.fa-layers-counter').text('').hide();
                $('#atividadesProActions').find('.iconBoxAtividade:visible').each(function(){
                    if ($(this).hasClass('iconAtividade_start') && iconsCount.start.length != 0) {
                        $(this).data('list',iconsCount.start).find('.fa-layers-counter').text(iconsCount.start.length).show();
                    } else if ($(this).hasClass('iconAtividade_complete') && iconsCount.complete.length != 0) {
                        $(this).data('list',iconsCount.complete).find('.fa-layers-counter').text(iconsCount.complete.length).show();
                    } else if ($(this).hasClass('iconAtividade_rate') && iconsCount.rate.length != 0) {
                        $(this).data('list',iconsCount.rate).find('.fa-layers-counter').text(iconsCount.rate.length).show();
                    } else if ($(this).hasClass('iconAtividade_send') && iconsCount.send.length != 0) {
                        $(this).data('list',iconsCount.send).find('.fa-layers-counter').text(iconsCount.send.length).show();
                    } else if ($(this).hasClass('iconAtividade_delete') && iconsCount.start.length != 0) {
                        $(this).data('list',iconsCount.start).find('.fa-layers-counter').text(iconsCount.start.length).show();
                    } 
                });
                // console.log('observerTableAtiv');
            });
            setTimeout(function(){ 
                if (tabelaAtiv.length > 0) {
                    observerTableAtiv.observe(tabelaAtiv[0], {
                        attributes: true,
                        childList: true,
                        subtree: true
                    });
                    checkboxRangerSelectShift();
                }
                forcePlaceHoldChosen();
                // dragColumnTable(tabelaAtiv);
                if (getOptionsPro('panelSortColumnsPro')) {
                    dragColumnTable(tabelaAtiv);
                }
            }, 500);

            initPanelResize('#atividadesProDiv .tabelaPanelScroll', 'atividadesPro');
            getInsertIconAtividade();
            checkboxRangerSelectShift();
            setResizeAreaTelaD();
        }
    } else {
        if (typeof $().tagsInput === 'undefined') { $.getScript((URL_SPRO+"js/lib/jquery.tagsinput-revisited.js")) }
        if (typeof $().tablesorter === 'undefined') { $.getScript((URL_SPRO+"js/lib/jquery.tablesorter.combined.min.js")) }
        setTimeout(function(){ 
            initFunctionsPanelAtiv(TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initFunctionsPanelAtiv'); 
        }, 500);
    }
}
function changeReportPrograma(this_) {
    var _this = $(this_);
    var type = _this.data('type');
    var _parent = _this.closest('.filterTablePro');
    var data = _this.find('option:selected').data();
        data = (typeof data !== 'undefined' && data !== null) ? data : false;
    var id_programa = (typeof _this !== 'undefined' && _this.val() !== null) ? _this.val() : 0;
    
    var _param = {id_programa: id_programa};
        _parent.find('.loadChartUserAtiv').remove();
        _parent.prepend('<i class="fas fa-spinner fa-spin loadChartUserAtiv" style="float: right; font-size: 12pt; margin: 5px;"></i>');

    setOptionsPro('selectReport_'+type, _param);
    getTabReport(type, 'get');
    $('#tableRelatorio_'+type+' tbody').html('');
    $('#tableRelatorio_'+type+' caption.infraCaption span.count').text('0');
}
function getAtividadeTagsPro() {
    if (typeof $('.atividadeTagsPro').tagsInput !== 'undefined') {
        $('.atividadeTagsPro').tagsInput({
            interactive: true,
            placeholder: 'Adicionar etiqueta',
            minChars: 2,
            maxChars: 100,
            limit: 8,
            autocomplete_url: '',
            autocomplete: {'source': sugestEtiquetaPro('ativ') },
            hide: true,
            delimiter: [';'],
            unique: true,
            removeWithBackspace: true,
            onAddTag: saveFollowEtiqueta,
            onRemoveTag: saveFollowEtiqueta,
            onChange: saveFollowEtiqueta
        }); 
    }
}
function checkPermissionAtiv(value) {
    return ((checkCapacidade('edit_atividade') && !checkCapacidade('only_self_atividades')) || (checkCapacidade('only_self_atividades') && value.id_user == parseInt(arrayConfigAtividades.perfil.id_user))) ? true : false
}
function checkPermissionAfast(value, capacidade) {
    return ((checkCapacidade(capacidade) && !checkCapacidade('only_self_afastamentos')) || (checkCapacidade('only_self_afastamentos') && value.id_user == parseInt(arrayConfigAtividades.perfil.id_user))) ? true : false
}
// BOX DE DEMANDA SIMPLIFICADA
function saveAtividadeSimple(id_demanda = 0) {
    var checkPlanos = (typeof arrayConfigAtividades.planos !== 'undefined' && arrayConfigAtividades.planos != 0 && arrayConfigAtividades.planos.length > 0) ? true : false;
    if (!checkPlanos) {
        alertaBoxPro('Error', 'exclamation-triangle', 'Nenhum plano de trabalho ativo!');
    } else {
        var value = getAtividadeData(id_demanda);
        var unidades =  (typeof arrayConfigAtividades.atividades !== 'undefined' && arrayConfigAtividades.atividades != 0 && arrayConfigAtividades.atividades.length > 0) 
                            ? uniqPro(jmespath.search(arrayConfigAtividades.atividades, "[?sigla_unidade].sigla_unidade"))
                            : [];
        var countUnidades = (arrayConfigAtividades.atividades.length > 0) ? unidades.length : 0;
        var unidadesPlanos = (checkPlanos) 
                            ? uniqPro(jmespath.search(arrayConfigAtividades.planos, "[?sigla_unidade].sigla_unidade")) 
                            : [];
        var countUnidadesPlanos = (checkPlanos) ? unidadesPlanos.length : 0;
        var config_unidade = getConfigDadosUnidade((id_demanda != 0 ? value.sigla_unidade: null));
        var dadosIfrArvore = getIfrArvoreDadosProcesso();
        if (value) {
            var dataDistribuicao = moment(value.data_distribuicao, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format);
            var prazoEntrega = moment(value.prazo_entrega, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format);
        } else {
            var dt_init = (dadosIfrArvore && dadosIfrArvore.data_documento && dadosIfrArvore.data_documento != '') 
                    ? moment(dadosIfrArvore.data_documento, 'DD/MM/YYYY HH:mm') : moment();
            var hr_init = dt_init.format('HH:mm');
            var dataDistribuicao = dt_init.format(config_unidade.hora_format);
                dataDistribuicao = (moment(hr_init, 'HH:mm') > moment(config_unidade.h_util_fim, 'HH:mm')) 
                    ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_fim).add(-1,'hours').format(config_unidade.hora_format)
                    : dataDistribuicao;
                dataDistribuicao = (moment(hr_init, 'HH:mm') < moment(config_unidade.h_util_inicio, 'HH:mm')) 
                        ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_inicio).format(config_unidade.hora_format)
                        : dataDistribuicao;
            var prazoEntrega = dt_init.add(1,'days').format(config_unidade.hora_format);
                prazoEntrega = (moment(hr_init, 'HH:mm') > moment(config_unidade.h_util_fim, 'HH:mm')) 
                    ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_fim).format(config_unidade.hora_format)
                    : prazoEntrega;
                prazoEntrega = (moment(hr_init, 'HH:mm') < moment(config_unidade.h_util_inicio, 'HH:mm')) 
                        ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_inicio).add(1,'hours').format(config_unidade.hora_format)
                        : prazoEntrega;
        }

        var optionSelectResponsavel = '';
        if (countUnidadesPlanos > 1) {
            $.each(unidadesPlanos, function(index, v){
                var arrayResp = jmespath.search(arrayConfigAtividades.planos, "[?sigla_unidade=='"+v+"'] | [?vigencia==`true`]");
                optionSelectResponsavel += '<optgroup label="'+v+'">';
                optionSelectResponsavel += getOptionsSelectResp(arrayResp, value);
                optionSelectResponsavel += '</optgroup>';
            });
        } else {
            var arrayResp = jmespath.search(arrayConfigAtividades.planos, "[?vigencia==`true`]");
            optionSelectResponsavel += getOptionsSelectResp(arrayResp, value);
        }

        var dadosMultProcessos = (
                                    dadosIfrArvore && 
                                    dadosIfrArvore.processos && 
                                    dadosIfrArvore.processos[0].id_procedimento != dadosIfrArvore.id_procedimento
                                ) 
                                    ? dadosIfrArvore.processos
                                    : getProcessoUnidadePro(true).length > 0
                                        ? getProcessoUnidadePro(true, true) 
                                        : false;    
        var checkProcessoHome = (!value && !dadosIfrArvore && dadosMultProcessos && dadosMultProcessos.length > 0) ? true : false;                 
        var htmlMultProcessos = '';
        if (dadosMultProcessos) {
            htmlMultProcessos += '<div class="listMultProcessos">';
            $.each(dadosMultProcessos, function(index, value){
                htmlMultProcessos +=    '<span class="ativProcessos" data-procedimento="'+value.id_procedimento+'" data-processo="'+value.processo_sei+'">'+
                                        '   <i class="fas fa-folder-open cinzaColor" style="font-size: 9pt;margin-right: 5px;"></i>'+
                                        '   '+value.processo_sei+
                                        '   <i class="fas fa-times vermelhoColor"  onclick="multProcessRemove(this)" style="font-size: 9pt;margin-left: 5px;cursor: pointer;user-select: none;"></i>'+
                                        '</span>';
            })
            htmlMultProcessos += "<input type='hidden' id='ativ_id_procedimentos' data-key='id_procedimentos' data-param='id_procedimentos' value='[]'>";
            htmlMultProcessos += '</div>';
        }

        var selectResponsavel = '<select id="ativ_id_user" data-key="id_user" data-type="user" onchange="updateAtivSelectUser(this)"><option>&nbsp;</option>'+optionSelectResponsavel+'</select>';

        var htmlBox =   '<div id="boxAtividade" class="atividadeWork" data-demanda="'+(value && value.id_demanda ? value.id_demanda : 0)+'">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        '      <tr '+(dadosIfrArvore || value ? '' : 'style="display:none;"')+'>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_processo_sei"><i class="iconPopup iconSwitch fas fa-folder-open cinzaColor"></i>Processo SEI:</label>'+
                        '               <input type="hidden" id="ativ_id_demanda" data-key="id_demanda" data-param="id_demanda" value="'+id_demanda+'">'+
                        '           </td>'+
                        '           <td>'+
                        '               <input type="text" id="ativ_processo_sei" onchange="changeProtocoloBoxAtiv(this)" data-key="processo_sei" value="'+(value && value.processo_sei ? value.processo_sei : (dadosIfrArvore ? dadosIfrArvore.processo_sei : '') )+'">'+
                        '               <input type="hidden" id="ativ_id_procedimento" data-key="id_procedimento" data-param="id_procedimento" value="'+(value && value.id_procedimento ? value.id_procedimento : (dadosIfrArvore ? dadosIfrArvore.id_procedimento : '') )+'">'+
                        '           </td>'+
                        '           <td style="vertical-align: bottom;" class="label">'+
                        '               <label class="last" for="ativ_requisicao_sei"><i class="iconPopup iconSwitch fas fa-file cinzaColor"></i>SEI n\u00BA:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <input type="text" maxlength="11" oninput="this.value=this.value.replace(/[^0-9]/g,\'\')" id="ativ_requisicao_sei" onchange="changeProtocoloBoxAtiv(this)" data-key="requisicao_sei" value="'+(value && value.requisicao_sei ? value.requisicao_sei : (dadosIfrArvore ? dadosIfrArvore.nr_sei : '') )+'">'+
                        '               <input type="hidden" id="ativ_id_documento_requisicao" data-key="id_documento_requisicao" data-param="id_documento" value="'+(value && value.id_documento_requisicao ? value.id_documento_requisicao : (dadosIfrArvore ? dadosIfrArvore.id_documento : '') )+'">'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr '+(checkProcessoHome ? '' : 'style="display:none;"')+' class="ativMultiProcesso">'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label for="ativ_processo_sei"><i class="iconPopup iconSwitch fas fa-folder-open cinzaColor" style="height: 50px;"></i>Processos SEI '+(checkProcessoHome ? 'Selecionados' : 'Listados')+': <br><span class="counterMultProcessos"></span></label>'+
                        '           </td>'+
                        '           <td colspan="3">'+
                        '               '+htmlMultProcessos+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_assunto"><i class="iconPopup iconSwitch fas fa-comment-dots cinzaColor"></i>'+__.Assunto+':</label>'+
                        '               <input type="hidden" class="hiddenOptionConfig" id="ativ_id_unidade" data-type="text" data-key="id_unidade" value="'+(value && value.id_unidade ? value.id_unidade : arrayConfigAtivUnidade.id_unidade)+'">'+
                        '               <input type="hidden" class="hiddenOptionConfig" id="ativ_id_tipo_requisicao" data-type="text" data-key="id_tipo_requisicao" value="'+(value && value.id_tipo_requisicao ? value.id_tipo_requisicao : 0)+'">'+
                        '               <input type="hidden" class="hiddenOptionConfig" id="ativ_id_atividade" data-type="text" data-key="id_atividade" value="'+(value && value.id_atividade ? value.id_atividade : 0)+'">'+
                        '               <input type="hidden" class="hiddenOptionConfig" id="ativ_tempo_pactuado" data-type="text" data-key="tempo_pactuado" value="'+(value && value.tempo_pactuado ? value.tempo_pactuado : '')+'">'+
                        '               <input type="hidden" class="hiddenOptionConfig" id="ativ_fator_complexidade" data-type="text" data-key="fator_complexidade" value="'+(value && value.fator_complexidade ? value.fator_complexidade : 0)+'">'+
                        '           </td>'+
                        '           <td class="required" colspan="3">'+
                        '               <input type="text" id="ativ_assunto" onchange="checkThisAtivRequiredFields(this)" maxlength="255" data-key="assunto" value="'+(value && value.assunto ? value.assunto : (dadosIfrArvore && dadosIfrArvore.assunto ? dadosIfrArvore.assunto : '' ) )+'" required>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label for="ativ_observacao_gerencial"><i class="iconPopup iconSwitch fas fa-comment-alt cinzaColor"></i>'+__.Observacao+' '+__.Gerencial+':</label>'+
                        '           </td>'+
                        '           <td colspan="3" style="text-align: left;">'+
                        '               <textarea type="text" id="ativ_observacao_gerencial" '+(value ? '' : 'oninput="checkboxAnotacoesProcessoAtiv(this);"')+' style="width: 97%;" data-key="observacao_gerencial">'+((value && value.observacao_gerencial !== null && value.observacao_gerencial != '') ? value.observacao_gerencial : '')+'</textarea>'+
                        ''+($('#ifrArvore').length > 0 ? 
                        '               <table style="width: 100%;font-size: 10pt; display:none" id="tableAnotacoesProcessoAtiv">'+
                        '                   <tbody>'+
                        '                       <tr style="height: 40px;">'+
                        '                           <td style="text-align: left;vertical-align: bottom;">'+
                        '                               <label for="ativ_anotacoes_processo">'+
                        '                                   <i class="iconPopup iconSwitch fas fa-sticky-note cinzaColor"></i>Adicionar '+__.observacao+' '+__.gerencial+' nas anota\u00E7\u00F5es do processo?</label>'+
                        '                           </td>'+
                        '                           <td style="width: 50px;">'+
                        '                               <div class="onoffswitch" style="float: right;">'+
                        '                                   <input type="checkbox" data-key="anotacoes_processo" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_anotacoes_processo" tabindex="0">'+
                        '                                   <label class="onoffswitch-label" for="ativ_anotacoes_processo"></label>'+
                        '                               </div>'+
                        '                           </td>'+
                        '                       </tr>'+
                        '                   </tbody>'+
                        '               </table>'+
                        '' : '')+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_id_user"><i class="iconPopup iconSwitch fas fa-user-tie cinzaColor"></i>Respons\u00E1vel:</label>'+
                        '           </td>'+
                        '           <td colspan="3">'+
                        '               '+selectResponsavel+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr style="height: auto;">'+
                        '           <td colspan="4">'+
                        '               <table style="font-size: 10pt;width: 100%;">'+
                        '                   <tr class="modoDistribuicao_determinada">'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '                            <label for="ativ_data_distribuicao"><i class="iconPopup iconSwitch fas fa-briefcase cinzaColor"></i>Data de Distribui\u00E7\u00E3o:</label>'+
                        '                        </td>'+
                        '                        <td class="required date" style="width: 210px;">'+
                        '                            <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="changeDadosTrabalho(this)" id="ativ_data_distribuicao" data-key="data_distribuicao" data-type="inicio" data-name="data de distribui\u00E7\u00E3o" value="'+dataDistribuicao+'" required>'+
                        '                        </td>'+
                        '                        <td style="vertical-align: bottom;" class="label">'+
                        '                            <label class="last" for="ativ_prazo_entrega"><i class="iconPopup iconSwitch fas fa-business-time cinzaColor" style="float: initial;"></i>Prazo de Entrega:</label>'+
                        '                        </td>'+
                        '                        <td class="required date">'+
                        '                            <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="changeDadosTrabalho(this)" id="ativ_prazo_entrega" data-key="prazo_entrega" data-type="fim" data-name="prazo de entrega" value="'+prazoEntrega+'" required>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '                   <tr style="display:none">'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '                            <label for="ativ_tempo_planejado"><i class="iconPopup iconSwitch fas fa-hourglass-half cinzaColor"></i>'+
                        '                           <i class="fas fa-info-circle azulColor" style="margin: 0px 2px;float: right;" onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\'Tempo l\u00EDquido entre a data de distribui\u00E7\u00E3o '+getNameGenre('demanda', 'do', 'da')+' '+__.demanda+' e seu <u>prazo de entrega</u>\')"></i>'+
                        '                           Tempo Planejado:</label>'+
                        '                        </td>'+
                        '                        <td style="width: 210px;">'+
                        '                            <input type="number" min="1" id="ativ_tempo_planejado" onchange="changeDadosTrabalho(this)" data-key="tempo_planejado" data-type="tempo" value="'+(value && value.tempo_planejado ? value.tempo_planejado : '')+'" disabled>'+
                        '                        </td>'+
                        '                        <td style="vertical-align: bottom;" class="label">'+
                        '                            <label class="last" for="ativ_dias_planejado"><i class="iconPopup iconSwitch fas fa-calendar-alt cinzaColor" style="float: initial;"></i><span id="ativ_dias_planejado_label">Dias '+(config_unidade.count_dias_uteis ? '\u00FAteis' : '')+' de Planejamento</span>:</label>'+
                        '                        </td>'+
                        '                        <td class="required number">'+
                        '                            <input type="number" min="0" id="ativ_dias_planejado" onchange="changeDadosTrabalho(this)" data-key="dias_planejado" data-type="dias" value="'+(value && value.dias_planejado ? value.dias_planejado : '0')+'" required>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr style="height: 30px;vertical-align: bottom;">'+
                        '           <td colspan="4">'+
                        '               <a class="newLink moreInfoBoxAtiv" onclick="moreInfoBoxAtiv(this)" style="font-size: 10pt;cursor: pointer;margin: -12px 0 0 0;float: right; background-color: #fff;">'+
                        '                   <i class="fas fa-plus-circle cinzaColor"></i> Op\u00E7\u00F5es'+
                        '               </a>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr style="height: auto;">'+
                        '           <td colspan="4">'+
                        '               <table style="font-size: 10pt;width: 100%; display:none;" class="moreInfoBox">'+
                        '                   <tr class="hrForm"><td colspan="4"></td></tr>'+
                        '                   <tr '+(dadosMultProcessos && !value ? '' : 'style="display:none;"')+'>'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label" colspan="2">'+
                        '                           <table style="width: 100%; font-size: 10pt;">'+
                        '                               <tr>'+
                        '                                   <td style="padding-top: 15px;width: 250px;text-align: left;">'+
                        '                                       <label for="ativ_multiprocesso"><i class="iconPopup iconSwitch fas fa-clone cinzaColor"></i>Clonar '+__.esta_demanda+' nos processos <br> listados no documento?</label>'+
                        '                                   </td>'+
                        '                                   <td style="text-align: left;'+(dadosMultProcessos ? '' : 'display:none;')+'">'+
                        '                                       <div class="onoffswitch" style="float: left;">'+
                        '                                           <input type="checkbox" data-key="multiprocesso" onchange="changeAtivMultiProcesso(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_multiprocesso" tabindex="0">'+
                        '                                           <label class="onoffswitch-label" for="ativ_multiprocesso"></label>'+
                        '                                       </div>'+
                        '                                   </td>'+
                        '                               </tr>'+
                        '                           </table>'+
                        '                   </tr>'+
                        '                   <tr '+(value ? 'style="display:none"' : '')+'>'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label" colspan="2">'+
                        '                            <table style="width: 100%; font-size: 10pt;">'+
                        '                                <tr>'+
                        '                                    <td style="padding-top: 15px;width: 130px;text-align: left;">'+
                        '                                        <label for="ativ_multiplicacao"><i class="iconPopup iconSwitch fas fa-retweet cinzaColor"></i>Multiplicar '+__.demanda+'?</label>'+
                        '                                    </td>'+
                        '                                    <td style="text-align: left;width: 50px;">'+
                        '                                        <div class="onoffswitch">'+
                        '                                            <input type="checkbox" data-key="multiplicacao" onchange="changeAtivMultiSwitch(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_multiplicacao" tabindex="0">'+
                        '                                            <label class="onoffswitch-label" for="ativ_multiplicacao"></label>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                    <td>'+
                        '                                        <div id="div_ativ_fator_multiplicacao" style="display:none">'+
                        '                                            <label style="margin-right: 10px;">x</label>'+
                        '                                            <input type="number" min="1" style="width: 50px !important;" id="ativ_fator_multiplicacao" onchange="updateAtivTempoPactuado(this)" data-key="fator_multiplicacao" value="1">'+''+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                </tr>'+
                        '                            </table>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '                   <tr id="trAtivVinculacao" '+(value ? 'style="display:none"' : '')+'>'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label" colspan="4">'+
                        '                            <table style="width: 100%; font-size: 10pt;">'+
                        '                                <tr>'+
                        '                                    <td style="padding-top: 15px; width: 130px; text-align: left;">'+
                        '                                        <label for="ativ_vinculacao"><i class="iconPopup iconSwitch fas fa-random cinzaColor"></i>Vincular '+__.demanda+'?</label>'+
                        '                                    </td>'+
                        '                                    <td style="width: 50px; text-align: left;">'+
                        '                                        <div class="onoffswitch">'+
                        '                                            <input type="checkbox" data-key="vinculacao" onchange="changeAtivVinculacaoSwitch(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_vinculacao" tabindex="0">'+
                        '                                            <label class="onoffswitch-label" for="ativ_vinculacao"></label>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                    <td>'+
                        '                                        <div id="div_ativ_lista_vinculacao" style="text-align: right; display:none;width: 530px !important;">'+
                        '                                            <select id="ativ_lista_vinculacao" data-key="lista_vinculacao">'+
                        '                                               <option value="0">&nbsp;</option>'+
                        '                                               '+getListAtivVinculacao()+
                        '                                           </select>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                </tr>'+
                        '                            </table>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '                   <tr id="trAtivPrioridade" '+(!value ? 'style="display:none"' : '')+'>'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label" colspan="4">'+
                        '                            <table style="width: 100%; font-size: 10pt;">'+
                        '                                <tr>'+
                        '                                    <td style="padding-top: 15px; width: 130px; text-align: left;">'+
                        '                                        <label for="ativ_prioridades"><i class="iconPopup iconSwitch fas fa-exclamation cinzaColor"></i>Priorizar '+__.demanda+'?</label>'+
                        '                                    </td>'+
                        '                                    <td style="width: 50px; text-align: left;">'+
                        '                                        <div class="onoffswitch">'+
                        '                                            <input type="checkbox" data-key="prioridades" onchange="changeAtivPrioritySwitch(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_prioridades" tabindex="0">'+
                        '                                            <label class="onoffswitch-label" for="ativ_prioridades"></label>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                    <td>'+
                        '                                        <div id="div_ativ_lista_prioridades" style="text-align: right; display:none;width: 530px !important;">'+
                        '                                            <select id="ativ_lista_prioridades" data-key="lista_prioridades"><option value="0">&nbsp;</option></select>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                </tr>'+
                        '                            </table>'+
                        '                        </td>'+
                        '                   </tr>'+
                        (value ? '' : 
                        '                   <tr id="trAtivChecklist">'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label" colspan="4">'+
                        '                            <input type="hidden" id="ativ_checklist" data-key="lista_checklist" data-param="lista_checklist" value="'+(value && value.checklist ? value.checklist : '')+'">'+
                        '                            <table style="width: 100%; font-size: 10pt;">'+
                        '                                <tr>'+
                        '                                    <td style="padding-top: 15px; width: 130px; text-align: left;">'+
                        '                                        <label for="ativ_insert_checklist"><i class="iconPopup iconSwitch fas fa-check-double cinzaColor"></i>Inserir <br>Checklist?</label>'+
                        '                                    </td>'+
                        '                                    <td style="width: 50px; text-align: left;">'+
                        '                                        <div class="onoffswitch">'+
                        '                                            <input type="checkbox" data-key="checklist" onchange="changeAtivChecklistSwitch(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_insert_checklist" tabindex="0">'+
                        '                                            <label class="onoffswitch-label" for="ativ_insert_checklist"></label>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                    <td>'+
                        '                                        <div id="div_ativ_lista_checklist" style="text-align: right; display:none">'+
                        '                                            <table id="ativBox_checklist" data-format="array" data-key="checklist" data-mode-insert="'+(value && value.checklist ? 'manual' : 'auto')+'" style="font-size: 8pt !important;width: 100%; margin:0" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebraOdd tableFollow tableAtividades">'+
                        '                                                 <tbody>'+
                        '                                                 </tbody>'+
                        '                                                 <tfoot>'+
                        '                                                    <tr>'+
                        '                                                        <th colspan="3" style="text-align: right;">'+
                        '                                                            <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                        '                                                                <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                                                                Adicionar novo item'+
                        '                                                            </a>'+
                        '                                                        </th>'+
                        '                                                    </tr>'+
                        '                                                 </tfoot>'+
                        '                                            </table>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                </tr>'+
                        '                            </table>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '                   <tr>'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '                            <label for="ativ_etiquetas"><i class="iconPopup iconSwitch fas fa-tags cinzaColor"></i>Etiquetas:</label>'+
                        '                        </td>'+
                        '                        <td colspan="3">'+
                        '                            <input type="text" id="ativ_etiquetas" data-key="etiquetas" value="'+(value && value.etiquetas ? (value.etiquetas !== null && value.etiquetas.length > 0 ? value.etiquetas.join(';') : '') : '')+'">'+
                        '                        </td>'+
                        '                   </tr>'+
                        '')+
                        '               </table>'+
                        '           </td>'+
                        '       </tr>'+
                        '   </table>'+
                        '</div>';

        var btnDialogBoxPro =   [{
                                    text: (id_demanda != 0) ? 'Editar' : 'Salvar',
                                    class: 'confirm',
                                    click: function(event) { 
                                        if (checkAtivRequiredFields(this, 'mark')) {
                                            var action = (id_demanda != 0) ? 'edit_atividade' : 'save_atividade';
                                            var param = extractDataAtiv(this);
                                                param.action = action;
                                            var id_plano = jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+param.id_user+"`] | [0].id_plano");
                                                id_plano = (id_plano === null) ? 0 : id_plano;
                                                param.id_plano = id_plano;
                                            var id_atividade = (param.id_atividade.trim() == '') ? 0 : param.id_atividade;
                                                param.id_atividade = id_atividade;
                                                getServerAtividades(param, action);
                                        }
                                    }
                                }];
        if (id_demanda != 0) {
            if (value.data_inicio != '0000-00-00 00:00:00') {
                if (checkCapacidade('complete_atividade') || checkCapacidade('complete_edit_atividade')) {
                    btnDialogBoxPro.unshift({
                        text: (value.data_entrega == '0000-00-00 00:00:00') ? 'Concluir '+__.Demanda+'' : 'Editar Conclus\u00E3o',
                        icon: 'ui-icon-check',
                        click: function(event) { 
                            completeAtividade(id_demanda);
                        }
                    });
                }
            } else {
                if (checkCapacidade('start_atividade')) {
                    btnDialogBoxPro.unshift({
                        text: 'Iniciar Execu\u00E7\u00E3o',
                        icon: 'ui-icon-play',
                        click: function(event) { 
                            startAtividade(id_demanda);
                        }
                    });
                }
            }
            btnDialogBoxPro.unshift({
                text: 'Gerar Notifica\u00E7\u00E3o',
                icon: 'ui-icon-mail-closed',
                click: function(event) { 
                    notifyAtividade(id_demanda, event);
                }
            });
            if (checkCapacidade('delete_atividade') || checkCapacidade('delete_atividade_all')) {
                btnDialogBoxPro.unshift({
                    text: 'Excluir',
                    icon: 'ui-icon-trash',
                    click: function(event) { 
                        deleteAtividade_(value);
                    }
                });
            }
        } else {
            if (checkCapacidade('edit_atividade')) {
                btnDialogBoxPro.unshift({
                    text: 'Cadastro Avan\u00E7ado',
                    icon: 'ui-icon-notice',
                    click: function(event) { 
                        changeSaveAtividade('full');
                    }
                });
            }
        }
        var titleBox = (id_demanda != 0) 
                            ? 'Editar '+__.demanda+': '+getTitleDialogBox(value)
                            : 'Criar  '+__.nova_demanda;
        resetDialogBoxPro('dialogBoxPro');
        dialogBoxPro = $('#dialogBoxPro')
            .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
            .dialog({
                title: titleBox,
                width: 780,
                open: function() { 
                    prepareFieldsReplace(this);
                },
                close: function() { 
                    $('#boxAtividade').remove();
                    cancelSelectedItensAtiv(id_demanda);
                    resetDialogBoxPro('dialogBoxPro');
                },
                buttons: btnDialogBoxPro
        });
        checkTagsIput();

        var selectUser = $('#ativ_id_user');
        if (dadosIfrArvore && id_demanda == 0) {
            var tipo_processo = dadosIfrArvore.tipo;
            var usuario = dadosIfrArvore.usuario;
            var prazo = dadosIfrArvore.prazo;
            if (usuario) {    
                selectUser.find('option').each(function(){
                    var text = $(this).text().toLowerCase();
                    if (text == usuario.toLowerCase()) {
                        if ($(this).prop('disabled') == false && $(this).closest('optgroup').prop('disabled') == false) {
                            selectUser.val($(this).val()).trigger('change');
                            return false;
                        }
                    }
                });
            }
            if (prazo) { $('#ativ_dias_planejado').val(prazo).trigger('change') }
        }
        if (!checkCapacidade('select_user_atividade')) {
            selectUser.val(arrayConfigAtividades.perfil.id_user).trigger('change');
        } 
        if (checkProcessoHome) {
            multProcessUpdateInput();
        }
    }
}
function deleteAtividade_(value) {
    if (value.data_avaliacao != '0000-00-00 00:00:00') {
        confirmaFraseBoxPro(__.A_demanda+' j\u00E1 possui avalia\u00E7\u00E3o cadastrada. Tem certeza que deseja excluir?', 'EXCLUIR', function() { deleteAtividade(value.id_demanda) });
    } else if (value.data_entrega != '0000-00-00 00:00:00') {
        confirmaFraseBoxPro(__.A_demanda+' j\u00E1 possui entrega realizada. Tem certeza que deseja excluir?', 'EXCLUIR', function() { deleteAtividade(value.id_demanda) });
    } else {
        confirmaBoxPro('Tem certeza que deseja excluir '+__.esta_demanda+'?', function() { deleteAtividade(value.id_demanda) }, 'Excluir');
    }
}
function recoveryDemanda(this_, id_demanda) {
    var _this = $(this_);
    if (id_demanda > 0) {
        var action = 'restory_atividade';
        var param = {
            action: action,
            id_unidade: arrayConfigAtivUnidade.id_unidade,
            id_demanda: id_demanda
        };
        getServerAtividades(param, action);
        _this.find('i').attr('class','fas fa-spinner fa-spin cinzaColor');
        infraTooltipOcultar();
    }
}
function changeSaveAtividade(type) {
    var assunto = $('#ativ_assunto').val();
    var observacao_gerencial = $('#ativ_observacao_gerencial').val();
    var id_user = $('#ativ_id_user').val();
    var data_distribuicao = $('#ativ_data_distribuicao').val();
    var prazo_entrega = $('#ativ_prazo_entrega').val();
    if (type == 'simple') {
        saveAtividadeSimple();
    } else if (type == 'quick') {
        saveAtividadeQuick();
    } else {
        saveAtividadeFull();
    }
    setOptionsPro('formSaveAtividade', type);
    setTimeout(function(){ 
        $('#ativ_assunto').val(assunto);
        $('#ativ_observacao_gerencial').val(observacao_gerencial).trigger('change');
        $('#ativ_id_user').val(id_user).trigger('change');
        $('#ativ_data_distribuicao').val(data_distribuicao).trigger('change');
        $('#ativ_prazo_entrega').val(prazo_entrega).trigger('change');
        if (observacao_gerencial !== '' && !$('#ativ_observacao_gerencial').is(':visible')) {
            $('.atividadeWork .moreInfoBoxAtiv').trigger('click');
        }
    }, 300);
}
function checkMaxDateAvaliacao() {
    var daysMaxAvaliacao = (checkOptionEntidade('checar_avaliacao') && checkOptionEntidade('prazo_avaliacao')) ? getOptionEntidade('prazo_avaliacao') : 40;
    var dateMaxAvaliacao = moment().add(-daysMaxAvaliacao,'day').format('YYYY-MM-DD HH:mm:ss');
    var checkMaxAvaliacao = jmespath.search(arrayAtividadesPro,"[?data_entrega!='0000-00-00 00:00:00'] | [?id_avaliacao==`0`] | [?data_entrega < `"+dateMaxAvaliacao+"`]");
    return (checkMaxAvaliacao === null || checkMaxAvaliacao.length == 0 || !checkOptionEntidade('checar_avaliacao')) ? true : false;
}
function saveAtividade(id_demanda = 0) {
    if (checkMaxDateAvaliacao()) {
        if (
                id_demanda == 0 &&
                (getOptionsPro('formSaveAtividade') == 'simple' || (!getOptionsPro('formSaveAtividade') && checkOptionEntidade('cadastro_simplificado'))) 
            ){
            saveAtividadeSimple(id_demanda);
        } else if (
            id_demanda == 0 &&
            (getOptionsPro('formSaveAtividade') == 'quick' && checkCapacidade('save_atividade_rapida'))
        ) {
            saveAtividadeQuick();
        } else {
            saveAtividadeFull(id_demanda);
        }
    } else {
        // alertaBoxPro('Error', 'exclamation-triangle', 'Existem demandas n\u00E3o avaliadas h\u00E1 mais de 40 dias. Solicite ao gestor que as avalie antes de prosseguir!');
        
        var daysMaxAvaliacao = (checkOptionEntidade('checar_avaliacao') && checkOptionEntidade('prazo_avaliacao')) ? getOptionEntidade('prazo_avaliacao') : 40;
        var htmlBox =   '<strong class="alertaErrorPro dialogBoxDiv">'+
                        '   <i class="fas fa-exclamation-triangle" style="margin-right: 5px;"></i> '+
                        '   Existem demandas n\u00E3o avaliadas h\u00E1 mais de '+daysMaxAvaliacao+' dias. <br>'+(checkCapacidade('rate_atividade') ? 'Avalie-as antes de prosseguir.' : 'Solicite ao gestor que as avalie antes de prosseguir!')+
                        '</strong>';

        resetDialogBoxPro('dialogBoxPro');
        dialogBoxPro = $('#dialogBoxPro')
            .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
            .dialog({
                title: NAMESPACE_SPRO,
                width:450,
                open: function() { 
                    updateButtonConfirm(this, true);
                },
                close: function() { 
                    resetDialogBoxPro('dialogBoxPro');
                    updateAtividade_(false);
                },
                buttons: [{
                    text: (checkCapacidade('rate_atividade') && $('#ifrArvore').length == 0 ? 'Visualizar '+__.demandas : 'Ok'),
                    class: (checkCapacidade('rate_atividade') ? 'confirm' : ''),
                    click: function(event) { 
                        if (checkCapacidade('rate_atividade')) {
                            selectDemanadasPendentesAvaliacao(daysMaxAvaliacao);
                        } else {
                            updateAtividade_(false);
                        }
                        resetDialogBoxPro('dialogBoxPro');
                    }
                }]
        });
    }
}
function selectDemanadasPendentesAvaliacao(daysMaxAvaliacao) {
    $('.filterTablePro.filterTableAtivStatus .tagTableText_date_entregue').trigger('click');
    $('#tabelaAtivPanel').find('.tableAtividades').trigger("sorton",[[[0,0],[2,0]]]); 

    $('#tabelaAtivPanel').find('thead th a[onclick*="setSelectAllTr"]').data('index',1).trigger('click');

    $('.dateboxDisplay.tagTableText_date_entregue').each(function(){
        if (moment($(this).data('time-sorter'), 'YYYY-MM-DD HH:mm:ss').add(daysMaxAvaliacao,'d') < moment()) {
            $(this).closest('tr').find('input[type="checkbox"][onclick*="followSelecionarItens("]').trigger('click');
        }
    });
}
// BOX DE DEMANDA COMPLETA
function saveAtividadeFull(id_demanda = 0) {
    var checkPlanos = (typeof arrayConfigAtividades.planos !== 'undefined' && arrayConfigAtividades.planos != 0 && arrayConfigAtividades.planos.length > 0) ? true : false;
    if (!checkPlanos) {
        alertaBoxPro('Error', 'exclamation-triangle', 'Nenhum plano de trabalho ativo!');
    } else {
        var value = getAtividadeData(id_demanda);
        var unidades =  (typeof arrayConfigAtividades.atividades !== 'undefined' && arrayConfigAtividades.atividades != 0 && arrayConfigAtividades.atividades.length > 0) 
                            ? uniqPro(jmespath.search(arrayConfigAtividades.atividades, "[?sigla_unidade].sigla_unidade"))
                            : [];
        var countUnidades = (arrayConfigAtividades.atividades.length > 0) ? unidades.length : 0;
        var unidadesPlanos = (checkPlanos) 
                            ? uniqPro(jmespath.search(arrayConfigAtividades.planos, "[?sigla_unidade].sigla_unidade")) 
                            : [];
        var countUnidadesPlanos = (checkPlanos) ? unidadesPlanos.length : 0;
        var config_unidade = getConfigDadosUnidade((id_demanda != 0 ? value.sigla_unidade: null));
        var dadosIfrArvore = getIfrArvoreDadosProcesso();
        if (value) {
            var dataDistribuicao = moment(value.data_distribuicao, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format);
            var prazoEntrega = moment(value.prazo_entrega, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format);
        } else {
            var dt_init = (dadosIfrArvore && dadosIfrArvore.data_documento && dadosIfrArvore.data_documento != '') 
                    ? moment(dadosIfrArvore.data_documento, 'DD/MM/YYYY HH:mm') : moment();
            var hr_init = dt_init.format('HH:mm');
            var dataDistribuicao = dt_init.format(config_unidade.hora_format);
                dataDistribuicao = (moment(hr_init, 'HH:mm') > moment(config_unidade.h_util_fim, 'HH:mm')) 
                    ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_fim).add(-1,'hours').format(config_unidade.hora_format)
                    : dataDistribuicao;
                dataDistribuicao = (moment(hr_init, 'HH:mm') < moment(config_unidade.h_util_inicio, 'HH:mm')) 
                        ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_inicio).format(config_unidade.hora_format)
                        : dataDistribuicao;
            var prazoEntrega = dt_init.add(1,'hours').format(config_unidade.hora_format);
                prazoEntrega = (moment(hr_init, 'HH:mm') > moment(config_unidade.h_util_fim, 'HH:mm')) 
                    ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_fim).format(config_unidade.hora_format)
                    : prazoEntrega;
                prazoEntrega = (moment(hr_init, 'HH:mm') < moment(config_unidade.h_util_inicio, 'HH:mm')) 
                        ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_inicio).add(1,'hours').format(config_unidade.hora_format)
                        : prazoEntrega;
        }

        var optionSelectRequisicoes = ( arrayConfigAtividades.tipos_requisicoes.length > 0 ) ? $.map(arrayConfigAtividades.tipos_requisicoes, function(v,k){ return ( (value && v.id_tipo_requisicao == value.id_tipo_requisicao) || (dadosIfrArvore && dadosIfrArvore.nome_documento.indexOf(v.nome_requisicao) !== -1) ) ? '<option value="'+v.id_tipo_requisicao+'" selected>'+v.nome_requisicao+'</option>' : '<option value="'+v.id_tipo_requisicao+'">'+v.nome_requisicao+'</option>' }).join('') : '';
        var selectRequisicoes = '<select id="ativ_id_tipo_requisicao" class="requiredSelect" onchange="checkThisAtivRequiredFields(this)" data-key="id_tipo_requisicao" required><option>&nbsp;</option>'+optionSelectRequisicoes+'</select>';
            selectRequisicoes = (checkOptionEntidade('dispensa_tipos_requisicao')) ? '<input type="hidden" id="ativ_id_tipo_requisicao" data-key="id_tipo_requisicao" data-param="id_tipo_requisicao" value="0">' : selectRequisicoes;

        var optionSelectAtividades = '';
        // var arrayTabelaAtividades = jmespath.search(arrayConfigAtividades.atividades,"[?homologado==`true`]");
            // arrayTabelaAtividades = (arrayTabelaAtividades !== null) ? arrayTabelaAtividades : [];
        var arrayTabelaAtividades = arrayConfigAtividades.atividades;
        if (countUnidades > 1) {
            $.each(unidades, function(index, v){
                var arrayAtiv = jmespath.search(arrayTabelaAtividades, "[?sigla_unidade=='"+v+"']");
                optionSelectAtividades +=   '<optgroup label="'+v+'">'+
                                            '   '+getOptionsSelectAtivGroup(arrayAtiv, value, true)+
                                            '</optgroup>';
            });
        } else {
            optionSelectAtividades += getOptionsSelectAtivGroup(arrayTabelaAtividades, value, true);
        } 
        var selectAtividades = '<select id="ativ_id_atividade" data-key="id_atividade" onchange="changeAtivSelect(this)"><option>&nbsp;</option>'+optionSelectAtividades+'</select>';
        
        var optionSelectResponsavel = '';
        if (countUnidadesPlanos > 1) {
            $.each(unidadesPlanos, function(index, v){
                var arrayResp = jmespath.search(arrayConfigAtividades.planos, "[?sigla_unidade=='"+v+"'] | [?vigencia==`true`]");
                optionSelectResponsavel += '<optgroup label="'+v+'">';
                optionSelectResponsavel += getOptionsSelectResp(arrayResp, value);
                optionSelectResponsavel += '</optgroup>';
            });
        } else {
            var arrayResp = jmespath.search(arrayConfigAtividades.planos, "[?vigencia==`true`]");
            optionSelectResponsavel += getOptionsSelectResp(arrayResp, value);
        }

        var dadosMultProcessos = (
                                    dadosIfrArvore && 
                                    dadosIfrArvore.processos && 
                                    dadosIfrArvore.processos[0].id_procedimento != dadosIfrArvore.id_procedimento
                                ) 
                                    ? dadosIfrArvore.processos
                                    : getProcessoUnidadePro(true).length > 0
                                        ? getProcessoUnidadePro(true, true) 
                                        : false;    
        var checkProcessoHome = (!value && !dadosIfrArvore && dadosMultProcessos && dadosMultProcessos.length > 0) ? true : false;                 
        var htmlMultProcessos = '';
        if (dadosMultProcessos) {
            htmlMultProcessos += '<div class="listMultProcessos">';
            $.each(dadosMultProcessos, function(index, value){
                htmlMultProcessos +=    '<span class="ativProcessos" data-procedimento="'+value.id_procedimento+'" data-processo="'+value.processo_sei+'">'+
                                        '   <i class="fas fa-folder-open cinzaColor" style="font-size: 9pt;margin-right: 5px;"></i>'+
                                        '   '+value.processo_sei+
                                        '   <i class="fas fa-times vermelhoColor"  onclick="multProcessRemove(this)" style="font-size: 9pt;margin-left: 5px;cursor: pointer;user-select: none;"></i>'+
                                        '</span>';
            })
            htmlMultProcessos += "<input type='hidden' id='ativ_id_procedimentos' data-key='id_procedimentos' data-param='id_procedimentos' value='[]'>";
            htmlMultProcessos += '</div>';
        }

        var selectResponsavel = '<select id="ativ_id_user" data-key="id_user" data-type="user" onchange="updateAtivSelectUser(this)"><option>&nbsp;</option>'+optionSelectResponsavel+'</select>';
        var htmlBox =   '<div id="boxAtividade" class="atividadeWork" data-demanda="'+(value && value.id_demanda ? value.id_demanda : 0)+'">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        '      <tr '+(dadosIfrArvore || value ? '' : 'style="display:none;"')+'>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_processo_sei"><i class="iconPopup iconSwitch fas fa-folder-open cinzaColor"></i>Processo SEI:</label>'+
                        '               <input type="hidden" id="ativ_id_demanda" data-key="id_demanda" data-param="id_demanda" value="'+id_demanda+'">'+
                        '           </td>'+
                        '           <td colspan="'+(dadosMultProcessos ? '' : '3')+'">'+
                        '               <input type="text" id="ativ_processo_sei" onchange="changeProtocoloBoxAtiv(this)" data-key="processo_sei" value="'+(value && value.processo_sei ? value.processo_sei : (dadosIfrArvore ? dadosIfrArvore.processo_sei : '') )+'">'+
                        '               <input type="hidden" id="ativ_id_procedimento" data-key="id_procedimento" data-param="id_procedimento" value="'+(value && value.id_procedimento ? value.id_procedimento : (dadosIfrArvore ? dadosIfrArvore.id_procedimento : '') )+'">'+
                        '           </td>'+
                        '           <td colspan="2" '+(dadosMultProcessos && !value ? '' : 'style="display:none;"')+'>'+
                        '               <table style="width: 100%; font-size: 10pt;">'+
                        '                   <tr>'+
                        '                       <td colspan="2" style="padding-top: 15px;text-align: left;padding-left: 25px;">'+
                        '                           <label for="ativ_multiprocesso"><i class="iconPopup iconSwitch fas fa-clone cinzaColor"></i>Clonar '+__.esta_demanda+' nos processos <br> listados no documento?</label>'+
                        '                       </td>'+
                        '                       <td '+(dadosMultProcessos ? '' : 'style="display:none;"')+'>'+
                        '                           <div class="onoffswitch" style="float: right;">'+
                        '                               <input type="checkbox" data-key="multiprocesso" onchange="changeAtivMultiProcesso(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_multiprocesso" tabindex="0">'+
                        '                               <label class="onoffswitch-label" for="ativ_multiprocesso"></label>'+
                        '                           </div>'+
                        '                       </td>'+
                        '                   </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr '+(checkProcessoHome ? '' : 'style="display:none;"')+' class="ativMultiProcesso">'+
                        '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '               <label for="ativ_processo_sei"><i class="iconPopup iconSwitch fas fa-folder-open cinzaColor" style="height: 50px;"></i>Processos SEI '+(checkProcessoHome ? 'Selecionados' : 'Listados')+': <br><span class="counterMultProcessos"></span></label>'+
                        '           </td>'+
                        '           <td colspan="3">'+
                        '               '+htmlMultProcessos+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr '+(checkOptionEntidade('dispensa_tipos_requisicao') && !dadosIfrArvore && !value ? 'style="display:none;"' : '')+'>'+
                        '          <td style="vertical-align: bottom; text-align: left; '+(checkOptionEntidade('dispensa_tipos_requisicao') ? 'display:none;' : '')+'" class="label">'+
                        '               <label for="ativ_id_tipo_requisicao"><i class="iconPopup iconSwitch fas fa-inbox cinzaColor"></i>Requisi\u00E7\u00E3o:</label>'+
                        '           </td>'+
                        '           <td class="required" style="width: 210px;max-width: 210px; '+(checkOptionEntidade('dispensa_tipos_requisicao') ? 'display:none;' : '')+'">'+
                        '               '+selectRequisicoes+
                        '           </td>'+
                        '           <td style="vertical-align: bottom; '+(dadosIfrArvore || value ? '' : 'display:none;')+'" class="label">'+
                        '               <label class="'+(checkOptionEntidade('dispensa_tipos_requisicao') ? '' : 'last')+'" for="ativ_requisicao_sei"><i class="iconPopup iconSwitch fas fa-file cinzaColor"></i>SEI n\u00BA:</label>'+
                        '           </td>'+
                        '           <td '+(dadosIfrArvore || value ? '' : 'style="display:none;"')+'>'+
                        '               <input type="text" oninput="this.value=this.value.replace(/[^0-9]/g,\'\')" id="ativ_requisicao_sei" onchange="changeProtocoloBoxAtiv(this)" data-key="requisicao_sei" value="'+(value && value.requisicao_sei ? value.requisicao_sei : (dadosIfrArvore ? dadosIfrArvore.nr_sei : '') )+'">'+
                        '               <input type="hidden" id="ativ_id_documento_requisicao" data-key="id_documento_requisicao" data-param="id_documento" value="'+(value && value.id_documento_requisicao ? value.id_documento_requisicao : (dadosIfrArvore ? dadosIfrArvore.id_documento : '') )+'">'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_assunto"><i class="iconPopup iconSwitch fas fa-comment-dots cinzaColor"></i>'+__.Assunto+':</label>'+
                        '           </td>'+
                        '           <td class="required" colspan="3">'+
                        '               <input type="text" id="ativ_assunto" onchange="checkThisAtivRequiredFields(this)" maxlength="255" data-key="assunto" value="'+(value && value.assunto ? value.assunto : (dadosIfrArvore && dadosIfrArvore.assunto ? dadosIfrArvore.assunto : '' ) )+'" required>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr class="hrForm"><td colspan="4"></td></tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_id_atividade"><i class="iconPopup iconSwitch fas fa-clipboard-list cinzaColor"></i>'+__.Atividade+':</label>'+
                        '           </td>'+
                        '           <td colspan="3">'+
                        '               '+selectAtividades+
                        '               <input type="hidden" id="ativ_id_unidade" data-key="id_unidade" data-param="id_unidade" value="">'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '           <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_fator_complexidade"><i class="iconPopup iconSwitch fas fa-graduation-cap cinzaColor"></i>Grau de '+__.Complexidade+':</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <select id="ativ_fator_complexidade" data-key="fator_complexidade" onchange="updateAtivTempoPactuado(this)"><option>&nbsp;</option></select>'+
                        '           </td>'+
                        '           <td colspan="2" rowspan="3">'+
                        '               <div id="chartUser" style="width: 380px; height: 85px;"></div>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_id_user"><i class="iconPopup iconSwitch fas fa-user-tie cinzaColor"></i>Respons\u00E1vel:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               '+selectResponsavel+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_tempo_pactuado"><i class="iconPopup iconSwitch fas fa-user-clock cinzaColor"></i>Tempo pactuado:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <input type="text" id="ativ_tempo_pactuado" data-key="tempo_pactuado" value="'+(value && value.tempo_pactuado ? value.tempo_pactuado : '')+'" data-tempo-pactuado="'+(value && value.tempo_pactuado ? value.tempo_pactuado : '')+'" disabled>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr '+(value ? 'style="display:none"' : '')+'>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label" colspan="2">'+
                        '               <table style="width: 100%; font-size: 10pt;">'+
                        '                   <tr>'+
                        '                       <td style="padding-top: 15px;">'+
                        '                           <label for="ativ_multiplicacao"><i class="iconPopup iconSwitch fas fa-retweet cinzaColor"></i>Multiplicar '+__.demanda+'?</label>'+
                        '                       </td>'+
                        '                       <td>'+
                        '                           <div class="onoffswitch" style="float: right;">'+
                        '                               <input type="checkbox" data-key="multiplicacao" onchange="changeAtivMultiSwitch(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_multiplicacao" tabindex="0">'+
                        '                               <label class="onoffswitch-label" for="ativ_multiplicacao"></label>'+
                        '                           </div>'+
                        '                       </td>'+
                        '                       <td style="width: 105px;">'+
                        '                           <div id="div_ativ_fator_multiplicacao" style="text-align: right; display:none">'+
                        '                               <label style="margin-right: 10px;">x</label>'+
                        '                               <input type="number" min="1" style="width: 50px !important;" id="ativ_fator_multiplicacao" onchange="updateAtivTempoPactuado(this)" data-key="fator_multiplicacao" value="1">'+''+
                        '                           </div>'+
                        '                       </td>'+
                        '                   </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr class="hrForm">'+
                        '           <td colspan="4">'+
                        (!checkOptionEntidade('desativa_demandas_recorrentes') ?
                        '               <div '+(value ? 'style="display:none"' : '')+' class="btn-group atividadesBtnModeDist" role="group" style="float: right;margin: -15px -20px 8px 0;transform: scale(0.9);">'+
                        '                   <button type="button" onclick="changeModeDistribuicao(this)" data-value="Determinada" class="btn btn-sm btn-light active">'+
                        '                       <i class="far fa-calendar-check" style="color: #888;"></i> <span class="text">\u00DAnica</span>'+
                        '                   </button>'+
                        '                   <button type="button" onclick="changeModeDistribuicao(this)" data-value="Recorrente" class="btn btn-sm btn-light">'+
                        '                       <i class="fas fa-redo-alt" style="color: #888;"></i> <span class="text">Recorrente</span>'+
                        '                   </button>'+
                        '               </div>'+
                        '' : '')+
                        '           </td>'+
                        '      </tr>'+
                        '      </tr>'+
                        '      <tr style="height: auto;">'+
                        '           <td colspan="4">'+
                        '               <table style="font-size: 10pt;width: 100%;">'+
                        '                   <tr class="modoDistribuicao_determinada">'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '                            <label for="ativ_data_distribuicao"><i class="iconPopup iconSwitch fas fa-briefcase cinzaColor"></i>Data de Distribui\u00E7\u00E3o:</label>'+
                        '                        </td>'+
                        '                        <td class="required date" style="width: 210px;">'+
                        '                            <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="changeDadosTrabalho(this)" id="ativ_data_distribuicao" data-key="data_distribuicao" data-type="inicio" data-name="data de distribui\u00E7\u00E3o" value="'+dataDistribuicao+'" required>'+
                        '                        </td>'+
                        '                        <td style="vertical-align: bottom;" class="label">'+
                        '                            <label class="last" for="ativ_prazo_entrega"><i class="iconPopup iconSwitch fas fa-business-time cinzaColor" style="float: initial;"></i>Prazo de Entrega:</label>'+
                        '                        </td>'+
                        '                        <td class="required date">'+
                        '                            <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="changeDadosTrabalho(this)" id="ativ_prazo_entrega" data-key="prazo_entrega" data-type="fim" data-name="prazo de entrega" value="'+prazoEntrega+'" required>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '                   <tr>'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '                            <label for="ativ_tempo_planejado"><i class="iconPopup iconSwitch fas fa-hourglass-half cinzaColor"></i>'+
                        '                            <i class="fas fa-info-circle azulColor" style="margin: 0px 2px;float: right;" onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\'Tempo l\u00EDquido entre a data de distribui\u00E7\u00E3o '+getNameGenre('demanda', 'do', 'da')+' '+__.demanda+' e seu prazo de entrega\')"></i>'+
                        '                            Tempo Planejado:</label>'+
                        '                        </td>'+
                        '                        <td style="width: 210px;">'+
                        '                            <input type="number" min="1" id="ativ_tempo_planejado" onchange="changeDadosTrabalho(this)" data-key="tempo_planejado" data-type="tempo" value="'+(value && value.tempo_planejado ? value.tempo_planejado : '')+'" disabled>'+
                        '                        </td>'+
                        '                        <td style="vertical-align: bottom;" class="label">'+
                        '                            <label class="last" for="ativ_dias_planejado"><i class="iconPopup iconSwitch fas fa-calendar-alt cinzaColor" style="float: initial;"></i><span id="ativ_dias_planejado_label">Dias '+(config_unidade.count_dias_uteis ? '\u00FAteis' : '')+' de Planejamento</span>:</label>'+
                        '                        </td>'+
                        '                        <td class="required number">'+
                        '                            <input type="number" min="0" id="ativ_dias_planejado" onchange="changeDadosTrabalho(this)" data-key="dias_planejado" data-type="dias" value="'+(value && value.dias_planejado ? value.dias_planejado : '0')+'" required>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr style="height: auto;">'+
                        '           <td colspan="4">'+
                        '               <input type="hidden" id="ativ_recorrencia" data-key="lista_recorrencia" data-param="lista_recorrencia" value="[]">'+
                        '               <table style="font-size: 10pt;width: 100%; display:none; margin-bottom: 15px;" class="modoDistribuicao_recorrente">'+
                        '                   <tr>'+
                        '                        <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '                            <label for="ativ_modo_recorrencia"><i class="iconPopup iconSwitch fas fa-redo-alt cinzaColor"></i>Recorr\u00EAncia '+__.da_Demanda+':</label>'+
                        '                        </td>'+
                        '                        <td style="width: 210px;">'+
                        '                            <select id="ativ_modo_recorrencia" data-key="modo_recorrencia" data-type="modo_recorrencia" onchange="changeModoRecorrenciaFields(this)">'+
                        '                               <option value="semana1" data-view="hide">Semanal (Segundas-feira)</option>'+
                        '                               <option value="semana5" data-view="hide">Semanal (Sextas-feira)</option>'+
                        '                               <option value="quinzena1" data-view="hide">Quinzenal (Segundas-feira)</option>'+
                        '                               <option value="quinzena5" data-view="hide">Quinzenal (Sextas-feira)</option>'+
                        '                               <option value="mes_inicio" data-view="hide">Mensal (Come\u00E7o do M\u00EAs)</option>'+
                        '                               <option value="mes_fim" data-view="hide">Mensal (Final do M\u00EAs)</option>'+
                        '                               <option value="3mes_inicio" data-view="hide">Trimestral (Come\u00E7o do Trimestre)</option>'+
                        '                               <option value="3mes_fim" data-view="hide">Trimestral (Final do Trimestre)</option>'+
                        '                               <option value="6mes_inicio" data-view="hide">Semestral (Come\u00E7o do Semestre)</option>'+
                        '                               <option value="6mes_fim" data-view="hide">Semestral (Final do Semestre)</option>'+
                        '                               <option value="ano_inicio" data-view="hide">Anual (Come\u00E7o do Ano)</option>'+
                        '                               <option value="ano_fim" data-view="hide">Anual (Final do Ano)</option>'+
                        '                               <option value="diaria" data-view="hide">Di\u00E1ria</option>'+
                        '                               <option value="numero_fixo_uteis" data-view="show">A cada (n) dias \u00FAteis</option>'+
                        '                               <option value="numero_fixo" data-view="show">A cada (n) dias corridos</option>'+
                        '                            </select>'+
                        '                        </td>'+
                        '                        <td colspan="2">'+
                        '                           <table style="font-size: 10pt;width: 100%; display:none;" class="modoDistribuicao_recorrente_modo_recorrencia">'+
                        '                               <tr>'+
                        '                                   <td style="vertical-align: bottom;" class="label">'+
                        '                                       <label class="last" for="ativ_recorrencia_numero_fixo" id="label_recorrencia_numero_fixo"><i class="iconPopup iconSwitch fas fa-calendar-day cinzaColor" style="float: initial;"></i>N\u00FAmero de Dias de Recorr\u00EAncia:</label>'+
                        '                                       <label class="last" for="ativ_recorrencia_numero_fixo" id="label_recorrencia_numero_fixo_uteis"><i class="iconPopup iconSwitch fas fa-calendar-day cinzaColor" style="float: initial;"></i>N\u00FAmero de Dias \u00DAteis de Recorr\u00EAncia:</label>'+
                        '                                   </td>'+
                        '                                   <td>'+
                        '                                       <input type="number" id="ativ_recorrencia_numero_fixo" onchange="calculoRecorrenciaAtiv(this)" data-key="recorrencia_numero_fixo" value="1">'+
                        '                                   </td>'+
                        '                               </tr>'+
                        '                           </table>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '                   <tr>'+
                        '                        <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '                            <label for="ativ_data_inicio_recorrencia"><i class="iconPopup iconSwitch fas fa-briefcase cinzaColor"></i>Data Inicial da Recorr\u00EAncia:</label>'+
                        '                        </td>'+
                        '                        <td class="date" style="width: 210px;">'+
                        '                            <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="calculoRecorrenciaAtiv(this)" id="ativ_data_inicio_recorrencia" data-key="data_inicio_recorrencia" data-name="data inicial de eecorr\u00EAncia" value="'+dataDistribuicao+'">'+
                        '                        </td>'+
                        '                        <td style="vertical-align: baseline;padding-top: 18px;" class="label">'+
                        '                            <label class="last" for="ativ_modo_fim_recorrencia"><i class="iconPopup iconSwitch fas fa-business-time cinzaColor" style="float: initial;"></i>Data Final da Recorr\u00EAncia:</label>'+
                        '                        </td>'+
                        '                        <td>'+
                        '                            <select id="ativ_modo_fim_recorrencia" data-key="modo_fim_recorrencia" data-type="fim_recorrencia" onchange="changeModoRecorrenciaFields(this)">'+
                        '                               <option value="plano_trabalho" data-view="hide">Fim do Plano de Trabalho</option>'+
                        '                               <option value="data_determinada" data-view="show">Data determinada</option>'+
                        '                            </select>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '                   <tr style="display:none;" class="modoDistribuicao_recorrente_fim_recorrencia">'+
                        '                        <td style="vertical-align: bottom; text-align: left;" class="label" colspan="2">'+
                        '                        </td>'+
                        '                        <td>'+
                        '                        </td>'+
                        '                        <td class="date">'+
                        '                            <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="calculoRecorrenciaAtiv(this)" id="ativ_data_fim_recorrencia" data-key="data_fim_recorrencia" data-name="data final de recorr\u00EAncia" value="'+prazoEntrega+'">'+
                        '                        </td>'+
                        '                   </tr>'+
                        '                   <tr>'+
                        '                        <td style="vertical-align: top; text-align: center;" class="label" colspan="4">'+
                        '                           <div id="ganttRecorrenciaPanel" style="max-width: 725px;position: relative;"></div>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr class="hrForm">'+
                        '           <td colspan="4">'+
                        '               <a class="newLink moreInfoBoxAtiv" onclick="moreInfoBoxAtiv(this)" style="font-size: 10pt;cursor: pointer;margin: -12px 0 0 0;float: right; background-color: #fff;">'+
                        '                   <i class="fas fa-'+(getOptionsPro('moreInfoBoxAtiv') == 'hide' ? 'plus' : 'minus' )+'-circle cinzaColor"></i> Op\u00E7\u00F5es'+
                        '               </a>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr style="height: auto;">'+
                        '           <td colspan="4">'+
                        '               <table style="font-size: 10pt;width: 100%; '+(getOptionsPro('moreInfoBoxAtiv') == 'hide' ? 'display:none;' : '' )+'" class="moreInfoBox">'+
                        '                   <tr>'+
                        '                       <td style="padding-top: 15px; width: 130px; text-align: left;">'+
                        '                           <label for="ativ_recalcula_prazo"><i class="iconPopup iconSwitch fas fa-calendar-check cinzaColor"></i>Prazo M\u00F3vel?</label>'+
                        '                       </td>'+
                        '                       <td style="width: 50px; text-align: left;">'+
                        '                           <div class="onoffswitch">'+
                        '                               <input type="checkbox" data-key="recalcula_prazo" onchange="changeAtivRecalcPrazoSwitch(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_recalcula_prazo" tabindex="0" data-mode-insert="'+(value && typeof value.recalcula_prazo !== 'undefined' ? 'manual' : 'auto')+'" '+(value && typeof value.recalcula_prazo !== 'undefined' && value.recalcula_prazo == 1 ? 'checked' : '')+'>'+
                        '                               <label class="onoffswitch-label" for="ativ_recalcula_prazo"></label>'+
                        '                           </div>'+
                        '                       </td>'+
                        '                       <td style="text-align: left;">'+
                        '                           <span style="color: #777; '+(value && value.recalcula_prazo ? '' : 'display:none;')+'" class="infoAtivRecalcPrazo">'+
                        '                               <i class="fas fa-info-circle laranjaColor" style="float: initial;"></i> Recalcula o prazo de entrega assim que '+__.a_demanda+' for '+getNameGenre('demanda', 'iniciado', 'iniciada')+', acrescentando o n\u00FAmero de dias de planejamento ao prazo final.'+
                        '                           </span>'+
                        '                       </td>'+
                        '                   </tr>'+
                        '                   <tr id="trAtivMarcador" '+(dadosIfrArvore ? '' : 'style="display:none"')+'>'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label" colspan="4">'+
                        '                            <table style="width: 100%; font-size: 10pt;">'+
                        '                                <tr>'+
                        '                                    <td style="padding-top: 15px; width: 130px; text-align: left;">'+
                        '                                        <label for="ativ_marcador"><i class="iconPopup iconSwitch fas fa-clock cinzaColor"></i>Adicionar Prazo no Processo?</label>'+
                        '                                    </td>'+
                        '                                    <td style="width: 50px; text-align: left;">'+
                        '                                        <div class="onoffswitch">'+
                        '                                            <input type="checkbox" data-key="marcador" onchange="changeAtivMarcadorSwitch(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_marcador" tabindex="0">'+
                        '                                            <label class="onoffswitch-label" for="ativ_marcador"></label>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                    <td>'+
                        '                                        <div id="div_ativ_lista_marcador" style="text-align: right; display:none;width: 530px !important;">'+
                        '                                            <select id="ativ_lista_marcador" data-key="id_marcador">'+
                        '                                           </select>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                </tr>'+
                        '                            </table>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '                   <tr id="trAtivVinculacao" '+(value ? 'style="display:none"' : '')+'>'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label" colspan="4">'+
                        '                            <table style="width: 100%; font-size: 10pt;">'+
                        '                                <tr>'+
                        '                                    <td style="padding-top: 15px; width: 130px; text-align: left;">'+
                        '                                        <label for="ativ_vinculacao"><i class="iconPopup iconSwitch fas fa-random cinzaColor"></i>Vincular '+__.demanda+'?</label>'+
                        '                                    </td>'+
                        '                                    <td style="width: 50px; text-align: left;">'+
                        '                                        <div class="onoffswitch">'+
                        '                                            <input type="checkbox" data-key="vinculacao" onchange="changeAtivVinculacaoSwitch(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_vinculacao" tabindex="0">'+
                        '                                            <label class="onoffswitch-label" for="ativ_vinculacao"></label>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                    <td>'+
                        '                                        <div id="div_ativ_lista_vinculacao" style="text-align: right; display:none;width: 530px !important;">'+
                        '                                            <select id="ativ_lista_vinculacao" data-key="lista_vinculacao">'+
                        '                                               <option value="0">&nbsp;</option>'+
                        '                                               '+getListAtivVinculacao()+
                        '                                           </select>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                </tr>'+
                        '                            </table>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '                   <tr id="trAtivPrioridade" '+(!value ? 'style="display:none"' : '')+'>'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label" colspan="4">'+
                        '                            <table style="width: 100%; font-size: 10pt;">'+
                        '                                <tr>'+
                        '                                    <td style="padding-top: 15px; width: 130px; text-align: left;">'+
                        '                                        <label for="ativ_prioridades"><i class="iconPopup iconSwitch fas fa-exclamation cinzaColor"></i>Priorizar '+__.demanda+'?</label>'+
                        '                                    </td>'+
                        '                                    <td style="width: 50px; text-align: left;">'+
                        '                                        <div class="onoffswitch">'+
                        '                                            <input type="checkbox" data-key="prioridades" onchange="changeAtivPrioritySwitch(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_prioridades" tabindex="0">'+
                        '                                            <label class="onoffswitch-label" for="ativ_prioridades"></label>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                    <td>'+
                        '                                        <div id="div_ativ_lista_prioridades" style="text-align: right; display:none;width: 530px !important;">'+
                        '                                            <select id="ativ_lista_prioridades" data-key="lista_prioridades"><option value="0">&nbsp;</option></select>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                </tr>'+
                        '                            </table>'+
                        '                        </td>'+
                        '                   </tr>'+
                        (value ? 
                        '                   <tr id="trAtivChecklist">'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label" colspan="4">'+
                        '                            <table style="width: 100%; font-size: 10pt;">'+
                        '                                <tr>'+
                        '                                    <td style="padding-top: 15px; width: 130px; text-align: left;">'+
                        '                                        <label for="ativ_insert_checklist"><i class="iconPopup iconSwitch fas fa-check-double cinzaColor"></i>Checklist</label>'+
                        '                                    </td>'+
                        '                                    <td style="text-align: left;">'+
                        '                                       '+getInfoAtividadeChecklist(value, 'actions')+
                        '                                    </td>'+
                        '                                </tr>'+
                        '                            </table>'+
                        '                       </td>'+
                        '                   </tr>'
                        : 
                        '                   <tr id="trAtivChecklist">'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label" colspan="4">'+
                        '                            <input type="hidden" id="ativ_checklist" data-key="lista_checklist" data-param="lista_checklist" value="'+(value && value.checklist ? value.checklist : '')+'">'+
                        '                            <table style="width: 100%; font-size: 10pt;">'+
                        '                                <tr>'+
                        '                                    <td style="padding-top: 15px; width: 130px; text-align: left;">'+
                        '                                        <label for="ativ_insert_checklist"><i class="iconPopup iconSwitch fas fa-check-double cinzaColor"></i>Inserir <br>Checklist?</label>'+
                        '                                    </td>'+
                        '                                    <td style="width: 50px; text-align: left;">'+
                        '                                        <div class="onoffswitch">'+
                        '                                            <input type="checkbox" data-key="checklist" onchange="changeAtivChecklistSwitch(this)" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_insert_checklist" tabindex="0">'+
                        '                                            <label class="onoffswitch-label" for="ativ_insert_checklist"></label>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                    <td>'+
                        '                                        <div id="div_ativ_lista_checklist" style="text-align: right; display:none">'+
                        '                                            <table id="ativBox_checklist" data-format="array" data-key="checklist" data-mode-insert="'+(value && value.checklist ? 'manual' : 'auto')+'" style="font-size: 8pt !important;width: 100%; margin:0" class="tableOptionConfig tableSortable seiProForm tableDialog tableInfo tableZebraOdd tableFollow tableAtividades">'+
                        '                                                 <tbody>'+
                        '                                                 </tbody>'+
                        '                                                 <tfoot>'+
                        '                                                    <tr>'+
                        '                                                        <th colspan="3" style="text-align: right;">'+
                        '                                                            <a class="newLink addConfigItem" onclick="addConfigItem(this)" style="cursor: pointer; margin: 5px;display: inline-block;">'+
                        '                                                                <i class="fas fa-plus-circle cinzaColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '                                                                Adicionar novo item'+
                        '                                                            </a>'+
                        '                                                        </th>'+
                        '                                                    </tr>'+
                        '                                                 </tfoot>'+
                        '                                            </table>'+
                        '                                        </div>'+
                        '                                    </td>'+
                        '                                </tr>'+
                        '                            </table>'+
                        '                        </td>'+
                        '                   </tr>'+
                        '')+
                        '                   <tr>'+
                        '                       <td style="vertical-align: middle; text-align: left;" class="label">'+
                        '                            <label for="ativ_observacao_gerencial"><i class="iconPopup iconSwitch fas fa-comment-alt cinzaColor"></i>'+__.Observacao+' '+__.Gerencial+':</label>'+
                        '                        </td>'+
                        '                        <td colspan="3" style="text-align: left;">'+
                        '                            <textarea type="text" id="ativ_observacao_gerencial" '+(value ? 'oninput="userTyped(this);"' : 'oninput="checkboxAnotacoesProcessoAtiv(this);userTyped(this);"')+' style="width: 97%;" data-key="observacao_gerencial">'+((value && value.observacao_gerencial !== null && value.observacao_gerencial != '') ? value.observacao_gerencial : '')+'</textarea>'+
                        ''+($('#ifrArvore').length > 0 ? 
                        '                               <table style="width: 100%;font-size: 10pt; display:none" id="tableAnotacoesProcessoAtiv">'+
                        '                                   <tbody>'+
                        '                                       <tr style="height: 40px;">'+
                        '                                           <td style="text-align: left;vertical-align: bottom;">'+
                        '                                               <label for="ativ_anotacoes_processo">'+
                        '                                                   <i class="iconPopup iconSwitch fas fa-sticky-note cinzaColor"></i>Adicionar '+__.observacao+' '+__.gerencial+' nas anota\u00E7\u00F5es do processo?</label>'+
                        '                                           </td>'+
                        '                                           <td style="width: 50px;">'+
                        '                                               <div class="onoffswitch" style="float: right;">'+
                        '                                                   <input type="checkbox" data-key="anotacoes_processo" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_anotacoes_processo" tabindex="0">'+
                        '                                                   <label class="onoffswitch-label" for="ativ_anotacoes_processo"></label>'+
                        '                                               </div>'+
                        '                                           </td>'+
                        '                                       </tr>'+
                        '                                   </tbody>'+
                        '                               </table>'+
                        '' : '')+
                        '                        </td>'+
                        '                   </tr>'+
                        '                   <tr>'+
                        '                       <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '                            <label for="ativ_etiquetas"><i class="iconPopup iconSwitch fas fa-tags cinzaColor"></i>Etiquetas:</label>'+
                        '                        </td>'+
                        '                        <td colspan="3">'+
                        '                            <input type="text" id="ativ_etiquetas" data-key="etiquetas" value="'+(value && value.etiquetas ? (value.etiquetas !== null && value.etiquetas.length > 0 ? value.etiquetas.join(';') : '') : '')+'">'+
                        '                        </td>'+
                        '                   </tr>'+
                        '               </table>'+
                        '           </td>'+
                        '       </tr>'+
                        '   </table>'+
                        '</div>';

        var btnDialogBoxPro =   [{
                                    text: (id_demanda != 0) ? 'Editar' : 'Salvar',
                                    class: 'confirm',
                                    click: function(event) { 
                                        if (checkAtivRequiredFields(this, 'mark')) {
                                            var action = (id_demanda != 0) ? 'edit_atividade' : 'save_atividade';
                                            var param = extractDataAtiv(this);
                                                param.action = action;
                                            var id_plano = jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+param.id_user+"`] | [0].id_plano");
                                                id_plano = (id_plano === null) ? 0 : id_plano;
                                                param.id_plano = id_plano;
                                            var id_atividade = (param.id_atividade.trim() == '') ? 0 : param.id_atividade;
                                                param.id_atividade = id_atividade;
                                                getServerAtividades(param, action);
                                        }
                                    }
                                }];
        if (id_demanda != 0) {
            if (value.data_inicio != '0000-00-00 00:00:00') {
                if (checkCapacidade('complete_atividade') || checkCapacidade('complete_edit_atividade')) {
                    btnDialogBoxPro.unshift({
                        text: (value.data_entrega == '0000-00-00 00:00:00') ? 'Concluir '+__.Demanda+'' : 'Editar Conclus\u00E3o',
                        icon: 'ui-icon-check',
                        click: function(event) { 
                            completeAtividade(id_demanda);
                        }
                    });
                }
            } else {
                if (checkCapacidade('start_atividade')) {
                    btnDialogBoxPro.unshift({
                        text: 'Iniciar Execu\u00E7\u00E3o',
                        icon: 'ui-icon-play',
                        click: function(event) { 
                            startAtividade(id_demanda);
                        }
                    });
                }
            }
            btnDialogBoxPro.unshift({
                text: 'Gerar Notifica\u00E7\u00E3o',
                icon: 'ui-icon-mail-closed',
                click: function(event) { 
                    notifyAtividade(id_demanda, event);
                }
            });
            if (checkCapacidade('delete_atividade') || checkCapacidade('delete_atividade_all')) {
                btnDialogBoxPro.unshift({
                    text: 'Excluir',
                    icon: 'ui-icon-trash',
                    click: function(event) { 
                        if (value.data_avaliacao != '0000-00-00 00:00:00') {
                            confirmaFraseBoxPro(__.A_demanda+' j\u00E1 possui avalia\u00E7\u00E3o cadastrada. Tem certeza que deseja excluir?', 'EXCLUIR', function() { deleteAtividade(id_demanda) });
                        } else if (value.data_entrega != '0000-00-00 00:00:00') {
                            confirmaFraseBoxPro(__.A_demanda+' j\u00E1 possui entrega realizada. Tem certeza que deseja excluir?', 'EXCLUIR', function() { deleteAtividade(id_demanda) });
                        } else {
                            confirmaBoxPro('Tem certeza que deseja excluir '+__.esta_demanda+'?', function() { deleteAtividade(id_demanda) }, 'Excluir');
                        }
                    }
                });
            }
        } else {
            if (checkCapacidade('edit_atividade')) {
                btnDialogBoxPro.unshift({
                    text: 'Editar '+__.Demandas,
                    icon: 'ui-icon-pencil',
                    click: function(event) { 
                        selectAtividadeBox('edit');
                    }
                });
                if (checkOptionEntidade('cadastro_simplificado')) {
                    btnDialogBoxPro.unshift({
                        text: 'Cadastro Simplificado',
                        icon: 'ui-icon-check',
                        click: function(event) { 
                            changeSaveAtividade('simple');
                        }
                    });
                }
            }
            if (checkCapacidade('save_atividade_rapida')) {
                btnDialogBoxPro.unshift({
                    text: 'Cadastro R\u00E1pido',
                    icon: 'ui-icon-check',
                    click: function(event) { 
                        changeSaveAtividade('quick');
                    }
                });
            }
        }
        
        var titleBox = (id_demanda != 0) 
                            ? 'Editar '+__.demanda+': '+getTitleDialogBox(value)
                            : 'Criar  '+__.nova_demanda;
        resetDialogBoxPro('dialogBoxPro');
        dialogBoxPro = $('#dialogBoxPro')
            .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
            .dialog({
                title: titleBox,
                width: 780,
                open: function() { 
                    prepareFieldsReplace(this);
                },
                close: function() { 
                    $('#boxAtividade').remove();
                    cancelSelectedItensAtiv(id_demanda)
                    resetDialogBoxPro('dialogBoxPro');
                },
                buttons: btnDialogBoxPro
        });
        checkTagsIput();

        var selectAtiv = $('#ativ_id_atividade');
        var selectUser = $('#ativ_id_user');
        if (id_demanda != 0) {
            var selectComplexidade = $('#ativ_fator_complexidade');
            var inputPrazoEntrega = $('#ativ_prazo_entrega');
            // console.log(value);
            selectAtiv.trigger('change');
            selectComplexidade.val(value.fator_complexidade).trigger('change');
            inputPrazoEntrega.trigger('change');
        }
        if (dadosIfrArvore && id_demanda == 0) {
            var tipo_processo = dadosIfrArvore.tipo;
            var usuario = dadosIfrArvore.usuario;
            var prazo = dadosIfrArvore.prazo;
            if (tipo_processo) {
                selectAtiv.find('option').each(function(){
                    var config = $(this).data('config');
                    var config_tipo_processo = (typeof config !== 'undefined' && typeof config.tipo_processo !== 'undefined') ? config.tipo_processo : [];

                    if (config && config_tipo_processo.length > 0 && $.inArray(tipo_processo, config_tipo_processo) !== -1 ) {
                        selectAtiv.val($(this).val()).trigger('change');
                        return false;
                    }
                });
            }
            if (usuario) {    
                selectUser.find('option').each(function(){
                    var text = $(this).text().toLowerCase();
                    if (text == usuario.toLowerCase()) {
                        if ($(this).prop('disabled') == false && $(this).closest('optgroup').prop('disabled') == false) {
                            selectUser.val($(this).val()).trigger('change');
                            return false;
                        }
                    }
                });
            }
            if (prazo) { $('#ativ_dias_planejado').val(prazo).trigger('change') }
        }
        if (!checkCapacidade('select_user_atividade')) {
            selectUser.val(arrayConfigAtividades.perfil.id_user).trigger('change');
        } 
        if (checkProcessoHome) {
            multProcessUpdateInput();
        }
    }
}
// BOX DE DEMANDA RAPIDA
function saveAtividadeQuick(id_demanda = 0) {
    var checkPlanos = (typeof arrayConfigAtividades.planos !== 'undefined' && arrayConfigAtividades.planos != 0 && arrayConfigAtividades.planos.length > 0) ? true : false;
    if (!checkPlanos) {
        alertaBoxPro('Error', 'exclamation-triangle', 'Nenhum plano de trabalho ativo!');
    } else {
        var value = getAtividadeData(id_demanda);
        var unidades =  (typeof arrayConfigAtividades.atividades !== 'undefined' && arrayConfigAtividades.atividades != 0 && arrayConfigAtividades.atividades.length > 0) 
                            ? uniqPro(jmespath.search(arrayConfigAtividades.atividades, "[?sigla_unidade].sigla_unidade"))
                            : [];
        var countUnidades = (arrayConfigAtividades.atividades.length > 0) ? unidades.length : 0;
        var unidadesPlanos = (checkPlanos) 
                            ? uniqPro(jmespath.search(arrayConfigAtividades.planos, "[?sigla_unidade].sigla_unidade")) 
                            : [];
        var countUnidadesPlanos = (checkPlanos) ? unidadesPlanos.length : 0;
        var config_unidade = getConfigDadosUnidade((id_demanda != 0 ? value.sigla_unidade: null));
        var dadosIfrArvore = getIfrArvoreDadosProcesso();
        var dt_init = (dadosIfrArvore && dadosIfrArvore.data_documento && dadosIfrArvore.data_documento != '') 
                ? moment(dadosIfrArvore.data_documento, 'DD/MM/YYYY HH:mm') : moment();
        var hr_init = dt_init.format('HH:mm');
        var dataDistribuicao = dt_init.format(config_unidade.hora_format);
            dataDistribuicao = (moment(hr_init, 'HH:mm') > moment(config_unidade.h_util_fim, 'HH:mm')) 
                ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_fim).add(-1,'hours').format(config_unidade.hora_format)
                : dataDistribuicao;
            dataDistribuicao = (moment(hr_init, 'HH:mm') < moment(config_unidade.h_util_inicio, 'HH:mm')) 
                    ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_inicio).format(config_unidade.hora_format)
                    : dataDistribuicao;
        var prazoEntrega = dt_init.add(1,'hours').format(config_unidade.hora_format);
            prazoEntrega = (moment(hr_init, 'HH:mm') > moment(config_unidade.h_util_fim, 'HH:mm')) 
                ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_fim).format(config_unidade.hora_format)
                : prazoEntrega;
            prazoEntrega = (moment(hr_init, 'HH:mm') < moment(config_unidade.h_util_inicio, 'HH:mm')) 
                    ? moment(dt_init.format('YYYY-MM-DD')+'T'+config_unidade.h_util_inicio).add(1,'hours').format(config_unidade.hora_format)
                    : prazoEntrega;

        var dataInicio = dataDistribuicao;
        var dataEntrega = dataDistribuicao;

        var optionSelectRequisicoes = ( arrayConfigAtividades.tipos_requisicoes.length > 0 ) ? $.map(arrayConfigAtividades.tipos_requisicoes, function(v,k){ return ( (value && v.id_tipo_requisicao == value.id_tipo_requisicao) || (dadosIfrArvore && dadosIfrArvore.nome_documento.indexOf(v.nome_requisicao) !== -1) ) ? '<option value="'+v.id_tipo_requisicao+'" selected>'+v.nome_requisicao+'</option>' : '<option value="'+v.id_tipo_requisicao+'">'+v.nome_requisicao+'</option>' }).join('') : '';
        var selectRequisicoes = '<select id="ativ_id_tipo_requisicao" onchange="checkThisAtivRequiredFields(this)" data-key="id_tipo_requisicao" required><option value="0"></option>'+optionSelectRequisicoes+'</select>';
            selectRequisicoes = (checkOptionEntidade('dispensa_tipos_requisicao')) ? '<input type="hidden" id="ativ_id_tipo_requisicao" data-key="id_tipo_requisicao" data-param="id_tipo_requisicao" value="0">' : selectRequisicoes;

        var optionSelectAtividades = '';
        var arrayTabelaAtividades = arrayConfigAtividades.atividades;
        if (countUnidades > 1) {
            $.each(unidades, function(index, v){
                var arrayAtiv = jmespath.search(arrayTabelaAtividades, "[?sigla_unidade=='"+v+"']");
                optionSelectAtividades +=   '<optgroup label="'+v+'">'+
                                            '   '+getOptionsSelectAtivGroup(arrayAtiv, value, true)+
                                            '</optgroup>';
            });
        } else {
            optionSelectAtividades += getOptionsSelectAtivGroup(arrayTabelaAtividades, value, true);
        } 
        var selectAtividades = '<select id="ativ_id_atividade" class="requiredSelect" data-key="id_atividade" onchange="changeAtivSelect(this);repairTemposDemandaQuick();"><option value="0"></option>'+optionSelectAtividades+'</select>';
        
        var optionSelectResponsavel = '';
        if (countUnidadesPlanos > 1) {
            $.each(unidadesPlanos, function(index, v){
                var arrayResp = jmespath.search(arrayConfigAtividades.planos, "[?sigla_unidade=='"+v+"'] | [?vigencia==`true`]");
                optionSelectResponsavel += '<optgroup label="'+v+'">';
                optionSelectResponsavel += getOptionsSelectResp(arrayResp, value);
                optionSelectResponsavel += '</optgroup>';
            });
        } else {
            var arrayResp = jmespath.search(arrayConfigAtividades.planos, "[?vigencia==`true`]");
            optionSelectResponsavel += getOptionsSelectResp(arrayResp, value);
        }

        var selectResponsavel = '<select id="ativ_id_user" class="requiredSelect" data-key="id_user" data-type="user" onchange="updateAtivSelectUser(this);repairTemposDemandaQuick();"><option value="0"></option>'+optionSelectResponsavel+'</select>';
        var optionSelectDocumentos = ( arrayConfigAtividades.tipos_documentos.length > 0 ) ? $.map(arrayConfigAtividades.tipos_documentos, function(v,k){ return ( (value && v.id_tipo_documento == value.id_tipo_documento) || (dadosIfrArvore && dadosIfrArvore.nome_documento.indexOf(v.nome_documento) !== -1) ) ? '<option value="'+v.id_tipo_documento+'" selected>'+v.nome_documento+'</option>' : '<option value="'+v.id_tipo_documento+'">'+v.nome_documento+'</option>' }).join('') : '';
        var selectDocumentos = '<select id="ativ_id_tipo_documento" onchange="checkThisAtivRequiredFields(this)" data-key="id_tipo_documento" required><option value="0"></option>'+optionSelectDocumentos+'</select>';
            selectDocumentos = (checkOptionEntidade('dispensa_tipos_requisicao')) ? '<input type="hidden" id="ativ_id_tipo_documento" data-key="id_tipo_documento" data-param="id_tipo_documento" value="0">' : selectDocumentos;

        var htmlBox =   '<div id="boxAtividade" class="atividadeWork" data-demanda="'+(value && value.id_demanda ? value.id_demanda : 0)+'">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        '      <tr style="display:none;">'+
                        '           <td style="display:nones;">'+
                        '               '+selectRequisicoes+
                        '               '+selectDocumentos+
                        '               <input type="hidden" id="ativ_id_demanda" data-key="id_demanda" data-param="id_demanda" value="'+id_demanda+'">'+
                        '               <input type="hidden" id="ativ_processo_sei" onchange="changeProtocoloBoxAtiv(this)" data-key="processo_sei" value="'+(value && value.processo_sei ? value.processo_sei : (dadosIfrArvore ? dadosIfrArvore.processo_sei : '') )+'">'+
                        '               <input type="hidden" id="ativ_id_procedimento" data-key="id_procedimento" data-param="id_procedimento" value="'+(value && value.id_procedimento ? value.id_procedimento : (dadosIfrArvore ? dadosIfrArvore.id_procedimento : '') )+'">'+
                        '               <input type="hidden" id="ativ_numero_documento" onchange="checkThisAtivRequiredFields(this)" maxlength="255" data-key="numero_documento" value="'+(value && value.numero_documento !== null ? value.numero_documento : (dadosIfrArvore && dadosIfrArvore.numero_documento ? dadosIfrArvore.numero_documento : '' ) )+'">'+
                        '               <input type="hidden" oninput="this.value=this.value.replace(/[^0-9]/g,\'\')" id="ativ_documento_sei" onchange="changeProtocoloBoxAtiv(this)" maxlength="11" data-key="documento_sei" value="'+(value && value.documento_sei !== null && parseInt(value.documento_sei) != 0  ? value.documento_sei : (dadosIfrArvore && dadosIfrArvore.nr_sei ? dadosIfrArvore.nr_sei : '') )+'">'+
                        '               <input type="hidden" id="ativ_id_documento_entregue" data-key="id_documento_entregue" data-param="id_documento_entregue" value="'+(value && value.id_documento_entregue !== null && value.id_documento_entregue != '0' ? value.id_documento_entregue : (dadosIfrArvore && dadosIfrArvore.id_documento ? dadosIfrArvore.id_documento : '') )+'">'+
                        '               <input type="hidden" min="0" id="ativ_dias_executado" onchange="changeDadosTrabalho(this)" data-key="dias_executado" data-type="dias_executado" value="'+(value && value.dias_executado ? value.dias_executado : '0')+'" required>'+
                        '               <input type="hidden" min="0.1" step=".1" id="ativ_tempo_executado" data-key="tempo_executado" data-type="tempo_executado" value="'+(value && value.tempo_executado ? value.tempo_executado : '0')+'" disabled>'+
                        '               <input type="hidden" min="0" id="ativ_dias_despendido" onchange="changeDadosTrabalho(this)" data-key="dias_despendido" data-type="dias" value="'+(value && value.dias_despendido ? value.dias_despendido : '0')+'" required>'+
                        '               <input type="hidden" min="0.1" step=".1" id="ativ_tempo_despendido" onchange="changeDadosTrabalho(this)" data-key="tempo_despendido" data-type="tempo" value="'+(value && value.tempo_despendido ? value.tempo_despendido : '0')+'" disabled>'+
                        '               <input type="hidden" oninput="this.value=this.value.replace(/[^0-9]/g,\'\')" id="ativ_requisicao_sei" onchange="changeProtocoloBoxAtiv(this)" data-key="requisicao_sei" value="'+(value && value.requisicao_sei ? value.requisicao_sei : (dadosIfrArvore ? dadosIfrArvore.nr_sei : '') )+'">'+
                        '               <input type="hidden" id="ativ_id_documento_requisicao" data-key="id_documento_requisicao" data-param="id_documento" value="'+(value && value.id_documento_requisicao ? value.id_documento_requisicao : (dadosIfrArvore ? dadosIfrArvore.id_documento : '') )+'">'+
                        '               <input type="hidden" min="1" id="ativ_tempo_planejado" onchange="changeDadosTrabalho(this)" data-key="tempo_planejado" data-type="tempo" value="'+(value && value.tempo_planejado ? value.tempo_planejado : '')+'" disabled>'+
                        '               <input type="hidden" min="0" id="ativ_dias_planejado" onchange="changeDadosTrabalho(this)" data-key="dias_planejado" data-type="dias" value="'+(value && value.dias_planejado ? value.dias_planejado : '0')+'" required>'+
                        '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="changeDadosTrabalho(this)" id="ativ_data_distribuicao" data-key="data_distribuicao" data-type="inicio" data-name="data de distribui\u00E7\u00E3o" value="'+dataDistribuicao+'" required>'+
                        '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="changeDadosTrabalho(this)" id="ativ_prazo_entrega" data-key="prazo_entrega" data-type="fim" data-name="prazo de entrega" value="'+prazoEntrega+'" required>'+
                        '               <input type="hidden" id="ativ_tempo_pactuado" data-key="tempo_pactuado" value="'+(value && value.tempo_pactuado ? value.tempo_pactuado : '')+'" data-tempo-pactuado="'+(value && value.tempo_pactuado ? value.tempo_pactuado : '')+'" disabled>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_assunto"><i class="iconPopup iconSwitch fas fa-comment-dots cinzaColor"></i>'+__.Assunto+':</label>'+
                        '           </td>'+
                        '           <td class="required" colspan="3">'+
                        '               <input type="text" id="ativ_assunto" onchange="checkThisAtivRequiredFields(this)" maxlength="255" data-key="assunto" value="'+(value && value.assunto ? value.assunto : (dadosIfrArvore && dadosIfrArvore.assunto ? dadosIfrArvore.assunto : '' ) )+'" required>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_id_atividade"><i class="iconPopup iconSwitch fas fa-clipboard-list cinzaColor"></i>'+__.Atividade+':</label>'+
                        '           </td>'+
                        '           <td class="required" colspan="3">'+
                        '               '+selectAtividades+
                        '               <input type="hidden" id="ativ_id_unidade" data-key="id_unidade" data-param="id_unidade" value="">'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '           <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_fator_complexidade"><i class="iconPopup iconSwitch fas fa-graduation-cap cinzaColor"></i>Grau de '+__.Complexidade+':</label>'+
                        '           </td>'+
                        '           <td class="required">'+
                        '               <select id="ativ_fator_complexidade" class="requiredSelect" data-key="fator_complexidade" onchange="updateAtivTempoPactuado(this);repairTemposDemandaQuick();"><option>&nbsp;</option></select>'+
                        '           </td>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_id_user"><i class="iconPopup iconSwitch fas fa-user-tie cinzaColor"></i>Respons\u00E1vel:</label>'+
                        '           </td>'+
                        '           <td class="required">'+
                        '               '+selectResponsavel+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr class="hrForm"><td colspan="4"></td></tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_data_inicio"><i class="iconPopup iconSwitch fas fa-play-circle cinzaColor"></i>Data de In\u00EDcio:</label>'+
                        '           </td>'+
                        '           <td class="required date">'+
                        '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="repairTemposDemandaQuick();" id="ativ_data_inicio" data-key="data_inicio" data-type="inicio" data-name="data de in\u00EDcio" value="'+dataInicio+'" required>'+
                        '           </td>'+
                        '           <td style="vertical-align: bottom;" class="label">'+
                        '               <label class="last" for="ativ_data_entrega"><i class="iconPopup iconSwitch fas fa-user-clock cinzaColor" style="float: initial;"></i>Data de Entrega:</label>'+
                        '           </td>'+
                        '           <td class="required date">'+
                        '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="repairTemposDemandaQuick();" id="ativ_data_entrega" data-key="data_entrega" data-type="fim" data-name="data de entrega" value="'+dataEntrega+'" required>'+
                        '           </td>'+
                        '      </tr>'+
                        (!checkOptionEntidade('desativa_produtividade_geral') ? 
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_produtividade"><i class="iconPopup iconSwitch fas fa-toolbox cinzaColor"></i>Produtividade:</label>'+
                        '           </td>'+
                        '           <td colspan="3" style="text-align: left;">'+
                        '               <div id="ativ_produtividade" style="margin: 5px 0;"></div>'+
                        '               <div id="ativ_produtividade_executada" style="margin: 5px 0;"></div>'+
                        '           </td>'+
                        '      </tr>'+
                        '' : '')+
                        '   </table>'+
                        '</div>';

        var btnDialogBoxPro =   [{
                                    text: 'Salvar',
                                    class: 'confirm',
                                    click: function(event) { 
                                        if (checkAtivRequiredFields(this, 'mark')) {
                                            repairTemposDemandaQuick();
                                            var action = 'save_atividade_rapida';
                                            var param = extractDataAtiv(this);
                                                param.action = action;
                                            var id_plano = jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+param.id_user+"`] | [0].id_plano");
                                                id_plano = (id_plano === null) ? 0 : id_plano;
                                                param.id_plano = id_plano;
                                            var id_atividade = (param.id_atividade.trim() == '') ? 0 : param.id_atividade;
                                                param.id_atividade = id_atividade;
                                                getServerAtividades(param, action);
                                                // console.log(param, action);
                                        }
                                    }
                                }];
            
            if (checkCapacidade('edit_atividade')) {
                btnDialogBoxPro.unshift({
                    text: 'Cadastro Avan\u00E7ado',
                    icon: 'ui-icon-notice',
                    click: function(event) { 
                        delayCrash = true;
                        changeSaveAtividade('full');
                        setTimeout(() => {delayCrash = false;}, 2000);
                    }
                });
            }

        var titleBox = 'Criar '+__.nova_demanda+' r\u00E1pida';
            resetDialogBoxPro('dialogBoxPro');
            dialogBoxPro = $('#dialogBoxPro')
                .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
                .dialog({
                    title: titleBox,
                    width: 780,
                    open: function() { 
                        prepareFieldsReplace(this);
                    },
                    close: function() { 
                        $('#boxAtividade').remove();
                        cancelSelectedItensAtiv(id_demanda)
                        resetDialogBoxPro('dialogBoxPro');
                    },
                    buttons: btnDialogBoxPro
            });

        var selectAtiv = $('#ativ_id_atividade');
        var selectUser = $('#ativ_id_user');
        var selectComplexidade = $('#ativ_fator_complexidade');
        if (dadosIfrArvore && id_demanda == 0) {
            var tipo_processo = dadosIfrArvore.tipo;
            var usuario = dadosIfrArvore.usuario;
            var prazo = dadosIfrArvore.prazo;
            if (tipo_processo) {
                selectAtiv.find('option').each(function(){
                    var config = $(this).data('config');
                    var config_tipo_processo = (typeof config !== 'undefined' && typeof config.tipo_processo !== 'undefined') ? config.tipo_processo : [];

                    if (config && config_tipo_processo.length > 0 && $.inArray(tipo_processo, config_tipo_processo) !== -1 ) {
                        selectAtiv.val($(this).val()).trigger('change');
                        return false;
                    }
                });
            }
            if (usuario) {    
                selectUser.find('option').each(function(){
                    var text = $(this).text().toLowerCase();
                    if (text == usuario.toLowerCase()) {
                        if ($(this).prop('disabled') == false && $(this).closest('optgroup').prop('disabled') == false) {
                            selectUser.val($(this).val()).trigger('change');
                            return false;
                        }
                    }
                });
            }
            if (prazo) { $('#ativ_dias_planejado').val(prazo).trigger('change') }
        }
        if (!checkCapacidade('select_user_atividade')) {
            selectUser.val(arrayConfigAtividades.perfil.id_user).trigger('change');
        }
        var paramDemanda = getOptionsPro('recordParamDemanda');
        if (paramDemanda) {
            setTimeout(() => {
                delayCrash = true;
                if (selectUser.length && selectUser.val().trim() == '' && paramDemanda.id_user) selectUser.val(paramDemanda.id_user).trigger('chosen:updated').trigger('change');
                if (selectAtiv.length && selectAtiv.val().trim() == '' && paramDemanda.id_atividade) selectAtiv.val(paramDemanda.id_atividade).trigger('chosen:updated').trigger('change');
                setTimeout(() => {
                    if (selectComplexidade.length && paramDemanda.fator_complexidade) {
                        selectComplexidade.val(paramDemanda.fator_complexidade).trigger('chosen:updated').trigger('change');
                    }
                }, 200);

                setTimeout(() => {
                    repairTemposDemandaQuick();
                    delayCrash = false;
                }, 2000);
            }, 500);
        }
    }
}
function repairTemposDemandaQuick() {
    var this_ = $('#ativ_data_entrega')[0];
    var param = extractDataAtiv(this_);
    var dias = checkTemposDemanda(param, 'tempo_executado', false); 
    var tempo = checkTemposDemanda(param, 'tempo_executado');
        $('#ativ_prazo_entrega').val($('#ativ_data_entrega').val());
        $('#ativ_data_distribuicao').val($('#ativ_data_inicio').val());
        $('#ativ_tempo_planejado').val(tempo);
        $('#ativ_tempo_executado').val(tempo);
        $('#ativ_tempo_despendido').val(tempo);
        $('#ativ_dias_planejado').val(dias);
        $('#ativ_dias_executado').val(dias);
        $('#ativ_dias_despendido').val(dias);
        $('#ativ_data_entrega').attr('min',$('#ativ_data_inicio').val());
        $('#ativ_data_inicio').attr('max',$('#ativ_data_entrega').val());
        if (!checkOptionEntidade('desativa_produtividade_geral') && checkAtivRequiredFields(this_, 'check')) {
            $('#ativ_produtividade').html(getInfoAtividadeProdutividade(false, true, 'despendido', true));
            $('#ativ_produtividade_executada').html(getInfoAtividadeProdutividade(false, true, 'executado', true));
        } else {
            $('#ativ_produtividade').html('');
            $('#ativ_produtividade_executada').html('');
        }
}
function checkTagsIput(TimeOut = 9000) {
        if (TimeOut <= 0) { return; }
        if (typeof $().tagsInput !== 'undefined') {
            var ativEtiquetas = $('#ativ_etiquetas').tagsInput({
                interactive: true,
                placeholder: 'Adicionar etiqueta',
                minChars: 2,
                maxChars: 100,
                limit: 8,
                autocomplete_url: '',
                autocomplete: {'source': sugestEtiquetaPro('ativ') },
                hide: true,
                delimiter: [';'],
                unique: true,
                removeWithBackspace: true,
                onAddTag: changeAtivEtiqueta,
                onRemoveTag: changeAtivEtiqueta,
                onChange: changeAtivEtiqueta
            });
            $('.atividadeWork input.tag-input').on('blur', function(ev) {
                var text = $(this).val().trim();
                if (text != '') {
                    $(this).val('');
                    ativEtiquetas.addTag(text); 
                }
            });
        } else {
            $.getScript((URL_SPRO+"js/lib/jquery.tagsinput-revisited.js"));
            setTimeout(function(){ 
                checkTagsIput(TimeOut - 100); 
                if(verifyConfigValue('debugpage')) console.log('Reload checkTagsIput'); 
            }, 500);
        }
}
function prepareFieldsReplace(this_) {
    if (checkBrowser() == 'Firefox') {
        changeInputDateTime(this_);
    }
    initChosenReplace('box_init', this_, true);
}
function calculoRecorrenciaAtiv(this_) {
    clearTimeout(dly);
    dly = setTimeout(function() {
        calculoRecorrenciaAtiv_(this_);
    }, 800);
}
function calculoRecorrenciaAtiv_(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var config_unidade = getBoxConfigDadosUnidade(_parent);
    var config_data_format = (config_unidade.count_horas) ? 'DD/MM/YYYY HH:mm' : 'DD/MM/YYYY';
    var _dias_planejado = _parent.find('#ativ_dias_planejado');
    var dias_planejado = parseInt(_dias_planejado.val());
    var _modo = _parent.find('#ativ_modo_recorrencia');
    var modo = _modo.val();
    var _numero_fixo = _parent.find('#ativ_recorrencia_numero_fixo');
    var _data_inicio = _parent.find('#ativ_data_inicio_recorrencia');
    var data_inicio = moment(_data_inicio.val(), config_unidade.hora_format);
    var hora_inicio_recorrencia = (config_unidade.count_horas) ? data_inicio.format('HH:mm') : config_unidade.h_util_inicio;
    var _modo_fim = _parent.find('#ativ_modo_fim_recorrencia');
    var _data_fim = _parent.find('#ativ_data_fim_recorrencia');
    var data_fim = moment(_data_fim.val(), config_unidade.hora_format);
    var hora_fim_recorrencia = (config_unidade.count_horas) ? data_fim.format('HH:mm') : config_unidade.h_util_fim;
    var _plano_user = _parent.find('#ativ_id_user').find('option:selected').data('config');
        _plano_user = (typeof _plano_user !== 'undefined') ? jmespath.search(arrayConfigAtividades.planos, "[?id_plano==`"+_plano_user.id_plano+"`] | [0]") : null;
    var _plano_user_data_fim_vigencia = (_plano_user !== null) ? _plano_user.data_fim_vigencia : false;
    var carga_horaria = (_plano_user !== null) ? _plano_user.carga_horaria : false;
    var data_fim_recorrencia = (_modo_fim.val() == 'data_determinada') 
                                ? moment(_data_fim.val(), config_unidade.hora_format) 
                                : moment(_plano_user_data_fim_vigencia,'YYYY-MM-DD HH:mm:ss');
    var dias_acrescimo = (modo != 'numero_fixo' && modo != 'numero_fixo_uteis') ? 1 : parseInt(_numero_fixo.val());
        dias_acrescimo = (modo == 'quinzena1' || modo == 'quinzena5') ? 2 : dias_acrescimo;
        dias_acrescimo = (modo == '3mes_inicio' || modo == '3mes_fim') ? 3 : dias_acrescimo;
        dias_acrescimo = (modo == '6mes_inicio' || modo == '6mes_inicio') ? 6 : dias_acrescimo;

    var viewModeGantt = (getOptionsPro('ganttRecorrenciasView')) ? getOptionsPro('ganttRecorrenciasView') : 'Week';

    var config_feriados = (typeof config_unidade.feriados !== 'undefined' && config_unidade.feriados !== null) ? config_unidade.feriados : false;
    var arrayFeriados = (config_unidade.count_dias_uteis && data_inicio.isValid() && data_fim_recorrencia.isValid() ) 
                        ? jmespath.search(getHolidayBetweenDates(data_inicio.format('Y')+'-01-01', data_fim.clone().add(1, 'Y').format('Y')+'-01-01', config_feriados), "[*].d_")
                        : [];

    var diff_acresc = (modo == 'diaria' || modo == 'numero_fixo' || modo == 'numero_fixo_uteis') ? 'days' : false;
        diff_acresc = (
                        modo == 'mes_inicio' || modo == 'mes_fim' || 
                        modo == '3mes_inicio' || modo == '3mes_fim' ||
                        modo == '6mes_inicio' || modo == '6mes_fim'
                    ) ? 'months' : diff_acresc;
        diff_acresc = (modo == 'semana1' || modo == 'semana5' || modo == 'quinzena1' || modo == 'quinzena5') ? 'weeks' : diff_acresc;
        diff_acresc = (modo == 'ano_inicio' || modo == 'ano_fim') ? 'years' : diff_acresc;

        // console.log({diff_acresc: diff_acresc, arrayFeriados: arrayFeriados, dias_acrescimo: dias_acrescimo, config_unidade: config_unidade, _dias_planejado: _dias_planejado.val(),  _modo: _modo.val(),  _numero_fixo: _numero_fixo.val(),  _data_inicio: _data_inicio.val(),  _modo_fim: _modo_fim.val(),  _data_fim: _data_fim.val(),   _plano_user: _plano_user, data_fim_recorrencia: data_fim_recorrencia});

    var taskRecorrencia = [];
    var dataFall = '';

    if (diff_acresc) {
        var index = 0
        var dataInitRef = data_inicio.clone();
        if (modo == 'numero_fixo_uteis') {
            getDateAddWeekdaysFromSet(dataInitRef, 0);
        } else {
            var initDate = getRecorrenciaAtiv(data_inicio.clone(), dias_planejado, arrayFeriados, modo, config_unidade, index, hora_inicio_recorrencia, hora_fim_recorrencia, dataInitRef, data_fim_recorrencia);
            if (initDate) {
                taskRecorrencia.push(initDate);
                // console.log('check', initDate.start_ >= dataInitRef, initDate.start_.format(config_data_format), dataInitRef.format(config_data_format), data_fim_recorrencia.format(config_data_format));
                index++;
            }
            while(data_inicio.add(dias_acrescimo, diff_acresc).diff(data_fim_recorrencia) < 0) {
                var dataRef = data_inicio.clone();
                var newDate = getRecorrenciaAtiv(dataRef, dias_planejado, arrayFeriados, modo, config_unidade, index, hora_inicio_recorrencia, hora_fim_recorrencia, dataInitRef, data_fim_recorrencia);
                if (newDate) {
                    taskRecorrencia.push(newDate);
                    index++;
                    // console.log('check', newDate.start_ >= dataInitRef, newDate.start_.format(config_data_format), dataInitRef.format(config_data_format), data_fim_recorrencia.format(config_data_format));
                }
            }
            // console.log(taskRecorrencia, _data_inicio.val(), dias_acrescimo, diff_acresc, _data_fim.val(), data_fim_recorrencia.format(config_data_format));
        }

        function getDateAddWeekdaysFromSet(dt_init, index) {
            if (index == 0) {
                var nextIndex = index+1;
                var dt_next = (dt_init.weekday() != 0 && arrayFeriados.indexOf(dt_init.format('YYYY-MM-DD')) === -1) ? dt_init : dt_init.clone().addWorkdays(0, arrayFeriados);
                // dias_acrescimo = (dias_acrescimo > 0) ? dias_acrescimo-1 : dias_acrescimo;
            } else if (dt_init <= data_fim_recorrencia) {
                var nextIndex = index+1;
                var dt_next = dt_init.isoAddWeekdaysFromSet({  
                                    'workdays': dias_acrescimo,  
                                    'weekdays': [1,2,3,4,5],
                                    'exclusions': arrayFeriados
                                    });
            } else {
                var dt_next = false; 
            }
            if (dt_next) {
                // console.log(dt_init.format('DD/MM/YYYY'), dt_next.format('DD/MM/YYYY'), data_fim.format('DD/MM/YYYY'));
                var initDateWk = getRecorrenciaAtiv(dt_next, dias_planejado, arrayFeriados, modo, config_unidade, nextIndex, hora_inicio_recorrencia, hora_fim_recorrencia, dataInitRef, data_fim_recorrencia);
                if (initDateWk) { taskRecorrencia.push(initDateWk) }
                    getDateAddWeekdaysFromSet(dt_next, nextIndex);
            }
        }

        $('#ganttRecorrenciaPanel').html('');
        if (taskRecorrencia.length > 0) {

            var param = {
                count_dias_uteis: config_unidade.count_dias_uteis,
                count_horas: config_unidade.count_horas,
                h_dataInicio: taskRecorrencia[0].start_,
                h_dataFim: taskRecorrencia[0].end_,
                h_utilInicio: moment(taskRecorrencia[0].end_.format('YYYY-MM-DD')+'T'+config_unidade.h_util_inicio, 'YYYY-MM-DDTHH:mm'),
                h_utilFim: moment(taskRecorrencia[0].start_.format('YYYY-MM-DD')+'T'+config_unidade.h_util_fim, 'YYYY-MM-DDTHH:mm'),
                carga_horaria: carga_horaria,
                valueDias: dias_planejado
            };
            var tempoTrabalho = (carga_horaria) ? getTempoTrabalhoAtiv(param) : false;
            // console.log(param, tempoTrabalho);

            if (tempoTrabalho) {
                tempoTrabalho = (tempoTrabalho < 1) ? tempoTrabalho.toFixed(3) : tempoTrabalho.toFixed(1);
                _parent.find('#ativ_tempo_planejado').val(tempoTrabalho);
                var updateAtiv = _parent.find('#ativ_fator_complexidade');
                // var updateAtiv = _parent.find('#ativ_id_atividade');

                if (typeof updateAtiv.data('update_recorrencia') === 'undefined' || updateAtiv.data('update_recorrencia') == false) {
                    updateAtiv.data('update_recorrencia', true);
                    setTimeout(function(){ 
                        updateAtiv.trigger('change');
                        setTimeout(function(){ updateAtiv.data('update_recorrencia', false) }, 1500);
                    }, 500);
                }
            }

            var arrayTaskRecorrencia = jmespath.search(taskRecorrencia,"[*].{id: id, data_distribuicao: start_format, prazo_entrega: end_format}");
            _parent.find('#ativ_recorrencia').val(JSON.stringify(arrayTaskRecorrencia));
            // console.log('arrayTaskRecorrencia',arrayTaskRecorrencia);

            var gantt = new Gantt("#ganttRecorrenciaPanel", taskRecorrencia,{
                header_height: 50,
                column_width: 10,
                step: 24,
                language: 'en',
                language: 'ptBr',
                view_modes: ['Day', 'Week', 'Month'],
                bar_height: 15,
                bar_corner_radius: 3,
                arrow_curve: 5,
                padding: 18,
                edit_task: false,
                view_mode: viewModeGantt,   
                date_format: 'YYYY-MM-DD',
                custom_popup_html: function(task) {
                    var html = '<div class="details-container seiProForm">'+
                                '   <table class="tableInfo tableLine">'+
                                '      <tr>'+
                                '           <td colspan="2" class="td_view">'+
                                '               <h5><i class="iconPopup fas fa-check-circle cinzaColor"></i> '+
                                '                   <span class="boxInfo" style="font-size: 11pt;font-weight: bold;width: 85%;text-align: left;display: inline-block;">'+__.Demanda+' #'+(parseInt(task.id)+1)+'</span>'+
                                '                   <a style="float: right; margin: -4px -4px 0 0; padding: 5px;" onclick="ganttRecorrencias.hide_popup()"><i class="far fa-times-circle cinzaColor"></i></a>'+
                                '               </h5>'+
                                '           </td>'+
                                '      </tr>'+
                                '      <tr style="height: 40px;">'+
                                '          <td style="vertical-align: bottom; width: 180px;"><i class="iconPopup iconSwitch fas fa-briefcase cinzaColor"></i>Data de Distribui\u00E7\u00E3o:</td>'+
                                '          <td class="td_view">'+task.start_.format(config_data_format)+'</td>'+
                                '      </tr>'+
                                '      <tr style="height: 40px;">'+
                                '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-business-time cinzaColor"></i>Prazo de Entrega:</td>'+
                                '          <td class="td_view">'+task.end_.format(config_data_format)+'</td>'+
                                '      </tr>'+
                                '   </table>'+
                                '</div>';
                            return html;
                },
                on_click: function (task) {
                }
            });
            ganttRecorrencias = gantt;
            if (!getOptionsPro('panelHeight_recorrenciasGanttPro') && $('#ganttRecorrenciaPanel').height() > 500) { setOptionsPro('panelHeight_recorrenciasGanttPro', 500) }
            $('#ganttRecorrenciaPanel').find('.gantt-container').addClass('tabelaPanelScroll');
            initPanelResize('.gantt-container', 'ganttRecorrenciaPanel');

            if (ganttRecorrencias && ganttRecorrencias.bars.length > 0) {
                var scrollLeft = ganttRecorrencias.bars[0].x-20;
                var windowDiv = $('#ganttRecorrenciaPanel').find('.gantt-container');
                    windowDiv.animate({scrollLeft: scrollLeft}, 500);
    
                var popupRecorreAtiv = $('#ganttRecorrenciaPanel').find('.popup-wrapper');
                if (popupRecorreAtiv.length > 0) {
                    var observerPopupRecorreAtiv = new MutationObserver(function(mutations) {
                        var _this = $(mutations[0].target);
                        var _parent = _this.closest('.gantt-container');
                        if (_this.is(':visible')) {
                            _parent.attr('style', function(i,s) { return (s || '') + 'position: relative !important;' });
                            _parent.find('.ui-resizable-handle').hide();
                        } else {
                            _parent.attr('style', function(i,s) { return (s || '') + 'position: initial !important;' });
                            _parent.find('.ui-resizable-handle').show();
                        }
                    });
                    observerPopupRecorreAtiv.observe(popupRecorreAtiv.get(0), {
                        attributes: true
                    });
                }
            }
        } else {
            dataFall = '<div class="gantt-container dataFallback" style="z-index:9;" data-text="Nenhum dado dispon\u00EDvel"></div>';
        }
        
        var btnGroupView =  '<div style="position: absolute; right: 0; z-index: 99;">'+
                            '   <div class="btn-group" role="group" style="float: right;">'+
                            '       <button type="button" data-value="Day" class="btn btn-sm btn-light '+(getOptionsPro('ganttRecorrenciasView') == 'Day' ? 'active' : '')+'">Dia</button>'+
                            '       <button type="button" data-value="Week" class="btn btn-sm btn-light '+(getOptionsPro('ganttRecorrenciasView') == 'Week' ? 'active' : '')+'">Semana</button>'+
                            '       <button type="button" data-value="Month" class="btn btn-sm btn-light '+(getOptionsPro('ganttRecorrenciasView') == 'Month' || !getOptionsPro('ganttRecorrenciasView') ? 'active' : '')+'">M\u00EAs</button>'+
                            '       <button type="button" data-value="Year" class="btn btn-sm btn-light '+(getOptionsPro('ganttRecorrenciasView') == 'Year' ? 'active' : '')+'">Ano</button>'+
                            '   </div>'+
                            '</div>';

        var counterTaskRecorrencia = (taskRecorrencia.length > 0) 
            ? '<div style="padding:8px;color:#666;text-align: right;font-size: 9pt;"><i class="fa fa-info-circle azulColor"></i> '+(taskRecorrencia.length > 1 ? taskRecorrencia.length+' '+__.demandas_programadas : '1 '+__.demanda_programada)+'</div>' 
            : '';

        $('#ganttRecorrenciaPanel').prepend(counterTaskRecorrencia+btnGroupView+dataFall);
        $("#ganttRecorrenciaPanel .btn-group").on("click", "button", function() {
            $btn = $(this);
            var mode = $btn.data('value');
            $btn.parent().find('button').removeClass('active'); 
            $btn.addClass('active');
            ganttRecorrencias.change_view_mode(mode);
            setOptionsPro('ganttRecorrenciasView', mode);
        });
    }
}
function getRecorrenciaAtiv(newDate, dias_planejado, arrayFeriados, modo, config_unidade, index, hora_inicio_recorrencia, hora_fim_recorrencia, dataInitRef, dataEndRef) {
    var config_data_format = (config_unidade.count_horas) ? 'DD/MM/YYYY HH:mm' : 'DD/MM/YYYY';
    var config_data_format_sys = 'YYYY-MM-DD HH:mm:ss';
        newDate = (modo == 'semana1' || modo == 'quinzena1') ? newDate.startOf('isoweek') : newDate;
        newDate = (modo == 'semana5' || modo == 'quinzena5') ? newDate.startOf('isoweek').add('days', 4) : newDate;
        newDate = (modo == 'mes_inicio' || modo == '3mes_inicio' || modo == '6mes_inicio') ? newDate.startOf('month') : newDate;
        newDate = (modo == 'mes_fim' || modo == '3mes_fim' || modo == '6mes_fim') ? newDate.endOf('month') : newDate;
        newDate = (modo == 'ano_inicio') ? newDate.startOf('year') : newDate;
        newDate = (modo == 'ano_fim') ? newDate.endOf('year') : newDate;
    var newDate_format = newDate.format('YYYY-MM-DD');
    if (modo) {
    // if ((modo != 'diaria' && modo != 'numero_fixo') || ((modo == 'diaria' || modo == 'numero_fixo') && newDate.weekday() != 6 && newDate.weekday() != 0 && arrayFeriados.indexOf(newDate_format) === -1)) {
        var dt_init_ativ = nextWorkDay(newDate, arrayFeriados, modo, config_unidade);
            dt_init_ativ = (config_unidade.count_horas) ? moment(dt_init_ativ.format('YYYY-MM-DD')+'T'+hora_inicio_recorrencia, config_unidade.hora_format) : dt_init_ativ;
        var dt_end_ativ = (dias_planejado > 0) 
                        ? (config_unidade.count_dias_uteis) 
                            ? dt_init_ativ.clone().addWorkdays(dias_planejado, arrayFeriados) 
                            : dt_init_ativ.clone().add(dias_planejado) 
                        : dt_init_ativ;
            dt_end_ativ = (config_unidade.count_horas) ? moment(dt_end_ativ.format('YYYY-MM-DD')+'T'+hora_fim_recorrencia, config_unidade.hora_format) : dt_end_ativ;
        // console.log(newDate_format, newDate.weekday(), dt_init_ativ.format(config_data_format), dt_end_ativ.format(config_data_format));

        return (dt_init_ativ >= dataInitRef && dt_init_ativ <= dataEndRef) 
            ? {
                id: index.toString(), 
                start_: dt_init_ativ, 
                start: dt_init_ativ.format('YYYY-MM-DD'), 
                start_format: dt_init_ativ.format(config_data_format_sys), 
                end_: dt_end_ativ, 
                end: dt_end_ativ.format('YYYY-MM-DD'),
                end_format: dt_end_ativ.format(config_data_format_sys), 
                progress: 0,
                custom_class: 'bar-iniciado',
                name: __.Demanda+' #'+(index+1)+' em '+dt_init_ativ.format(config_data_format),
                dependencies: (index == 0 ? '' : index-1).toString()
            } : false;
    } else {
        return false;
    }
}
function nextWorkDay(date, arrayFeriados, modo, config_unidade) {
    var date_format = date.format('YYYY-MM-DD');
    if (config_unidade.count_dias_uteis && (date.weekday() == 6 || date.weekday() == 0 || arrayFeriados.indexOf(date_format) !== -1)) {
        return date.addWorkdays((modo == 'mes_fim' ? -1 : 1), arrayFeriados);
    } else {
        return date;
    }
}
function changeModoRecorrenciaFields(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var type = _this.data('type');
    var mode_select = _this.find('option:selected').data('view');
    if (mode_select == 'show') {
        _parent.find('.modoDistribuicao_recorrente_'+type).show();
        if (_this.val() == 'numero_fixo_uteis') {
            _parent.find('#label_recorrencia_numero_fixo').hide();
            _parent.find('#label_recorrencia_numero_fixo_uteis').show();
        } else if (_this.val() == 'numero_fixo') {
            _parent.find('#label_recorrencia_numero_fixo').show();
            _parent.find('#label_recorrencia_numero_fixo_uteis').hide();

        } else {
            _parent.find('#label_recorrencia_numero_fixo').hide();
            _parent.find('#label_recorrencia_numero_fixo_uteis').hide();
        }
    } else {
        _parent.find('.modoDistribuicao_recorrente_'+type).hide();
    }
    calculoRecorrenciaAtiv(this_);
}
function addAtividadesAlertModeMult(this_, mode = 'remove') {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    _parent.find('.atividadesAlertModeMult').remove();
    if (mode != 'remove') {
        var htmlAtivAlertMult = '<div class="atividadesAlertModeMult" style="float: left;margin: -14px 0 0 0;transform: scale(0.9);background-color: #f9efad;padding: 5px 8px;border-radius: 5px;">'+
                                '   <i class="fas fa-exclamation-circle azulColor"></i>  '+__.Demanda+' recorrente incompat\u00EDvel com a cria\u00E7\u00E3o de '+__.demandas+' em m\u00FAltiplos processos'+
                                '</div>';
            _parent.find('.atividadesBtnModeDist').before(htmlAtivAlertMult);
    }
}
function changeModeDistribuicao(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var data = _this.data();
    if (data.value == 'Determinada') {
        _parent.find('.modoDistribuicao_determinada').show();
        _parent.find('.modoDistribuicao_recorrente').hide();
        _parent.find('#ativ_recorrencia').val('[]');
        _parent.find('#ativ_prazo_entrega').trigger('change');
        setTimeout(function(){ 
            _parent.find('#ativ_fator_complexidade').trigger('change');
        }, 500);
        if (!_parent.find('.ativMultiProcesso').is(':visible') && !_parent.find('#ativ_multiprocesso').is(':visible') && _parent.find('.ativMultiProcesso .ativProcessos').length > 0) {
            _parent.find('.ativMultiProcesso').show();
            multProcessUpdateInput();
        }
        addAtividadesAlertModeMult(this_, 'remove');
    } else if (data.value == 'Recorrente') {
        _parent.find('.modoDistribuicao_determinada').hide();
        _parent.find('.modoDistribuicao_recorrente').show();
        calculoRecorrenciaAtiv(this_);
        if (_parent.find('#ativ_multiprocesso').is(':visible') && _parent.find('#ativ_multiprocesso').is(':checked')) {
            _parent.find('#ativ_multiprocesso').prop('checked',false).trigger('change');
            addAtividadesAlertModeMult(this_, 'add');
        }
        if (_parent.find('.ativMultiProcesso').is(':visible') && !_parent.find('#ativ_multiprocesso').is(':visible')) {
            _parent.find('.ativMultiProcesso').hide();
            _parent.find('#ativ_id_procedimentos').val('[]');
            _parent.find('#ativ_id_user').trigger('change');
            addAtividadesAlertModeMult(this_, 'add');
        }
    }
    _this.closest('.atividadesBtnModeDist').find('.btn').removeClass('active');
    _this.addClass('active');
    initChosenReplace('box_reload', this_, true);
}
function changeAtivMultiProcesso(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    if(_this.is(':checked')) {
        _parent.find('.ativMultiProcesso').show();
        multProcessUpdateInput();
        if ($('.atividadesBtnModeDist button[data-value="Recorrente"]').hasClass('active')) {
            $('.atividadesBtnModeDist button[data-value="Determinada"]').trigger('click');
            addAtividadesAlertModeMult(this_, 'remove');
        }
    } else {
        _parent.find('.ativMultiProcesso').hide();
        _parent.find('#ativ_id_procedimentos').val('[]');
        _parent.find('#ativ_id_user').trigger('change');
    }
}
function multProcessUpdateInput() {
    var _parent = $('#boxAtividade.atividadeWork');
    var divList = _parent.find('.ativMultiProcesso');
    var ativProcessos = divList.find('.listMultProcessos span.ativProcessos').map(function(){
                            return {processo_sei: $(this).data('processo'), id_procedimento: $(this).data('procedimento').toString()} 
                        }).get();
        divList.find('#ativ_id_procedimentos').val(JSON.stringify(ativProcessos));
        divList.find('.counterMultProcessos').text('('+ativProcessos.length+' '+(ativProcessos.length > 1 ? 'processos' : 'processo')+')');
        _parent.find('#ativ_id_user').trigger('change');
}
function multProcessRemove(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
        _this.closest('.ativProcessos').remove();
        multProcessUpdateInput();
}
function completeAtividade(id_demanda, confirmeBox = false) {
    var dadosIfrArvore = getIfrArvoreDadosProcesso();
    var value = getAtividadeData(id_demanda);
    var id_plano_check = checkRegularizaPlano(value);
    if (id_plano_check) {
        regularizaPlano(false, {id_plano: id_plano_check, refplano: 'anterior'});
    } else {
        if (!checkSignDocsPlano(value)) {
            alertSignDocsPlano(value);
        } else {
            if (!confirmeBox && dadosIfrArvore && value.requisicao_sei == dadosIfrArvore.nr_sei) {
                confirmaBoxPro('O documento de entrega selecionado \u00E9 igual ao documento de requisi\u00E7\u00E3o. Deseja continuar?', function(){ completeAtividade(id_demanda, true) }, 'Continuar...');
            } else {
                var check_ispaused = (typeof value.data_retomada !== 'undefined' && value.data_retomada !== null && value.data_retomada == '0000-00-00 00:00:00') ? true : false;
                if (check_ispaused) {
                    confirmaBoxPro(__.A_demanda+' est\u00E1 '+getNameGenre('demanda', 'paralisado', 'paralisada')+'. Deseja retom\u00E1-la agora?', function(){ pauseAtividade(id_demanda) }, __.Retomar+'...', cancelMoveKanbanItens);
                } else {
                    var check_isresumed = (typeof value.data_retomada !== 'undefined' && value.data_retomada !== null && value.data_retomada != '0000-00-00 00:00:00') ? true : false;
                    var config_unidade = getConfigDadosUnidade(value.sigla_unidade);
                    var optionSelectDocumentos = ( arrayConfigAtividades.tipos_documentos.length > 0 ) ? $.map(arrayConfigAtividades.tipos_documentos, function(v,k){ return ( (value && v.id_tipo_documento == value.id_tipo_documento) || (dadosIfrArvore && dadosIfrArvore.nome_documento.indexOf(v.nome_documento) !== -1) ) ? '<option value="'+v.id_tipo_documento+'" selected>'+v.nome_documento+'</option>' : '<option value="'+v.id_tipo_documento+'">'+v.nome_documento+'</option>' }).join('') : '';
                    var selectDocumentos = '<select id="ativ_id_tipo_documento" class="requiredSelect" onchange="checkThisAtivRequiredFields(this)" data-key="id_tipo_documento" required><option>&nbsp;</option>'+optionSelectDocumentos+'</select>';
                        selectDocumentos = (checkOptionEntidade('dispensa_tipos_requisicao')) ? '<input type="hidden" id="ativ_id_tipo_documento" data-key="id_tipo_documento" data-param="id_tipo_documento" value="0">' : selectDocumentos;

                    var dataInicio = moment(value.data_inicio, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format);
                    var dataEntrega = (value.data_entrega != '0000-00-00 00:00:00') 
                                    ? moment(value.data_entrega, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format)
                                    : (dadosIfrArvore && typeof dadosIfrArvore.data_documento !== 'undefined' && dadosIfrArvore.data_documento) 
                                        ? moment(dadosIfrArvore.data_documento, 'DD/MM/YYYY HH:mm').format(config_unidade.hora_format)
                                        : moment().format(config_unidade.hora_format);
                                        // console.log(value.data_entrega, dadosIfrArvore, dadosIfrArvore.data_document);
                    var dataDistribuicao = moment(value.data_distribuicao, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format);
                    var inputAtiv = jmespath.search(arrayConfigAtividades.atividades, "[?id_atividade==`"+value.id_atividade+"`].{sigla_unidade: sigla_unidade, id_unidade: id_unidade, dias_planejado: dias_planejado, tempo_pactuado: tempo_pactuado, complexidade: config.complexidade, etiqueta: config.etiqueta.lista, tipo_processo: config.tipo_processo, desativa_produtividade: config.desativa_produtividade, observacao_gerencial: config.observacao_gerencial} | [0]");
                        inputAtiv = (inputAtiv !== null) ? "<input type='hidden' id='ativ_id_atividade' data-key='id_atividade' data-param='id_atividade' data-config='"+JSON.stringify(inputAtiv)+"' value='"+value.id_atividade+"'>" : '';
                    var inputUser = jmespath.search(arrayConfigAtividades.planos, "[?id_user==`"+value.id_user+"`].{id_plano: id_plano, sigla_unidade: sigla_unidade, nome_modalidade: nome_modalidade, carga_horaria: carga_horaria} | [0]");
                        inputUser = (inputUser !== null) ? "<input type='hidden' id='ativ_id_user' data-key='id_user' data-param='id_user' data-config='"+JSON.stringify(inputUser)+"' value='"+value.id_user+"'>" : '';

                    var listAtividadesVinculadas = getAtividadesVinculadas(value, 'concluidas');
                        
                    var htmlBox =   '<div id="boxAtividade" class="atividadeWork" data-demanda="'+(value && value.id_demanda ? value.id_demanda : 0)+'">'+
                                    '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                                    '      <tr>'+
                                    '          <td style="vertical-align: bottom; text-align: left; '+(checkOptionEntidade('dispensa_tipos_requisicao') ? 'display:none;' : '')+'" class="label">'+
                                    '               <label for="ativ_id_tipo_documento"><i class="iconPopup iconSwitch fas fa-file-signature cinzaColor"></i>Documento:</label>'+
                                    '               '+inputAtiv+
                                    '               '+inputUser+
                                    '           </td>'+
                                    '           <td class="required" style="width: 230px; '+(checkOptionEntidade('dispensa_tipos_requisicao') ? 'display:none;' : '')+'">'+
                                    '               '+selectDocumentos+
                                    '           </td>'+
                                    '           <td style="vertical-align: bottom;" class="label">'+
                                    '               <label class="'+(checkOptionEntidade('dispensa_tipos_requisicao') ? '' : 'last')+'" for="ativ_documento_sei"><i class="iconPopup iconSwitch fas fa-file cinzaColor"></i>SEI n\u00BA:</label>'+
                                    '           </td>'+
                                    '           <td colspan="2">'+
                                    '               <input type="text" oninput="this.value=this.value.replace(/[^0-9]/g,\'\')" id="ativ_documento_sei" onchange="changeProtocoloBoxAtiv(this)" maxlength="11" data-key="documento_sei" value="'+(value && value.documento_sei !== null && parseInt(value.documento_sei) != 0  ? value.documento_sei : (dadosIfrArvore && dadosIfrArvore.nr_sei ? dadosIfrArvore.nr_sei : '') )+'">'+
                                    '               <input type="hidden" id="ativ_id_documento_entregue" data-key="id_documento_entregue" data-param="id_documento_entregue" value="'+(value && value.id_documento_entregue !== null && value.id_documento_entregue != '0' ? value.id_documento_entregue : (dadosIfrArvore && dadosIfrArvore.id_documento ? dadosIfrArvore.id_documento : '') )+'">'+
                                    '           </td>'+
                                    '      </tr>'+
                                    '      <tr>'+
                                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    '               <label for="ativ_numero_documento"><i class="iconPopup iconSwitch fas fa-file cinzaColor"></i>Descri\u00E7\u00E3o do Documento:</label>'+
                                    '           </td>'+
                                    '           <td colspan="4">'+
                                    '               <input type="text" id="ativ_numero_documento" onchange="checkThisAtivRequiredFields(this)" maxlength="255" data-key="numero_documento" value="'+(value && value.numero_documento !== null ? value.numero_documento : (dadosIfrArvore && dadosIfrArvore.numero_documento ? dadosIfrArvore.numero_documento : '' ) )+'">'+
                                    '           </td>'+
                                    '      </tr>'+
                                    '      <tr>'+
                                    '          <td style="vertical-align: middle; text-align: left;" class="label">'+
                                    '               <label for="ativ_observacao_tecnica"><i class="iconPopup iconSwitch fas fa-comment-alt cinzaColor"></i>'+__.Observacao+' '+__.Tecnica+':</label>'+
                                    '           </td>'+
                                    '           <td colspan="4">'+
                                    '               <textarea style="width: 97%;float: left;" type="text" id="ativ_observacao_tecnica" '+((value.data_entrega == '0000-00-00 00:00:00') ? 'oninput="checkboxAnotacoesProcessoAtiv(this)"' : '')+' data-key="observacao_tecnica">'+((value && value.observacao_tecnica !== null && value.observacao_tecnica != '') ? value.observacao_tecnica : '')+'</textarea>'+
                                    ''+($('#ifrArvore').length > 0 ? 
                                    '               <table style="width: 100%;font-size: 10pt; display:none" id="tableAnotacoesProcessoAtiv">'+
                                    '                   <tbody>'+
                                    '                       <tr style="height: 40px;">'+
                                    '                           <td style="text-align: left;vertical-align: bottom;">'+
                                    '                               <label for="ativ_anotacoes_processo">'+
                                    '                                   <i class="iconPopup iconSwitch fas fa-sticky-note cinzaColor"></i>Adicionar '+__.observacao+' '+__.tecnica+' nas anota\u00E7\u00F5es do processo?</label>'+
                                    '                           </td>'+
                                    '                           <td>'+
                                    '                               <div class="onoffswitch" style="float: right;">'+
                                    '                                   <input type="checkbox" data-key="anotacoes_processo" name="onoffswitch" class="onoffswitch-checkbox" id="ativ_anotacoes_processo" tabindex="0">'+
                                    '                                   <label class="onoffswitch-label" for="ativ_anotacoes_processo"></label>'+
                                    '                               </div>'+
                                    '                           </td>'+
                                    '                       </tr>'+
                                    '                   </tbody>'+
                                    '               </table>'+
                                    '' : '')+
                                    '           </td>'+
                                    '      </tr>'+
                                    '      <tr class="hrForm"><td colspan="5"></td></tr>'+
                                    '      <tr>'+
                                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    '               <label for="ativ_data_inicio"><i class="iconPopup iconSwitch fas fa-play-circle cinzaColor"></i>Data de In\u00EDcio:</label>'+
                                    '           </td>'+
                                    '           <td class="required date">'+
                                    '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="changeDadosTrabalho(this)" id="ativ_data_inicio" data-key="data_inicio" data-type="inicio" data-name="data de in\u00EDcio" value="'+dataInicio+'" min="'+dataDistribuicao+'" required>'+
                                    '               <input type="hidden" id="ativ_data_distribuicao" data-key="data_distribuicao" data-type="distribuicao" value="'+dataDistribuicao+'">'+
                                    '           </td>'+
                                    '           <td style="vertical-align: bottom;" class="label">'+
                                    '               <label class="last" for="ativ_data_entrega"><i class="iconPopup iconSwitch fas fa-user-clock cinzaColor" style="float: initial;"></i>Data de Entrega:</label>'+
                                    '           </td>'+
                                    '           <td class="required date">'+
                                    '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="changeDadosTrabalho(this)" id="ativ_data_entrega" data-key="data_entrega" data-type="fim" data-name="data de entrega" value="'+dataEntrega+'" min="'+dataDistribuicao+'" required>'+
                                    '           </td>'+
                                    '           <td>'+
                                    '               <i class="fas fa-chevron-circle-right azulColor" style="margin: 0px 2px;float: right;cursor:pointer" onmouseout="return infraTooltipOcultar();" onclick="toggleTemposLiquidos(this)" onmouseover="return infraTooltipMostrar(\'Clique para visualizar os tempos despendido, executado e planejado\')"></i> '+
                                    '           </td>'+
                                    '      </tr>'+
                                    '      <tr '+(check_isresumed ? '': 'style="display:none"')+'>'+
                                    // '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    // '               <label for="ativ_tempo_pausado"><i class="iconPopup iconSwitch fas fa-clock cinzaColor"></i>Tempo '+__.Paralisado+':</label>'+
                                    // '           </td>'+
                                    // '           <td>'+
                                    // '               <input type="number" min="0.1" step=".1" id="ativ_tempo_pausado" data-key="tempo_pausado" value="0" disabled>'+
                                    // '           </td>'+
                                    '           <td style="vertical-align: middle;text-align: right;padding-left: 25px;" class="label" colspan="4">'+
                                    '               <button type="button" id="manPauseAtividade" '+(checkCapacidade('pause_atividade') ? '' : 'style="display:none"')+' class="confirm ui-button ui-corner-all ui-widget"><span class="ui-button-icon ui-icon ui-icon-calendar"></span><span class="ui-button-icon-space"> </span>Gerenciar Paralisa\u00E7\u00F5es</button>'+
                                    '           </td>'+
                                    '      </tr>'+
                                    '      <tr class="tempos_liquidos" style="display:none">'+
                                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    '               <label for="ativ_tempo_despendido">'+
                                    '                   <i class="iconPopup iconSwitch fas fa-hourglass-half cinzaColor"></i>'+
                                    '                   <i class="fas fa-info-circle azulColor" style="margin: 0px 2px;float: right;" onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\'Tempo l\u00EDquido entre a <u>data de in\u00EDcio</u> '+getNameGenre('demanda', 'do', 'da')+' '+__.demanda+' e sua data de entrega\')"></i>'+
                                    '                   Tempo Despendido:'+
                                    '               </label>'+
                                    '           </td>'+
                                    '           <td class="td_tempo_despendido" data-tempo="'+decimalHourToMinute(value && value.tempo_despendido ? value.tempo_despendido : '0')+'">'+
                                    '               <input type="number" min="0.1" step=".1" id="ativ_tempo_despendido" onchange="changeDadosTrabalho(this)" data-key="tempo_despendido" data-type="tempo" value="'+(value && value.tempo_despendido ? value.tempo_despendido : '0')+'" disabled>'+
                                    '           </td>'+
                                    '           <td style="vertical-align: bottom;" class="label">'+
                                    '               <label class="last" for="ativ_dias_despendido"><i class="iconPopup iconSwitch fas fa-calendar-alt cinzaColor" style="float: initial;"></i><span id="ativ_dias_despendido_label">Dias '+(config_unidade.count_dias_uteis ? '\u00FAteis' : '')+' Despendido</span>:</label>'+
                                    '           </td>'+
                                    '           <td class="required number" colspan="2">'+
                                    '               <input type="number" min="0" id="ativ_dias_despendido" onchange="changeDadosTrabalho(this)" data-key="dias_despendido" data-type="dias" value="'+(value && value.dias_despendido ? value.dias_despendido : '0')+'" required>'+
                                    '           </td>'+
                                    '      </tr>'+
                                    '      <tr class="tempos_liquidos" style="display:none">'+
                                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    '               <label for="ativ_tempo_executado">'+
                                    '                   <i class="iconPopup iconSwitch fas fa-hourglass-half cinzaColor"></i>'+
                                    '                   <i class="fas fa-info-circle azulColor" style="margin: 0px 2px;float: right;" onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\'Tempo l\u00EDquido entre a <u>data de distribui\u00E7\u00E3o</u> '+getNameGenre('demanda', 'do', 'da')+' '+__.demanda+' e sua data de entrega\')"></i>'+
                                    '                   Tempo Executado:'+
                                    '               </label>'+
                                    '           </td>'+
                                    '           <td class="td_tempo_executado" data-tempo="'+decimalHourToMinute(value && value.tempo_executado ? value.tempo_executado : '0')+'">'+
                                    '               <input type="number" min="0.1" step=".1" id="ativ_tempo_executado" data-key="tempo_executado" data-type="tempo_executado" value="'+(value && value.tempo_executado ? value.tempo_executado : '0')+'" disabled>'+
                                    '           </td>'+
                                    '           <td style="vertical-align: bottom;" class="label">'+
                                    '               <label class="last" for="ativ_dias_executado"><i class="iconPopup iconSwitch fas fa-calendar-alt cinzaColor" style="float: initial;"></i><span id="ativ_dias_executado_label">Dias '+(config_unidade.count_dias_uteis ? '\u00FAteis' : '')+' Executado</span>:</label>'+
                                    '           </td>'+
                                    '           <td class="required number" colspan="2">'+
                                    '               <input type="number" min="0" id="ativ_dias_executado" onchange="changeDadosTrabalho(this)" data-key="dias_executado" data-type="dias_executado" value="'+(value && value.dias_executado ? value.dias_executado : '0')+'" required>'+
                                    '           </td>'+
                                    '      </tr>'+
                                    '      <tr class="hrForm tempos_liquidos" style="display:none"><td colspan="5"></td></tr>'+
                                    '      <tr class="tempos_liquidos" style="display:none">'+
                                    '            <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    '                <label for="ativ_data_distribuicao"><i class="iconPopup iconSwitch fas fa-briefcase cinzaColor"></i>Data de Distribui\u00E7\u00E3o:</label>'+
                                    '            </td>'+
                                    '            <td class="required date" style="width: 210px;">'+
                                    '                <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" value="'+value.data_distribuicao+'" required disabled>'+
                                    '            </td>'+
                                    '            <td style="vertical-align: bottom;" class="label">'+
                                    '                <label class="last" for="ativ_prazo_entrega"><i class="iconPopup iconSwitch fas fa-business-time cinzaColor" style="float: initial;"></i>Prazo de Entrega:</label>'+
                                    '            </td>'+
                                    '            <td class="required date" colspan="2">'+
                                    '                <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" value="'+value.prazo_entrega+'" required disabled>'+
                                    '            </td>'+
                                    '      </tr>'+
                                    '      <tr class="tempos_liquidos" style="display:none">'+
                                    '            <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    '                <label for="ativ_tempo_planejado"><i class="iconPopup iconSwitch fas fa-hourglass-half cinzaColor"></i>'+
                                    '                   <i class="fas fa-info-circle azulColor" style="margin: 0px 2px;float: right;" onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\'Tempo l\u00EDquido entre a data de distribui\u00E7\u00E3o '+getNameGenre('demanda', 'do', 'da')+' '+__.demanda+' e seu <u>prazo de entrega</u>\')"></i>'+
                                    '                   Tempo Planejado:</label>'+
                                    '            </td>'+
                                    '            <td style="width: 210px;">'+
                                    '                <input type="number" id="ativ_tempo_planejado_complete" value="'+(value && value.tempo_planejado ? value.tempo_planejado : '')+'" disabled>'+
                                    '            </td>'+
                                    '            <td style="vertical-align: bottom;" class="label">'+
                                    '                <label class="last" for="ativ_dias_planejado"><i class="iconPopup iconSwitch fas fa-calendar-alt cinzaColor" style="float: initial;"></i><span id="ativ_dias_planejado_label">Dias '+(config_unidade.count_dias_uteis ? '\u00FAteis' : '')+' de Planejamento</span>:</label>'+
                                    '            </td>'+
                                    '            <td class="required number" colspan="2">'+
                                    '                <input type="number" value="'+(value && value.dias_planejado ? value.dias_planejado : '0')+'" required disabled>'+
                                    '            </td>'+
                                    '      </tr>'+
                                    '      <tr class="hrForm tempos_liquidos" style="display:none"><td colspan="5"></td></tr>'+
                                    '      <tr>'+
                                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    '               <label for="ativ_tempo_pactuado"><i class="iconPopup iconSwitch fas fa-handshake cinzaColor"></i>Tempo Pactuado:</label>'+
                                    '           </td>'+
                                    '           <td colspan="3" style="text-align: left;" colspan="2">'+
                                    '               <span id="ativ_tempo_pactuado">'+getTagTempoPactuadoAtiv(value)+'</span>'+
                                    '           </td>'+
                                    '      </tr>'+
                                    (!checkOptionEntidade('desativa_produtividade_geral') ? 
                                    '      <tr>'+
                                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    '               <label for="ativ_produtividade"><i class="iconPopup iconSwitch fas fa-toolbox cinzaColor"></i>Produtividade:</label>'+
                                    '           </td>'+
                                    '           <td colspan="3" style="text-align: left;">'+
                                    '               <div id="ativ_produtividade" style="margin: 5px 0;">'+getInfoAtividadeProdutividade(value, true, 'despendido')+'</div>'+
                                    '               <div id="ativ_produtividade_executada" style="margin: 5px 0;">'+getInfoAtividadeProdutividade(value, true, 'executado')+'</div>'+
                                    '           </td>'+
                                    '           <td>'+
                                    '               <i class="fas fa-redo cinzaColor update_tempos_demanda" style="margin: 0px 2px;float: left;cursor:pointer" onmouseout="return infraTooltipOcultar();" data-demanda="'+value.id_demanda+'" data-type="set" data-tempo="tempo_planejado" onclick="updateDialogTemposDemanda(this)" onmouseover="return infraTooltipMostrar(\'Clique para atualizar os c\u00E1lculos de produtividade\')"></i>'+
                                    '           </td>'+
                                    '      </tr>'+
                                    '' : '')+
                                    (value.checklist && value.checklist.length > 0 ?
                                    '      <tr>'+
                                    '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    '               <label for="ativ_checklist"><i class="iconPopup iconSwitch fas fa-check-double cinzaColor"></i>Checklist:</label>'+
                                    '           </td>'+
                                    '           <td colspan="4" style="text-align: left;">'+
                                    '               '+getInfoAtividadeChecklist(value, 'actions')+
                                    '           </td>'+
                                    '      </tr>'+
                                    '' : '')+
                                    (listAtividadesVinculadas.length_check > 0 ? 
                                    '      <tr>'+
                                    '           <td colspan="5">'+
                                    '               '+listAtividadesVinculadas.input+
                                    '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                                    '                  <tr style="height: 40px;">'+
                                    '                      <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    '                           <label for="complete_others"><i class="iconPopup iconSwitch fas fa-check-circle cinzaColor"></i> '+(listAtividadesVinculadas.length_check > 1 ? 'Concluir '+getNameGenre('demanda', 'os outros', 'as outras')+' '+listAtividadesVinculadas.length_check+' '+__.demandas+' '+getNameGenre('demanda', 'vinculados', 'vinculadas') : 'Concluir '+__.a_outra_demanda_vinculada)+'?</label>'+
                                    '                      </td>'+
                                    '                      <td style="width: 50px;">'+
                                    '                          <div class="onoffswitch" style="float: right;">'+
                                    '                              <input type="checkbox" name="onoffswitch" data-target="#listCompleteOtherAtiv" onchange="changeOthersAtiv(this)" class="onoffswitch-checkbox singleOptionConfig" id="complete_others" data-key="complete_others" tabindex="0" checked>'+
                                    '                              <label class="onoffswitch-label" for="complete_others"></label>'+
                                    '                          </div>'+
                                    '                      </td>'+
                                    '                  </tr>'+
                                    '                  <tr style="height: 40px;">'+
                                    '                      <td style="vertical-align: bottom; text-align: left;" class="label">'+
                                    '                           <label for="dividir_tempo_despendido"><i class="iconPopup iconSwitch fas fa-hourglass-half cinzaColor"></i> Dividir o tempo despendido entre todas as demandas?</label>'+
                                    '                      </td>'+
                                    '                      <td style="width: 50px;">'+
                                    '                          <div class="onoffswitch" style="float: right;">'+
                                    '                              <input type="checkbox" name="onoffswitch" data-target="#listCompleteOtherAtiv" onchange="changeDadosTrabalho(this)" class="onoffswitch-checkbox singleOptionConfig" id="dividir_tempo_despendido" data-key="dividir_tempo_despendido" tabindex="0" checked>'+
                                    '                              <label class="onoffswitch-label" for="dividir_tempo_despendido"></label>'+
                                    '                          </div>'+
                                    '                      </td>'+
                                    '                  </tr>'+
                                    '                  <tr style="height: auto;">'+
                                    '                      <td colspan="2">'+
                                    '                           '+listAtividadesVinculadas.html+
                                    '                      </td>'+
                                    '                  </tr>'+
                                    '               </table>'+
                                    '           </td>'+
                                    '      </tr>'+
                                    '' : '')+
                                    '   </table>'+
                                    '</div>';

                    var btnDialogBoxPro =   [{
                        text: (value.data_entrega != '0000-00-00 00:00:00') ? 'Editar Conclus\u00E3o' : 'Concluir',
                        class: 'confirm',
                        click: function(event) { 
                            if (checkSigleInputDateAtiv_(this)) {
                                if (checkAtivRequiredFields(this, 'mark')) {
                                    if (checkAtivProdutividade(this, value)) {
                                        if (checkAtivChecklist(this, value)) {
                                            sendCompleteAtividade(this, value);
                                        }
                                    }
                                }
                            }
                        }
                    }];
                    if (value.data_entrega != '0000-00-00 00:00:00') {
                        btnDialogBoxPro.unshift({
                            text: 'Gerar Notifica\u00E7\u00E3o',
                            icon: "ui-icon-mail-closed",
                            click: function(event) { 
                                notifyAtividade(id_demanda, event);
                            }
                        });
                        if (checkCapacidade('complete_cancel_atividade')) {
                            btnDialogBoxPro.unshift({
                                text: 'Cancelar Conclus\u00E3o',
                                icon: "ui-icon-close",
                                click: function(event) { 
                                    completeCancelAtividade(id_demanda);
                                }
                            });
                        }
                    } else {
                        var checkConfigAtiv = jmespath.search(arrayConfigAtividades.atividades, "[?id_atividade==`"+value.id_atividade+"`] | [0].config.desativa_produtividade");
                        if (!checkConfigAtiv && checkCapacidade('pause_atividade')) {
                            var check_ispaused = (typeof value.data_retomada !== 'undefined' && value.data_retomada == '0000-00-00 00:00:00') ? true : false;
                            btnDialogBoxPro.unshift({
                                text: (check_ispaused ? __.Retomar+' '+__.Demanda : 'Inserir '+__.Paralisacao),
                                icon: 'ui-icon-'+(check_ispaused ? 'play' : 'pause'),
                                click: function(event) { 
                                    pauseAtividade(id_demanda);
                                }
                            });
                        }
                        if (checkCapacidade('extend_atividade')) {
                            btnDialogBoxPro.unshift({
                                text: __.Prorrogar+' Prazo',
                                icon: "ui-icon-refresh",
                                click: function(event) { 
                                    extendAtividade(id_demanda);
                                }
                            });
                        }
                        if (checkCapacidade('variation_atividade') || checkCapacidade('type_atividade')) {
                            btnDialogBoxPro.unshift({
                                text: (value.tempo_pactuado == 0 ? 'Atribuir '+__.Atividade : 'Alterar '+__.Complexidade),
                                icon: (value.tempo_pactuado == 0 ? 'ui-icon-arrowreturnthick-1-n' : 'ui-icon-transferthick-e-w'),
                                click: function(event) { 
                                    variationAtividade(id_demanda);
                                }
                            });
                        }
                        btnDialogBoxPro.unshift({
                            text: 'Cancelar In\u00EDcio',
                            icon: "ui-icon-close",
                            click: function(event) { 
                                startCancelAtividade(id_demanda);
                            }
                        });
                    }
                    if (checkCapacidade('complete_atividade')) {
                        resetDialogBoxPro('dialogBoxPro');
                        dialogBoxPro = $('#dialogBoxPro')
                            .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
                            .dialog({
                                title: 'Concluir '+__.Demanda+': '+getTitleDialogBox(value),
                                width: 780,
                                open: function() { 
                                    updateButtonConfirm(this, true);
                                    $('#ativ_data_entrega').trigger('change');
                                    updateServerTemposDemanda('set', 'tempo_planejado', value);
                                },
                                close: function() { 
                                    $('#boxAtividade').remove();
                                    cancelMoveKanbanItens();
                                    cancelSelectedItensAtiv(id_demanda);
                                    resetDialogBoxPro('dialogBoxPro');
                                },
                                buttons: btnDialogBoxPro
                        });
                        if (check_isresumed) { getPausasAtividade(id_demanda) }
                    }
                }
            }
        }
    }
}
function updateDialogTemposDemanda(this_) {
    var data = $(this_).data();
    var value = getAtividadeData(data.demanda);
    updateServerTemposDemanda(data.set, data.tempo, value);
}
function toggleTemposLiquidos(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    if (_parent.find('.tempos_liquidos').is(':visible')) {
        _parent.find('.tempos_liquidos').hide();
        _this.attr('class','fas fa-chevron-circle-right azulColor');
    } else {
        _parent.find('.tempos_liquidos').show();
        _this.attr('class','fas fa-chevron-circle-down azulColor');
    }
    centralizeDialogBox(dialogBoxPro);
}
function sendCompleteAtividade(this_, value, tempo_parcial = false) {
    var listAtividadesVinculadas = getAtividadesVinculadas(value, 'concluidas');
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    var action = (value.data_entrega != '0000-00-00 00:00:00') ? 'complete_edit_atividade' : 'complete_atividade';
    var id_demandas_complete = (listAtividadesVinculadas.length_check > 0 && _parent.find('#complete_others').is(':checked')) 
                            ? JSON.parse(_parent.find('#lista_complete_others').val())
                            : [];
    var param = extractDataAtiv(this_);
        param.action = action;
        param.id_demandas_complete = id_demandas_complete;
        param.id_demanda = value.id_demanda;
        param.id_unidade = value.id_unidade;
        param.return_tempo_parcial = (tempo_parcial) ? {id_demanda: value.id_demanda, tempo_pactuado_original: value.tempo_pactuado, tempo_pactuado: tempo_parcial} : [];
    var id_plano = jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+param.id_user+"`] | [0].id_plano");
        id_plano = (id_plano === null) ? 0 : id_plano;
        param.id_plano = id_plano;
        getServerAtividades(param, action);
}
function updateAnotacaoProcesso(anotacao) {
    if ($('#ifrArvore').length > 0) {
        var ifrArvore = $('#ifrArvore').contents();
        var ref = ifrArvore.find('.saveStickNote')[0];
        $('#ifrArvore')[0].contentWindow.sticknoteEdit(ref);
        $('#ifrArvore')[0].contentWindow.sticknoteUpdate(ref, anotacao, 'save', false, 'increment');
    }
}
function checkboxAnotacoesProcessoAtiv(this_) {
    var _this = $(this_);
    var _parent = _this.closest('tr');
    if (checkValue(_this)) {
        _parent.find('#tableAnotacoesProcessoAtiv').show();
    } else {
        _parent.find('#tableAnotacoesProcessoAtiv').hide();
    }
}
function getPausasAtividadeCalc(pausa_lista = false, mode = 'despendido') {
    var _parent = $('#boxAtividade.atividadeWork');
    var value = (typeof _parent !== 'undefined') ? getAtividadeData(_parent.data('demanda')) : false;
    if (value) {
            pausa_lista = !pausa_lista ? value.pausa_lista : pausa_lista;
        var user = _parent.find('#ativ_id_user');
        var data_inicio = (mode == 'despendido') ? _parent.find('input[data-type="inicio"]') : _parent.find('input[data-type="distribuicao"]');
        var data_fim = _parent.find('#ativ_data_entrega');
        var tempo = (mode == 'despendido') ? _parent.find('input[data-type="tempo"]') : _parent.find('input[data-type="tempo_executado"]');

        var config_entidade = jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config");
            config_entidade = (config_entidade !== null) ? config_entidade : false;
        var carga_horaria_padrao = (config_entidade && typeof config_entidade.carga_horaria_padrao !== 'undefined' && config_entidade.carga_horaria_padrao !== null) ? config_entidade.carga_horaria_padrao : 8;

        var config_user = (user.is('select')) ? user.find('option:selected').data('config') : user.data('config');
            config_user = (typeof config_user !== 'undefined') ? config_user : {carga_horaria: carga_horaria_padrao};
        var config_unidade = getBoxConfigDadosUnidade(_parent);
        
        var config_user_perfil = (arrayConfigAtividades.perfil.hasOwnProperty('config') && arrayConfigAtividades.perfil.config !== null) ? arrayConfigAtividades.perfil.config : false;
        var h_util_inicio = (config_user_perfil && config_user_perfil.hasOwnProperty('distribuicao') && config_user_perfil.distribuicao.hasOwnProperty('horario_util')) ? config_user_perfil.distribuicao.horario_util.inicio : config_unidade.h_util_inicio;
        var h_util_fim = (config_user_perfil && config_user_perfil.hasOwnProperty('distribuicao') && config_user_perfil.distribuicao.hasOwnProperty('horario_util')) ? config_user_perfil.distribuicao.horario_util.fim : config_unidade.h_util_fim;
        
        var config_feriados = (typeof config_unidade.feriados !== 'undefined' && config_unidade.feriados !== null) ? config_unidade.feriados : false;
        var arrayFeriados = (config_unidade.count_dias_uteis && data_inicio.val() != '' && data_fim.val() != '') 
                            ? jmespath.search(getHolidayBetweenDates(moment(data_inicio.val(), 'YYYY-MM-DD HH:mm:ss').format('Y')+'-01-01', moment(data_fim.val(), 'YYYY-MM-DD HH:mm:ss').add(1, 'Y').format('Y')+'-01-01', config_feriados), "[*].d_")
                            : [];
        
        function getCalcPausasDt(initData, endData, value) {
            var valueDias = (config_unidade.count_dias_uteis) 
                        ? moment().isoWeekdayCalc({  
                            rangeStart: initData,  
                            rangeEnd: endData,  
                            weekdays: [1,2,3,4,5],  
                            exclusions: arrayFeriados
                        })-1
                        : moment(endData, 'YYYY-MM-DD HH:mm:ss').diff(moment(initData, 'YYYY-MM-DD HH:mm:ss'), 'days');
                valueDias = (valueDias < 0) ? 0 : valueDias;
            var h_dataInicio = moment(initData, 'YYYY-MM-DD HH:mm:ss');
            var h_dataFim = moment(endData, 'YYYY-MM-DD HH:mm:ss');
            var h_utilInicio = moment(h_dataFim.format('YYYY-MM-DD')+'T'+h_util_inicio, 'YYYY-MM-DDTHH:mm');
            var h_utilFim = moment(h_dataInicio.format('YYYY-MM-DD')+'T'+h_util_fim, 'YYYY-MM-DDTHH:mm');
            
            var param = {
                id_pausa: value.id_pausa,
                id_demanda: value.id_demanda,
                count_dias_uteis: config_unidade.count_dias_uteis,
                count_horas: config_unidade.count_horas,
                h_dataInicio: h_dataInicio,
                h_dataFim: h_dataFim,
                h_utilInicio: h_utilInicio,
                h_utilFim: h_utilFim,
                carga_horaria: config_user.carga_horaria,
                valueDias: valueDias
            };
            var tempoTrabalho = getTempoTrabalhoAtiv(param);
            return tempoTrabalho;
        }
        
        if (typeof pausa_lista !== 'undefined' && pausa_lista !== null && pausa_lista.length > 0) {
            var arrayPausas = [];
            var totalDespendido = 0;
        
            var initData = moment(data_inicio.val(),'YYYY-MM-DDTHH:mm:ss').format('YYYY-MM-DD HH:mm:ss');
            var endData = pausa_lista[0].data_inicio;
            var initTempoTrabalho = getCalcPausasDt(initData, endData, value);
                if (mode == 'despendido') arrayPausas.push({type: 'init', tempo_trabalho : initTempoTrabalho});
                totalDespendido = totalDespendido+initTempoTrabalho;
            
            $.each(pausa_lista, function(i, v){
                if (typeof pausa_lista[i+1] !== 'undefined') {
                    var pausaTempoTrabalho = getCalcPausasDt(v.data_fim, pausa_lista[i+1].data_inicio, value);
                        if (mode == 'despendido') arrayPausas.push({type: 'loop', tempo_trabalho : pausaTempoTrabalho});
                        totalDespendido = totalDespendido+pausaTempoTrabalho;
                }
            });
        
            var endTempoTrabalhoInicio = pausa_lista[pausa_lista.length-1].data_fim;
            var endTempoTrabalhoFim = moment(data_fim.val(),'YYYY-MM-DDTHH:mm:ss').format('YYYY-MM-DD HH:mm:ss');
            var endTempoTrabalho = getCalcPausasDt(endTempoTrabalhoInicio, endTempoTrabalhoFim, value);
                if (mode == 'despendido') arrayPausas.push({type: 'end', tempo_trabalho : endTempoTrabalho});
                totalDespendido = totalDespendido+endTempoTrabalho;
            
            if (totalDespendido > 0) {
                    // tempo_despendido.val(parseFloat(totalDespendido.toFixed(1)));
                    checkTempoProdutividade(tempo);
                var data_inicio_min = jmespath.search(pausa_lista, "[].data_inicio").reduce(function (a, b) { return a < b ? a : b; }); 
                var data_fim_max = jmespath.search(pausa_lista, "[].data_fim").reduce(function (a, b) { return a > b ? a : b; });
                    data_inicio.attr('max', data_inicio_min.replace(' ', 'T').slice(0, -3)).data('date-max','fixed').data('name','data de '+__.retomada);
                    data_fim.attr('min', data_fim_max.replace(' ', 'T').slice(0, -3)).data('date-min', 'fixed');
            } else {
                    data_inicio.attr('max', data_fim.val()).data('date-max','').data('name','data de in\u00EDcio');
                    data_fim.attr('min', data_inicio.val()).data('date-min', '');
            }

            // _parent.find('#ativ_dias_despendido').trigger('change');
            if (mode == 'despendido') {
                _parent.find('#manPauseAtividade').unbind().on('click', function(){
                    getPausasAtividadePanel(value, arrayPausas, totalDespendido);
                });
            }
            // console.log(totalDespendido, arrayPausas, pausa_lista);

            return totalDespendido;
        } else {
            if (typeof tempo.data('tempo-geral') !== 'undefined') { tempo.val(tempo.data('tempo-geral')) }
            return false;
        }
    } else {
        return false;
    }
}
function getPausasAtividadeCalc_(pause_lista) {
    var _parent = $('#boxAtividade.atividadeWork');
    var user = _parent.find('#ativ_id_user');
    var data_inicio = _parent.find('#ativ_data_inicio');
    var data_fim = _parent.find('#ativ_data_entrega');
    var tempo_despendido = _parent.find('#ativ_tempo_despendido');
    var tempo_pausado = _parent.find('#ativ_tempo_pausado');
    var config_user = (user.is('select')) ? user.find('option:selected').data('config') : user.data('config');
        config_user = (typeof config_user !== 'undefined') ? config_user : {carga_horaria: carga_horaria_padrao};
    var config_unidade = getBoxConfigDadosUnidade(_parent);

    var config_user_perfil = (arrayConfigAtividades.perfil.hasOwnProperty('config') && arrayConfigAtividades.perfil.config !== null) ? arrayConfigAtividades.perfil.config : false;
    var h_util_inicio = (config_user_perfil && config_user_perfil.hasOwnProperty('distribuicao') && config_user_perfil.distribuicao.hasOwnProperty('horario_util')) ? config_user_perfil.distribuicao.horario_util.inicio : config_unidade.h_util_inicio;
    var h_util_fim = (config_user_perfil && config_user_perfil.hasOwnProperty('distribuicao') && config_user_perfil.distribuicao.hasOwnProperty('horario_util')) ? config_user_perfil.distribuicao.horario_util.fim : config_unidade.h_util_fim;
    // console.log('config_user_perfil', config_user_perfil);

    if (typeof pause_lista !== 'undefined' && pause_lista.length > 0) {
        var arrayPausas = [];
        var totalPausas = 0;

        $.each(pause_lista, function(index, value){
            var config_feriados = (typeof config_unidade.feriados !== 'undefined' && config_unidade.feriados !== null) ? config_unidade.feriados : false;
            var arrayFeriados = (config_unidade.count_dias_uteis && value.data_inicio != '' && value.data_fim != '') 
                                ? jmespath.search(getHolidayBetweenDates(moment(value.data_inicio, 'YYYY-MM-DD HH:mm:ss').format('Y')+'-01-01', moment(value.data_fim, 'YYYY-MM-DD HH:mm:ss').add(1, 'Y').format('Y')+'-01-01', config_feriados), "[*].d_")
                                : [];
            var valueDias = (config_unidade.count_dias_uteis) 
                        ? moment().isoWeekdayCalc({  
                            rangeStart: value.data_inicio,  
                            rangeEnd: value.data_fim,  
                            weekdays: [1,2,3,4,5],  
                            exclusions: arrayFeriados
                        })-1
                        : moment(value.data_fim, 'YYYY-MM-DD HH:mm:ss').diff(moment(value.data_inicio, 'YYYY-MM-DD HH:mm:ss'), 'days');
                valueDias = (valueDias < 0) ? 0 : valueDias;
            var h_dataInicio = moment(value.data_inicio, 'YYYY-MM-DD HH:mm:ss');
            var h_dataFim = moment(value.data_fim, 'YYYY-MM-DD HH:mm:ss');
            var h_utilInicio = moment(h_dataFim.format('YYYY-MM-DD')+'T'+h_util_inicio, 'YYYY-MM-DDTHH:mm');
            var h_utilFim = moment(h_dataInicio.format('YYYY-MM-DD')+'T'+h_util_fim, 'YYYY-MM-DDTHH:mm');

            var check_lastPrevDay = (index != 0 && h_dataInicio.diff(moment(pause_lista[index-1].data_fim, 'YYYY-MM-DD HH:mm:ss'), 'days') == 0)
                ? moment.duration(
                        moment(pause_lista[index-1].data_fim, 'YYYY-MM-DD HH:mm:ss')
                        .diff(moment(moment(pause_lista[index-1].data_fim, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD')+'T'+h_util_inicio, 'YYYY-MM-DDTHH:mm'))
                    ).asHours()
                : false;
                check_lastPrevDay = (check_lastPrevDay > config_user.carga_horaria) ? config_user.carga_horaria : check_lastPrevDay;
            var check_firstCurrentDay = moment.duration(h_utilFim.diff(h_dataInicio)).asHours();
                check_firstCurrentDay = (check_firstCurrentDay > config_user.carga_horaria) ? config_user.carga_horaria : check_firstCurrentDay;
            var check_prevDay_currentDay = (check_lastPrevDay) ? ((check_lastPrevDay+check_firstCurrentDay)-(config_user.carga_horaria)) : false;

            var param = {
                id_pausa: value.id_pausa,
                id_demanda: value.id_demanda,
                count_dias_uteis: config_unidade.count_dias_uteis,
                count_horas: config_unidade.count_horas,
                h_dataInicio: h_dataInicio,
                h_dataFim: h_dataFim,
                h_utilInicio: h_utilInicio,
                h_utilFim: h_utilFim,
                carga_horaria: config_user.carga_horaria,
                valueDias: valueDias,
                last_day: check_lastPrevDay,
                first_day: check_firstCurrentDay,
                diff_day: check_prevDay_currentDay
            };
            var tempoTrabalho = getTempoTrabalhoAtiv(param);
                arrayPausas.push({param: param, tempo_trabalho : tempoTrabalho});
                totalPausas = totalPausas+tempoTrabalho;
        });
        if (totalPausas > 0) {
            var tempo_despendido_final = tempo_despendido.data('tempo-geral')-totalPausas;
                tempo_despendido_final = parseFloat(tempo_despendido_final.toFixed(1));
                tempo_pausado.val(parseFloat(totalPausas.toFixed(1)));
                tempo_despendido.val(tempo_despendido_final);
                checkTempoProdutividade(tempo_despendido);
            var data_inicio_min = jmespath.search(pause_lista, "[].data_inicio").reduce(function (a, b) { return a < b ? a : b; }); 
            var data_fim_max = jmespath.search(pause_lista, "[].data_fim").reduce(function (a, b) { return a > b ? a : b; });
            data_inicio.attr('max', data_inicio_min.replace(' ', 'T').slice(0, -3)).data('date-max','fixed').data('name','data de '+__.retomada);
            data_fim.attr('min', data_fim_max.replace(' ', 'T').slice(0, -3)).data('date-min', 'fixed');
        } else {
            data_inicio.attr('max', data_fim.val()).data('date-max','').data('name','data de in\u00EDcio');
            data_fim.attr('min', data_inicio.val()).data('date-min', '');
        }

        _parent.find('#ativ_dias_despendido').trigger('change');
        _parent.find('#manPauseAtividade').unbind().on('click', function(){
            getPausasAtividadePanel(arrayPausas);
        });
    } else {
        tempo_pausado.val(0);
        if (typeof tempo_despendido.data('tempo-geral') !== 'undefined') { tempo_despendido.val(tempo_despendido.data('tempo-geral')) }
        tempo_pausado.closest('tr').hide();
    }
    return totalPausas;
}
function getLabelTempoDespendido() {
    var _parent = $('#boxAtividade.atividadeWork');
    var tempo_despendido = _parent.find('#ativ_tempo_despendido');
    if (tempo_despendido.length > 0) {
        var tempo_decimal = (typeof tempo_despendido.data('tempo-decimal') !== 'undefined') ? tempo_despendido.data('tempo-decimal') : tempo_despendido.val();
        _parent.find('.td_tempo_despendido').attr('data-tempo',decimalHourToMinute(tempo_decimal));
    }
}
function getPausasAtividade(id_demanda) {
    var action = 'pause_atividade_lista';
    var param = {
        action: action, 
        id_demanda: id_demanda
    };
    getServerAtividades(param, action);
}
function removePausasAtividade(this_) {
    var _this = $(this_);
    var _parent = _this.closest('tr');
        _parent.slideUp();
    var data = _parent.data();
    var action = 'pause_atividade_remove';
    var param = {
        action: action, 
        id_demanda: data.demanda,
        id_pausa: data.pausa
    };
    getServerAtividades(param, action);
}
function getPausasAtividadePanel(value, arrayPausas, totalDespendido) {
    var pausa_lista = value.pausa_lista;
    var textBox =   '<table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                    '      <tbody>'+
                    '           <tr>'+
                    '               <td class="date" style="width: 205px;">'+
                    '                   <i class="iconSwitch fas fa-play-circle cinzaColor" style="height: 20px;float: initial;"></i> Data de In\u00EDcio<br>'+
                    '                   <input type="datetime-local" style="width: 180px;" value="'+$('#ativ_data_inicio').val()+'" disabled required>'+
                    '               </td>'+
                    '               <td style="width: 60px;"></td>'+
                    '               <td></td>'+
                    '               <td></td>'+
                    '           </tr>';
    $.each(pausa_lista, function(i, v){
        textBox +=  
                    '           <tr>'+
                    '               <td></td>'+
                    '               <td>'+
                    '                   <div style="text-align:center;position: absolute;width: 70px; margin: 0 0 0 -20px;z-index: 9;">'+
                    '                       <span style="color: #666;background: #f3f3f3;padding: 5px;border-radius: 5px;">'+decimalHourToMinute(arrayPausas[i].tempo_trabalho)+'</span>'+
                    '                   </div>'+
                    '                   <div class="hrTempoDir"></div>'+
                    '               </td>'+
                    '               <td></td>'+
                    '               <td></td>'+
                    '           </tr>'+
                    '           <tr>'+
                    '               <td></td>'+
                    '               <td></td>'+
                    '               <td class="date" style="text-align: right;">'+
                    '                   <i class="iconSwitch fas fa-pause-circle cinzaColor" style="height: 20px;"></i> Paralisa\u00E7\u00E3o<br>'+
                    '                   <input type="datetime-local" style="width: 180px;" id="ativ_data_pausa" data-key="data_pause" data-type="inicio" data-name="data de '+__.paralisacao+'" value="'+moment(v.data_inicio).format('YYYY-MM-DDTHH:mm')+'" disabled required>'+
                    '               </td>'+
                    '               <td></td>'+
                    '           </tr>'+
                    '           <tr data-pausa="'+v.id_pausa+'" data-demanda="'+value.id_demanda+'">'+
                    '               <td></td>'+
                    '               <td>'+
                    '                   <div style="text-align:center;position: absolute;width: 70px; margin: 0 0 0 -20px;z-index: 9;">'+
                    '                       <span style="color: #666;background: #f3f3f3;padding: 5px;border-radius: 5px;">00:00</span>'+
                    '                   </div>'+
                    '                   <div class="hrTempoEsq"></div>'+
                    '               </td>'+
                    '               <td></td>'+
                    '               <td style="width: 70px;">'+
                    '                   <div style="right: 10px;position: absolute;">'+
                    '                       <button type="button" onclick="removePausasAtividade(this)" class="ui-button ui-corner-all ui-widget"><i class="fas fa-trash cinzaColor" style="font-size: 10pt;"></i></button>'+
                    '                   </div>'+
                    '               </td>'+
                    '           </tr>'+
                    '           <tr>'+
                    '               <td class="date">'+
                    '                   <i class="iconSwitch fas fa-play-circle cinzaColor" style="height: 20px;float: initial;"></i> Retomada<br>'+
                    '                   <input type="datetime-local" style="width: 180px;" id="ativ_data_retomada" data-key="data_entrega" data-type="fim" data-name="data de '+__.retomada+'" value="'+moment(v.data_fim).format('YYYY-MM-DDTHH:mm')+'" disabled required>'+
                    '               </td>'+
                    '               <td></td>'+
                    '               <td></td>'+
                    '               <td></td>'+
                    '           </tr>';
    });
        textBox +=   
                    '           <tr>'+
                    '               <td></td>'+
                    '               <td>'+
                    '                   <div style="text-align:center;position: absolute;width: 70px; margin: 0 0 0 -20px;z-index: 9;">'+
                    '                       <span style="color: #666;background: #f3f3f3;padding: 5px;border-radius: 5px;">'+decimalHourToMinute(arrayPausas[arrayPausas.length-1].tempo_trabalho)+'</span>'+
                    '                   </div>'+
                    '                   <div class="hrTempoDir"></div>'+
                    '               </td>'+
                    '               <td></td>'+
                    '               <td></td>'+
                    '           </tr>'+
                    '           <tr>'+
                    '               <td></td>'+
                    '               <td></td>'+
                    '               <td class="date" style="text-align: right;">'+
                    '                   <i class="iconSwitch fas fa-user-clock cinzaColor" style="height: 20px;"></i> Data de Entrega<br>'+
                    '                   <input type="datetime-local" style="width: 180px;" value="'+$('#ativ_data_entrega').val()+'" disabled required>'+
                    '               </td>'+
                    '               <td></td>'+
                    '           </tr>'+
                    '           <tr style="height: 40px;">'+
                    '               <td colsan="4">'+
                    '                   <div style="text-align:center;position: absolute;width: 98%; margin: 0 0 0 -20px;z-index: 9;">'+
                    '                       <span style="display: block;height: 25px;">Tempo despendido</span>'+
                    '                       <span style="color: #666;background: #f3f3f3;padding: 5px;border-radius: 5px;">'+decimalHourToMinute(totalDespendido)+'</span>'+
                    '                   </div>'+
                    '               </td>'+
                    '           </tr>'+
                    '      </tbody>'+
                     '</table>';

        resetDialogBoxPro('alertBoxPro');
        alertBoxPro = $('#alertaBoxPro')
            .html('<div class="dialogBoxDiv" style="max-height: 500px;"> '+textBox+'</span>')
            .dialog({
                width: 570,
                title: 'Gerenciar Paralisa\u00E7\u00F5es',
                close: function() { 
                    getPausasAtividade(value.id_demanda);
                    resetDialogBoxPro('alertBoxPro');
                },
                open: function() { 
                    updateButtonConfirm(this, true);
                    prepareFieldsReplace(this);
                    $('#ativ_data_entrega').trigger('change');
                },
                buttons: [{
                    text: "Ok",
                    class: 'confirm',
                    click: function() {
                        getPausasAtividade(value.id_demanda);
                        resetDialogBoxPro('alertBoxPro');
                    }
                }]
        });
}
function completeCancelAtividade(id_demanda) {
    var value = getAtividadeData(id_demanda);
    if (checkCapacidade('complete_cancel_atividade')) {
        confirmaFraseBoxPro(__.A_demanda+' j\u00E1 foi entregue. Tem certeza que deseja cancelar?', 'CANCELAR', function(){
            var action = 'complete_cancel_atividade';
            var param = {
                action: action, 
                id_demanda: id_demanda,
                id_unidade: value.id_unidade
            };
            getServerAtividades(param, action);
        }, function(){
            cancelMoveKanbanItens();
            cancelSelectedItensAtiv(id_demanda);
        });
    }
}
function getSignCancelDocumento(this_) {
    var _this = $(this_);
    var data = _this.data();
    var paramData = {
        id_documento: data.id_documento,
        mode: data.mode,
        id_reference: data.id_reference
    };
    signCancelDocumento(paramData);
}
function signCancelDocumento(paramData) {
    confirmaFraseBoxPro('Tem certeza que deseja cancelar a assinatura do documento?', 'CANCELAR', function() { 
        var action = 'sign_cancel_documento';
        var param = {
            action: action,
            id_documento: paramData.id_documento,
            mode: paramData.mode,
            id_reference: paramData.id_reference,
            type: paramData.type
        };
        getConfigServer(action, param);
    });
}
function checkPageAtividadesVisualizacao() {
    if (perfilLoginAtiv) {
        waitLoadPro($('#ifrVisualizacao').contents(), '#frmDocumentoCadastro', isNewSEI ? ".barraBotoesSEI" : ".infraBarraComandos", startAtividadeNewDoc);
        waitLoadPro($('#ifrVisualizacao').contents(), '#frmAtividadeListar[action*="acao=procedimento_enviar"]', isNewSEI ? ".barraBotoesSEI" : ".infraBarraComandos", sendAtividadesEnviarProcesso);
    }
}
function startAtividadeNewDoc() {
    var startAtivuser = jmespath.search(arrayAtividadesProcPro, "[?data_inicio=='0000-00-00 00:00:00'] | [?id_user==`"+arrayConfigAtividades.perfil.id_user+"`]");
    if (startAtivuser.length > 0) {
        var htmlTableAtividades = $.map(startAtivuser, function(v,k){ 
                                    var datesAtivHtml = getDatesPreview(getConfigDateAtiv(v));
                                        datesAtivHtml = (datesAtivHtml != '') ? $(datesAtivHtml).find('.dateBoxIcon')[0].outerHTML : '';
                                        datesAtivHtml = (datesAtivHtml != '') ? '<span class="dateboxDisplay" onclick="actionsAtividade('+v.id_demanda+')">'+datesAtivHtml+'</span>' : '';
                                                    return '<div style="margin: 5px 0; display: inline-block; width: 100%;" data-value="'+v.id_demanda+'" title="'+getTitleDialogBox(v, true)+'">'+datesAtivHtml+getTitleDialogBox(v)+'</div>'
                                }).join('');
            htmlTableAtividades =   '<div style="max-height: 300px;overflow-y: scroll;display: block;font-size: 10pt;position: initial;margin-top: 20px;">'+
                                    '   '+htmlTableAtividades+
                                    '</div>'; 

        confirmaBoxPro((startAtivuser.length == 1 ? 'Existe '+__.demanda+' pendente' : 'Existem '+__.demandas+' pendentes')+' de in\u00EDcio. Deseja iniciar agora?'+htmlTableAtividades, function(){ selectAtividadeBox('start') }, 'Iniciar...');
    }
}
function sendAtividadesEnviarProcesso() {
    var sendAtivList = jmespath.search(arrayAtividadesProcPro, "[?data_envio=='0000-00-00 00:00:00'] | [?data_avaliacao!='0000-00-00 00:00:00'] | [?id_unidade==`"+arrayConfigAtivUnidade.id_unidade+"`]");
    // var sendAtivList = jmespath.search(arrayAtividadesProcPro, "[?data_envio=='0000-00-00 00:00:00']");
    
    if (sendAtivList.length > 0) {
        var htmlTableAtividades = $.map(sendAtivList, function(v,k){ 
                                    var datesAtivHtml = getDatesPreview(getConfigDateAtiv(v));
                                        datesAtivHtml = (datesAtivHtml != '') ? $(datesAtivHtml).find('.dateBoxIcon')[0].outerHTML : '';
                                        datesAtivHtml = (datesAtivHtml != '') ? '<span class="dateboxDisplay" onclick="actionsAtividade('+v.id_demanda+')">'+datesAtivHtml+'</span>' : '';
                                                    return '<div style="margin: 5px 0; display: inline-block; width: 100%;" data-value="'+v.id_demanda+'" title="'+getTitleDialogBox(v, true)+'">'+datesAtivHtml+getTitleDialogBox(v)+'</div>'
                                }).join('');
            htmlTableAtividades =   '<div style="max-height: 300px;overflow-y: scroll;display: block;font-size: 10pt;position: initial;margin-top: 20px;">'+
                                    '   '+htmlTableAtividades+
                                    '</div>'; 
        confirmaBoxPro((sendAtivList.length == 1 ? 'Existe '+__.demanda+' pendente' : 'Existem '+__.demandas+' pendentes')+' de '+__.arquivamento+'. Deseja '+__.arquivar+' agora?'+htmlTableAtividades, archiveAtividade, __.Arquivar+'...');
    }
}
function startAtividade(id_demanda = 0) {
    var dadosIfrArvore = getIfrArvoreDadosProcesso();
    var value = getAtividadeData(id_demanda);
    var id_plano_check = checkRegularizaPlano(value);
    if (id_plano_check) {
        regularizaPlano(false, {id_plano: id_plano_check, refplano: 'anterior'});
    } else {
        if (!checkSignDocsPlano(value)) {
            alertSignDocsPlano(value);
        } else {
            var config_unidade = getConfigDadosUnidade(value.sigla_unidade);
            var dataInicio = (dadosIfrArvore) 
                                ? (dadosIfrArvore.versao) 
                                    ? moment(dadosIfrArvore.versao, 'DD/MM/YYYY HH:mm').format(config_unidade.hora_format)
                                    : moment().format(config_unidade.hora_format)
                                : moment().format(config_unidade.hora_format);
                dataInicio = (moment(dataInicio, config_unidade.hora_format) < moment(dataDistribuicao, config_unidade.hora_format)) 
                                ? (moment(dataDistribuicao, config_unidade.hora_format) < moment()) ? moment().format(config_unidade.hora_format) : dataDistribuicao
                                : dataInicio;
            var prazoEntrega = (value.recalcula_prazo == 1) 
                                ? getRecalculaPrazo(dataInicio, config_unidade.hora_format, value.dias_planejado, config_unidade)
                                : '';

            var listAtividadesVinculadas = getAtividadesVinculadas(value, 'iniciadas');

            var listAtividadesIniciadas = (value.id_user != 0) ? jmespath.search(arrayAtividadesPro, "[?data_inicio!='0000-00-00 00:00:00'] | [?data_entrega=='0000-00-00 00:00:00'] | [?data_retomada==null || data_retomada!='0000-00-00 00:00:00'] | [?id_user==`"+value.id_user+"`]") : null;
                listAtividadesIniciadas = (listAtividadesIniciadas !== null) ? listAtividadesIniciadas : false;
            if (listAtividadesIniciadas && listAtividadesIniciadas.length > 0) {
                var htmlTableAtividades = $.map(listAtividadesIniciadas, function(v,k){ 
                                            var datesAtivHtml = getDatesPreview(getConfigDateAtiv(v));
                                                datesAtivHtml = (datesAtivHtml != '') ? $(datesAtivHtml).find('.dateBoxIcon')[0].outerHTML : '';
                                                datesAtivHtml = (datesAtivHtml != '') ? '<span class="dateboxDisplay" onclick="actionsAtividade('+v.id_demanda+')">'+datesAtivHtml+'</span>' : '';
                                                            return '<div style="margin: 5px 0; display: inline-block; width: 100%;" data-value="'+v.id_demanda+'" title="'+getTitleDialogBox(v, true)+'">'+datesAtivHtml+getTitleDialogBox(v)+'</div>'
                                        }).join('');
                    htmlTableAtividades =   '<div id="listPauseOtherAtiv" style="max-height: 300px;overflow-y: scroll;display: none;font-size: 10pt;position: initial;">'+
                                            '   '+htmlTableAtividades+
                                            '</div>'; 
                var inputPauseOthers = jmespath.search(listAtividadesIniciadas,"[*].{id: id_demanda, id_unidade: id_unidade}");
                    inputPauseOthers = (inputPauseOthers !== null) ? "<input type='hidden' id='lista_pause_others' data-key='lista_pause_others' data-param='lista_pause_others' value='"+JSON.stringify(inputPauseOthers)+"'>" : '';
            } else {
                var inputPauseOthers = '';
                var htmlTableAtividades = '';
            }

            var dataDistribuicao_vinculadas = (listAtividadesVinculadas.length_check > 0) ? jmespath.search(arrayAtividadesPro, "reverse(sort_by([?id_vinculacao=='"+value.id_vinculacao+"'] | [?data_inicio=='0000-00-00 00:00:00'], &data_distribuicao)) | [*].data_distribuicao | [0]") : null;
            var dataDistribuicao = (dataDistribuicao_vinculadas !== null) ? moment(dataDistribuicao_vinculadas, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format) : moment(value.data_distribuicao, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format);

            var optionSelectResponsavel = '';
            if (checkCapacidade('select_user_atividade') && value.id_user == 0) {
                var arrayResp = jmespath.search(arrayConfigAtividades.planos, "[?sigla_unidade=='"+value.sigla_unidade+"']");
                optionSelectResponsavel += getOptionsSelectResp(arrayResp, value);
            }
            // console.log(checkCapacidade('select_user_atividade'), value.id_user, optionSelectResponsavel);
            var htmlSelectResponsavel = (optionSelectResponsavel != '')
                    ?   '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left; width: 140px;" class="label">'+
                        '               <label for="ativ_id_user"><i class="iconPopup iconSwitch fas fa-user-tie cinzaColor"></i>Respons\u00E1vel:</label>'+
                        '           </td>'+
                        '           <td class="required date">'+
                        '               <select id="ativ_id_user" class="requiredSelect" data-key="id_user" onchange="" required><option>&nbsp;</option>'+optionSelectResponsavel+'</select>'+
                        '           </td>'+
                        '      </tr>'
                    : '';

            var htmlBox =   '<div id="boxAtividade" class="atividadeWork" data-demanda="'+(value && value.id_demanda ? value.id_demanda : 0)+'">'+
                            '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                            '      '+htmlSelectResponsavel+
                            '      <tr>'+
                            '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                            '               <label for="ativ_data_inicio"><i class="iconPopup iconSwitch fas fa-play-circle cinzaColor"></i>Data de In\u00EDcio '+__.da_Demanda+':</label>'+
                            '           </td>'+
                            '           <td class="required date">'+
                            '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="checkSigleInputDateAtiv(this); updateRecalculaPrazo(this);" id="ativ_data_inicio" data-key="data_inicio" data-type="inicio" data-name="data de in\u00EDcio" data-name-min="data de distribui\u00E7\u00E3o" value="'+dataInicio+'" min="'+dataDistribuicao+'" required>'+
                            '           </td>'+
                            '      </tr>'+
                            (listAtividadesIniciadas && listAtividadesIniciadas.length > 0 ? 
                            '      <tr>'+
                            '           <td colspan="2">'+
                            '               '+inputPauseOthers+
                            '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="text-align: left;">'+
                            '                           <label><i class="iconPopup fas fa-pause-circle cinzaColor"></i> '+(listAtividadesIniciadas.length > 1 ? __.Paralisar+' '+getNameGenre('demanda', 'os', 'as')+' '+listAtividadesIniciadas.length+' '+__.demandas+' j\u00E1 '+getNameGenre('demanda', 'iniciados', 'iniciadas') : __.Paralisar+' '+__.a_demanda+' j\u00E1 '+getNameGenre('demanda', 'iniciado', 'iniciada'))+' '+(arrayConfigAtividades.perfil.id_user != value.id_user ? 'por '+value.apelido : 'por mim')+'?</label>'+
                            '                      </td>'+
                            '                      <td>'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" data-target="#listPauseOtherAtiv" onchange="changeOthersAtiv(this)" class="onoffswitch-checkbox singleOptionConfig" id="pause_others" data-key="pause_others" tabindex="0">'+
                            '                              <label class="onoffswitch-label" for="pause_others"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: auto;">'+
                            '                      <td colspan="2">'+
                            '                           '+htmlTableAtividades+
                            '                      </td>'+
                            '                  </tr>'+
                            '               </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '' : '')+
                            (value.recalcula_prazo == 1 ? 
                            '      <tr>'+
                            '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                            '               <label for="ativ_prazo_entrega"><i class="iconPopup iconSwitch fas fa-business-time cinzaColor"></i>Prazo de Entrega (Recalculado):</label>'+
                            '           </td>'+
                            '           <td class="required date">'+
                            '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" id="ativ_prazo_entrega" data-dias-planejado="'+value.dias_planejado+'" data-dias-uteis="'+config_unidade.count_dias_uteis+'" data-format-date="'+config_unidade.hora_format+'" data-key="prazo_entrega" value="'+prazoEntrega+'" required disabled>'+
                            '           </td>'+
                            '      </tr>'+
                            '' : '')+
                            (listAtividadesVinculadas.length_check > 0 ? 
                            '      <tr>'+
                            '           <td colspan="2">'+
                            '               '+listAtividadesVinculadas.input+
                            '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                            '                  <tr style="height: 40px;">'+
                            '                      <td style="vertical-align: bottom; text-align: left;" class="label">'+
                            '                           <label for="init_others"><i class="iconPopup fas fa-play-circle cinzaColor"></i> '+(listAtividadesVinculadas.length_check > 1 ? 'Iniciar '+getNameGenre('demanda', 'os outros', 'as outras')+' '+listAtividadesVinculadas.length_check+' '+__.demandas+' '+getNameGenre('demanda', 'vinculados', 'vinculadas') : 'Iniciar '+__.a_outra_demanda_vinculada)+'?</label>'+
                            '                      </td>'+
                            '                      <td style="width: 50px;">'+
                            '                          <div class="onoffswitch" style="float: right;">'+
                            '                              <input type="checkbox" name="onoffswitch" data-target="#listInitOtherAtiv" data-id_demanda="'+value.id_demanda+'" onchange="changeOthersAtiv(this)" class="onoffswitch-checkbox singleOptionConfig" id="init_others" data-key="init_others" tabindex="0" checked>'+
                            '                              <label class="onoffswitch-label" for="init_others"></label>'+
                            '                          </div>'+
                            '                      </td>'+
                            '                  </tr>'+
                            '                  <tr style="height: auto;">'+
                            '                      <td colspan="2">'+
                            '                           '+listAtividadesVinculadas.html+
                            '                      </td>'+
                            '                  </tr>'+
                            '               </table>'+
                            '           </td>'+
                            '      </tr>'+
                            '' : '')+
                            '   </table>'+
                            '</div>';

            var btnDialogBoxPro =   [{
                text: 'Iniciar',
                class: 'confirm',
                click: function(event) { 
                    if (checkSigleInputDateAtiv_(this)) {
                        if (checkAtivRequiredFields(this, 'mark')) {
                            var _parent = $(this).closest('.ui-dialog');
                            var data_inicio = moment(_parent.find('#ativ_data_inicio').val(), config_unidade.hora_format).format('YYYY-MM-DD HH:mm:ss');
                            var prazo_entrega = (_parent.find('#ativ_prazo_entrega').length > 0) 
                                                ? moment(_parent.find('#ativ_prazo_entrega').val(), config_unidade.hora_format).format('YYYY-MM-DD HH:mm:ss')
                                                : false;
                            var id_user = (checkCapacidade('select_user_atividade') && value.id_user == 0) 
                                                ? _parent.find('#ativ_id_user').val() 
                                                : (value.id_user == 0) 
                                                    ? parseInt(arrayConfigAtividades.perfil.id_user)
                                                    : value.id_user;
                                id_user = (id_user == 0 || typeof id_user === 'undefined') ? parseInt(arrayConfigAtividades.perfil.id_user) : id_user;

                            var id_demandas_pause = (listAtividadesIniciadas && listAtividadesIniciadas.length > 0 && _parent.find('#pause_others').is(':checked')) 
                                                    ? JSON.parse(_parent.find('#lista_pause_others').val())
                                                    : [];
                            var id_demandas_init = (listAtividadesVinculadas && listAtividadesVinculadas.length_check > 0 && _parent.find('#init_others').is(':checked')) 
                                                    ? JSON.parse(_parent.find('#lista_init_others').val())
                                                    : [];
                            var action = 'start_atividade';
                            var id_plano = jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+id_user+"`] | [0].id_plano");
                                id_plano = (id_plano === null) ? 0 : id_plano;
                                
                            var param = {
                                            id_demanda: value.id_demanda, 
                                            id_demandas_pause: id_demandas_pause, 
                                            id_demandas_init: id_demandas_init, 
                                            id_user: id_user, 
                                            id_plano: id_plano, 
                                            id_unidade: value.id_unidade, 
                                            data_inicio: data_inicio, 
                                            prazo_entrega: prazo_entrega, 
                                            action: action
                                        };
                            getServerAtividades(param, action);
                        }
                    }
                }
            }];

            if (checkCapacidade('edit_atividade')) {
                btnDialogBoxPro.unshift({
                    text: 'Editar '+__.Demanda,
                    icon: 'ui-icon-pencil',
                    click: function(event) { 
                        saveAtividade(id_demanda);
                    }
                });
            }

            if (checkCapacidade('start_atividade')) {
                resetDialogBoxPro('dialogBoxPro');
                dialogBoxPro = $('#dialogBoxPro')
                    .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
                    .dialog({
                        title: 'Iniciar '+__.Demanda+': '+getTitleDialogBox(value),
                        width: 550,
                        open: function() { 
                            updateButtonConfirm(this, true);
                            checkSigleInputDateAtiv_(this);
                            prepareFieldsReplace(this);
                        },
                        close: function() { 
                            $('#boxAtividade').remove();
                            cancelMoveKanbanItens();
                            cancelSelectedItensAtiv(id_demanda);
                            resetDialogBoxPro('dialogBoxPro');
                        },
                        buttons: btnDialogBoxPro
                });
            }
        }
    }
}
function alertSignDocsPlano(value) {
    confirmaBoxPro('Plano de Trabalho pendente de assinatura! Deseja assinar agora?', function(){
        initClassicEditor();
        var plano = jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+value.id_user+"`] | [0]");
        var _this = '<a data-type="planos" data-sign="true" data-user="'+value.id_user+'" data-id_reference="'+plano.id_plano+'" data-icon="pencil-alt" data-action="view" data-mode="modelo_termo_adesao" data-title="Termo de Ades\u00E3o" onclick="editModelConfigItem(this)">';
            _this = $(_this).get(0);
            editModelConfigItem(_this);
    }, 'Visualizar Termo');
}
function checkRegularizaPlano(value) {
    var plano = jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+value.id_user+"`] | [0]");
    var assinatura = (value.id_user != 0 && typeof plano !== 'undefined' && plano !== null && typeof plano.config !== 'undefined' && plano.config !== null && typeof plano.config.assinatura !== 'undefined' && plano.config.hasOwnProperty('assinatura')) ? plano.config.assinatura : false;
    if (value.id_user != 0 && !assinatura && typeof plano !== 'undefined' && plano !== null && plano.vigencia && plano.pendencias_plano && plano.pendencias_plano.anterior && !plano.pendencias_plano.anterior.homologavel) {
        return plano.id_plano;
    } else {
        return false;
    }
}
function checkSignDocsPlano(value) {
    var plano = jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+value.id_user+"`] | [0]");
    var modalidade = (plano !== null && plano.hasOwnProperty('id_tipo_modalidade')) ? jmespath.search(arrayConfigAtividades.tipos_modalidades,"[?id_tipo_modalidade==`"+plano.id_tipo_modalidade+"`] | [0]") : null;
    var require_sign = (modalidade !== null && modalidade.hasOwnProperty('config') && typeof modalidade.config !== 'undefined' && modalidade.config !== null && modalidade.config.hasOwnProperty('exige_assinatura')) ? modalidade.config.exige_assinatura : false;
    var assinatura =  (plano !== null && plano.hasOwnProperty('config') && typeof plano.config !== 'undefined' && plano.config !== null && typeof plano.config.assinatura !== 'undefined' && plano.config.hasOwnProperty('assinatura')) ? plano.config.assinatura : false;
    return (!require_sign || (require_sign && assinatura)) ? true : false;
}
function getAtividadesVinculadas(value, mode) {
    var queryDemandas = (mode == 'iniciadas') ? "| [?data_inicio=='0000-00-00 00:00:00']" : "";
        queryDemandas = (mode == 'concluidas' || mode == 'pausadas') ? "| [?data_inicio!='0000-00-00 00:00:00'] | [?data_entrega=='0000-00-00 00:00:00'] | [?data_retomada!='0000-00-00 00:00:00']" : queryDemandas;
        queryDemandas = (mode == 'avaliadas') ? "| [?data_entrega!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00']" : queryDemandas;
        queryDemandas = (mode == 'retomadas') ? "| [?data_inicio!='0000-00-00 00:00:00'] | [?data_entrega=='0000-00-00 00:00:00'] | [?data_retomada=='0000-00-00 00:00:00']" : queryDemandas;

    var label = (mode == 'iniciadas') ? {input: 'lista_init_others', list_id: 'listInitOtherAtiv'} : '';
        label = (mode == 'concluidas') ? {input: 'lista_complete_others', list_id: 'listCompleteOtherAtiv'} : label;
        label = (mode == 'avaliadas') ? {input: 'lista_rate_others', list_id: 'listRateOtherAtiv'} : label;
        label = (mode == 'pausadas' || mode == 'retomadas') ? {input: 'lista_pause_others', list_id: 'listPauseOtherAtiv'} : label;


    var arrayAtividades = ($('#ifrArvore').length > 0) ? arrayAtividadesProcPro : arrayAtividadesPro;

    var listAtividadesVinculadas = (typeof value.id_user !== 'undefined' && value.id_user !== null && value.id_user != 0 && typeof value.id_vinculacao !== 'undefined' && value.id_vinculacao !== null) ? jmespath.search(arrayAtividades, "[?id_vinculacao=='"+value.id_vinculacao+"'] "+queryDemandas+" | [?id_demanda!=`"+value.id_demanda+"`]") : null;
    var checkAtividadesVinculadas = (listAtividadesVinculadas !== null && listAtividadesVinculadas.length> 0) ? true : false;
    if (checkAtividadesVinculadas) {
        var htmlTableAtiv = $.map(listAtividadesVinculadas, function(v,k){ 
                                    var datesAtivHtml = getDatesPreview(getConfigDateAtiv(v));
                                        datesAtivHtml = (datesAtivHtml != '') ? $(datesAtivHtml).find('.dateBoxIcon')[0].outerHTML : '';
                                        datesAtivHtml = (datesAtivHtml != '') ? '<span class="dateboxDisplay" onclick="actionsAtividade('+v.id_demanda+')">'+datesAtivHtml+'</span>' : '';
                                                    return '<div style="margin: 5px 0; display: inline-block; width: 100%;" data-value="'+v.id_demanda+'" title="'+getTitleDialogBox(v, true)+'">'+datesAtivHtml+getTitleDialogBox(v)+'</div>'
                                }).join('');
            htmlTableAtiv =   '<div id="'+label.list_id+'" style="max-height: 300px;overflow-y: scroll;font-size: 9pt;position: initial;">'+
                                    '   '+htmlTableAtiv+
                                    '</div>'; 
        var inputOthers = jmespath.search(listAtividadesVinculadas,"[*].{id: id_demanda, id_unidade: id_unidade}");
            inputOthers = (inputOthers !== null) ? "<input type='hidden' id='"+label.input+"' data-key='"+label.input+"' data-param='"+label.input+"' value='"+JSON.stringify(inputOthers)+"'>" : '';
        var lengtOthers = listAtividadesVinculadas.length;
    } else {
        var inputOthers = '';
        var htmlTableAtiv = '';
        var lengtOthers = 0;
    }
    return {input: inputOthers, html: htmlTableAtiv, length_check: lengtOthers};
}
function changeOthersAtiv(this_, target) {
    var _this = $(this_);
    var target = _this.data('target');
    var _parent = _this.closest('.ui-dialog');
    if (_this.is(':checked')) {
        _parent.find(target).show();
    } else {
        _parent.find(target).hide();
    }
    if (_this.attr('id') == 'init_others') {
        var id_demanda = _this.data('id_demanda');
        var value = getAtividadeData(id_demanda);
        var config_unidade = getConfigDadosUnidade(value.sigla_unidade);
        var dataDistribuicao_vinculadas = (value.id_vinculacao !== null) ? jmespath.search(arrayAtividadesPro, "reverse(sort_by([?id_vinculacao=='"+value.id_vinculacao+"'] | [?data_inicio=='0000-00-00 00:00:00'], &data_distribuicao)) | [*].data_distribuicao | [0]") : null;
        var dataDistribuicao = (dataDistribuicao_vinculadas !== null && _this.is(':checked')) ? moment(dataDistribuicao_vinculadas, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format) : moment(value.data_distribuicao, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format);
        _parent.find('#ativ_data_inicio').attr('min', dataDistribuicao);
    }
}
function pauseOthersAtiv(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    if (_this.is(':checked')) {
        _parent.find('#listPauseOtherAtiv').show();
    } else {
        _parent.find('#listPauseOtherAtiv').hide();
    }
}
function updateRecalculaPrazo(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    var inputPrazoEntrega =  _parent.find('#ativ_prazo_entrega');
    var sigla_unidade = (typeof _parent.find('#ativ_id_user').data('config') !== 'undefined') ? _parent.find('#ativ_id_user').data('config').sigla_unidade : null;
    var config_unidade = getConfigDadosUnidade(sigla_unidade);
    if (inputPrazoEntrega.length > 0) {
        // var hora_format = inputPrazoEntrega.data('format-date');
        // var count_dias_uteis = inputPrazoEntrega.data('dias-uteis');
        // var dias_planejado = parseFloat(inputPrazoEntrega.data('dias-planejado'));
        // var arrayFeriados = (count_dias_uteis) 
                                // ? jmespath.search(getHolidayBetweenDates(moment(_this.val(), hora_format).format('Y')+'-01-01', moment(_this.val(), hora_format).add(1, 'Y').format('Y')+'-01-01'), "[*].d_")
                                // : [];
        // console.log(dias_planejado, count_dias_uteis, arrayFeriados);
        var prazoEntrega = getRecalculaPrazo(_this.val(), inputPrazoEntrega.data('format-date'), parseFloat(inputPrazoEntrega.data('dias-planejado')), config_unidade);
            inputPrazoEntrega.val(prazoEntrega);
    }
}
function getRecalculaPrazo(data_ref, hora_format, prazo, config_unidade) {
    var workday = config_unidade.count_dias_uteis;
    var config_feriados = (typeof config_unidade.feriados !== 'undefined' && config_unidade.feriados !== null) ? config_unidade.feriados : false;
    var arrayFeriados = (workday) 
                        ? jmespath.search(getHolidayBetweenDates(moment(data_ref, hora_format).format('Y')+'-01-01', moment(data_ref, hora_format).add(1, 'Y').format('Y')+'-01-01', config_feriados), "[*].d_")
                        : [];

    var prazoEntrega = (workday)   
                        ? moment(data_ref, hora_format).isoAddWeekdaysFromSet({  
                            'workdays': prazo,  
                            'weekdays': [1,2,3,4,5],  
                            'exclusions': arrayFeriados
                            }).format(hora_format)
                        : moment(data_ref, hora_format).add(prazo, 'd').format(hora_format);
    return prazoEntrega;
}
function pauseAtividade(id_demanda) {
    var value = getAtividadeData(id_demanda);
    var check_ispaused = (typeof value.data_retomada !== 'undefined' && value.data_retomada !== null && value.data_retomada == '0000-00-00 00:00:00') ? true : false;
    var check_isresumed = (typeof value.data_retomada !== 'undefined' && value.data_retomada !== null && value.data_retomada != '0000-00-00 00:00:00') ? true : false;
    // console.log('check_ispaused->',check_ispaused, 'check_isresumed->',check_isresumed);

    var config_unidade = getConfigDadosUnidade(value.sigla_unidade);
    var dataInicio = (check_ispaused) 
                        ? moment(value.data_pausa, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format)
                        : (check_isresumed)
                            ? moment(value.data_retomada, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format)
                            : moment(value.data_inicio, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format);
    var dataPausa = moment().format(config_unidade.hora_format);
    var txtTitle = (check_ispaused) ? __.Retomar : __.Paralisar;

    var listAtividadesVinculadas = getAtividadesVinculadas(value, (check_ispaused ? 'retomadas' : 'pausadas'));

    var htmlBox =   '<div id="boxAtividade" class="atividadeWork" data-demanda="'+value.id_demanda+'">'+
                    '   <div style="font-size: 10pt; margin: 10px 0;" class="alertaBoxDisplay">'+
                    '       <i class="fas fa-info-circle azulColor" style="margin: 0 5px;"></i>Dica: N\u00E3o \u00E9 necess\u00E1rio '+__.paralisar+' '+__.a_demanda+' entre as jornadas de trabalho!'+
                    '   </div>'+
                    '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                    '      <tr>'+
                    '          <td style="vertical-align: bottom; text-align: left; width: 150px;" class="label">'+
                    '               <label for="ativ_data_pausa"><i class="iconPopup iconSwitch fas fa-'+(check_ispaused ? 'play' : 'pause')+'-circle cinzaColor"></i>Data de '+(check_ispaused ? 'Retomada' : __.Paralisacao)+' '+__.da_Demanda+':</label>'+
                    '           </td>'+
                    '           <td class="required date">'+
                    '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="checkSigleInputDateAtiv(this)" id="ativ_data_pausa" data-key="data_pausa" data-type="inicio" data-name="data de '+(check_ispaused ? __.retomada : __.paralisacao)+'" data-name-min="data de '+(check_ispaused ? __.paralisacao : (check_isresumed ? __.retomada : 'in\u00EDcio'))+'" value="'+dataPausa+'" min="'+dataInicio+'" required>'+
                    '           </td>'+
                    '      </tr>'+
                    (listAtividadesVinculadas.length_check > 0 ? 
                    '      <tr>'+
                    '           <td colspan="2">'+
                    '               '+listAtividadesVinculadas.input+
                    '               <table style="font-size: 10pt;width: 100%; margin: 10px 0;" class="seiProForm">'+
                    '                  <tr style="height: 40px;">'+
                    '                      <td style="vertical-align: bottom; text-align: left;" class="label">'+
                    '                           <label for="pause_others"><i class="iconPopup fas fa-'+(check_ispaused ? 'play' : 'pause')+'-circle cinzaColor"></i> '+(listAtividadesVinculadas.length_check > 1 ? txtTitle+' '+getNameGenre('demanda', 'os outros', 'as outras')+' '+listAtividadesVinculadas.length_check+' '+__.demandas+' '+getNameGenre('demanda', 'vinculados', 'vinculadas') : txtTitle+' '+__.a_outra_demanda_vinculada)+'?</label>'+
                    '                      </td>'+
                    '                      <td style="width: 50px;">'+
                    '                          <div class="onoffswitch" style="float: right;">'+
                    '                              <input type="checkbox" name="onoffswitch" data-target="#listPauseOtherAtiv" onchange="changeOthersAtiv(this)" class="onoffswitch-checkbox singleOptionConfig" id="pause_others" data-key="pause_others" tabindex="0" checked>'+
                    '                              <label class="onoffswitch-label" for="pause_others"></label>'+
                    '                          </div>'+
                    '                      </td>'+
                    '                  </tr>'+
                    '                  <tr style="height: auto;">'+
                    '                      <td colspan="2">'+
                    '                           '+listAtividadesVinculadas.html+
                    '                      </td>'+
                    '                  </tr>'+
                    '               </table>'+
                    '           </td>'+
                    '      </tr>'+
                    '' : '')+
                    '   </table>'+
                    '</div>';

    if (checkCapacidade('pause_atividade') && value !== null) {
        resetDialogBoxPro('dialogBoxPro');
        dialogBoxPro = $('#dialogBoxPro')
            .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
            .dialog({
                title: txtTitle+' '+__.Demanda+': '+getTitleDialogBox(value),
                width: 550,
                open: function() { 
                    updateButtonConfirm(this, true);
                    checkSigleInputDateAtiv_(this);
                    prepareFieldsReplace(this);
                },
                close: function() { 
                    $('#boxAtividade').remove();
                    cancelMoveKanbanItens();
                    cancelSelectedItensAtiv(id_demanda);
                    resetDialogBoxPro('dialogBoxPro');
                },
                buttons: [{
                    text: txtTitle,
                    class: 'confirm',
                    click: function(event) { 
                        if (checkSigleInputDateAtiv_(this)) {
                            var _this = $(this);
                            var _parent = _this.closest('.ui-dialog');
                            var data_pausa = moment(_this.closest('.ui-dialog').find('#ativ_data_pausa').val(), config_unidade.hora_format).format('YYYY-MM-DD HH:mm:ss');
                            var id_demandas_pause = (listAtividadesVinculadas.length_check > 0 && _parent.find('#pause_others').is(':checked')) 
                                                    ? JSON.parse(_parent.find('#lista_pause_others').val())
                                                    : [];
                            var action = 'pause_atividade';
                            var param = {
                                            id_demanda: value.id_demanda, 
                                            id_demandas_pause: id_demandas_pause, 
                                            data_pausa: data_pausa, 
                                            action: action
                                        };
                            getServerAtividades(param, action);
                        }
                    }
                }]
        });
    }
}
function variationAtividade(id_demanda, alertAtividade = false) {
    var value = getAtividadeData(id_demanda);
    if (checkCapacidade('variation_atividade') || checkCapacidade('type_atividade') ) {
        var config_unidade = getConfigDadosUnidade(value.sigla_unidade);

        var arrayOptionAtiv = jmespath.search(arrayConfigAtividades.atividades, "[?id_atividade==`"+value.id_atividade+"`].{sigla_unidade: sigla_unidade, id_unidade: id_unidade, dias_planejado: dias_planejado, tempo_pactuado: tempo_pactuado, complexidade: config.complexidade, etiqueta: config.etiqueta.lista, tipo_processo: config.tipo_processo} | [0]");
        var checkEmptyAtiv = (arrayOptionAtiv == null || arrayOptionAtiv.length == 0 || value.id_atividade == 0 || value.tempo_pactuado == 0) ? true : false;
        if (checkEmptyAtiv || checkCapacidade('type_atividade') ) {
            // alertaBoxPro('Error', 'exclamation-triangle', 'Atividade inativa ou inexistente. Reative-a para prosseguir.');
            var optionAtiv = '';
            var optionSelectComplexidade = '';
            var arrayTabelaAtividades = arrayConfigAtividades.atividades;
            var unidades =  (typeof arrayConfigAtividades.atividades !== 'undefined' && arrayConfigAtividades.atividades != 0 && arrayConfigAtividades.atividades.length > 0) 
                            ? uniqPro(jmespath.search(arrayConfigAtividades.atividades, "[?sigla_unidade].sigla_unidade"))
                            : [];
            var countUnidades = (arrayConfigAtividades.atividades.length > 0) ? unidades.length : 0;
            if (countUnidades > 1) {
                $.each(unidades, function(index, v){
                    var arrayAtiv = jmespath.search(arrayTabelaAtividades, "[?sigla_unidade=='"+v+"']");
                    optionAtiv +=   '<optgroup label="'+v+'">'+
                                                '   '+getOptionsSelectAtivGroup(arrayAtiv, value, true)+
                                                '</optgroup>';
                });
            } else {
                optionAtiv += getOptionsSelectAtivGroup(arrayTabelaAtividades, value, true);
            }
            var selectAtiv =    '               <select id="ativ_id_atividade" onchange="changeAtivSelect(this);checkTempoProdutividade($(this));" data-key="id_atividade" style="width: 100%;" required>'+
                                '                   <option>&nbsp;</option>'+
                                '                   '+optionAtiv+
                                '               </select>';
        } else {
            var tempo_pactuado_display = (arrayOptionAtiv.complexidade.length > 0) ? jmespath.search(arrayOptionAtiv.complexidade, "[?default==`true`].fator | [0]") : null;
                tempo_pactuado_display = (tempo_pactuado_display !== null) ? tempo_pactuado_display*value.tempo_pactuado : value.tempo_pactuado;
            var tempo_pactuado_display_ = parseFloat(tempo_pactuado_display.toFixed(2)); value.hasOwnProperty
            
            // console.log(id_demanda, arrayOptionAtiv, arrayOptionAtiv.complexidade.length, jmespath.search(arrayOptionAtiv.complexidade, "[?default==`true`].fator | [0]"), value.tempo_pactuado, tempo_pactuado_display, tempo_pactuado_display_);

            var optionAtiv = (optionAtiv !== null) ? "<option value='"+value.id_atividade+"' data-config='"+JSON.stringify(arrayOptionAtiv)+"'>"+value.nome_atividade+" ["+(tempo_pactuado_display_)+" "+(tempo_pactuado_display > 1 ? 'horas' : 'hora')+"]</option>" : '';
            var arrayOptionUser = jmespath.search(arrayConfigAtividades.planos, "[?id_user==`"+value.id_user+"`].{id_plano: id_plano, sigla_unidade: sigla_unidade, nome_modalidade: nome_modalidade, carga_horaria: carga_horaria} | [0]");

            var optionSelectComplexidade = ( arrayOptionAtiv && arrayOptionAtiv.complexidade.length > 0 ) 
                    ? $.map(arrayOptionAtiv.complexidade, function(v,k){ 
                        var selected = (parseFloat(value.fator_complexidade) == parseFloat(v.fator)) ? 'selected' : '';
                        // console.log(selected, parseFloat(value.fator_complexidade), parseFloat(v.fator), v.complexidade);

                        var tempo_pactuado_fator = (typeof arrayOptionAtiv.tempo_pactuado !== 'undefined' && typeof v.fator !== 'undefined' && arrayOptionAtiv.tempo_pactuado > 0 && v.fator > 0) ? (arrayOptionAtiv.tempo_pactuado * v.fator) : false;
                        var tempo_pactuado_fator_display = (tempo_pactuado_fator) 
                                                        ? (tempo_pactuado_fator < 1) ? parseFloat(tempo_pactuado_fator.toFixed(3)) : parseFloat(tempo_pactuado_fator.toFixed(1))
                                                        : false;
                            tempo_pactuado_fator_display = (tempo_pactuado_fator_display) ? " ["+tempo_pactuado_fator_display+" "+(tempo_pactuado_fator > 1 ? 'horas' : 'hora')+"]" : '';
                        return "<option value='"+v.fator+"' "+selected+">"+unicodeToChar(v.complexidade)+tempo_pactuado_fator_display+"</option>";
                    }).join('') : '<option>&nbsp;</option>';

            var selectAtiv =    '               <select id="ativ_id_atividade" data-key="id_atividade" style="width: 100%;" required disabled>'+
                                '                   '+optionAtiv+
                                '               </select>';
        }
        var optionUser = (optionUser !== null) ? "<option value='"+value.id_user+"' data-config='"+JSON.stringify(arrayOptionUser)+"'>"+value.apelido+"</option>" : '';
        var htmlAlertAtividade = (alertAtividade) 
            ?   '<span class="inlineAlert setAtivBeforeRate">'+
                '   <i class="fas fa-info-circle azulColor" style="color: #7baaf7;"></i>'+
                '   Atribua um tipo de atividade '+getNameGenre('demanda', 'ao', '\u00E0')+' '+__.demanda+' antes de prosseguir com a avalia\u00E7\u00E3o'+
                '</span>' 
            :   '';

        var htmlBox =   '<div id="boxAtividade" class="atividadeWork" data-demanda="'+value.id_demanda+'" data-unidade="'+value.sigla_unidade+'">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        '      <tr style="height: auto;">'+
                        '           <td colspan="4">'+htmlAlertAtividade+'</td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_id_atividade"><i class="iconPopup iconSwitch fas fa-clipboard-list cinzaColor"></i>'+__.Atividade+':</label>'+
                        '           </td>'+
                        '           <td class="required" colspan="3">'+
                        '               '+selectAtiv+
                        '               <input type="hidden" id="ativ_id_unidade" data-key="id_unidade" data-param="id_unidade" value="'+value.id_unidade+'">'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '           <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_fator_complexidade"><i class="iconPopup iconSwitch fas fa-graduation-cap cinzaColor"></i>Grau de '+__.Complexidade+':</label>'+
                        '           </td>'+
                        '           <td class="required">'+
                        '               <select id="ativ_fator_complexidade" data-key="fator_complexidade" style="width: 100%;" onchange="updateAtivTempoPactuado(this);checkTempoProdutividade($(this));" required>'+
                        '                   '+optionSelectComplexidade+
                        '               </select>'+
                        '           </td>'+
                        '           <td colspan="2" rowspan="3">'+
                        '               <div id="chartUser" style="width: 380px; height: 85px;"></div>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_id_user"><i class="iconPopup iconSwitch fas fa-user-tie cinzaColor"></i>Respons\u00E1vel:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <select id="ativ_id_user" data-key="id_user" data-type="user" style="width: 100%;" required disabled>'+
                        '                   '+optionUser+
                        '               </select>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_tempo_pactuado"><i class="iconPopup iconSwitch fas fa-user-clock cinzaColor"></i>Tempo pactuado:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <input type="text" id="ativ_tempo_pactuado" data-key="tempo_pactuado" value="'+(value && value.tempo_pactuado ? value.tempo_pactuado : '')+'" data-tempo-pactuado="'+(value && value.tempo_pactuado ? value.tempo_pactuado : '')+'" disabled>'+
                        '           </td>'+
                        '      </tr>'+
                        (value.data_entrega != '0000-00-00 00:00:00' && !checkOptionEntidade('desativa_produtividade_geral') ? 
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_produtividade"><i class="iconPopup iconSwitch fas fa-toolbox cinzaColor"></i>Produtividade:</label>'+
                        '           </td>'+
                        '           <td colspan="3" style="text-align: left;">'+
                        '               <span id="ativ_produtividade">'+getInfoAtividadeProdutividade(value, true)+'</span>'+
                        '           </td>'+
                        '      </tr>'+
                        '' : '')+
                        '   </table>'+
                        '</div>';
                        
        resetDialogBoxPro('dialogBoxPro');
        dialogBoxPro = $('#dialogBoxPro')
            .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
            .dialog({
                title: (value.tempo_pactuado == 0 ? 'Atribuir '+__.Atividade : 'Alterar '+__.Complexidade)+': '+getTitleDialogBox(value),
                width: 780,
                open: function() { 
                    updateButtonConfirm(this, true);
                    if ($('#ativ_fator_complexidade').val() == null) {
                        $('#ativ_id_atividade').trigger('change');
                    } else {
                        $('#ativ_fator_complexidade').trigger('change');
                    }
                    initChosenReplace('box_init', this, true);
                },
                close: function() { 
                    $('#boxAtividade').remove();
                    resetDialogBoxPro('dialogBoxPro');
                },
                buttons: [{
                    text: (checkEmptyAtiv ? 'Atribuir' : 'Alterar'),
                    class: 'confirm',
                    click: function(event) { 
                        if (checkAtivRequiredFields(this, 'mark')) {
                            var action = (checkEmptyAtiv ? 'type_atividade' : 'variation_atividade');
                            var inpuData = extractDataAtiv(this);
                            var param = {
                                action: action,
                                id_demanda: id_demanda,
                                before_rate: ($('.setAtivBeforeRate').length > 0 ? true : false),
                                id_atividade: parseInt(inpuData.id_atividade),
                                changed_atividade: (action == 'variation_atividade' && parseInt(inpuData.id_atividade) != value.id_atividade ? true : false),
                                fator_complexidade: parseFloat(inpuData.fator_complexidade),
                                tempo_pactuado: parseFloat(inpuData.tempo_pactuado)
                            };                            
                            getServerAtividades(param, action);
                            // console.log(param, action);
                        }
                    }
                }]
        });
    }
}
function extendAtividade(id_demanda) {
    var value = getAtividadeData(id_demanda);
    // console.log(value);
    if (checkCapacidade('extend_atividade')) {
        var config_unidade = getConfigDadosUnidade(value.sigla_unidade);
        var dataDistribuicao = moment(value.data_distribuicao, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format);
        var prazoEntrega = moment(value.prazo_entrega, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format);
        var inputAtiv = jmespath.search(arrayConfigAtividades.atividades, "[?id_atividade==`"+value.id_atividade+"`].{sigla_unidade: sigla_unidade, id_unidade: id_unidade, dias_planejado: dias_planejado, tempo_pactuado: tempo_pactuado, complexidade: config.complexidade, etiqueta: config.etiqueta.lista, tipo_processo: config.tipo_processo} | [0]");
            inputAtiv = (inputAtiv !== null) ? "<input type='hidden' id='ativ_id_atividade' data-key='id_atividade' data-param='id_atividade' data-config='"+JSON.stringify(inputAtiv)+"' value='"+value.id_atividade+"'>" : '';
        var inputUser = jmespath.search(arrayConfigAtividades.planos, "[?id_user==`"+value.id_user+"`].{id_plano: id_plano, sigla_unidade: sigla_unidade, nome_modalidade: nome_modalidade, carga_horaria: carga_horaria} | [0]");
            inputUser = (inputUser !== null) ? "<input type='hidden' id='ativ_id_user' data-key='id_user' data-param='id_user' data-config='"+JSON.stringify(inputUser)+"' value='"+value.id_user+"'>" : '';

        var htmlBox =   '<div id="boxAtividade" class="atividadeWork" data-demanda="'+value.id_demanda+'" data-unidade="'+value.sigla_unidade+'">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_data_distribuicao"><i class="iconPopup iconSwitch fas fa-briefcase cinzaColor"></i>Data de Distribui\u00E7\u00E3o:</label>'+
                        '           </td>'+
                        '           <td class="required date">'+
                        '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" id="ativ_data_distribuicao" data-key="data_distribuicao" data-type="inicio" data-name="data de distribui\u00E7\u00E3o" value="'+dataDistribuicao+'" required disabled>'+
                        '               '+inputAtiv+
                        '               '+inputUser+
                        '           </td>'+
                        '           <td style="vertical-align: bottom;" class="label">'+
                        '               <label class="last" for="ativ_prazo_entrega"><i class="iconPopup iconSwitch fas fa-business-time cinzaColor" style="float: initial;"></i>Prazo de Entrega:</label>'+
                        '           </td>'+
                        '           <td class="required date">'+
                        '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="changeDadosTrabalho(this)" id="ativ_prazo_entrega" data-key="prazo_entrega" data-type="fim" data-name="prazo de entrega" value="'+prazoEntrega+'" required>'+
                        '           </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <label for="ativ_tempo_planejado"><i class="iconPopup iconSwitch fas fa-hourglass-half cinzaColor"></i>Tempo Planejado:</label>'+
                        '           </td>'+
                        '           <td>'+
                        '               <input type="number" min="1" id="ativ_tempo_planejado" data-key="tempo_planejado" data-type="tempo" value="'+value.tempo_planejado+'" disabled>'+
                        '           </td>'+
                        '           <td style="vertical-align: bottom;" class="label">'+
                        '               <label class="last" for="ativ_dias_planejado"><i class="iconPopup iconSwitch fas fa-calendar-alt cinzaColor" style="float: initial;"></i><span id="ativ_dias_planejado_label">Dias '+(config_unidade.count_dias_uteis ? '\u00FAteis' : '')+' de Planejamento</span>:</label>'+
                        '           </td>'+
                        '           <td class="required number">'+
                        '               <input type="number" min="0" id="ativ_dias_planejado" onchange="changeDadosTrabalho(this)" data-key="dias_planejado" data-type="dias" value="'+value.dias_planejado+'" required>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '</div>';

        resetDialogBoxPro('dialogBoxPro');
        dialogBoxPro = $('#dialogBoxPro')
            .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
            .dialog({
                title: __.Prorrogar+' '+__.Demanda+': '+getTitleDialogBox(value),
                width: 780,
                open: function() { 
                    updateButtonConfirm(this, true);
                    prepareFieldsReplace(this);
                },
                close: function() { 
                    $('#boxAtividade').remove();
                    resetDialogBoxPro('dialogBoxPro');
                },
                buttons: [{
                    text: __.Prorrogar,
                    class: 'confirm',
                    click: function(event) { 
                        if (checkAtivRequiredFields(this, 'mark')) {
                            var action = 'extend_atividade';
                            var inpuData = extractDataAtiv(this);
                            var param = {
                                action: 'extend_atividade',
                                id_demanda: id_demanda,
                                prazo_entrega: inpuData.prazo_entrega,
                                tempo_planejado: parseInt(inpuData.tempo_planejado),
                                dias_planejado: parseInt(inpuData.dias_planejado)
                            };                            
                            getServerAtividades(param, action);
                            // console.log(param, action);
                        }
                    }
                }]
        });
    }
}
function startCancelAtividadeLote(list) {
    if (checkCapacidade('start_cancel_atividades')) {
        setTimeout(() => {
            confirmaFraseBoxPro(__.As_demandas+' j\u00E1 foram '+getNameGenre('demanda', 'iniciados', 'iniciadas')+'. Tem certeza que deseja cancelar?', 'CANCELAR', function(){
                var action = 'start_cancel_atividades';
                if (typeof list !== 'undefined' && list !== null && list.length > 0) {
                    var ids = list.map(function(v){ return {id_demanda: v.id, id_unidade: v.id_unidade} });
                    var param = {action: action, ids: ids };
                    getServerAtividades(param, action);
                }
            }, function(){
                $.each(list, function(i, value){
                    cancelSelectedItensAtiv(value.id_demanda);
                });
            });
        }, 500);
    }
}
function startCancelAtividade(id_demanda) {
    var value = getAtividadeData(id_demanda);
    if (checkCapacidade('start_cancel_atividade')) {
        confirmaFraseBoxPro(__.A_demanda+' j\u00E1 foi '+getNameGenre('demanda', 'iniciado', 'iniciada')+'. Tem certeza que deseja cancelar?', 'CANCELAR', function(){
            var action = 'start_cancel_atividade';
            var param = {
                    action: action, 
                    id_demanda: id_demanda,
                    id_unidade: value.id_unidade
                };
                getServerAtividades(param, action);
        }, function(){
            cancelMoveKanbanItens();
            cancelSelectedItensAtiv(id_demanda);
        });
    }
}
function statusIconsAtividade(value) {
    var config_unidade = getConfigDadosUnidade(value.sigla_unidade); 
    var format_hora = (config_unidade && config_unidade.count_horas) ? 'DD/MM/YYYY [\u00E0s] HH:mm' : 'DD/MM/YYYY';
    return  '<span style="float: right;">'+
            '   <i '+(value.data_distribuicao != '0000-00-00 00:00:00' ? 'onmouseover="return infraTooltipMostrar(\'Cadastrado em: '+moment(value.data_distribuicao, 'YYYY-MM-DD HH:mm:ss').format(format_hora)+'\');" onmouseout="return infraTooltipOcultar();"' : '')+' class="far fa-clock '+(value.data_distribuicao != '0000-00-00 00:00:00' ? 'azulColor' : 'cinzaColor')+'" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
            '   <i '+(value.data_inicio != '0000-00-00 00:00:00' ? 'onmouseover="return infraTooltipMostrar(\'Iniciado em: '+moment(value.data_inicio, 'YYYY-MM-DD HH:mm:ss').format(format_hora)+'\');" onmouseout="return infraTooltipOcultar();"' : '')+' class="fas fa-play-circle '+(value.data_inicio != '0000-00-00 00:00:00' ? 'azulColor' : 'cinzaColor')+'" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
            '   <i '+(value.data_entrega != '0000-00-00 00:00:00' ? 'onmouseover="return infraTooltipMostrar(\'Conclu\u00EDdo em: '+moment(value.data_entrega, 'YYYY-MM-DD HH:mm:ss').format(format_hora)+'\');" onmouseout="return infraTooltipOcultar();"' : '')+' class="fas fa-check-circle '+(value.data_entrega != '0000-00-00 00:00:00' ? 'verdeColor' : 'cinzaColor')+'" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
            '   <i '+(value.data_avaliacao != '0000-00-00 00:00:00' ? 'onmouseover="return infraTooltipMostrar(\'Avaliado em: '+moment(value.data_avaliacao, 'YYYY-MM-DD HH:mm:ss').format(format_hora)+'\');" onmouseout="return infraTooltipOcultar();"' : '')+' class="fas fa-star '+(value.data_avaliacao != '0000-00-00 00:00:00' ? 'starGold' : 'cinzaColor')+'" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
            '</span>';
}
function sendCancelAtividade(id_demanda) {
    var value = getAtividadeData(id_demanda);
    if (value.data_entrega != '0000-00-00 00:00:00') {
        confirmaFraseBoxPro(__.A_demanda+' j\u00E1 foi '+getNameGenre('demanda', 'arquivado', 'arquivada')+'. Tem certeza que deseja cancelar?', 'CANCELAR', function(){
            var action = 'send_cancel_atividade';
            var param = {
                action: action, 
                id_demanda: id_demanda
            };
            getServerAtividades(param, action);
        }, function(){
            cancelMoveKanbanItens();
            cancelSelectedItensAtiv(id_demanda);
        });
    }
}
function archiveAtividade(id_demanda = 0) {
    if ($.isArray(id_demanda) && id_demanda.length > 0) {
        var id_demandas = jmespath.search(id_demanda,"[*].id");
    } else if (id_demanda != 0) {
        var value = (id_demanda != 0) ? jmespath.search(arrayAtividadesPro, "[?id_demanda==`"+id_demanda+"`]") : null;
            value = (value !== null) ? jmespath.search(value, "[?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00'] | [0]") : null;
            value = (value !== null) ? value : false;
        var id_demandas = (value) ? [value.id_demanda] : false;
    }
    if (id_demandas) {

        if (checkCapacidade('rate_cancel_atividades')) {
            var func_rateCancelAtiv = function() {
                var list = $('#atividadesProActions .iconAtividade_send').data('list');
                rateCancelAtividadeLote(list);
            };
            var txt_rateCancelAtiv = 'Cancelar Avalia\u00E7\u00E3o';
        } else {
            var func_rateCancelAtiv = false;
            var txt_rateCancelAtiv = 'Cancelar';
        }
        confirmaBoxPro('Tem certeza que deseja '+__.arquivar+' '+(id_demandas.length > 1 ? __.as_demandas_selecionadas : __.a_demanda_selecionada)+'?', function() { 
            var action = 'send_atividade';
            var param = {
                            id_demandas: id_demandas, 
                            data_envio: moment().format('YYYY-MM-DD HH:mm:ss'), 
                            action: action
                        };
            getServerAtividades(param, action);
        }, __.Arquivar, func_rateCancelAtiv, txt_rateCancelAtiv);
    }
}
function sendAtividade(id_demanda = 0) {
    var dadosIfrArvore = getIfrArvoreDadosProcesso();   
    var value = getAtividadeData(id_demanda);
    var checkAtivProcesso = (value && value.id_procedimento !== null && parseInt(value.id_procedimento) != 0) ? true : false;
    var listaAtividades = (dadosIfrArvore && id_demanda == 0) 
                ? jmespath.search(arrayAtividadesProcPro, "[?data_avaliacao=='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00']")
                : (checkAtivProcesso)
                    ? jmespath.search(arrayAtividadesPro, "[?id_procedimento=='"+value.id_procedimento+"'] | [?data_avaliacao=='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00']")
                    : jmespath.search(arrayAtividadesPro, "[?id_demanda==`"+id_demanda+"`] | [?data_avaliacao=='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00']");
    var sendListaAtividades = (dadosIfrArvore && id_demanda == 0) 
                ? jmespath.search(arrayAtividadesProcPro, "[?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00']")
                : (checkAtivProcesso) 
                    ? jmespath.search(arrayAtividadesPro, "[?id_procedimento=='"+value.id_procedimento+"'] | [?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00']")
                    : jmespath.search(arrayAtividadesPro, "[?id_demanda==`"+id_demanda+"`] | [?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00']");
    var idListaAtividades = (dadosIfrArvore && id_demanda == 0) 
                ? jmespath.search(arrayAtividadesProcPro, "[?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00'].id_demanda")
                : (checkAtivProcesso) 
                    ? jmespath.search(arrayAtividadesPro, "[?id_procedimento=='"+value.id_procedimento+"'] | [?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00'].id_demanda")
                    : [id_demanda]; 
    var config_unidade = getConfigDadosUnidade(); 
    var btnDialogBoxPro =   [];

    // console.log({checkAtivProcesso: checkAtivProcesso, id_demanda: id_demanda, value: value, listaAtividades: listaAtividades, sendListaAtividades: sendListaAtividades, idListaAtividades: idListaAtividades});
    
    if (listaAtividades.length > 0) {
        btnDialogBoxPro =   [{
            text: 'Ok',
            click: function(event) { 
                resetDialogBoxPro('dialogBoxPro');
            }
        }];
    } else {
        btnDialogBoxPro =   [{
            text: __.Arquivar,
            class: 'confirm',
            click: function(event) { 
                if (checkSigleInputDateAtiv_(this)) {
                    var data_envio = moment($(this).closest('.ui-dialog').find('#ativ_data_envio').val(), config_unidade.hora_format).format('YYYY-MM-DD HH:mm:ss');
                    var action = 'send_atividade';
                    var param = {
                                    id_demandas: idListaAtividades, 
                                    data_envio: data_envio, 
                                    action: action
                                };
                    getServerAtividades(param, action);
                }
            }
        }];
    }
    if (checkCapacidade('rate_edit_atividade')) {
        btnDialogBoxPro.unshift({
            text: 'Editar Avalia\u00E7\u00E3o',
            icon: "ui-icon-star",
            click: function(event) { 
                if (id_demanda == 0) { selectAtividadeBox('rate_edit') } else { rateAtividade(id_demanda) }
            }
        });
    }

    if (sendListaAtividades.length == 0) {
        selectAtividadeBox('send');
    } else if (listaAtividades.length > 0 && checkAtivProcesso) {
        // console.log(listaAtividades);
        var htmlTableAtividades = $.map(listaAtividades, function(v,k){ 
            var datesAtivHtml = getDatesPreview(getConfigDateAtiv(v));
                                    datesAtivHtml = (datesAtivHtml != '') ? $(datesAtivHtml).find('.dateBoxIcon')[0].outerHTML : '';
                                    datesAtivHtml = (datesAtivHtml != '') ? '<span class="dateboxDisplay" onclick="actionsAtividade('+v.id_demanda+')">'+datesAtivHtml+'</span>' : '';
                                    return '<div style="margin: 5px 0; display: inline-block; width: 100%;" data-value="'+v.id_demanda+'" title="'+getTitleDialogBox(v, true)+'">'+datesAtivHtml+statusIconsAtividade(v)+getTitleDialogBox(v)+'</div>'
                                }).join('');
        var htmlBox =   '<div id="boxAtividade" class="atividadeWork">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                        '               <div style="display: inline-block;"><i class="iconPopup iconSwitch fas fa-exclamation-triangle laranjaColor"></i>'+(listaAtividades.length == 1 ? 'Existe '+__.demanda+' pendente'+(checkAtivProcesso ? ' neste processo' : '')+'. Finalize-a antes de '+__.arquivar+':' : 'Existem '+__.demandas+' pendentes'+(checkAtivProcesso ? ' neste processo' : '')+'. Finalize-as antes de '+__.arquivar+':')+'</div>'+
                        '               '+htmlTableAtividades+
                        '          </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '</div>';
        
        resetDialogBoxPro('dialogBoxPro');
        dialogBoxPro = $('#dialogBoxPro')
        .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
        .dialog({
            title: __.Arquivar+' '+__.Demandas+' do Processo',
                width: 850,
                close: function() { 
                    $('#boxAtividade').remove();
                    resetDialogBoxPro('dialogBoxPro');
                },
                buttons: btnDialogBoxPro
            });
    } else {
        var dataEntrega = jmespath.search(sendListaAtividades, "reverse(sort_by([?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00'], &data_entrega)) | [*].data_entrega | [0]");
            dataEntrega = (dataEntrega != null) ? moment(dataEntrega, 'YYYY-MM-DD HH:mm:ss').format(config_unidade.hora_format) : '';
        var dataEnvio = (dadosIfrArvore.data_documento) 
                            ? (dadosIfrArvore.data_documento) 
                                ? moment(dadosIfrArvore.data_documento, 'DD/MM/YYYY HH:mm').format(config_unidade.hora_format) 
                                : moment().format(config_unidade.hora_format)
                            : moment().format(config_unidade.hora_format);
        var htmlTableAtividades = $.map(sendListaAtividades, function(v,k){ 
                                            var datesAtivHtml = getDatesPreview(getConfigDateAtiv(v));
                                                datesAtivHtml = (datesAtivHtml != '') ? $(datesAtivHtml).find('.dateBoxIcon')[0].outerHTML : '';
                                                datesAtivHtml = (datesAtivHtml != '') ? '<span class="dateboxDisplay" onclick="actionsAtividade('+v.id_demanda+')">'+datesAtivHtml+'</span>' : '';
                                                            return '<div style="margin: 5px 0; display: inline-block; width: 100%;" data-value="'+v.id_demanda+'" title="'+getTitleDialogBox(v, true)+'">'+datesAtivHtml+getTitleDialogBox(v)+'</div>'
                                        }).join('');

        var htmlBox =   '<div id="boxAtividade" class="atividadeWork">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left;" class="label" colspan="2">'+
                        '               <div style="display: inline-block;"><i class="iconPopup iconSwitch fas fa-archive azulColor"></i>'+(sendListaAtividades.length == 1 ? getNameGenre('demanda', 'O seguinte', 'A seguinte')+' '+__.demanda+' ser\u00E1 '+getNameGenre('demanda', 'arquivado', 'arquivada')+(checkAtivProcesso ? ' com o processo' : '')+':' : getNameGenre('demanda', 'Os seguintes', 'As seguintes')+' '+__.demandas+' ser\u00E3o '+__.arquivadas+(checkAtivProcesso ? ' com o processo' : '')+':')+'</div>'+
                        '               <div style="max-height: 300px;overflow-y: scroll;display: block;position: initial;">'+htmlTableAtividades+'</div>'+
                        '          </td>'+
                        '      </tr>'+
                        '      <tr>'+
                        '          <td style="vertical-align: bottom; text-align: left; width: 200px;" class="label">'+
                        '               <label for="ativ_data_envio"><i class="iconPopup iconSwitch fas fa-play-circle cinzaColor"></i>Data de '+__.Arquivamento+':</label>'+
                        '           </td>'+
                        '           <td class="required date">'+
                        '               <input type="'+(config_unidade.count_horas ? 'datetime-local' : 'date')+'" onchange="checkSigleInputDateAtiv(this)" id="ativ_data_envio" data-key="data_envio" data-type="inicio" data-name="data de '+__.arquivamento+'" data-name-min="data de conclus\u00E3o" value="'+dataEnvio+'" min="'+dataEntrega+'" required>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '</div>';

        resetDialogBoxPro('dialogBoxPro');
        dialogBoxPro = $('#dialogBoxPro')
            .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
            .dialog({
                title: __.Arquivar+' '+__.Demandas+''+(checkAtivProcesso ? ' do Processo' : ''),
                width: 700,
                open: function() { 
                    updateButtonConfirm(this, true);
                    checkSigleInputDateAtiv_(this);
                    prepareFieldsReplace(this);
                },
                close: function() { 
                    $('#boxAtividade').remove();
                    resetDialogBoxPro('dialogBoxPro');
                },
                buttons: btnDialogBoxPro
        });
    }
}
function infoAtividade(id_demanda) {
    var value = getAtividadeData(id_demanda);
    var htmlInfo = getInfoAtividade(value);
    var htmlBox =   '<div id="boxAtividade" class="atividadeInfo" style="height: 80vh;overflow-y: auto;">'+
                    '   <table style="font-size: 10pt;width: 100%;" class="seiProForm tableLine tableInfo">'+
                    '           '+htmlInfo+
                    '   </table>'+
                    '</div>';
    var btnDialogBoxPro =   [{
        text: 'Ok',
        click: function(event) { 
            resetDialogBoxPro('dialogBoxPro');
        }
    }];
    if (checkCapacidade('complete_cancel_atividade') && value.data_entrega != '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00' && value.data_avaliacao == '0000-00-00 00:00:00' && checkPermissionAtiv(value) ) {
        btnDialogBoxPro.unshift({
            text: 'Cancelar Conclus\u00E3o',
            icon: "ui-icon-close",
            click: function(event) { 
                completeCancelAtividade(value.id_demanda);
            }
        });
    }
    if (checkCapacidade('complete_edit_atividade') && value.data_entrega != '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00' && value.data_avaliacao == '0000-00-00 00:00:00' && checkPermissionAtiv(value) ) {
        btnDialogBoxPro.unshift({
            text: 'Editar Conclus\u00E3o',
            icon: "ui-icon-check",
            click: function(event) { 
                completeAtividade(value.id_demanda);
            }
        });
    }
    if (checkCapacidade('send_cancel_atividade') && value.data_envio != '0000-00-00 00:00:00') {
        btnDialogBoxPro.unshift({
            text: 'Cancelar '+__.Arquivamento,
            icon: "ui-icon-close",
            click: function(event) { 
                sendCancelAtividade(value.id_demanda);
            }
        });
    }
    if (actionsAtividade(value.id_demanda, 'icon').action != 'info') {
        btnDialogBoxPro.unshift({
            text: actionsAtividade(value.id_demanda, 'icon').name,
            click: function(event) { 
                actionsAtividade(value.id_demanda);
            }
        });
    }
    if (checkCapacidade('edit_atividade') && value.data_inicio == '0000-00-00 00:00:00') {
        btnDialogBoxPro.unshift({
            text: 'Editar '+__.Demanda,
            icon: 'ui-icon-pencil',
            click: function(event) { 
                saveAtividade(value.id_demanda);
            }
        });
    }
    if (checkCapacidade('rate_cancel_atividade') && value.data_avaliacao != '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00') {
        btnDialogBoxPro.unshift({
            text: 'Cancelar Avalia\u00E7\u00E3o',
            icon: 'ui-icon-close',
            click: function(event) { 
                rateCancelAtividade(id_demanda);
            }
        });
    }
    if (checkCapacidade('history_atividade')) {
        btnDialogBoxPro.unshift({
            text: 'Hist\u00F3rico',
            icon: 'ui-icon-script',
            click: function(event) { 
                historyAtividade(id_demanda);
            }
        });
    }

    resetDialogBoxPro('dialogBoxPro');
    dialogBoxPro = $('#dialogBoxPro')
            .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
            .dialog({
                title: 'Informa\u00E7\u00F5es '+__.da_Demanda+'',
                width: 700,
                open: function() { 
                    updateButtonConfirm(this, true);
                    getAtividadeTagsPro();
                },
                close: function() { 
                    $('#boxAtividade').remove();
                    resetDialogBoxPro('dialogBoxPro');
                },
                buttons: btnDialogBoxPro
            });
}
function historyAtividade(id_ref = false, mode = 'get', data = false) {
    if (mode == 'set') {
        var htmlBody = '';
        $.each(data,function(i, v){
            htmlBody += '<tr>'+
                        '   <td align="left">'+v.nome_completo+'</td>'+
                        '   <td align="left">'+v.descricao+'</td>'+
                        '   <td align="left">'+moment(v.datetime,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm')+'</td>'+
                        '</tr>';
        });
        $('#historyAtivPro tbody').html(htmlBody).trigger('click');
        loadingButtonConfirm(false);
        centralizeDialogBox(dialogBoxPro);
    } else if (mode == 'get') {
        var value = getAtividadeData(id_ref);
        if (value) {
            var htmlBox =   '<div id="view_doc" class="atividadeWork" style="max-height: 400px;overflow: auto;">'+
                            '   <table id="historyAtivPro" style="font-size: 8pt !important;width: 100%;" class="seiProForm tableAtividades tableDialog tableInfo tableZebra">'+
                            '        <thead>'+
                            '            <tr class="tableHeader">'+
                            '                <th class="tituloControle" style="text-align: center;">Usu\u00E1rio</th>'+
                            '                <th class="tituloControle" style="text-align: center;">A\u00E7\u00E3o</th>'+
                            '                <th class="tituloControle" style="text-align: center;">Data / Hora</th>'+
                            '            </tr>'+
                            '        </thead>'+
                            '        <tbody>'+
                            '           <tr>'+
                            '               <td colspan="3">'+
                            '                   <div class="dataFallback dataLoading" style="z-index: 1;" data-text="Nenhum dado dispon\u00EDvel"></div>'+
                            '               </td>'+
                            '           </tr>'+
                            '        </tbody>'+
                            '   </table>'+
                            '</div>';

                resetDialogBoxPro('dialogBoxPro');
                dialogBoxPro = $('#dialogBoxPro')
                    .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
                    .dialog({
                        title: 'Hist\u00F3rico da Demanda',
                        width: 780,
                        open: function() { 
                            updateButtonConfirm(this, true);
                            var action = 'history_atividade';
                            var param = {
                                action: action,
                                id_ref: id_ref
                            };
                            getServerAtividades(param, action);
                        },
                        close: function() { 
                            $('#view_doc').remove();
                            resetDialogBoxPro('dialogBoxPro');
                        },
                        buttons: [{
                            text: 'Imprimir',
                            icon: 'ui-icon-print',
                            click: function(event) {
                                printDocumento();
                            }
                        },{
                            text: 'Ok',
                            class: 'confirm',
                            click: function(event) {
                                $('#view_doc').remove();
                                resetDialogBoxPro('dialogBoxPro');
                            }
                        }]
                });
        }
    }
}
function getInfoAtividadeChecklist(value, mode) {
    var checklist = value.checklist;
    var checklist_length = typeof checklist !== 'undefined' ? checklist.length : 1;
    var verifyChecklist = (checklist && checklist.length > 0) ? true : false;
    var valueNow = (verifyChecklist) ? jmespath.search(checklist, "[?data_fim!='0000-00-00 00:00:00']") : null;
        valueNow = (valueNow !== null) ? valueNow.length : 0;
    var valuePercent = (verifyChecklist) ? ((valueNow/checklist_length)*100).toFixed(2) : 0;

    
    if (mode == 'actions') {
        var verifyCheck = ((checkCapacidade('update_checklist') && value.id_user == arrayConfigAtividades.perfil.id_user) || checkCapacidade('update_checklist_all')) ? true : false;
        var updateCheck = (value.data_entrega == '0000-00-00 00:00:00' && verifyCheck) ? true : false;

        var html_list = '<span class="info_checklist info_noclick" data-id-demanda="'+value.id_demanda+'" style="'+(verifyChecklist ? 'display:block;' : 'display:none;')+'">'+
                        '   <span class="info_checklist_head">'+
                        '       <span class="head_label">'+
                        '           <i class="fas fa-check-double" style="color: #4285f4; padding-right: 3px; font-size: 12pt;"></i> '+
                        '           Checklist'+
                        '       </span>'+
                        (updateCheck ?
                        '       <a class="newLink checklist_edit" onclick="parent.checklistEdit(this)" style="position: absolute;right: 15px;">'+
                        '           <i style="margin-right: 3px;font-size: 11pt;" class="fas fa-edit azulColor"></i>'+
                        '       </a>'+
                        '' : '')+
                        (value.data_entrega != '0000-00-00 00:00:00' ? 
                        '       <a class="newLink checklist_toggle" onclick="parent.checklistToggle(this)" style="position: absolute;right: 15px;">'+
                        '           <i style="margin-right: 3px;font-size: 11pt;" class="fas fa-'+(value.data_avaliacao == '0000-00-00 00:00:00' ? 'chevron-down' : 'chevron-right')+' azulColor"></i>'+
                        '       </a>'+
                        '' : '')+
                        '       <div class="checklist_progress ui-progressbar ui-corner-all ui-widget ui-widget-content" data-valuenow="'+valueNow+'" data-max="'+(verifyChecklist ? checklist.length : 0)+'">'+
                        '           <div class="ui-progressbar-value ui-corner-left ui-widget-header" style="width: '+valuePercent+'%;"></div>'+
                        '       </div>'+
                        '   </span>'+
                        '   <span class="info_checklist_itens" style="'+(value.data_avaliacao != '0000-00-00 00:00:00' ? 'display:none;' : '')+'" data-id-demanda="'+value.id_demanda+'">';
        if (verifyChecklist) {
            $.each(checklist, function(i, v) {
                var checked = (v.data_fim != '0000-00-00 00:00:00') ? true : false;
                var data_fim = (v.data_fim != '0000-00-00 00:00:00') ? getDateSemantic({date: v.data_fim}).dateref : '';  
                html_list +=    '   <span class="info_checklist_item '+(checked ? 'checklist_checked' : '')+'" data-id-checklist="'+v.id_checklist+'" data-id-demanda="'+value.id_demanda+'" data-ordem="'+v.ordem+'" data-old-value="'+v.nome_checklist+'">'+
                                '       <span class="label_item" '+(verifyCheck ? 'onkeypress="if (event.which == 13) { parent.checklistUpdate(this, \'rename\'); return false; }"' : '')+' '+(updateCheck ? 'onclick="parent.checklistUpdate(this, \'send\')" style="cursor:pointer"' : '')+' >'+
                                '           <i class="'+(checked ? 'fas fa-check-square' : 'far fa-square')+'" style="color: #406987; margin-right: 3px; '+(updateCheck ? 'cursor: pointer;' : '')+' font-size: 12pt;"></i> '+
                                '           <span class="label_name" '+(verifyCheck ? 'onblur="parent.checklistUpdate(this, \'rename\');"' : '')+'>'+replaceTextToProcessoSEI(replaceTextToUrl(v.nome_checklist))+'</span>'+
                                '       </span>'+
                                '       <span class="label_options">'+
                                (verifyCheck ? 
                                '           <span class="checklist_remove" onclick="parent.checklistUpdate(this, \'remove\')" style="cursor:pointer"><i class="far fa-trash-alt cinzaColor" style="font-size: 10pt;"></i></span>'+
                                '           <span class="checklist_order" ><i class="fas fa-bars cinzaColor" style="font-size: 12pt;"></i></span>'+
                                '' : '')+
                                '           <span class="checklist_date" data-date-fim="'+v.data_fim+'" '+(data_fim != '' ? 'onmouseover="return infraTooltipMostrar(\'Conclu\u00EDdo em: '+moment(v.data_fim, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm')+'\');" onmouseout="return infraTooltipOcultar();"' : '')+'>'+data_fim+'</span>'+
                                '       </span>'+
                                '   </span>';
            });
        }        
            html_list +=    '</span>'+
                        (verifyCheck ?
                        '   <span class="info_checklist_new" style="text-align: right;">'+
                        '       <a class="newLink checklist_new" onclick="parent.checklistUpdate(this, \'new\')">'+
                        '           <i style="margin-right: 3px;" class="fas fa-plus-circle azulColor"></i>'+
                        '           Adicionar item'+
                        '       </a>'+
                        '   </span>'+
                        '' : '')+
                        '</span>';
            if (updateCheck) {
                html_list +=    '<span class="info_checklist_btn info_noclick" style="'+(!verifyChecklist ? 'display:block;' : 'display:none;')+' padding: 0;opacity: 1;">'+
                                '   <a class="newLink" onclick="parent.checklistOpen(this)" style="font-size: 100%;">'+
                                '       <i style="margin-right: 3px;" class="fas fa-check-double azulColor"></i>'+
                                '       Inserir checklist'+
                                '   </a>'+
                                '</span>';
            }
        return html_list;
    } else if (mode == 'html') {
        var html_list = '<span class="info_checklist">'+
                        '   <span class="info_checklist_head">'+
                        '       <div class="checklist_progress ui-progressbar ui-corner-all ui-widget ui-widget-content" data-valuenow="'+valueNow+'" data-max="'+checklist.length+'">'+
                        '           <div class="ui-progressbar-value ui-corner-left ui-widget-header" style="width: '+valuePercent+'%;"></div>'+
                        '       </div>'+
                        '   </span>'+
                        '   <span class="info_checklist_itens">';
                $.each(checklist, function(i, v) {
                var checked = (v.data_fim != '0000-00-00 00:00:00') ? true : false;
                var data_fim = (v.data_fim != '0000-00-00 00:00:00') ? getDateSemantic({date: v.data_fim}).dateref : '';  
                    html_list +=    '   <span class="info_checklist_item '+(checked ? 'checklist_checked' : '')+'">'+
                                    '       <span class="label_item">'+
                                    '           <i class="'+(checked ? 'fas fa-check-square' : 'far fa-square')+'" style="color: #406987; margin-right: 3px; font-size: 12pt;"></i> '+
                                    '           <span class="label_name">'+replaceTextToProcessoSEI(replaceTextToUrl(v.nome_checklist))+'</span>'+
                                    '       </span>'+
                                    '       <span class="label_options">'+
                                    '           <span class="checklist_date" data-date-fim="'+v.data_fim+'" '+(data_fim != '' ? 'onmouseover="return infraTooltipMostrar(\'Conclu\u00EDdo em: '+moment(v.data_fim, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm')+'\');" onmouseout="return infraTooltipOcultar();"' : '')+'>'+data_fim+'</span>'+
                                    '       </span>'+
                                    '   </span>';
                });
                html_list +=    '</span>'+
                        '</span>';
        return html_list;
    } else if (mode == 'text') {
        var valueNow = jmespath.search(checklist, "[?data_fim!='0000-00-00 00:00:00']");
            valueNow = valueNow !== null ? valueNow.length : 0;
        var valuePercent = ((valueNow/checklist_length)*100).toFixed(2);
        var text_list = '-- Checklist ('+valuePercent+'%)<br>';
        $.each(checklist, function(i, v) {
            var checked = (v.data_fim != '0000-00-00 00:00:00') ? true : false;
                text_list +=    '   '+(checked ? '<i class=\'fas fa-check-square\'></i> <span style=\'text-decoration: line-through;\'>'+v.nome_checklist+'</span>' : '<i class=\'far fa-square\'></i> '+v.nome_checklist)+'<br>';
            });
        return text_list;
    } else if (mode == 'icon') {
        var valueNow = jmespath.search(checklist, "[?data_fim!='0000-00-00 00:00:00']");
            valueNow = valueNow !== null ? valueNow.length : 0;
        var percentCheck = parseFloat(((valueNow/checklist_length)*100).toFixed(2));
        var tooltip = getInfoAtividadeChecklist(value, 'text').replace(/'/g, "\\'");
            tooltip = 'onmouseover="return infraTooltipMostrar(\''+tooltip+'\')" onmouseout="return infraTooltipOcultar();"';
        var html_icon = '<span class="info_checklist_icon" onclick="parent.infoAtividade('+value.id_demanda+')">'+
                        '   <span class="dateboxDisplay" '+tooltip+'>'+
                        '       <svg viewBox="0 0 36 36" class="circular-chart"><path class="circle" stroke-dasharray="'+percentCheck+', 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path></svg>'+
                        '       <i class="fas fa-circle azulColor" style="padding-right: 3px;cursor: pointer;font-size: 12pt;"></i>'+
                        '       <i class="fas fa-check-double" style="margin: 3px 0px 0px -16px;cursor: pointer;font-size: 8pt;position: absolute;color: #fff;"></i>'+
                        '   </span>'+
                        '</span>';
        return html_icon;
    } else if (mode == 'percent') {
        var valueNow = jmespath.search(checklist, "[?data_fim!='0000-00-00 00:00:00']");
            valueNow = valueNow !== null ? valueNow.length : 0;
        var percentCheck = parseFloat(((valueNow/checklist_length)*100).toFixed(2));
        return percentCheck;
    }
}
function getInfoAtividadeProdutividade_calc(value, result_ = 'text', mode = 'despendido') {
    var val_tempo_pactuado = ($('#ativ_tempo_pactuado').length > 0 && $('#ativ_tempo_pactuado').is('input')) ? parseFloat($('#ativ_tempo_pactuado').val()) : value.tempo_pactuado;
    var val_tempo_planejado = ($('#ativ_tempo_planejado').length > 0 && $('#ativ_tempo_planejado').is('input')) ? parseFloat($('#ativ_tempo_planejado').val()) : value.tempo_planejado;
    var val_tempo_despendido = ($('#ativ_tempo_despendido').length > 0 && $('#ativ_tempo_despendido').is('input')) ? parseFloat($('#ativ_tempo_despendido').val()) : value.tempo_despendido;
    var val_tempo_executado = ($('#ativ_tempo_executado').length > 0 && $('#ativ_tempo_executado').is('input')) ? parseFloat($('#ativ_tempo_executado').val()) : value.tempo_executado;

    var tempo_init = (mode == 'despendido') ? val_tempo_pactuado : val_tempo_planejado;
    var tempo_end = (mode == 'despendido') ? val_tempo_despendido : val_tempo_executado;
    var tempo_end = (tempo_end <= 0 ) ? 0.01 : tempo_end;
    var produtividade = (tempo_init/tempo_end).toFixed(5);
    var produtividadePercent = (produtividade*100).toFixed(2);
    var produtividadePercentBR = toNumBr(produtividadePercent)+'%';
    return (result_ == 'text') ? toNumBr(produtividadePercent)+'%' : produtividade;
}
function getInfoAtividadeProdutividade(value, show = false, mode = 'despendido', forcer = false) {
    var val_id_atividade = ($('#ativ_id_atividade').length > 0 && $('#ativ_id_atividade').is('select')) ? parseFloat($('#ativ_id_atividade').val()) : value.id_atividade;

    var val_tempo_despendido = ($('#ativ_tempo_despendido').length > 0 && $('#ativ_tempo_despendido').is('input')) ? parseFloat($('#ativ_tempo_despendido').val()) : value.tempo_despendido;
    var val_tempo_executado = ($('#ativ_tempo_executado').length > 0 && $('#ativ_tempo_executado').is('input')) ? parseFloat($('#ativ_tempo_executado').val()) : value.tempo_executado;
    var val_tempo_end = (mode == 'despendido') ? val_tempo_despendido : val_tempo_executado;
    var txt_tempo_end = (mode == 'despendido') ? 'Tempo despendido' : 'Tempo executado';

    var val_tempo_pactuado = ($('#ativ_tempo_pactuado').length > 0 && $('#ativ_tempo_pactuado').is('input')) ? parseFloat($('#ativ_tempo_pactuado').val()) : value.tempo_pactuado;
    var val_tempo_planejado = ($('#ativ_tempo_planejado').length > 0 && $('#ativ_tempo_planejado').is('input')) ? parseFloat($('#ativ_tempo_planejado').val()) : value.tempo_planejado;
    var val_tempo_init = (mode == 'despendido') ? val_tempo_pactuado : val_tempo_planejado;
    var txt_tempo_init = (mode == 'despendido') ? 'Tempo pactuado' : 'Tempo planejado';

    var txt_tempo_label = (mode == 'despendido') ? 'Por agilidade' : 'Por antecipa\u00E7\u00E3o';
    var tooltip_tempo = (mode == 'despendido') 
                    ? '<i class="fas fa-info-circle azulColor" style="margin: 0px 6px 0 2px;" onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\'Raz\u00E3o entre o tempo pactuado ('+val_tempo_pactuado+') e o tempo despendido ('+val_tempo_despendido+')\')"></i>' 
                    : '<i class="fas fa-info-circle azulColor" style="margin: 0px 6px 0 2px;" onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\'Raz\u00E3o entre o tempo planejado ('+val_tempo_planejado+') e o tempo executado ('+val_tempo_executado+')\')"></i>';

    var val_tempo_end = (val_tempo_end <= 0 ) ? 0.01 : val_tempo_end;
    var tempo_init = (val_tempo_init <= 1) ? decimalHourToMinute(val_tempo_init)+' hora' : decimalHourToMinute(val_tempo_init)+' horas';
    var tempo_end = (val_tempo_end <= 1) ? decimalHourToMinute(val_tempo_end)+' hora' : decimalHourToMinute(val_tempo_end)+' horas';
    var produtividade = (val_tempo_init/val_tempo_end).toFixed(5);
    var produtividadePercent = (produtividade*100).toFixed(2);
    var produtividadeParam = (produtividade > 1) 
                ? {color: 'stroke: #72a50a70;', class: 'verdeColor', icon: 'fas fa-arrow-alt-circle-up' }
                : {color: 'stroke: #ff010199;', class: 'vermelhoColor', icon: 'fas fa-arrow-alt-circle-down' };
        produtividadeParam = (produtividade == 1) 
                ? {color: '', class: 'azulColor', icon: 'fas fa-check-circle' }
                : produtividadeParam;
        produtividadeParam = (produtividade >= 0.5 && produtividade < 1) 
                ? {color: 'stroke: #ffa20199;', class: 'laranjaColor', icon: 'fas fa-minus-circle' }
                : produtividadeParam;
    var produtividadeHtml = tooltip_tempo+txt_tempo_label+':'+
                            '<div class="demandaProdutividade dateboxDisplay" onmouseover="return infraTooltipMostrar(\''+txt_tempo_init+': '+tempo_init+'<br>'+txt_tempo_end+': '+tempo_end+'\',\'Produtividade: '+toNumBr(produtividadePercent)+'%\');" onmouseout="return infraTooltipOcultar();">'+
                            '   <svg viewBox="0 0 36 36" class="circular-chart"><path style="'+produtividadeParam.color+'" class="circle" stroke-dasharray="'+produtividadePercent+', 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path></svg>'+
                            '   <i class="'+produtividadeParam.icon+' '+produtividadeParam.class+'" style="padding-right: 3px;cursor: pointer;font-size: 12pt;margin-right: 3px;"></i> '+toNumBr(produtividadePercent)+'%'+
                            '</div>';

    var checkConfigAtiv = jmespath.search(arrayConfigAtividades.atividades, "[?id_atividade==`"+val_id_atividade+"`] | [0].config.desativa_produtividade");
    var infoProdutividade = (checkConfigAtiv) 
        ? '- <span onmouseover="return infraTooltipMostrar(\'C\u00E1lculo de produtividade desativado para este tipo de atividade\')" onmouseout="return infraTooltipOcultar();"><i class="fas fa-info-circle azulColor"></i></span>' 
        : (val_tempo_init == 0) 
            ? '- <span onmouseover="return infraTooltipMostrar(\'Vincule um tipo de atividade para o c\u00E1lculo de produtividade.\')" onmouseout="return infraTooltipOcultar();"><i class="fas fa-info-circle azulColor"></i></span>'
            : '-';

    var ativNaoEntregue = (value && typeof value.avaliacao !== 'undefined' && value.avaliacao !== null && typeof value.avaliacao.nota_atribuida !== 'undefined' && value.avaliacao.hasOwnProperty('nota_atribuida') && value.avaliacao.nota_atribuida !== null) 
            ? jmespath.search(arrayConfigAtividades.avaliacao,"[?nota_atribuida==`"+value.avaliacao.nota_atribuida+"`].aceita_entrega | [0]")
            : false;
        ativNaoEntregue = (ativNaoEntregue == 0) ? true : false;
    
    var configAtviTempoMin = jmespath.search(arrayConfigAtividades.atividades, "[?id_atividade==`"+val_id_atividade+"`] | [0].config.tempo_minimo");
        configAtviTempoMin = (configAtviTempoMin === null) 
                            ? 0.2 
                            : (configAtviTempoMin == 0) ? false : parseFloat(configAtviTempoMin)/100;

    var checkConfigAtivTempoMin = (configAtviTempoMin && val_tempo_end < val_tempo_init*configAtviTempoMin) ? true : false;
    var produtividadeHtml = (checkConfigAtivTempoMin) 
        ?   produtividadeHtml+
            '<div class="info_tags_follow info_alerta_produtividade" style="margin-top: 5px;">'+
            '   <span style="background-color: #f9efad;font-size: 10pt;color: #666;" class="tag_text">'+
            '       <i class="fas fa-info-circle azulColor" style="margin: 0px 2px;"></i>'+
            '       '+txt_tempo_end+' abaixo do m\u00EDnimo esperado ('+decimalHourToMinute(val_tempo_init*configAtviTempoMin)+' '+(val_tempo_init*configAtviTempoMin > 1 ? 'horas' : 'hora')+')'+
            '   </span>'+
            '</div>'
        : produtividadeHtml;
    
    // console.log(value, val_tempo_despendido, val_tempo_executado, val_tempo_end, val_tempo_pactuado, val_tempo_planejado, val_tempo_init, produtividade, checkConfigAtivTempoMin);
    // console.log(!checkConfigAtiv, val_tempo_end > 0, val_tempo_init > 0, value.data_avaliacao == '0000-00-00 00:00:00', !ativNaoEntregue,show,checkCapacidade('chart_produtividade'),(typeof arrayConfigAtividades.perfil !== 'undefined' && value.id_user == arrayConfigAtividades.perfil.id_user), produtividadeHtml, infoProdutividade);
    
    return (forcer || !checkConfigAtiv && val_tempo_end > 0 && val_tempo_init > 0 && (value.data_avaliacao == '0000-00-00 00:00:00' || !ativNaoEntregue) && (show || checkCapacidade('chart_produtividade') || (typeof arrayConfigAtividades.perfil !== 'undefined' && value.id_user == arrayConfigAtividades.perfil.id_user)) ) ? produtividadeHtml : infoProdutividade;
}
function getInfoAtividade(value) {
    var requisicao = (typeof value.requisicao_sei !== 'undefined' && value.requisicao_sei !== null && parseInt(value.requisicao_sei) != 0) ? value.nome_requisicao+' ('+value.requisicao_sei+')' : value.nome_requisicao;
        requisicao = (requisicao === null) ? '-' : requisicao;
    var linkProc = (value.id_procedimento !== null && value.processo_sei !== null && value.processo_sei != '') ? url_host+'?acao=procedimento_trabalhar&id_procedimento='+value.id_procedimento : 'javascript:return false';
    var processoHtml = (value.processo_sei !== null && value.processo_sei != '')
                        ? '               <a '+(linkProc == '' ? 'style="cursor: auto;"' : 'style="font-size: 10pt;text-decoration: underline;" class="bLink" href="'+linkProc+'" target="_blank"')+'>'+
                        '                   <i class="far fa-folder-open '+(linkProc == '' ? '' : 'bLink')+'" '+(linkProc == '' ? 'style="font-size: 10pt;color: #a2a2a2;"' : 'style="text-decoration: underline;"')+'></i> '+
                        '                   <span '+(linkProc == '' ? '' : 'class="bLink"')+'></i> '+
                        '                       '+value.processo_sei+
                        '                   </span>'+
                        '                   <i class="fas fa-external-link-alt bLink" style="font-size: 80%;vertical-align: top;margin-left: 5px;"></i>'+
                        '               </a>'
                        : '-';
    var entrega = (typeof value.documento_sei !== 'undefined' && value.documento_sei !== null && parseInt(value.documento_sei) != 0) ? value.nome_documento+' ('+value.documento_sei+')' : value.nome_documento;
        entrega = (value.processo_sei !== null && value.processo_sei != '') ? value.processo_sei+' / '+entrega : entrega;
        entrega = (entrega === null) ? '-' : entrega;
    var tempo_planejado = (value.tempo_planejado == 1) ? decimalHourToMinute(value.tempo_planejado)+' hora' : decimalHourToMinute(value.tempo_planejado)+' horas';
    var dias_planejado = (value.dias_planejado == 1) ? value.dias_planejado+' dia' : value.dias_planejado+' dias';
    var tempo_despendido = (value.tempo_despendido == 1) ? decimalHourToMinute(value.tempo_despendido)+' hora' : decimalHourToMinute(value.tempo_despendido)+' horas';
    var tempo_executado = (value.tempo_executado == 1) ? decimalHourToMinute(value.tempo_executado)+' hora' : decimalHourToMinute(value.tempo_executado)+' horas';
    var dias_despendido = (value.dias_despendido == 1) ? value.dias_despendido+' dia' : value.dias_despendido+' dias';
    var linkRequisicao = (value.id_documento_requisicao !== null && value.id_documento_requisicao != '') ? url_host+'?acao=procedimento_trabalhar&id_procedimento='+value.id_procedimento+'&id_documento='+value.id_documento_requisicao : 'javascript:return false';
    var projetado = getDatesFormatBR(value.data_distribuicao)+' \u00E0 '+getDatesFormatBR(value.prazo_entrega)+' ('+tempo_planejado+' / '+dias_planejado+')';
    var despendido = (value.data_entrega == '0000-00-00 00:00:00') ? '-' : getDatesFormatBR(value.data_inicio)+' \u00E0 '+getDatesFormatBR(value.data_entrega)+' ('+tempo_despendido+' / '+dias_despendido+')';
    var executado = (value.data_entrega == '0000-00-00 00:00:00') ? '-' : getDatesFormatBR(value.data_distribuicao)+' \u00E0 '+getDatesFormatBR(value.data_entrega)+' ('+tempo_executado+')';
    var statusAtividade = (moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss') < moment()) ? '<i class="fas fa-exclamation-triangle vermelhoColor"></i> Atrasado' : '<i class="far fa-clock azulColor"></i> No prazo';
        statusAtividade = (value.data_entrega != '0000-00-00 00:00:00' && moment(value.data_entrega,'YYYY-MM-DD HH:mm:ss') <= moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss')) ? '<i class="fas fa-check-circle verdeColor"></i> Entregue no prazo' : statusAtividade;
        statusAtividade = (value.data_entrega != '0000-00-00 00:00:00' && moment(value.data_entrega,'YYYY-MM-DD HH:mm:ss') > moment(value.prazo_entrega,'YYYY-MM-DD HH:mm:ss')) ? '<i class="fas fa-check-circle laranjaColor"></i> Entregue fora do prazo' : statusAtividade;
    var modalDocRequisicao = "openDialogDoc({title: '"+requisicao+"', id_procedimento: '"+value.id_procedimento+"', id_documento: '"+value.id_documento_requisicao+"'})";
    var modalDocEntrega = "openDialogDoc({title: '"+entrega+"', id_procedimento: '"+value.id_procedimento+"', id_documento: '"+value.id_documento_entregue+"'})";
    var textPause = (typeof value.pausa_lista !== 'undefined' && value.pausa_lista !== null && value.pausa_lista.length > 0) 
                    ? $.map(value.pausa_lista, function(v, i){ return '('+(i+1)+') '+moment(v.data_inicio,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm')+' \u00E0 '+moment(v.data_fim,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm') }).join('<br>')
                    : false;
                    textPause = (textPause) ? '<br><br> -- Paralisa\u00E7\u00F5es<br>'+textPause : '';

    var tagsAtivName = (typeof value.etiquetas !== 'undefined' && value.etiquetas !== null) ? $.map(value.etiquetas, function (i) { return normalizeNameTag(i); }).join(' ') : '';   
    var tagsAtivPriority = (tagsAtivName.indexOf('importante') !== -1) ? 'importanteBoxDisplay' : '';
        tagsAtivPriority = (tagsAtivName.indexOf('urgente') !== -1) ? 'urgenteBoxDisplay' : tagsAtivPriority;
    var planoAtiv = (value.plano) ? '#'+value.id_plano+': '+moment(value.plano.data_inicio_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY')+' \u00E0 '+moment(value.plano.data_fim_vigencia,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY') : 'Nenhum plano de trabalho vinculado \u00E0 demanda';
                    // console.log(textPause, value.pausa_lista);
    var atividadeHtml =     '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom; width: 170px;"><i class="iconPopup iconSwitch fas fa-hashtag cinzaColor"></i>ID '+__.da_Demanda+':</td>'+
                            '          <td>'+
                            '               '+value.id_demanda+
                            '          </td>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom; width: 170px;"><i class="iconPopup iconSwitch fas fa-folder-open cinzaColor"></i>Processo SEI:</td>'+
                            '          <td>'+
                            '               '+processoHtml+
                            '          </td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom; width: 170px;"><i class="iconPopup iconSwitch fas fa-inbox cinzaColor"></i>Requisi\u00E7\u00E3o:</td>'+
                            '          <td>'+
                            '           '+getHtmlLinkQuicView({id_procedimento: value.id_procedimento, id_documento: value.id_documento_requisicao, action: modalDocRequisicao, title: requisicao})+
                            '          </td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-briefcase cinzaColor"></i>Unidade:</td>'+
                            '          <td>'+value.nome_unidade+' ('+value.sigla_unidade+')</td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-user-tie cinzaColor"></i>Respons\u00E1vel:</td>'+
                            '          <td>'+(value.nome_completo ? value.nome_completo : '-')+'</td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-clipboard-list cinzaColor"></i>'+__.Atividade+':</td>'+
                            '          <td>'+(value.nome_atividade ? value.nome_atividade : '-')+'</td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;" data-index="'+value.id_demanda+'">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-comment-dots cinzaColor"></i>'+__.Assunto+':</td>'+
                            '          <td class="content_desc">'+
                            '               <div class="content_edit" data-field="assunto" style="position:relative" data-id="'+value.id_demanda+'">'+
                            '                   <span class="info">'+value.assunto+'</span>'+
                            '                   '+(checkCapacidade('edit_field') && checkPermissionAtiv(value) && checkCapacidade('edit_assunto') ? '<a class="newLink content_btnsave" onclick="editFieldAtiv(this)" onmouseover="return infraTooltipMostrar(\'Editar '+__.assunto+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-edit" style="font-size: 100%;"></i></a>' : '')+
                            '               </div>'+
                            '          </td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-quote-left cinzaColor"></i>'+__.Observacao+' '+__.Gerencial+':</td>'+
                            '          <td class="content_desc">'+
                            '               <div class="content_edit" data-field="observacao_gerencial" style="position:relative" data-id="'+value.id_demanda+'">'+
                            '                   <span class="info">'+(value.observacao_gerencial ? value.observacao_gerencial : '-')+'</span>'+
                            '                   '+(checkCapacidade('edit_field') && checkPermissionAtiv(value) && checkCapacidade('edit_observacao_gerencial') ? '<a class="newLink content_btnsave" style="position: absolute;top: 0;right: 0;" onclick="editFieldAtiv(this)" onmouseover="return infraTooltipMostrar(\'Editar '+__.Observacao+' '+__.Gerencial+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-edit" style="font-size: 100%;"></i></a>' : '')+
                            '               </div>'+
                            '          </td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;" class="'+tagsAtivPriority+'" data-index="'+value.id_demanda+'">'+
                            '          <td style="vertical-align: middle;padding: 10px 0 0 0;"><i class="iconPopup iconSwitch fas fa-tags cinzaColor"></i>Etiquetas:</td>'+
                            '          <td data-etiqueta-mode="ativ">'+
                            '               <span class="info_tags_follow">'+$.map(value.etiquetas, function (i) { return $(getHtmlEtiqueta(i,'ativ')).css('cursor','initial')[0].outerHTML }).join('')+'</span>'+
                            (!checkCapacidade('edit_etiqueta') ? '' : 
                            '               <span class="info_tags_follow_txt" style="display:none">'+
                            '                   <input id="infoAtivTagsPro" value="'+((typeof value.etiquetas !== 'undefined' && value.etiquetas !== null) ? value.etiquetas.join(';') : '')+'" class="atividadeTagsPro">'+
                            '               </span>'+
                            '')+
                            '               <a class="newLink content_btnsave followLinkTags '+(value.etiquetas !== null && value.etiquetas.length > 0 ? 'followLinkTagsEdit' : 'followLinkTagsAdd')+'" onclick="showFollowEtiqueta(this, \'show\', \'ativ\')" onmouseover="return infraTooltipMostrar(\''+(value.etiquetas !== null && value.etiquetas.length > 0 ? 'Editar etiqueta' : 'Adicionar etiqueta')+'\');" onmouseout="return infraTooltipOcultar();"><i class="'+(value.etiquetas !== null && value.etiquetas.length > 0 ? 'fas fa-edit' : 'fas fa-tags')+'" style="font-size: 100%;"></i></a>'+
                            '          </td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-handshake cinzaColor"></i>Tempo Pactuado:</td>'+
                            '          <td><span title="'+value.tempo_pactuado+' '+(value.tempo_pactuado > 1 ? 'horas' : 'hora')+'">'+decimalHourToMinute(value.tempo_pactuado)+' '+(value.tempo_pactuado > 1 ? 'horas' : 'hora')+'</span> (Fator de '+__.complexidade+': '+value.fator_complexidade+')</td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-business-time cinzaColor"></i>Tempo Planejado:</td>'+
                            '          <td>'+projetado+'</td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-hourglass-half cinzaColor"></i>Tempo Despendido:</td>'+
                            '          <td>'+despendido+textPause+'</td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-hourglass-half cinzaColor"></i>Tempo Executado:</td>'+
                            '          <td>'+executado+'</td>'+
                            '      </tr>'+
                            (!checkOptionEntidade('desativa_produtividade_geral') ? 
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-toolbox cinzaColor"></i>Produtividade:</td>'+
                            '          <td>'+
                            '               <div>'+getInfoAtividadeProdutividade(value, true, 'despendido')+'</div>'+
                            '               <div>'+getInfoAtividadeProdutividade(value, true, 'executado')+'</div>'+
                            '          </td>'+
                            '      </tr>'+
                            '' : '')+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-handshake cinzaColor"></i>Plano de Trabalho:</td>'+
                            '          <td>'+planoAtiv+'</td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-inbox cinzaColor"></i>Entrega:</td>'+
                            '          <td>'+
                            '           '+(value.data_entrega == '0000-00-00 00:00:00' ? '-' : getHtmlLinkQuicView({id_procedimento: value.id_procedimento, id_documento: value.id_documento_entregue, action: modalDocEntrega, title: entrega}))+
                            '          </td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-info cinzaColor"></i>Status:</td>'+
                            '          <td style="padding-left: 5px;">'+statusAtividade+'</td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-quote-left cinzaColor"></i>'+__.Observacao+' '+__.Tecnica+':</td>'+
                            '          <td class="content_desc">'+
                            '               <div class="content_edit" data-field="observacao_tecnica" style="position:relative" data-id="'+value.id_demanda+'">'+
                            '                   <span class="info">'+(value.observacao_tecnica ? value.observacao_tecnica : '-')+'</span>'+
                            '                   '+(checkCapacidade('edit_field') && checkPermissionAtiv(value) && checkCapacidade('edit_observacao_tecnica') ? '<a class="newLink content_btnsave" onclick="editFieldAtiv(this)" style="position: absolute;top: 0;right: 0;" onmouseover="return infraTooltipMostrar(\'Editar '+__.Observacao+' '+__.Tecnica+'\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-edit" style="font-size: 100%;"></i></a>' : '')+
                            '               </div>'+
                            '          </td>'+
                            '      </tr>'+
                            '      <tr style="height: 40px;">'+
                            '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-check-double cinzaColor"></i>Checklist:</td>'+
                            '          <td><span class="info_checklist_text" style="position: relative;">'+(value.checklist ? getInfoAtividadeChecklist(value, 'actions') : '-')+'</span></td>'+
                            '      </tr>';

            atividadeHtml += (value.data_avaliacao != '0000-00-00 00:00:00' && value.avaliacao != 0) 
                            ?   
                                (!checkOptionEntidade('desativa_produtividade_geral') ? 
                                '      <tr style="height: 40px;">'+
                                '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-toolbox cinzaColor"></i>Produtividade:</td>'+
                                '          <td><div style="margin-left: -10px;">'+getInfoAtividadeProdutividade(value)+'</div></td>'+
                                '      </tr>'+
                                '' : '')+
                                '      <tr style="height: 40px;">'+
                                '          <td style="vertical-align: bottom;"><i class="iconPopup iconSwitch fas fa-tasks cinzaColor"></i>Avalia\u00E7\u00E3o:</td>'+
                                '          <td style="vertical-align: baseline;">'+
                                '               <div class="ratingWhy" style="text-align: left; margin: 0;">'+
                                '                   <i data-nota="'+(value.avaliacao.nota_atribuida === false ? '-' : value.avaliacao.nota_atribuida)+'" class="fas fa-star cinzaColor starGold starSelected"></i>'+
                                '                   '+(value.avaliacao.comentarios != '' ? '<span class="answer" style="cursor: initial;"><i class="far fa-comment-alt cinzaColor"></i> '+value.avaliacao.comentarios+'</span>' : '' )+
                                '                   '+(value.avaliacao.nota_atribuida && value.avaliacao.justificativas.length > 0 ? $.map(value.avaliacao.justificativas,function(i){ return '<span class="answer" style="cursor: initial;">'+i.nome_justificativa+'</span>' }).join('') : (value.avaliacao.nota_atribuida === false ? 'Avalia\u00E7\u00E3o Dispensada' : '') )+
                                '               </div>'+
                                '          </td>'+
                                '      </tr>'
                            : ''; 
    return atividadeHtml;
}
function getHtmlLinkQuicView(value) {
    var html =  (value.id_procedimento !== null && value.id_procedimento != 0 && value.id_documento !== null && value.id_documento != 0) 
                ?   '<a class="bLink" style="text-decoration: underline; font-size: 10pt; cursor: pointer;" onclick="'+value.action+'" onmouseover="return infraTooltipMostrar(\'Visualiza\u00E7\u00E3o r\u00E1pida\');" onmouseout="return infraTooltipOcultar();">'+
                    '    '+value.title+
                    '    <i class="fas fa-eye bLink" style="font-size: 80%;vertical-align: top;margin-left: 5px;"></i>'+
                    '</a>'
                :   '<span>'+
                    '    '+value.title+
                    '</span>';
    return html;
}
function checkAllInputEmail(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
        _parent.find('input[type="email"]').each(function(){
            checkInputEmail(this);
        });
}
function checkInputEmail(this_) {
    var _this = $(this_);
    var value = _this.val();
    if (checkValue(_this) && validateEmail(value)) {
        _this.removeClass('requiredNull');
        if (_this.data('server')) checkInputUserServer(this_);
        if (_this.attr('id') == 'user_email') { 
            var username = (value.indexOf('@') !== -1) ? value.split('@')[0] : false;
            if (username) _this.closest('table').find('#user_login').val(username);
        }
    } else {
        _this.addClass('requiredNull');
    }
}
function checkInputUserServer(this_) {
    var _this = $(this_);
    var value = _this.val();
    if (_this.data('server') && value.trim() != '') {
        var type = _this.attr('id');
        var action = 'config_new_users';
        var param = {
            action: action, 
            mode: 'check',
            value: value,
            type: type,
        };
        getServerAtividades(param, action);
    }
}
function moveUserCapacity(id_user) {
    var action = 'config_new_users';
    var param = {
        action: action, 
        mode: 'move',
        id_user: id_user
    };
    getServerAtividades(param, action);
}
function checkSigleInputDateAtiv(this_) {
    clearTimeout(dly);
    dly = setTimeout(function() {
        checkSigleInputDateAtiv_(this_);
    }, 1000);
}
function checkSigleInputDateAtiv_(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    var input = _parent.find('input[data-type="inicio"]');
    var element = input[0];
    var config_unidade = getConfigDadosUnidade();
    var dataInicio = input.val();
    var dataMin = input.attr('min');
    var dataMinFormat = moment(dataMin, config_unidade.hora_format).format('DD/MM/YYYY HH:mm');
    var labelInicio = input.data('name');
    var labelMin = input.data('name-min');
    if ( moment(dataMin, config_unidade.hora_format) > moment(dataInicio, config_unidade.hora_format) ) { 
        element.setCustomValidity('*'); 
    } else { 
        element.setCustomValidity(''); 
    }
    var userValidation = element.checkValidity();
    
    if (userValidation) {
        _this.removeClass('requiredNull');
        updateButtonConfirm(this_, true);
        return true;
    } else {
        _this.addClass('requiredNull');
        element.setCustomValidity('A '+labelInicio+' deve ser maior ou igual que a '+labelMin+' ('+dataMinFormat+')');
        var isValid = element.reportValidity();
        updateButtonConfirm(this_, false);
        return false;
    }
}
function actionsAtividade(id_demanda = 0, mode = 'action') {
    infraTooltipOcultar();
    if (id_demanda != 0) {
        var tr = $('#tabelaAtivPanel table tr[data-index="'+id_demanda+'"]');
        if (tr.is(':visible')) {
            var tableDemanda = $('#tabelaAtivPanel table');
            var countSelected = tableDemanda.find('tr.infraTrMarcada').length;
            if (countSelected > 0) {
                tableDemanda.find('.lnkInfraCheck').data('index',1).trigger('click');
            }
            tr.find('td').eq(0).find('input[type="checkbox"]').trigger('click');
        }
        var value = getAtividadeData(id_demanda);
        if (value) {
            if (checkCapacidade('edit_atividade') && checkCapacidade('select_user_atividade')) {
                if (id_demanda != 0 && checkCapacidade('rate_atividade') && value.data_avaliacao == '0000-00-00 00:00:00' && value.data_entrega != '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00') {
                    if (mode == 'action') { 
                        rateAtividade(id_demanda);
                    } else if (mode == 'icon') { 
                        return {icon: 'fas fa-star-half-alt', name: 'Avaliar '+__.demanda, action: 'rate'} 
                    }
                } else if (id_demanda != 0 && checkCapacidade('complete_atividade') && value.data_inicio != '0000-00-00 00:00:00' && value.data_entrega == '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00') {
                    if (mode == 'action') { 
                        completeAtividade(id_demanda);
                    } else if (mode == 'icon') { 
                        return {icon: 'fas fa-check-circle', name: 'Concluir '+__.demanda, action: 'complete'} 
                    }
                } else if (checkCapacidade('send_atividade') && value.data_avaliacao != '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00') {
                    if (mode == 'action') { 
                        archiveAtividade(id_demanda);
                    } else if (mode == 'icon') { 
                        return {icon: 'fas fa-archive', name: __.Arquivar+' '+__.demanda, action: 'send'} 
                    }
                } else if (value.data_envio == '0000-00-00 00:00:00') {
                    if (mode == 'action') { 
                        startAtividade(id_demanda);
                    } else if (mode == 'icon') { 
                        return {icon: 'fas fa-play-circle', name: 'Iniciar '+__.demanda, action: 'start'} 
                    }
                } else {
                    if (mode == 'action') { 
                        infoAtividade(id_demanda);
                    } else if (mode == 'icon') { 
                        return {icon: 'fas fa-info-circle', name: 'Informa\u00E7\u00F5es '+__.da_demanda, action: 'info'} 
                    }
                }
            } else {
                if (value.id_user == 0) {    
                    if (mode == 'action') { 
                        startAtividade(id_demanda);
                    } else if (mode == 'icon') { 
                        return {icon: 'fas fa-play-circle', name: 'Iniciar '+__.demanda, action: 'start'} 
                    }
                } else if (typeof arrayConfigAtividades.perfil !== 'undefined' && value.id_user != 0 && value.id_user != parseInt(arrayConfigAtividades.perfil.id_user)) {    
                    if (mode == 'action') { 
                        infoAtividade(id_demanda);
                    } else if (mode == 'icon') { 
                        return {icon: 'fas fa-info-circle', name: 'Informa\u00E7\u00F5es '+__.da_demanda, action: 'info'} 
                    }
                } else {
                    if (checkCapacidade('start_atividade') && value.data_inicio == '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00') {
                        if (mode == 'action') { 
                            startAtividade(id_demanda);
                        } else if (mode == 'icon') { 
                            return {icon: 'fas fa-play-circle', name: 'Iniciar '+__.demanda, action: 'start'} 
                        }
                    } else if (checkCapacidade('complete_atividade') && value.data_inicio != '0000-00-00 00:00:00' && value.data_entrega == '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00') {
                        if (mode == 'action') { 
                            completeAtividade(id_demanda);
                        } else if (mode == 'icon') { 
                            return {icon: 'fas fa-check-circle', name: 'Concluir '+__.demanda, action: 'complete'} 
                        }
                    } else if (checkCapacidade('rate_atividade') && value.data_avaliacao == '0000-00-00 00:00:00' && value.data_entrega != '0000-00-00 00:00:00' && value.data_envio == '0000-00-00 00:00:00') {
                        if (mode == 'action') { 
                            rateAtividade(id_demanda);
                        } else if (mode == 'icon') { 
                            return {icon: 'fas fa-star-half-alt', name: 'Avaliar '+__.demanda, action: 'rate'} 
                        }
                    } else {
                        if (mode == 'action') { 
                            infoAtividade(id_demanda);
                        } else if (mode == 'icon') { 
                            return {icon: 'fas fa-info-circle', name: 'Informa\u00E7\u00F5es '+__.da_demanda, action: 'info'}
                        }
                    }
                }
            }
        }
    }
}
function notifyAtividade(id_demanda = 0, event = false, loop = 10) {
    var value = getAtividadeData(id_demanda);
    var dados_usuario = jmespath.search(arrayConfigAtividades.usuarios, "[?id_user==`"+value.id_user+"`] | [0]");
    // console.log(value, id_demanda, event);
    if (value) {
        if (value.id_user == 0) {
            alertaBoxPro('Sucess', 'check-circle', 'Envio de notifica\u00E7\u00E3o dispon\u00EDvel apenas para demandas atribu\u00EDdas.');
        } else if (dados_usuario === null) {
            alertaBoxPro('Sucess', 'check-circle', 'Usu\u00E1rio n\u00E3o lotado na unidade.');
        } else if (dados_usuario !== null) {
            var notificacao_unidade = arrayConfigAtivUnidade.config.distribuicao.notificacao;
            var requisicao = (typeof value.requisicao_sei !== 'undefined' && value.requisicao_sei !== null && parseInt(value.requisicao_sei) != 0) 
                        ? 
                            !!value.nome_requisicao && value.requisicao_sei ? value.nome_requisicao+' ('+value.requisicao_sei+')' : ''
                        : 
                            !!value.nome_requisicao ? value.nome_requisicao : '';
            var documento = (typeof value.documento_sei !== 'undefined' && value.documento_sei !== null && parseInt(value.documento_sei) != 0) 
                        ? 
                            !!value.nome_documento && !!value.numero_documento && !!value.documento_sei  ? value.nome_documento+' '+value.numero_documento+' ('+value.documento_sei+')' : ''
                        : 
                            !!value.nome_documento && !!value.numero_documento ? value.nome_documento+' '+value.numero_documento : '';
            var data_entrega = moment(value.data_entrega, 'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm');
            var email_remetente = (value.data_entrega == '0000-00-00 00:00:00') ? notificacao_unidade.email : dados_usuario.email;
            var email_destinatario = (value.data_entrega == '0000-00-00 00:00:00') ? dados_usuario.email : notificacao_unidade.email;
            var list_destinatario = (value.data_entrega != '0000-00-00 00:00:00') ? jmespath.search(arrayConfigAtividades.usuarios,"[?recebe_notificacoes==`true`]") : null;
                list_destinatario = (list_destinatario !== null) 
                                ? $.map(list_destinatario, function(v){ 
                                    return '<option value="'+v.id_user+'">'+v.nome_completo+' &lt;'+v.email+'&gt;</option>';
                                }).join('') : '';

            var bodyMail = (value.data_entrega != '0000-00-00 00:00:00') ? notificacao_unidade.texto_conclusao : notificacao_unidade.texto_criacao;
                bodyMail = bodyMail.replace('{usuario}', !!value.apelido ? value.apelido : '');
                bodyMail = bodyMail.replace('{requisicao}', !!requisicao ? requisicao : '');
                bodyMail = bodyMail.replace('{atividade}', !!value.nome_atividade ? value.nome_atividade : '');
                bodyMail = bodyMail.replace('{processo}', !!value.processo_sei ? value.processo_sei : '');
                bodyMail = bodyMail.replace('{assunto}', !!value.assunto ? value.assunto : '');
                bodyMail = bodyMail.replace('{prazo}', !!value.dias_planejado ? value.dias_planejado : '');
                bodyMail = bodyMail.replace('{tempo_pactuado}', !!value.tempo_pactuado ? value.tempo_pactuado : '');
                bodyMail = bodyMail.replace('{tempo_planejado}', !!value.tempo_planejado ? value.tempo_planejado : '');
                bodyMail = bodyMail.replace('{data_entrega}', !!data_entrega ? data_entrega : '');
                bodyMail = bodyMail.replace('{observacoes_gerenciais}', !!value.observacao_gerencial ? value.observacao_gerencial : '');
                bodyMail = bodyMail.replace('{observacoes}', !!value.observacao_tecnica ? value.observacao_tecnica : '');
                bodyMail = bodyMail.replace('{documento_produto}', !!documento ? documento : '');
                // bodyMail = encodeURIComponent(bodyMail);
                bodyMail = unicodeToChar(bodyMail.replace(/\\n/g, "\n"));
                bodyMail += (value.data_entrega != '0000-00-00 00:00:00') ? "\n\n"+dados_usuario.nome_completo : "\n\n"+arrayConfigAtivUnidade.nome_unidade+" - "+arrayConfigAtivUnidade.sigla_unidade;

            var email_assunto = '[DEMANDA] '+(requisicao !== null ? requisicao+' - ' : '')+value.assunto;
            // var hrefMailto = 'mailto:'+userMail+'?subject='+subjectMail+'&body='+bodyMail;
            // window.location.href = hrefMailto;

            var htmlBox =   '<div id="boxAtividade" class="atividadeWork">'+
                            '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                            '      <tr>'+
                            '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                            '               <label for="ativ_data_remetente"><i class="iconPopup iconSwitch fas fa-envelope cinzaColor"></i>De:</label>'+
                            '           <td style="text-align: left;">'+email_remetente+'</td>'+
                            '      </tr>'+
                            '      <tr>'+
                            '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                            '               <label for="ativ_data_destinatario"><i class="iconPopup iconSwitch fas fa-at cinzaColor"></i>Para:</label>'+
                            '           <td style="text-align: left;">'+
                            '               <select id="ativ_data_destinatario"><option value="0">'+email_destinatario+'</option>'+list_destinatario+'</select>'+
                            '           </td>'+
                            '      </tr>'+
                            '      <tr>'+
                            '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                            '               <label for="ativ_data_assunto"><i class="iconPopup iconSwitch fas fa-inbox cinzaColor"></i>Assunto:</label>'+
                            '           <td style="text-align: left;">'+email_assunto+'</td>'+
                            '      </tr>'+
                            '      <tr>'+
                            '          <td style="text-align: left;" class="label">'+
                            '               <label for="ativ_data_mensagem"><i class="iconPopup iconSwitch fas fa-comment cinzaColor"></i>Mensagem:</label>'+
                            '           <td style="text-align: left;"><textarea id="ativ_data_mensagem" class="setClassEditor" style="min-height: 250px;">'+bodyMail+'</textarea></td>'+
                            '      </tr>'+
                            '   </table>'+
                            '</div>';

                resetDialogBoxPro('dialogBoxPro');
                dialogBoxPro = $('#dialogBoxPro')
                    .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
                    .dialog({
                        title: 'Gerar Notifica\u00E7\u00E3o',
                        width: 780,
                        open: function() { 
                            updateButtonConfirm(this, true);
                            initChosenReplace('box_init', this, true);
                        },
                        close: function() { 
                            $('#boxAtividade').remove();
                            resetDialogBoxPro('dialogBoxPro');
                        },
                        buttons: [{
                            text: 'Enviar',
                            class: 'confirm',
                            click: function(event) { 
                                
                                var action = 'notify_send';
                                var param = {
                                    action: action,
                                    id_user: $('#ativ_data_destinatario').val(),
                                    id_demanda: id_demanda,
                                    assunto: email_assunto,
                                    mensagem: $('#ativ_data_mensagem').val().replace(/(?:\r\n|\r|\n)/g, '<br>')
                                };
                                getConfigServer(action, param);
                            }
                        }]
                });
        }
    } else if (loop > 0) {
        setTimeout(function(){ 
            notifyAtividade(id_demanda, event, loop-1);
            if(verifyConfigValue('debugpage')) console.log('Reload notifyAtividade'); 
        }, 1000);
    }
}
function deleteAtividade(id_demanda = 0) {
    var action = (checkCapacidade('delete_atividade_all')) ? 'delete_atividade_all' : 'delete_atividade';
    var id_unidade = (id_demanda == 0) ? $('#ativ_id_unidade').val() : arrayConfigAtivUnidade.id_unidade;
        id_unidade = (typeof id_unidade !== 'undefined') ? id_unidade : false;

        id_demanda = (id_demanda == 0) ? $('#ativ_id_demanda').val() : id_demanda;
        id_demanda = (typeof id_demanda !== 'undefined' && id_demanda != 0 ) ? id_demanda : false;
    var param = {
                    id_demanda: id_demanda, 
                    id_unidade: id_unidade, 
                    action: action
                };
    if (id_demanda && id_unidade) { getServerAtividades(param, action) }
}
function extractDataAtiv(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    var arrayAtiv = {};
    _parent.find('input,textarea,select').each(function(){
        if (typeof $(this).data('key') !== 'undefined') { 
            var value = $(this).val();
            var date_format = (value && value.indexOf('T') !== -1) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
            var dataValue = ($(this).attr('type') == 'number' || (value != '' && $(this).data('key').indexOf('id_') !== -1)) ? parseInt(value) : value;
                dataValue = ($(this).attr('type') == 'number' && parseFloat($('#ativ_tempo_despendido').attr('step')) >= 1) ? parseFloat(value) : value;
                dataValue = ($(this).attr('type') == 'date') ? (value == '' ? '' : (moment(value, date_format).format('YYYY-MM-DD')+' 00:00:00')) : dataValue;
                dataValue = ($(this).attr('type') == 'datetime-local') ? (value == '' ? '' : moment(value, date_format).format('YYYY-MM-DD HH:mm:ss')) : dataValue;
                dataValue = ($(this).attr('type') == 'checkbox') ? ($(this).is(':checked') ? 'on' : 'off') : dataValue;
                dataValue = ($(this).is('textarea') || ($(this).is('input') && $(this).attr('type') == 'text') ) ? dataValue.replace(/["']/g, "").replace(/([\u200B]+|[\u200C]+|[\u200D]+|[\u200E]+|[\u200F]+|[\uFEFF]+)/g, "") : dataValue;
                dataValue = ($(this).is('input') && $(this).attr('type') == 'hidden' && $(this).data('type') == 'json') ? JSON.parse(value) : dataValue;
                dataValue = ($(this).is('input') && $(this).attr('type') == 'hidden' && $(this).data('type') == 'num') ? parseFloat(value) : dataValue;
                dataValue = ($(this).is('input') && $(this).attr('type') == 'hidden') ? value : dataValue;
            arrayAtiv[$(this).data('key')] = dataValue;
        }
    });
    arrayAtiv.etiquetas = (typeof arrayAtiv.etiquetas !== 'undefined' && arrayAtiv.etiquetas != '' && arrayAtiv.etiquetas.indexOf(';') !== -1) 
                        ? arrayAtiv.etiquetas.split(';') 
                        : (typeof arrayAtiv.etiquetas !== 'undefined' && arrayAtiv.etiquetas != '') ? [arrayAtiv.etiquetas] : null;
    arrayAtiv.tempo_pactuado = (arrayAtiv.tempo_pactuado != '') ? _parent.find('#ativ_tempo_pactuado').data('tempo-pactuado') : arrayAtiv.tempo_pactuado;
    arrayAtiv.tempo_planejado = (Number.isNaN(arrayAtiv.tempo_planejado)) ? '' : arrayAtiv.tempo_planejado;
    arrayAtiv.fator_complexidade = (arrayAtiv.fator_complexidade != '') ? parseFloat(_parent.find('#ativ_fator_complexidade').val()) : arrayAtiv.fator_complexidade;
    arrayAtiv.fator_complexidade = (Number.isNaN(arrayAtiv.fator_complexidade)) ? null : arrayAtiv.fator_complexidade;
    arrayAtiv.lista_prioridades = extractInputPriority(this_);
    arrayAtiv.lista_marcador = $('#ativ_marcador').is(':visible') 
        ? {
            id_marcador: $('#ativ_lista_marcador').val(),
            icon: $('#ativ_lista_marcador').find('option:selected').data('img-src'),
            tag: $('#ativ_lista_marcador').find('option:selected').text()
        } 
        : false;
    arrayAtiv.lista_recorrencia = (arrayAtiv.hasOwnProperty('lista_recorrencia') && arrayAtiv.lista_recorrencia != '') ? JSON.parse(arrayAtiv.lista_recorrencia) : arrayAtiv.lista_recorrencia;
    arrayAtiv.id_user = (arrayAtiv.hasOwnProperty('id_user') && arrayAtiv.id_user !== null && arrayAtiv.id_user.trim() != '') ? arrayAtiv.id_user : 0;
    arrayAtiv.id_unidade = (arrayAtiv.id_unidade == '') ? arrayConfigAtivUnidade.id_unidade : arrayAtiv.id_unidade;
    return arrayAtiv;
}
function extractInputPriority(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var id_demanda = _parent.data('demanda');
    var priority = [];
    var index = 0;
    $('#ativ_lista_prioridades:visible').find('option').each(function(){
        var selected = $(this).is(':selected');
        var data = $(this).data();
        if (selected) {
            index++;
            priority.push({id_demanda: id_demanda, prioridade: index});
        }
            index++;
            priority.push({id_demanda: data.demanda, prioridade: index});
    });
    return priority;
}
function changeProtocoloBoxAtiv(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    if (checkValue(_this)) {
        var protocoloSEI = _this.val().trim();
        getIDProtocoloSEI(protocoloSEI,  
            function(html){
                let $html = $(html);
                var params = getParamsUrlPro($html.find('#ifrArvore').attr('src'));
                var hidden = _this.closest('td').find('input[type="hidden"]');
                var param = hidden.data('param');
                    hidden.val(params[param]);
                    _this.removeClass('requiredNull');
            }, 
            function(){
                alertaBoxPro('Error', 'exclamation-triangle', 'Protocolo n\u00E3o encontrado!');
                _this.addClass('requiredNull');
            });
    } else {
        _this.removeClass('requiredNull');
        _this.closest('td').find('input[type="hidden"]').val('');
    }
}
function checkThisAtivRequiredFields(this_) {
    var _this = $(this_);
    if (_this.prop('required') && checkValue(_this)) { _this.removeClass('requiredNull') }
    if (checkAtivRequiredFields(this_, 'check')) { updateButtonConfirm(this_, true) } else { updateButtonConfirm(this_, false) }
}
function checkAtivRequiredDocuments(this_) {
    var _this = $(this_);
    var _return = true;
    var _parent = ($('.ui-dialog').is(':visible')) ? _this.closest('.ui-dialog') : _this.closest('.seiProForm') ;
    var table_docs = _parent.find('[data-key="documentos"]');
        table_docs = typeof table_docs !== 'undefined' && table_docs.is(':visible') ? true : false;
    var doc = extractOptionConfigItem(_parent);
        doc = doc && typeof doc.documentos !== 'undefined' ? jmespath.search(doc.documentos,"[?documento!='undefined'] | [?id_procedimento!='0']") : null;
    if (table_docs) {
        if (typeof doc !== 'undefined' && doc !== null && doc.length) {
            _return = true;
        } else {
            _return = false;
            alertaBoxPro('Error', 'exclamation-triangle', 'Necess\u00E1ria a vincula\u00E7\u00E3o de um documento!');
        }
    }
    return _return;
}
function checkAtivRequiredFields(this_, mode) {
    var _this = $(this_);
    var _parent = ($('.ui-dialog').is(':visible')) ? _this.closest('.ui-dialog') : _this.closest('.seiProForm') ;
    var _return = true;

    function checkFilds(__this) {
        if (!checkValue(__this)) {
            if (mode == 'mark') { 
                __this.addClass('requiredNull');
                $('#'+__this.attr('id')+'_chosen').addClass('requiredNull');
            }
            _return = false;
        } else {
            if (mode == 'mark') { 
                __this.removeClass('requiredNull');
                $('#'+__this.attr('id')+'_chosen').removeClass('requiredNull');
            }
        }
    }
    _parent.find('input,textarea,select').filter('[required]:visible').not(':disabled').each(function(){
        checkFilds($(this));
    });
    _parent.find('.requiredSelect').each(function(){
        checkFilds($(this));
    });
    
    return _return;
}
function changeAtivMultiSwitch(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    if(_this.is(':checked')) {
        _parent.find('#div_ativ_fator_multiplicacao').show();
    } else {
        _parent.find('#div_ativ_fator_multiplicacao').hide();
    }
    _parent.find('#ativ_fator_multiplicacao').val(1);
    updateAtivTempoPactuado(this_);
}
function resizeDialogBoxSwitch(this_, padding) {
    var _this = $(this_);
    var height = $('.ui-dialog:visible').height();
    var boxHeight = (_this.is(':checked')) ? height+padding : 'auto';
        dialogBoxPro.dialog( 'option', 'height', boxHeight );
}
function changeAtivVinculacaoSwitch(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    if(_this.is(':checked')) {
        _parent.find('#div_ativ_lista_vinculacao').show();
    } else {
        _parent.find('#div_ativ_lista_vinculacao').hide();
    }
    _parent.find('#div_ativ_lista_vinculacao').val(0);
    // resizeDialogBoxSwitch(this_, 130);
}
function changeAtivMarcadorSwitch(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    if(_this.is(':checked')) {
        _parent.find('#div_ativ_lista_marcador').show();
        
        var id_procedimento = getParamsUrlPro(window.location.href).id_procedimento;
            id_procedimento = (typeof id_procedimento === 'undefined') ? getParamsUrlPro(window.location.href).id_protocolo : id_procedimento;
            id_procedimento = (typeof id_procedimento === 'undefined') ? getParamsUrlPro($('#ifrArvore').attr('src')).id_procedimento : id_procedimento;
        var listaMarcadores = getOptionsPro('listaMarcadores');
        var listaMarcadores_unidade = getOptionsPro('listaMarcadores_unidade');
        var dataMarcador = (id_procedimento && listaMarcadores) ? jmespath.search(listaMarcadores, "[?id_procedimento=='"+id_procedimento+"'] | [0]") : null;
            dataMarcador = (dataMarcador !== null) ? dataMarcador : false;
        var textTag = dataMarcador.name;
        var tagName = dataMarcador.tag;
        
        if (listaMarcadores && listaMarcadores_unidade == $('#selInfraUnidades').val()) {
            var htmlOptions = $.map(listaMarcadores, function(v){
                                var selected = (tagName && tagName == v.name) ? 'selected' : '';
                                return '<option data-img-src="'+v.img+'" value="'+v.value+'" '+selected+'>'+v.name+'</option>';
                            }).join('');
                _parent.find('#ativ_lista_marcador').html(htmlOptions).trigger('chosen:updated').chosenImage();
        } else {
            var ifrArvore = $('#ifrArvore');
            var arrayLinksArvore = ifrArvore[0].contentWindow.arrayLinksArvore;
                arrayLinksArvore = (typeof arrayLinksArvore === 'undefined') ? parent.linksArvore : arrayLinksArvore;
            var href = jmespath.search(arrayLinksArvore, "[?name=='Gerenciar Marcador'].url");
            if (href !== null) {
                $.ajax({ 
                    url: href
                }).done(function (html) {
                    var $html = $(html);
                        listaMarcadores = getListaMarcadores($html).array;
                    var htmlOptions = $.map(listaMarcadores, function(v){
                                        var selected = (tagName && tagName == v.name) ? 'selected' : '';
                                        return '<option data-img-src="'+v.img+'" value="'+v.value+'" '+selected+'>'+v.name+'</option>';
                                    }).join('');
                        _parent.find('#ativ_lista_marcador').html(htmlOptions).trigger('chosen:updated').chosenImage();
                });
            }
        }
    } else {
        _parent.find('#div_ativ_lista_marcador').hide();
        _parent.find('#ativ_lista_marcador').html('');
    }
    _parent.find('#div_ativ_lista_marcador').val(0);
    // resizeDialogBoxSwitch(this_, 130);
}
function changeAtivPrioritySwitch(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    if(_this.is(':checked')) {
        _parent.find('#div_ativ_lista_prioridades').show();
    } else {
        _parent.find('#div_ativ_lista_prioridades').hide();
    }
    _parent.find('#ativ_lista_prioridades').val(0);
    updateAtivTempoPactuado(this_);
    // resizeDialogBoxSwitch(this_, 130);
}
function changeAtivRecalcPrazoSwitch(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    if(_this.is(':checked')) {
        _parent.find('.infoAtivRecalcPrazo').show();
    } else {
        _parent.find('.infoAtivRecalcPrazo').hide();
    }
}
function initSimpleTableCellEditor(id, TimeOut = 9000) {
    if (TimeOut <= 0) { return; }
    if (typeof SimpleTableCellEditor !== 'undefined') { 
        getSimpleTableCellEditor(id);
    } else {
        setTimeout(function(){ 
            initSimpleTableCellEditor(id, TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initSimpleTableCellEditor'); 
        }, 500);
    }
}
function getSimpleTableCellEditor(id) {
    ativBox = new SimpleTableCellEditor(id);
    ativBox.SetEditableClass("editCell");
}
function changeAtivChecklistSwitch(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    var idTable = 'ativBox_checklist';
    var table = $('#'+idTable);
    var table_body = table.find('tbody');
    var checklist = $('#ativ_checklist').val();
        checklist = (checklist != '') ? JSON.parse(checklist) : [];
    if(_this.is(':checked')) {
        _parent.find('#div_ativ_lista_checklist').show();

        if (!table.hasClass('tableEditCell')) {
            if (typeof SimpleTableCellEditor === 'undefined') { 
                $.getScript((URL_SPRO+"js/lib/jquery-table-edit.min.js"));
                initSimpleTableCellEditor(idTable);
            } else {
                getSimpleTableCellEditor(idTable);
            }
            table.addClass('tableEditCell');
        }
        
        $('#'+idTable+'.tableSortable tbody').sortable({
            items: 'tr',
            cursor: 'grabbing',
            handle: '.sorterTrConfig',
            forceHelperSize: true,
            opacity: 0.5,
            axis: 'y',
            dropOnEmpty: false,
            update: function(event, ui) {
                $(this).find('tr').each(function(index, value){
                    $(this).attr('data-index',index).data('index',index);
                });
                changeAtivChecklistInput(this);
            }
        });

        if (checklist.length == 0) {
            var html =  '                                        <tr data-index="0" data-key="checklist" style="text-align: left;">'+
                        '                                            <td onchange="changeConfigItemCell(this); changeAtivChecklistInput(this);" class="editCell" data-type="text" style="padding: 0 10px;"></td>'+
                        '                                            <td style="width: 50px; text-align: center;">'+
                        '                                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                        '                                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                        '                                            </td>'+  
                        '                                        </tr>';
                table_body.append(html);

                setTimeout(function(){ 
                    table_body.find('tr:last-child').find('td:first-child').trigger('click');
                }, 100);
        } else if (checklist.length > 0) {
            var html = '';
            $.each(checklist, function(i, v){
                html += '                                        <tr data-index="'+i+'" data-key="checklist" style="text-align: left;">'+
                        '                                            <td onchange="changeConfigItemCell(this); changeAtivChecklistInput(this);" class="editCell" data-type="text" style="padding: 0 10px;">'+v+'</td>'+
                        '                                            <td style="width: 50px; text-align: center;">'+
                        '                                               <i class="fas fa-bars cinzaColor sorterTrConfig" style="cursor: grab;"></i>'+
                        '                                               <i class="fas fa-trash-alt cinzaColor removeTrConfig" style="cursor: pointer;float: right;margin-right: 10px;" onclick="removeConfigRow(this)"></i>'+
                        '                                            </td>'+  
                        '                                        </tr>';

            });
            table_body.append(html);
        }
        changeAtivChecklistInput(table_body[0]);
    } else {
        _parent.find('#div_ativ_lista_checklist').hide();
        table_body.html('');
        $('#ativ_checklist').val('[]');
        table.data('mode-insert','auto');
    }
}
function changeAtivChecklistInput(this_) {
    var table = $(this_).closest('table');
    setTimeout(function(){ 
        var arrayChecklist = table.find('tbody .editCell').map(function(){ var text = $(this).text().trim(); if (text!= '') { return $(this).text().trim() } }).get();
        $('#ativ_checklist').val(JSON.stringify(arrayChecklist));
        table.data('mode-insert','manual');
    }, 100);
}
function changeAtivEtiqueta() {
    $('.atividadeWork .tagsinput').find('.tag').each(function(){
        var name = $(this).text().trim();
        var html = $(getHtmlEtiqueta(name, 'ativ'));
        var icon = html.find('i')[0].outerHTML;
        var style = html.attr('style');
            style = (typeof style !== 'undefined') ? style : '';
            $(this).attr('style', style);
            $(this).find('.tag-text').attr('style', style);
            if ($(this).find('i').length == 0) {
                $(this).prepend(icon);
            }
    });
}
function getConfigDadosEntidade() {
    return (typeof arrayConfigAtividades !== 'undefined' && arrayConfigAtividades !== null && arrayConfigAtividades.hasOwnProperty('entidades') && arrayConfigAtividades.entidades != 0) ? jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config") : null;
}
function getOptionEntidade(option) {
    return (checkOptionEntidade(option)) ? getConfigDadosEntidade()[option] : false;
}
function checkOptionEntidade(option) {
    var config_entidade = getConfigDadosEntidade();
    return (config_entidade !== null && typeof config_entidade[option] !== 'undefined' && config_entidade[option] !== null && config_entidade[option]) ? true : false;
}
function getOptionUnidade(option, option2 = false) {
    var _return = (checkOptionUnidade(option)) ? arrayConfigAtivUnidade['config'][option] : false;
        _return = (option2 && _return && checkOptionUnidade(option, option2)) ? arrayConfigAtivUnidade['config'][option][option2] : false;
    return _return;
}
function checkOptionUnidade(option, option2 = false) {
    var config_unidade = arrayConfigAtivUnidade.config;
    var _return = (config_unidade !== null && typeof config_unidade[option] !== 'undefined' && config_unidade[option] !== null && config_unidade[option]) ? true : false;
        _return = (option2 && config_unidade && typeof config_unidade[option][option2] !== 'undefined' && config_unidade[option][option2] !== null && config_unidade[option][option2]) ? true : false;
    return _return;
}
function getConfigDadosUnidade(sigla_unidade) {
    var config_entidade = getConfigDadosEntidade();
    var unidade = (typeof sigla_unidade === 'undefined' || sigla_unidade === null) ? arrayConfigAtivUnidade.sigla_unidade : sigla_unidade;
    var _return = jmespath.search(arrayConfigAtividades.unidades, "[?sigla_unidade=='"+unidade+"'] | [0].{sigla_unidade: sigla_unidade, nome_unidade: nome_unidade, count_dias_uteis: config.distribuicao.count_dias_uteis, count_horas: config.distribuicao.count_horas, h_util_inicio: config.distribuicao.horario_util.inicio, h_util_fim: config.distribuicao.horario_util.fim, feriados: config.feriados, modalidades: config.modalidades}");
    if (_return != null) {
        _return['hora_format'] = (_return.count_horas) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
        if (typeof config_entidade.feriados !== 'undefined' && config_entidade.feriados.length > 0) {
            var feriados = (_return['feriados'] !== null) ? _return['feriados'] : [];
            $.each(config_entidade.feriados, function(i,v){
                if (jmespath.search(feriados,"[?feriado_data=='"+v.feriado_data+"']").length == 0) {
                    feriados.push(v);
                }
            });
            _return['feriados'] = feriados;
        }
        return _return;
    } else {
        return false;
    }
}
function getBoxConfigDadosUnidade(_parent) {
	var unidade = (_parent.find('#ativ_id_atividade').length > 0 && checkValue(_parent.find('#ativ_id_atividade'))) 
                    ? (_parent.find('#ativ_id_atividade').is('select') && typeof _parent.find('#ativ_id_atividade').data('config') !== 'undefined')
                        ? _parent.find('#ativ_id_atividade').find('option:selected').data('config').sigla_unidade 
                        : (typeof _parent.find('#ativ_id_atividade').data('config') !== 'undefined') 
                            ? _parent.find('#ativ_id_atividade').data('config').sigla_unidade 
                            : (_parent.find('#ativ_id_user').is('select') && typeof _parent.find('#ativ_id_user').data('config') !== 'undefined') 
                                ? _parent.find('#ativ_id_user').find('option:selected').data('config').sigla_unidade 
                                : arrayConfigAtivUnidade.sigla_unidade
                    : arrayConfigAtivUnidade.sigla_unidade;
    return getConfigDadosUnidade(unidade);
}
function changeDadosTrabalho(this_, autotime = false) {
  clearTimeout(dly);
  dly = setTimeout(function() {
    changeDadosTrabalho_(this_, autotime, 'despendido');
    if ($('#ativ_tempo_executado').length) changeDadosTrabalho_(this_, autotime, 'executado');
  }, 1000);
}
function changeDadosTrabalho_(this_, autotime = false, mode = 'despendido') {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var data = _this.data();
    var config_unidade = getBoxConfigDadosUnidade(_parent);
    var dataInicio = (mode == 'despendido') ? _parent.find('input[data-type="inicio"]') : _parent.find('input[data-type="distribuicao"]');
	var dtStart = dataInicio.val();
    var dataFim = _parent.find('input[data-type="fim"]');
    var diasWork = (mode == 'despendido') ? _parent.find('input[data-type="dias"]') : _parent.find('input[data-type="dias_executado"]');
    var config_feriados = (typeof config_unidade.feriados !== 'undefined' && config_unidade.feriados !== null) ? config_unidade.feriados : false;
    var arrayFeriados = (config_unidade.count_dias_uteis && dtStart != '' && checkValue(dataFim)) 
                            ? jmespath.search(getHolidayBetweenDates(moment(dtStart, config_unidade.hora_format).format('Y')+'-01-01',moment(dataFim.val(), config_unidade.hora_format).add(1, 'Y').format('Y')+'-01-01', config_feriados), "[*].d_")
                            : [];
    var dtEnd_Contagem = (diasWork.val() == '' ||  dtStart == '') 
                            ? ''
                            : (config_unidade.count_dias_uteis) 
                                ? moment(dtStart).isoAddWeekdaysFromSet({  
                                    'workdays': parseInt(diasWork.val()),  
                                    'weekdays': [1,2,3,4,5],  
                                    'exclusions': arrayFeriados
                                    }).format(config_unidade.hora_format)
                                : moment(dtStart, config_unidade.hora_format).add(parseInt(diasWork.val()), 'days').format(config_unidade.hora_format);
    var dtEnd = ( data.type == 'fim' )  ? dataFim.val() 
                                                 : dtEnd_Contagem;
    var nrDias_Contagem = (dtStart == '' || dtEnd == '')
                            ? 0
                            : (config_unidade.count_dias_uteis) 
                                ? moment().isoWeekdayCalc({  
                                  rangeStart: dtStart,  
                                  rangeEnd: dtEnd,  
                                  weekdays: [1,2,3,4,5],  
                                  exclusions: arrayFeriados
                                })-1
                                : moment(dtEnd, config_unidade.hora_format).diff(moment(dtStart, config_unidade.hora_format), 'days');
	var nrDias = ( data.type == 'fim' ) ? nrDias_Contagem
                                        : diasWork.val();
        nrDias = (nrDias < 0) ? 0 : nrDias;

        if ( data.type == 'fim' ) { diasWork.val(nrDias) }

        var dtEnd_hour = moment((moment(dtEnd, config_unidade.hora_format).format('YYYY-MM-DD')+'T'+moment(dataFim.val(), config_unidade.hora_format).format('HH:mm')), config_unidade.hora_format).format(config_unidade.hora_format);
        var dtStart_hour = moment((moment(dtStart, config_unidade.hora_format).format('YYYY-MM-DD')+'T'+moment(dataInicio.val(), config_unidade.hora_format).format('HH:mm')), config_unidade.hora_format).format(config_unidade.hora_format);
            dataFim.val(dtEnd_hour);

        if (typeof dataFim.data('date-min') === 'undefined' || dataFim.data('date-min') != 'fixed') { 
            dataFim.attr('min', dtStart_hour);
        }
        if (typeof dataInicio.data('date-max') === 'undefined' || dataInicio.data('date-max') != 'fixed') {
            dataInicio.attr('max', dtEnd_hour);
        } 
    
        updateTempoTrabalhoAtiv(this_, mode); 
        checkThisAtivRequiredFields(this_);

        if ( data.type == 'dias' ) { checkDatasTrabalho(dataFim) } else { checkDatasTrabalho(_this) }
        // console.log(data.type, dataFim, _this);

        checkTempoProdutividade(_this);
    if (config_unidade.count_dias_uteis && config_unidade.count_horas && (data.key == 'data_distribuicao' || data.key == 'prazo_entrega')) {
        checkTempoUtilTrabalho(dataFim);
        checkTempoUtilTrabalho(dataInicio);
    }
    if (autotime) { 
        diasWork.data('autotime','auto') 
    } else { 
        diasWork.data('autotime',false);
    }
    if ($('.modoDistribuicao_recorrente:visible').length > 0) {
        var updateAtiv = _parent.find('#ativ_id_atividade');
        if (typeof updateAtiv.data('update_recorrencia') === 'undefined' || updateAtiv.data('update_recorrencia') == false) {
            calculoRecorrenciaAtiv(this_);
        }
    }
    prepareFieldsReplace(this_);
    getLabelTempoDespendido();
    if (data.type == 'inicio') dataFim.trigger('change');

    // console.log({config_unidade: config_unidade, dtEnd_hour: dtEnd_hour, dtEnd: dtEnd, hora_format: config_unidade.hora_format, dataFim: dataFim.val(), mode: mode, autotime: autotime});

}
function checkTempoProdutividade(_this) {
    if (!checkOptionEntidade('desativa_produtividade_geral')) {
        var _parent = _this.closest('.atividadeWork');
        var value = getAtividadeData(_parent.attr('data-demanda'));
        if (value && value !== null) {
            var html = getInfoAtividadeProdutividade(value, true, 'despendido');
            _parent.find('#ativ_produtividade').html(html);
            
            var htmlExec = getInfoAtividadeProdutividade(value, true, 'executado');
            _parent.find('#ativ_produtividade_executada').html(htmlExec);
        }
    }
}
function checkDatasTrabalho(_this) {
    var _parent = _this.closest('.atividadeWork');
    var config_unidade = getBoxConfigDadosUnidade(_parent);
    var dataInicio = _parent.find('input[data-type="inicio"]');
    var labelInicio = dataInicio.data('name');
    var dataFim = _parent.find('input[data-type="fim"]');
    var dataWork = _parent.find('input[data-type="dias"]');
    var labelFim = dataFim.data('name');
    var element = _this[0];
        
    if ( moment(dataFim.val(), config_unidade.hora_format) < moment(dataInicio.val(), config_unidade.hora_format) ) { 
        element.setCustomValidity('*'); 
        if (dataWork.length > 0) { dataWork.data('autotime',false); }
    } else { 
        element.setCustomValidity(''); 
    }
    var userValidation = element.checkValidity();
    
    if (userValidation) {
        _this.removeClass('requiredNull').closest('tr').removeClass('requiredNull');
    } else {
        _this.addClass('requiredNull');
        element.setCustomValidity('A '+labelFim+' deve ser maior ou igual que a '+labelInicio);
        var isValid = element.reportValidity();
    }
}
function checkTempoUtilTrabalho(_this) {
    var _parent = _this.closest('.atividadeWork');
    var config_unidade = getBoxConfigDadosUnidade(_parent);
    var element = _this[0];
    var _this_moment = moment(_this.val(), config_unidade.hora_format);
    var h_utilInicio = moment(_this_moment.format('YYYY-MM-DD')+'T'+config_unidade.h_util_inicio, config_unidade.hora_format);
    var h_utilFim = moment(_this_moment.format('YYYY-MM-DD')+'T'+config_unidade.h_util_fim, config_unidade.hora_format);
    if (typeof element !== 'undefined') {
        if ( _this_moment < h_utilInicio || _this_moment > h_utilFim ) { 
            element.setCustomValidity('*'); 
        } else { 
            element.setCustomValidity(''); 
        }
        var userValidation = element.checkValidity();
        
        if (userValidation) {
            _this.removeClass('requiredNull');
        } else {
            _this.addClass('requiredNull');
            element.setCustomValidity('Selecione um hor\u00E1rio dentro do hor\u00E1rio \u00FAtil de trabalho ('+config_unidade.h_util_inicio+' \u00E0s '+config_unidade.h_util_fim+')');
            var isValid = element.reportValidity();
        }
    }
}
function getTagTempoDecorridoAtiv(value, float_right = true, force_calc = false) {
    var tempoDecorrido = getTempoDecorridoAtiv(value, force_calc);
    var htmlTagTempo = '';
    var textTooltip_pause = (typeof value.pausa_lista !== 'undefined' && value.pausa_lista !== null && value.pausa_lista.length > 0) 
            ? $.map(value.pausa_lista, function(v, i){ 
                    var data_inicio = moment(v.data_inicio,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm');
                    var data_fim = (v.data_fim == '0000-00-00 00:00:00') ? 'agora' : moment(v.data_fim,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm');
                    return '('+(i+1)+') '+data_inicio+' \u00E0 '+data_fim
                }).join('<br>')
            : false;
        textTooltip_pause = (textTooltip_pause) ? '<br> -- Paralisa\u00E7\u00F5es<br>'+textTooltip_pause : '';

    var textTooltip = 'Iniciada em: '+moment(value.data_inicio,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm');
        htmlTagTempo =  '<span style="'+(float_right ? 'float: right;' : '')+'margin: 0;" class="dateboxDisplay '+(value.tempo_pactuado != 0 && tempoDecorrido > value.tempo_pactuado ? 'urgenteBoxDisplay' : '')+'">'+
                        '   <span class="dateBoxIcon" onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\''+textTooltip+textTooltip_pause+'\')">'+
                        '       <i class="fas fa-stopwatch '+(value.tempo_pactuado != 0 && tempoDecorrido > value.tempo_pactuado ? 'vermelhoColor' : 'azulColor')+'" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '   </span>'+
                        '   '+decimalHourToMinute(tempoDecorrido)+' '+(tempoDecorrido > 1 ? 'horas decorridas': 'hora decorrida')+
                        '</span>';
    var checkConfigAtiv = jmespath.search(arrayConfigAtividades.atividades, "[?id_atividade==`"+value.id_atividade+"`] | [0].config.desativa_produtividade");
    return (checkConfigAtiv) ? '' : htmlTagTempo;
}
function getTagTempoPactuadoAtiv(value) {
    var tagText = normalizeNameTag(value.apelido);
    var tempoPactuado = (value.tempo_pactuado == 0) ? 'N\u00E3o pactuado' : decimalHourToMinute(value.tempo_pactuado)+' '+(value.tempo_pactuado > 1 ? 'horas' : 'hora');
    var htmlTagTempo =  '<span class="info_tags_follow info_tags_pacto">'+
                        '   <span data-colortag="#bfd5e8" style="background-color: #eef4f9;font-size: 10pt;color: #666;" class="tag_text tagTableText_'+tagText+'" title="'+value.tempo_pactuado+' '+(value.tempo_pactuado > 1 ? 'horas' : 'hora')+'">'+
                        '       <i data-colortag="#7d99af" class="fas fa-handshake" style="font-size: 90%; margin: 0px 2px; color: #7d99af;"></i>'+
                        '       '+tempoPactuado+
                        '   </span>'+
                        '</span>';
    return htmlTagTempo;
}
function getTagTempoDespendidoAtiv(value, float_right = true) {

    var textTooltip_pause = (typeof value.pausa_lista !== 'undefined' && value.pausa_lista !== null && value.pausa_lista.length > 0) 
                            ? $.map(value.pausa_lista, function(v, i){ return '('+(i+1)+') '+moment(v.data_inicio,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm')+' \u00E0 '+moment(v.data_fim,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY HH:mm') }).join('<br>')
                            : false;
                        textTooltip_pause = (textTooltip_pause) ? '<br> -- Paralisa\u00E7\u00F5es<br>'+textTooltip_pause : '';

    var textTooltip =   'Iniciada em: '+moment(value.data_inicio,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm')+'<br>'+
                        'Conclu\u00EDda em: '+moment(value.data_entrega,'YYYY-MM-DD HH:mm:ss').format('DD/MM/YYYY [\u00E0s] HH:mm');
        htmlTagTempo =  '<span style="'+(float_right ? 'float: right;' : '')+'margin: 0;" class="dateboxDisplay">'+
                        '   <span class="dateBoxIcon" onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\''+textTooltip+textTooltip_pause+'\')">'+
                        '       <i class="fas fa-stopwatch verdeColor" style="padding-right: 3px; cursor: pointer; font-size: 12pt;"></i>'+
                        '   </span>'+
                        '   '+decimalHourToMinute(value.tempo_despendido)+' '+(value.tempo_despendido > 1 ? 'horas despendidas': 'hora despendida')+
                        '</span>';
    var checkConfigAtiv = jmespath.search(arrayConfigAtividades.atividades, "[?id_atividade==`"+value.id_atividade+"`] | [0].config.desativa_produtividade");
    return (checkConfigAtiv) ? '' : htmlTagTempo;
}
function getTempoDecorridoAtiv(value, force_calc = false) {
    // var arrayConfigAtividades = (typeof arrayConfigAtividades !== 'undefined') ? arrayConfigAtividades : parent.arrayConfigAtividades;
    var data_inicio = (force_calc) ? value.data_distribuicao : value.data_inicio;
    var config_unidade = getConfigDadosUnidade(value.sigla_unidade);

    var h_util_inicio = (config_user && config_user.hasOwnProperty('distribuicao') && config_user.distribuicao.hasOwnProperty('horario_util')) ? config_user.distribuicao.horario_util.inicio : config_unidade.h_util_inicio;
    var h_util_fim = (config_user && config_user.hasOwnProperty('distribuicao') && config_user.distribuicao.hasOwnProperty('horario_util')) ? config_user.distribuicao.horario_util.fim : config_unidade.h_util_fim;
    var carga_horaria = jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+value.id_user+"`] | [0].carga_horaria");
        carga_horaria = (carga_horaria == null) ? 8 : carga_horaria;

    var config_entidade = jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config");
        config_entidade = (config_entidade !== null) ? config_entidade : false;
    var carga_horaria_padrao = (config_entidade && typeof config_entidade.carga_horaria_padrao !== 'undefined' && config_entidade.carga_horaria_padrao !== null) ? config_entidade.carga_horaria_padrao : 8;

    var config_user = (typeof arrayConfigAtividades !== 'undefined' && arrayConfigAtividades !== null && typeof arrayConfigAtividades.perfil !== 'undefined' &&  arrayConfigAtividades.perfil.hasOwnProperty('config') && arrayConfigAtividades.perfil.config !== null) ? arrayConfigAtividades.perfil.config : false;
        config_user = (typeof config_user !== 'undefined') ? config_user : {carga_horaria: carga_horaria_padrao};

    var config_feriados = (typeof config_unidade.feriados !== 'undefined' && config_unidade.feriados !== null) ? config_unidade.feriados : false;
    var arrayFeriados = (config_unidade.count_dias_uteis && data_inicio != '' && value.data_fim != '') 
                        ? jmespath.search(getHolidayBetweenDates(moment(data_inicio, 'YYYY-MM-DD HH:mm:ss').format('Y')+'-01-01', moment(value.data_fim, 'YYYY-MM-DD HH:mm:ss').add(1, 'Y').format('Y')+'-01-01', config_feriados), "[*].d_")
                        : [];
    var currentDate = (typeof value.data_pausa !== null && value.data_pausa != '0000-00-00 00:00:00' && (typeof value.data_retomada === null || value.data_retomada == '0000-00-00 00:00:00') ) ? moment(value.data_pausa, 'YYYY-MM-DD HH:mm:ss') : moment();
    var valueDias = (config_unidade.count_dias_uteis) 
                ? currentDate.isoWeekdayCalc({  
                    rangeStart: data_inicio,  
                    rangeEnd: currentDate.format('YYYY-MM-DD'),  
                    weekdays: [1,2,3,4,5],  
                    exclusions: arrayFeriados
                })-1
                : moment(value.data_fim, 'YYYY-MM-DD HH:mm:ss').diff(moment(data_inicio, 'YYYY-MM-DD HH:mm:ss'), 'days');
        valueDias = (valueDias < 0) ? 0 : valueDias;
    var h_dataInicio = moment(data_inicio, 'YYYY-MM-DD HH:mm:ss');
    var h_dataFim = currentDate;
    var h_utilInicio = moment(h_dataFim.format('YYYY-MM-DD')+'T'+h_util_inicio, 'YYYY-MM-DDTHH:mm');
    var h_utilFim = moment(h_dataInicio.format('YYYY-MM-DD')+'T'+h_util_fim, 'YYYY-MM-DDTHH:mm');
    var currentDt = currentDate.format('YYYY-MM-DD HH:mm:ss');
    var totalDespendido = 0;

    function getCalcPausasDt(initData, endData, value) {
        var valueDias = (config_unidade.count_dias_uteis) 
                    ? moment().isoWeekdayCalc({  
                        rangeStart: initData,  
                        rangeEnd: endData,  
                        weekdays: [1,2,3,4,5],  
                        exclusions: arrayFeriados
                    })-1
                    : moment(endData, 'YYYY-MM-DD HH:mm:ss').diff(moment(initData, 'YYYY-MM-DD HH:mm:ss'), 'days');
            valueDias = (valueDias < 0) ? 0 : valueDias;
        var h_dataInicio = moment(initData, 'YYYY-MM-DD HH:mm:ss');
        var h_dataFim = moment(endData, 'YYYY-MM-DD HH:mm:ss');
        var h_utilInicio = moment(h_dataFim.format('YYYY-MM-DD')+'T'+h_util_inicio, 'YYYY-MM-DDTHH:mm');
        var h_utilFim = moment(h_dataInicio.format('YYYY-MM-DD')+'T'+h_util_fim, 'YYYY-MM-DDTHH:mm');
        
        var param = {
            id_pausa: value.id_pausa,
            id_demanda: value.id_demanda,
            count_dias_uteis: config_unidade.count_dias_uteis,
            count_horas: config_unidade.count_horas,
            h_dataInicio: h_dataInicio,
            h_dataFim: h_dataFim,
            h_utilInicio: h_utilInicio,
            h_utilFim: h_utilFim,
            carga_horaria: carga_horaria,
            valueDias: valueDias
        };
        var tempoTrabalho = getTempoTrabalhoAtiv(param);
        return tempoTrabalho;
    }
    
    if (typeof value.pausa_lista !== 'undefined' && value.pausa_lista !== null && value.pausa_lista.length > 0) {
        var initData = data_inicio;
        var endData = value.pausa_lista[0].data_inicio;
        var initTempoTrabalho = getCalcPausasDt(initData, endData, value);
            totalDespendido = totalDespendido+initTempoTrabalho;
        
        $.each(value.pausa_lista, function(i, v){
            if (typeof value.pausa_lista[i+1] !== 'undefined') {
                var pausaDataFim = (v.data_fim == '0000-00-00 00:00:00') ? currentDt : v.data_fim;
                var pausaTempoTrabalho = getCalcPausasDt(v.data_fim, value.pausa_lista[i+1].data_inicio, value);
                    totalDespendido = totalDespendido+pausaTempoTrabalho;
            }
        });
    
        var endTempoTrabalhoInicio = value.pausa_lista[value.pausa_lista.length-1].data_fim;
        if (endTempoTrabalhoInicio != '0000-00-00 00:00:00') {
            var endTempoTrabalhoFim = currentDt;
            var endTempoTrabalho = getCalcPausasDt(endTempoTrabalhoInicio, endTempoTrabalhoFim, value);
            totalDespendido = totalDespendido+endTempoTrabalho;
        }
    } else {
        totalDespendido = getCalcPausasDt(data_inicio, currentDt, value);
    }
    return totalDespendido;
}
function updateTempoTrabalhoAtiv(this_, mode = 'despendido') {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var user = _parent.find('#ativ_id_user');
    var dias = (mode == 'despendido') ? _parent.find('input[data-type="dias"]') : _parent.find('input[data-type="dias_executado"]');
    var tempo = (mode == 'despendido') ? _parent.find('input[data-type="tempo"]') : _parent.find('input[data-type="tempo_executado"]');
    var inicio = (mode == 'despendido') ? _parent.find('input[data-type="inicio"]') : _parent.find('input[data-type="distribuicao"]');
    var fim = _parent.find('input[data-type="fim"]');
    var atividade = _parent.find('#ativ_id_atividade');
    var config_atividade = (typeof atividade.data('config') !== 'undefined') ? atividade.data('config') : false;
    var carga_horaria_padrao = jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config.carga_horaria_padrao");
        carga_horaria_padrao = (carga_horaria_padrao == null) ? 8 : carga_horaria_padrao;

    if (config_atividade && typeof config_atividade.desativa_produtividade !== 'undefined' && config_atividade.hasOwnProperty('desativa_produtividade') && config_atividade.desativa_produtividade) {
        var ativ_tempo_pactuado = config_atividade.tempo_pactuado;
        tempo.val(ativ_tempo_pactuado).data('tempo-decimal',ativ_tempo_pactuado).data('tempo-geral',ativ_tempo_pactuado);
    } else {
        var config_user = (user.is('select')) ? user.find('option:selected').data('config') : user.data('config');
            config_user = (typeof config_user !== 'undefined') ? config_user : {carga_horaria: carga_horaria_padrao};
        var config_unidade = getBoxConfigDadosUnidade(_parent);

        var config_user_perfil = (arrayConfigAtividades.perfil.hasOwnProperty('config') && arrayConfigAtividades.perfil.config !== null) ? arrayConfigAtividades.perfil.config : false;
        var h_util_inicio = (config_user_perfil && config_user_perfil.hasOwnProperty('distribuicao') && config_user_perfil.distribuicao.hasOwnProperty('horario_util')) ? config_user_perfil.distribuicao.horario_util.inicio : config_unidade.h_util_inicio;
        var h_util_fim = (config_user_perfil && config_user_perfil.hasOwnProperty('distribuicao') && config_user_perfil.distribuicao.hasOwnProperty('horario_util')) ? config_user_perfil.distribuicao.horario_util.fim : config_unidade.h_util_fim;


        var tempo_total_pausas = getPausasAtividadeCalc(false, mode);
        // var tempo_pausado = _parent.find('#ativ_tempo_pausado');
            // tempo_pausado = (tempo_pausado.is(':visible') && tempo_pausado.val() > 0) ? tempo_pausado.val() : 0;
        var valueDias = dias.val();
        var h_dataInicio = moment(inicio.val(), config_unidade.hora_format);
        var h_dataFim = moment(fim.val(), config_unidade.hora_format);
        var h_utilInicio = moment(h_dataFim.format('YYYY-MM-DD')+'T'+h_util_inicio, config_unidade.hora_format);
        var h_utilFim = moment(h_dataInicio.format('YYYY-MM-DD')+'T'+h_util_fim, config_unidade.hora_format);
        if (checkValue(dias) && checkValue(inicio) && checkValue(fim)) {
            var param = {
                    count_dias_uteis: config_unidade.count_dias_uteis,
                    count_horas: config_unidade.count_horas,
                    h_dataInicio: h_dataInicio,
                    h_dataFim: h_dataFim,
                    h_utilInicio: h_utilInicio,
                    h_utilFim: h_utilFim,
                    carga_horaria: config_user.carga_horaria,
                    valueDias: valueDias
            };
            var tempo_geral = getTempoTrabalhoAtiv(param);
            var tempo_total = tempo_total_pausas ? tempo_total_pausas : tempo_geral;
            // var tempo_total = (tempo_geral-tempo_pausado);
                tempo.data('tempo-decimal',tempo_total);
                tempo_total = (tempo_total < 1) ? tempo_total.toFixed(3) : tempo_total.toFixed(1);
                tempo.val(parseFloat(tempo_total));
                if (typeof tempo.data('tempo-geral') === 'undefined') { tempo.data('tempo-geral', tempo_geral) }
                checkDatesAfast(fim.get(0), false);
                // console.log('getTempoTrabalhoAtiv***', param, tempo_geral, mode);
        } else {
            tempo.val(0.01).data('tempo-decimal','0').data('tempo-geral','0');
            // console.log('NULL getTempoTrabalhoAtiv***', config_atividade, checkValue(user), checkValue(dias), checkValue(inicio), checkValue(fim));
        }
    }
    if (_parent.find('#dividir_tempo_despendido').is(':checked') && _parent.find('#complete_others').is(':checked')) {
        var total_vinculadas = _parent.find('#lista_complete_others').val();
            total_vinculadas = typeof total_vinculadas !== 'undefined' && total_vinculadas !== null && total_vinculadas != '' && isJson(total_vinculadas) ? JSON.parse(total_vinculadas).length+1 : 0;
        var tempo_despendido = _parent.find('input[data-type="tempo"]').val();
        var despendido_parcial = (tempo_despendido/total_vinculadas).toFixed(2);
        tempo.val(despendido_parcial).data('tempo-decimal', despendido_parcial);
        getLabelTempoDespendido();
    }
}
function checkTemposDemanda(value, mode = 'tempo_planejado', return_tempo = true) {
    var carga_horaria_padrao = jmespath.search(arrayConfigAtividades.entidades,"[?id_entidade==`"+arrayConfigAtividades.perfil.id_entidade+"`] |[0].config.carga_horaria_padrao");
        carga_horaria_padrao = (carga_horaria_padrao == null) ? 8 : carga_horaria_padrao;
    var desativa_produtividade = jmespath.search(arrayConfigAtividades.atividades, "[?id_atividade==`"+value.id_atividade+"`] | [0].config.desativa_produtividade");

    var carga_horario_user = jmespath.search(arrayConfigAtividades.planos,"[?id_plano==`"+value.id_plano+"`] | [0].carga_horaria");
        carga_horario_user = carga_horario_user !== null ? carga_horario_user : carga_horaria_padrao;
    
    var config_unidade = getConfigDadosUnidade(value.sigla_unidade);

    var valueInit = value.data_distribuicao;
    var currentDate = moment(valueInit, 'YYYY-MM-DD HH:mm:ss');
    var valueEnd = (mode == 'tempo_planejado') ? value.prazo_entrega : value.data_entrega;
    
    var config_user_perfil = (arrayConfigAtividades.perfil.hasOwnProperty('config') && arrayConfigAtividades.perfil.config !== null) ? arrayConfigAtividades.perfil.config : false;
    var h_util_inicio = (config_user_perfil && config_user_perfil.hasOwnProperty('distribuicao') && config_user_perfil.distribuicao.hasOwnProperty('horario_util')) ? config_user_perfil.distribuicao.horario_util.inicio : config_unidade.h_util_inicio;
    var h_util_fim = (config_user_perfil && config_user_perfil.hasOwnProperty('distribuicao') && config_user_perfil.distribuicao.hasOwnProperty('horario_util')) ? config_user_perfil.distribuicao.horario_util.fim : config_unidade.h_util_fim;
    
    var h_dataInicio = moment(valueInit, config_unidade.hora_format);
    var h_dataFim = moment(valueEnd, config_unidade.hora_format);
    var h_utilInicio = moment(h_dataFim.format('YYYY-MM-DD')+'T'+h_util_inicio, config_unidade.hora_format);
    var h_utilFim = moment(h_dataInicio.format('YYYY-MM-DD')+'T'+h_util_fim, config_unidade.hora_format);

    var config_feriados = (typeof config_unidade.feriados !== 'undefined' && config_unidade.feriados !== null) ? config_unidade.feriados : false;
    var arrayFeriados = (config_unidade.count_dias_uteis && valueInit != '' && valueEnd != '') 
                        ? jmespath.search(getHolidayBetweenDates(moment(valueInit, 'YYYY-MM-DD HH:mm:ss').format('Y')+'-01-01', moment(valueEnd, 'YYYY-MM-DD HH:mm:ss').add(1, 'Y').format('Y')+'-01-01', config_feriados), "[*].d_")
                        : [];

    var valueDias = (mode == 'tempo_planejado') 
        ? value.dias_planejado
        : (config_unidade.count_dias_uteis) 
            ? currentDate.isoWeekdayCalc({  
                rangeStart: valueInit,  
                rangeEnd: valueEnd,  
                weekdays: [1,2,3,4,5],  
                exclusions: arrayFeriados
            })-1
            : moment(valueEnd, 'YYYY-MM-DD HH:mm:ss').diff(moment(valueInit, 'YYYY-MM-DD HH:mm:ss'), 'days');
    
    var param = {
            count_dias_uteis: config_unidade.count_dias_uteis,
            count_horas: config_unidade.count_horas,
            h_dataInicio: h_dataInicio,
            h_dataFim: h_dataFim,
            h_utilInicio: h_utilInicio,
            h_utilFim: h_utilFim,
            carga_horaria: carga_horario_user,
            valueDias: valueDias
    };
    var tempo_geral = getTempoTrabalhoAtiv(param);
    // console.log(mode, tempo_geral, param);

    return return_tempo ? tempo_geral : valueDias;
}
function updateServerTemposDemanda(type = 'set', mode = 'tempo_planejado', value = false, ativData = false, param = false) {
    if (type == 'reset') {
        var objIndexAtiv = (typeof arrayAtividadesPro === 'undefined' || arrayAtividadesPro == 0 || arrayAtividadesPro.length == 0) ? -1 : arrayAtividadesPro.findIndex((obj => obj.id_demanda == param.id_demanda));
        if (objIndexAtiv !== -1) {
            arrayAtividadesPro[objIndexAtiv][mode] = param.tempo;
        }
        if ($('#ativ_tempo_planejado_complete').length > 0 && type == 'tempo_planejado') {
            $('#ativ_tempo_planejado_complete').val(param.tempo);
            $('#ativ_data_entrega').trigger('change');
        } else if ($('#ratingAtividade[data-tempo-decorrido="0"]').length > 0) {
            rateAtividade(param.id_demanda);
        }
    } else {
        var tempo_geral = checkTemposDemanda(value, mode);
            tempo_geral = parseFloat(tempo_geral.toFixed(1));
        var tempo_init = (mode == 'tempo_planejado') ? value.tempo_planejado : value.tempo_executado;
            tempo_init = (typeof tempo_init !== 'undefined' && tempo_init !== null && tempo_init != 0) ? parseFloat(tempo_init.toFixed(1)) : 0;
        if (typeof tempo_init !== 'undefined' && tempo_init !== null && tempo_geral != tempo_init && 
                (
                    mode == 'tempo_planejado' ||
                    (mode == 'tempo_executado' && value.data_entrega != '0000-00-00 00:00:00')
                )
            ) {
            $('.update_tempos_demanda').addClass('fa-spin');
            var action = 'edit_tempos';
            var param = {
                action: action, 
                id_demanda: value.id_demanda,
                mode: mode,
                tempo: tempo_geral
            };
            getServerAtividades(param, action);
            setTimeout(function(){
                loadingButtonConfirm(false);
            }, 1000);
        } else {
            $('.update_tempos_demanda').addClass('fa-spin');
            checkTempoProdutividade($('.update_tempos_demanda'));
            setTimeout(() => {
                $('.update_tempos_demanda').removeClass('fa-spin');
            }, 2000);
        }
    }
}
function getTempoTrabalhoAtiv(param) {
    var tempo = '';
    if (param.count_dias_uteis && param.count_horas) {
        var h_planejada = moment.duration(param.h_dataFim.diff(param.h_dataInicio)).asHours();
        var countHoraInicio = (moment.duration(param.h_utilFim.diff(param.h_dataInicio)).asHours());
            countHoraInicio = (countHoraInicio < 0) ? 0 : countHoraInicio;
            countHoraInicio = (countHoraInicio > param.carga_horaria) ? param.carga_horaria : countHoraInicio;
        var countHoraFim = (moment.duration(param.h_dataFim.diff(param.h_utilInicio)).asHours());
            countHoraFim = (countHoraFim < 0) ? 0 : countHoraFim;
            countHoraFim = (countHoraFim > param.carga_horaria) ? param.carga_horaria : countHoraFim;
        var tempo_total = (countHoraInicio+countHoraFim);
            tempo_total = (param.valueDias > 0) ? tempo_total+(param.carga_horaria*(param.valueDias-1)) : tempo_total;
            tempo_total = (param.valueDias == 0) 
                        ? (countHoraInicio > param.carga_horaria && h_planejada > param.carga_horaria) 
                            ? param.carga_horaria 
                            : (h_planejada < countHoraInicio) ? h_planejada : countHoraInicio
                        : tempo_total;
            tempo_total = (tempo_total < 0) ? 0 : tempo_total;
            // tempo_total = (tempo_total < 1) ? tempo_total.toFixed(3) : tempo_total.toFixed(1);
            /*
            tempo_total = (tempo_total !== null) 
                        ? (tempo_total < 1) ? tempo_total.toFixed(3) : tempo_total.toFixed(1)
                        : tempo_total;
            */
            tempo = (parseFloat(tempo_total));
            // console.log(tempo_total, tempo_total.toFixed(1), parseFloat(tempo_total.toFixed(1)));
            // console.log({param: param, h_planejada: h_planejada, tempo: tempo, tempo_total: tempo_total, countHoraInicio: countHoraInicio, countHoraFim: countHoraFim});

    } else if (!param.count_dias_uteis && param.count_horas) {
        var tempo_total = (moment.duration(param.h_dataFim.diff(param.h_dataInicio)).asHours());
            tempo_total = (tempo_total < 0) ? 0 : tempo_total;
            // tempo_total = (tempo_total < 1) ? tempo_total.toFixed(3) : tempo_total.toFixed(1);
            tempo = parseFloat(tempo_total);
            //  console.log(tempo_total, tempo_total.toFixed(1), parseFloat(tempo_total.toFixed(1)));
    } else {
        tempo = (param.carga_horaria*param.valueDias);
    }
    return tempo;
}
function getOptionSelectPerfil(arraySelectPerfil, selected = false, sigla_display = true) {
    var htmlOption = '';
    function getSubordinacao(arrayU, loop = 8, selected = false, tab = true) {
        var mapU = false;
        if (typeof arrayU !== 'undefined' && arrayU !== null && arrayU.length > 0) {
            mapU = $.map(arrayU, function(v){
                var repeat = 8-loop;
                var subordinacao = false;
    
                var arraySubordinacao = jmespath.search(arraySelectPerfil, "[?dependencia==`"+v.id_unidade+"`].{id_unidade: id_unidade, nome_unidade: nome_unidade, sigla_unidade: sigla_unidade, dependencia: dependencia}");
                    arraySubordinacao = (arraySubordinacao !== null) ? arraySubordinacao : false;
                // var symbolTab = ' \uFEFF \uFEFF \uFEFF \uFEFF ';
                var symbolTab = ' \uFEFF ';
                    symbolTab = symbolTab.repeat(repeat);
                var tabSub = (v.dependencia != 0) ? symbolTab+'\u21AA ' : ''; 
                var target = (sigla_display) ? v.sigla_unidade.trim() : v.id_unidade.toString();
                var selected_ = (selected && selected == target ) ? 'selected' : '';
    
                if (loop > 0 && arraySubordinacao) {
                    if (arraySubordinacao.length > 0) htmlOption += symbolTab+'<optgroup label="'+v.nome_unidade+' ('+v.sigla_unidade+')">';
                    
                    htmlOption += (sigla_display) 
                                ? "<option data-id_unidade='"+v.id_unidade+"' data-label='"+v.sigla_unidade+"' title='"+v.sigla_unidade+" - "+v.nome_unidade+"' value='"+v.sigla_unidade+"' "+selected_+">"+(tab ? symbolTab : '')+tabSub+v.sigla_unidade+" - "+v.nome_unidade+"</option>"
                                : "<option data-id_unidade='"+v.id_unidade+"' data-label='"+v.sigla_unidade+"' value='"+v.id_unidade+"' "+selected_+">"+(tab ? symbolTab : '')+tabSub+v.sigla_unidade+" - "+v.nome_unidade+"</option>";

                    subordinacao = getSubordinacao(arraySubordinacao, loop-1, selected);
                    
                    if (arraySubordinacao.length > 0) htmlOption += symbolTab+'</optgroup>--'+v.nome_unidade+' '+v.sigla_unidade;
                    
                } else {
                    htmlOption += (sigla_display) 
                                ? "<option data-id_unidade='"+v.id_unidade+"' data-label='"+v.sigla_unidade+"' title='"+v.sigla_unidade+" - "+v.nome_unidade+"' value='"+v.sigla_unidade+"' "+selected_+">"+(tab ? symbolTab : '')+tabSub+v.sigla_unidade+" - "+v.nome_unidade+"</option>"
                                : "<option data-id_unidade='"+v.id_unidade+"' data-label='"+v.sigla_unidade+"' value='"+v.id_unidade+"' "+selected_+">"+(tab ? symbolTab : '')+tabSub+v.sigla_unidade+" - "+v.nome_unidade+"</option>";
                }
                return {id: v.id_unidade, nome_unidade: v.nome_unidade, sigla_unidade: v.sigla_unidade, subordinacao: subordinacao};
            });
        }
        return mapU;
    }
    var unidades_super = jmespath.search(arraySelectPerfil,"[?dependencia==`0`]");
    if (unidades_super !== null && unidades_super.length > 0) { 
        getSubordinacao(unidades_super, 8, selected);
    } else {
        getSubordinacao(arraySelectPerfil, 8, selected);
    }
    return htmlOption;
}
/* function getOptionSelectPerfil2(arraySelectPerfil, selected = false, sigla_display = true) {
    var unidades_super = jmespath.search(arraySelectPerfil,"[?dependencia==`0`]");
    var optionSelectPerfil = '';
    var arrayListEntidades = [];
    if (unidades_super !== null && unidades_super.length > 1) {
        $.each(unidades_super, function(index, v){
            var arrayPerfil = jmespath.search(arraySelectPerfil, "[?dependencia==`"+v.id_unidade+"`]");
                arrayPerfil.unshift(v);
                
            if ($.inArray(v.id_entidade, arrayListEntidades) == -1 ) {
                arrayListEntidades.push(v.id_entidade);
                optionSelectPerfil +=   '<option label="'+v.nome_entidade+' ('+v.sigla_entidade+')" disabled="true"></option>';
            }
            optionSelectPerfil +=   '<optgroup label="'+v.nome_unidade+' ('+v.sigla_unidade+')">'+
                                    '   '+getOptionsSelectPerfilGroup(arraySelectPerfil, arrayPerfil, selected, sigla_display)+
                                    '</optgroup>';
        });
    } else {
        optionSelectPerfil += getOptionsSelectPerfilGroup(arraySelectPerfil, arraySelectPerfil, selected, sigla_display);
    }       
    
    var excludedDependencia = $.map(arraySelectPerfil, function(v){
            var listSelectPerfil = $('<select>'+optionSelectPerfil+'</select>').find('option').map(function(){ return $(this).val() }).get();
            var target = (sigla_display) ? v.sigla_unidade.trim() : v.id_unidade.toString();
            if (listSelectPerfil.length > 0 && $.inArray(target, listSelectPerfil) == -1 ) {
                var selected_ = (selected && selected == target ) ? 'selected' : '';
                return (sigla_display) 
                        ? "<option data-label='"+v.sigla_unidade+"' title='"+v.sigla_unidade+" - "+v.nome_unidade+"' value='"+v.sigla_unidade+"' "+selected_+">"+v.sigla_unidade+"</option>"
                        : "<option data-label='"+v.sigla_unidade+"' value='"+v.id_unidade+"' "+selected_+">"+v.sigla_unidade+" - "+v.nome_unidade+"</option>";
            }
        });
        optionSelectPerfil += (excludedDependencia != '') ? excludedDependencia : '';
        
    return optionSelectPerfil;
} */
function getOptionsSelectPerfilGroup(arraySelectPerfil, arrayPerfil, selected = false, sigla_display = true, tab = false, loopOut = 1) {
    if (loopOut > 5) { return false; }
    var optionSelectPerfil = (typeof arrayPerfil !== 'undefined' && arrayPerfil !== null && arrayPerfil.length > 0 ) ? $.map(arrayPerfil, function(v,k){ 
        var target = (sigla_display) 
                    ? v.sigla_unidade.trim() 
                    : (parseInt(selected) > 0) ? v.id_unidade : v.sigla_unidade+' - '+v.nome_unidade;
        var selected_ = (selected && selected == target ) ? 'selected' : '';
        var arrayPerfilSub = jmespath.search(arraySelectPerfil, "[?dependencia==`"+v.id_unidade+"`]");
        var symbolTab = ' \uFEFF \uFEFF \uFEFF \uFEFF ';
            symbolTab = symbolTab.repeat(loopOut);
        var tabSub = (v.dependencia != 0) ? '\u21AA ' : ''; 
        var _result = (sigla_display) 
                    ? "<option data-id_unidade='"+v.id_unidade+"' data-label='"+v.sigla_unidade+"' title='"+v.sigla_unidade+" - "+v.nome_unidade+"' value='"+v.sigla_unidade+"' "+selected_+">"+(tab ? symbolTab : '')+tabSub+v.sigla_unidade+" - "+v.nome_unidade+"</option>"
                    : "<option data-id_unidade='"+v.id_unidade+"' data-label='"+v.sigla_unidade+"' value='"+v.id_unidade+"' "+selected_+">"+(tab ? symbolTab : '')+tabSub+v.sigla_unidade+" - "+v.nome_unidade+"</option>";
        if (arrayPerfilSub !== null && arrayPerfilSub.length > 0 && v.dependencia != 0) {
            _result += getOptionsSelectPerfilGroup(arraySelectPerfil, arrayPerfilSub, selected, sigla_display, true, loopOut+1);
        }
        return _result;
    }).join('') : '';
    return optionSelectPerfil;
}
function getOptionSelectCadeiaValor(arrayCadeiaValor, selected = false) {
    var processo_super = jmespath.search(arrayCadeiaValor,"[?dependencia==`0`]");
    var optionSelectCadeia = '';
    if (processo_super.length > 1) {
        $.each(processo_super, function(index, v){
            var arrayPerfil = jmespath.search(arrayCadeiaValor, "[?dependencia==`"+v.id_cadeia_valor+"`]");
                arrayPerfil.unshift(v);
                
            optionSelectCadeia +=   '<optgroup label="'+v.nome_processo+'">'+
                                    '   '+getOptionsSelectCadeiaValorGroup(arrayCadeiaValor, arrayPerfil, selected)+
                                    '</optgroup>';
        });
    } else {
        optionSelectCadeia += getOptionsSelectCadeiaValorGroup(arrayCadeiaValor, arrayCadeiaValor, selected);
    }
    return optionSelectCadeia;
}
function getOptionsSelectCadeiaValorGroup(arrayCadeiaValor, arrayPerfil, selected = false, tab = false, loopOut = 1) {
    if (loopOut > 5) { return false; }
    var optionSelectCadeia = ( arrayPerfil.length > 0 ) ? $.map(arrayPerfil, function(v,k){ 
        var target = (parseInt(selected) > 0) ? v.id_cadeia_valor : v.nome_processo;
        var selected_ = (selected && selected == target ) ? 'selected' : '';
        var arrayCadeiaSub = jmespath.search(arrayCadeiaValor, "[?dependencia==`"+v.id_cadeia_valor+"`]");
        var symbolTab = ' \uFEFF \uFEFF \uFEFF \uFEFF ';
            symbolTab = symbolTab.repeat(loopOut);
        var tabSub = (v.dependencia != 0) ? '\u21AA ' : ''; 
        var disabled_ = (v.selecionavel == 0) ? 'disabled' : '';
        var _result = "<option data-id_cadeia_valor='"+v.id_cadeia_valor+"' data-label='"+v.nome_processo+"' value='"+v.id_cadeia_valor+"' "+selected_+" "+disabled_+">"+(tab ? symbolTab : '')+tabSub+v.nome_processo+"</option>";
        if (arrayCadeiaSub !== null && arrayCadeiaSub.length > 0 && v.dependencia != 0) {
            _result += getOptionsSelectCadeiaValorGroup(arrayCadeiaValor, arrayCadeiaSub, selected, true, loopOut+1);
        }
        return _result;
    }).join('') : '';
    return optionSelectCadeia;
}
function getOptionsSelectAtivGroup(arrayAtiv, value, tab = false) {
    var html =  '';
    if (arrayAtiv && arrayAtiv != 0 && arrayAtiv.length > 0) {
        var uniqList = uniqPro(jmespath.search(arrayAtiv,"[*].macroatividade"));
        $.each(uniqList, function(i, v){
            var ativList = jmespath.search(arrayAtiv,"sort_by([?macroatividade=='"+v+"'],&nome_atividade)");
            html += '<option disabled>'+(tab ? '\u2500 ' : '')+(v == '' || v === null ? 'Macroatividade indefinida' : v)+'</option>'+
                    '   '+getOptionsSelectAtiv(ativList, value, tab);
        });
    }
    return html;
}
function getOptionsSelectAtiv(arrayAtiv, value, tab) {
    var dadosIfrArvore = getIfrArvoreDadosProcesso();
    var tipo_processo = (dadosIfrArvore) ? dadosIfrArvore.tipo : false;
    var optionSelectAtividades = ( arrayAtiv.length > 0 ) 
        ? $.map(arrayAtiv, function(v,k){
            //console.log('desativa_produtividade', typeof v.config.desativa_produtividade, v.config.desativa_produtividade);
            var complexidade = (v.config != null && typeof v.config !== 'undefined' && v.config.hasOwnProperty('complexidade')) ? v.config.complexidade : [];
            var recalcula_prazo = (v.config != null && typeof v.config !== 'undefined' && v.config.hasOwnProperty('recalcula_prazo') && v.config.recalcula_prazo) ? true : false;
            var desativa_produtividade = (v.config != null && typeof v.config !== 'undefined' && v.config.hasOwnProperty('desativa_produtividade') && v.config.desativa_produtividade) ? true : false;
            var modalidades_atividade = (v.config != null && typeof v.config !== 'undefined' && v.config.hasOwnProperty('ganho_unidade') && v.config.hasOwnProperty('modalidades') && v.config.ganho_unidade === false && v.config.modalidades.length > 0) ? v.config.modalidades : false;
            var tempo_pactuado_display = (complexidade.length > 0) ? jmespath.search(complexidade, "[?default==`true`].fator | [0]") : null;
                tempo_pactuado_display = (tempo_pactuado_display !== null) ? tempo_pactuado_display*v.tempo_pactuado : v.tempo_pactuado;
            var tempo_pactuado_display_ = parseFloat(tempo_pactuado_display.toFixed(2));
            var selected = ( value && v.id_atividade == value.id_atividade ) ? 'selected' : '';
            var config = {
                            sigla_unidade: v.sigla_unidade, 
                            id_unidade: v.id_unidade, 
                            dias_planejado: v.dias_planejado, 
                            tempo_pactuado: v.tempo_pactuado, 
                            complexidade: complexidade, 
                            recalcula_prazo: recalcula_prazo,
                            desativa_produtividade: desativa_produtividade,
                            modalidades_atividade: modalidades_atividade,
                            homologado: v.homologado,
                            etiqueta: (v.config != null && typeof v.config.etiquetas !== 'undefined' ? $.map(v.config.etiquetas,function(v){ return v[0] }) : []),
                            checklist: (v.config != null && typeof v.config.checklist !== 'undefined' ? $.map(v.config.checklist,function(v){ return v[0] }) : []),
                            tipo_processo: (v.config != null && typeof v.config.tipo_processo !== 'undefined' ? $.map(v.config.tipo_processo,function(v){ return v[0] }) : [])
                        };
            var icon = (tipo_processo && typeof config.tipo_processo !== 'undefined' && config.tipo_processo !== null && config.tipo_processo.length > 0 && $.inArray(tipo_processo, config.tipo_processo) !== -1 )
                ? '\u25AA\uFE0F ' : '\u25AB\uFE0F ';
                icon = (dadosIfrArvore) ? icon : '';
            return "<option value='"+v.id_atividade+"' "+selected+" data-config='"+JSON.stringify(config)+"'>"+(tab ? '&#160;&#160;&#160;&#160;' : '')+icon+v.nome_atividade+" ["+(tempo_pactuado_display_)+" "+(tempo_pactuado_display > 1 ? 'horas' : 'hora')+"]</option>";
        }).join('') : '';
    return optionSelectAtividades;
}
function getOptionsSelectResp(arrayResp, value) {
    var optionSelectResponsavel = (typeof arrayResp !== 'undefined' && arrayResp !== null && arrayResp.length > 0 ) ? $.map(arrayResp, function(v,k){ 
        var selected = ( value && v.id_user == value.id_user ) ? 'selected' : '';
        var disabled = (checkCapacidade('select_user_atividade') || arrayConfigAtividades.perfil.id_user == v.id_user) ? '' : 'disabled';
        var config = {
            id_plano: v.id_plano, 
            sigla_unidade: v.sigla_unidade, 
            id_unidade: v.id_unidade, 
            nome_modalidade: v.nome_modalidade, 
            id_tipo_modalidade: v.id_tipo_modalidade, 
            carga_horaria: v.carga_horaria, 
            lista_integral: (v.config !== null && v.config.hasOwnProperty('atividades_lista_integral') && v.config.atividades_lista_integral !== null && v.config.atividades_lista_integral == false ? false : true)
        };
        return "<option value='"+v.id_user+"' "+selected+" data-config='"+JSON.stringify(config)+"' "+disabled+">"+v.apelido+"</option>";
    }).join('') : '';    
    return optionSelectResponsavel;
}
function recordParamDemanda(this_) {
    if (!delayCrash) {
        var _this = $(this_);
        var _parent = _this.closest('.atividadeWork');
        var _id_atividade = _parent.find('[data-key="id_atividade"]');
        var id_atividade = (_id_atividade.length && _id_atividade.val().trim() != '') ? _id_atividade.val().trim() : false;
        var _fator_complexidade = _parent.find('[data-key="fator_complexidade"]');
        var fator_complexidade = (_fator_complexidade.length && _fator_complexidade.val().trim() != '') ? _fator_complexidade.val().trim() : false;
        var _id_user = _parent.find('[data-key="id_user"]');
        var id_user = (_id_user.length && _id_user.val().trim() != '') ? _id_user.val().trim() : false;
        var param = {id_atividade: id_atividade, fator_complexidade: fator_complexidade, id_user: id_user};
        setOptionsPro('recordParamDemanda', param);
    }
}
function changeAtivSelect(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var config = _this.find('option:selected').data('config');
    var inputRecalcPrazo =  _parent.find('#ativ_recalcula_prazo');
    var selectUser = _parent.find('#ativ_id_user');
    var inputUnidade = _parent.find('#ativ_id_unidade');
    var optionSelectComplexidade = ( config && config.complexidade.length > 0 ) 
            ? $.map(config.complexidade, function(v,k){ 
                var selected = (v.default === true) ? 'selected' : '';
                // console.log(v.default, selected, v.fator, v.default === 'true');
                var tempo_pactuado_fator = (typeof config.tempo_pactuado !== 'undefined' && typeof v.fator !== 'undefined' && config.tempo_pactuado > 0 && v.fator > 0) ? (config.tempo_pactuado * v.fator) : false;
                var tempo_pactuado_fator_display = (tempo_pactuado_fator) 
                                                ? (tempo_pactuado_fator < 1) ? parseFloat(tempo_pactuado_fator.toFixed(3)) : parseFloat(tempo_pactuado_fator.toFixed(1))
                                                : false;
                    tempo_pactuado_fator_display = (tempo_pactuado_fator_display) ? " ["+tempo_pactuado_fator_display+" "+(tempo_pactuado_fator > 1 ? 'horas' : 'hora')+"]" : '';
                return "<option value='"+v.fator+"' "+selected+">"+unicodeToChar(v.complexidade)+tempo_pactuado_fator_display+"</option>";
            }).join('') : '<option>&nbsp;</option>';
    _parent.find('#ativ_fator_complexidade').html(optionSelectComplexidade);
    if (selectUser.val() == '') {
        inputUnidade.val(config ? config.id_unidade : '');
    } else {
        var config_user = selectUser.find('option:selected').data('config');
        inputUnidade.val(config_user ? config_user.id_unidade : '');
    }

    updateAtivTempoPactuado(this_);
    if (_parent.find('#ativ_id_user').find('optgroup').length > 0 && checkOptionEntidade('limitar_vinculacao_atividades')) {
        disableOptGroupUser(this_);
    }

    var ativ_observacao_gerencial = _parent.find('#ativ_observacao_gerencial');
    if (typeof config !== 'undefined' && typeof config.observacao_gerencial !== 'undefined' && config.observacao_gerencial !== null && (typeof ativ_observacao_gerencial.data('user-typed') !== 'undefined' || !ativ_observacao_gerencial.data('user-typed'))) {
        ativ_observacao_gerencial.val(config.observacao_gerencial);
        if (ativ_observacao_gerencial.is(':hidden')) {
            _parent.find('.moreInfoBoxAtiv').trigger('click');
        }
    } else if (typeof ativ_observacao_gerencial.data('user-typed') !== 'undefined' && ativ_observacao_gerencial.data('user-typed') === false) {
        ativ_observacao_gerencial.val('');
    }

    if (
            (typeof config !== 'undefined' && typeof config.recalcula_prazo !== 'undefined' && config.recalcula_prazo && !inputRecalcPrazo.is(':checked') && inputRecalcPrazo.data('mode-insert') == 'auto') ||
            (typeof config !== 'undefined' && typeof config.recalcula_prazo !== 'undefined' && config.recalcula_prazo == false && inputRecalcPrazo.is(':checked') && inputRecalcPrazo.data('mode-insert') == 'auto')
        ) {

        if (!_parent.find('#ativ_recalcula_prazo').is(':visible')) {
            $('.atividadeWork .moreInfoBoxAtiv').trigger('click');
        }
        _parent.find('#ativ_recalcula_prazo').trigger('click');
    }
    
    // updateTempoPlanejado(this_, config);
    updateDateTimeDistribuicao(this_);
    updateAtivSelectEtiquetas(this_);
    updateAtivSelectChecklist(this_);
    checkThisAtivRequiredFields(this_);
    checkThisAtivRequiredFields(_parent.find('#ativ_fator_complexidade')[0]);
    checkUserListInAtividade(this_);
    initChosenReplace('box_refresh', this_, true);
    recordParamDemanda(this_);
}
function updateTempoPlanejado(this_, config) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var diasPlanejado = _parent.find('#ativ_dias_planejado');
    var complexidade = _parent.find('#ativ_fator_complexidade');
    if (typeof config !== 'undefined' && (parseFloat(diasPlanejado.val()) == 0 || diasPlanejado.val() == '' || diasPlanejado.data('autotime') == 'auto')) {
        var horasPlanejadas = parseFloat(complexidade.val())+(config.dias_planejado*8);
            horasPlanejadas = parseInt(horasPlanejadas/8);

        diasPlanejado.val(horasPlanejadas).data('autotime','auto');
        changeDadosTrabalho(diasPlanejado[0], true);
    }
}
function checkMoreInfoBoxAtiv(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var _moreInfo = _parent.find('.moreInfoBox');
    var _moreInfoLink = _parent.find('.moreInfoBoxAtiv');
    if (!_moreInfo.is(':visible')) {
        _moreInfoLink.trigger('click');
    }
}
function updateAtivSelectChecklist(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var config = _parent.find('#ativ_id_atividade').find('option:selected').data('config');
    var ativ_checklist = _parent.find('#ativ_checklist');
    var ativ_insert_checklist = _parent.find('#ativ_insert_checklist');
    var table = $('#ativBox_checklist');
    var checklist = (config && config.checklist !== null && config.checklist.length > 0) ? config.checklist : [];
    if (ativ_insert_checklist.is(':checked') && table.data('mode-insert') == 'auto') {
        ativ_insert_checklist.trigger('click');
        checkMoreInfoBoxAtiv(this_);
    }
    if (checklist.length > 0 && table.data('mode-insert') == 'auto') {
        ativ_checklist.val(JSON.stringify(checklist));
        ativ_insert_checklist.trigger('click');
        checkMoreInfoBoxAtiv(this_);
        setTimeout(function(){ 
            table.data('mode-insert','auto');
        }, 1000);
    }
}
function updateAtivSelectEtiquetas(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var config = _parent.find('#ativ_id_atividade').find('option:selected').data('config');
    var id_demanda = parseInt(_parent.find('#ativ_id_demanda').val());
    var etiqueta = (config && config.etiqueta !== null && config.etiqueta.length > 0) ? config.etiqueta.join(';') : '';
    if (id_demanda == 0 && etiqueta !== '') {
        _parent.find('input[data-key="etiquetas"]').importTags(etiqueta);
        checkMoreInfoBoxAtiv(this_);
    }
}
function updateDateTimeDistribuicao(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
	var unidade = (checkValue(_this)) ? _this.find('option:selected').data('config').sigla_unidade : arrayConfigAtivUnidade.sigla_unidade;
    var config_unidade = getBoxConfigDadosUnidade(_parent);
    var dtDistribuicao = _parent.find('#ativ_data_distribuicao');
    if (dtDistribuicao.length > 0) {
        var dtDistribuicao_format = (dtDistribuicao.val().indexOf('T') !== -1) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
        var dtDistribuicao_val = (dtDistribuicao.val() == '') ? '' : moment(dtDistribuicao.val(), dtDistribuicao_format).format(config_unidade.hora_format);
        var dtVencimento = _parent.find('#ativ_prazo_entrega');
        var dtVencimento_format = (dtVencimento.val().indexOf('T') !== -1) ? 'YYYY-MM-DDTHH:mm' : 'YYYY-MM-DD';
        var dtVencimento_val = (dtVencimento.val() == '') ? '' : moment(dtVencimento.val(), dtVencimento_format).format(config_unidade.hora_format);
        if (config_unidade.count_horas) {
            dtDistribuicao.attr('type', 'datetime-local').val(dtDistribuicao_val);
            dtVencimento.attr('type', 'datetime-local').val(dtVencimento_val);
        } else {
            dtDistribuicao.attr('type', 'date').val(dtDistribuicao_val);
            dtVencimento.attr('type', 'date').val(dtVencimento_val);
        }
        var labelDiasPlan = 'Dias '+(config_unidade.count_dias_uteis ? '\u00FAteis' : '')+' de Planejamento';
        _parent.find('#ativ_dias_planejado_label').text(labelDiasPlan);
    }
}
function updateAtivSelectUser(this_) {
    updateAtivTempoPactuado(this_); 
    if(checkOptionEntidade('limitar_vinculacao_atividades')) disableOptGroupAtiv(this_); 
    updateTempoTrabalhoAtiv(this_);
    updateTempoTrabalhoAtiv(this_, 'executado');
    checkUserListInAtividade(this_);
    initChosenReplace('box_reload', this_, true);
    recordParamDemanda(this_);
}
function disableOptGroupAtiv(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var config = _this.find('option:selected').data('config');
    var unidade_super = jmespath.search(arrayConfigAtividades.atividades, "[?id_unidade==`"+arrayConfigAtivUnidade.dependencia+"`].sigla_unidade | [0]");
        unidade_super = (unidade_super && unidade_super !== null) ? unidade_super : arrayConfigAtivUnidade.sigla_unidade; 
        _parent.find('#ativ_id_atividade').find('optgroup').each(function(){
            if (config && $(this).attr('label') != config.sigla_unidade && $(this).attr('label') != unidade_super) {
                $(this).prop('disabled', true);
            } else {
                $(this).prop('disabled', false);
            }
        });
    if (_parent.find('#ativ_id_atividade').val() != _parent.find('#ativ_id_atividade option:selected').val()) {
        _parent.find('#ativ_id_atividade').val('').trigger('chosen:updated').trigger('change');
    }
}
function disableOptGroupUser(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var config = _this.find('option:selected').data('config');
    var id_unidade = (typeof config !== 'undefined' && typeof config.id_unidade !== 'undefined') ? config.id_unidade : false;
    var dependencia = (id_unidade) ? jmespath.search(arrayConfigAtividades.unidades, "[?id_unidade==`"+config.id_unidade+"`] | [0].dependencia") : false;
    var checkDependencia = (id_unidade) ? jmespath.search(arrayConfigAtividades.unidades, "[?id_unidade==`"+dependencia+"`]") : null;
    var checkSubordinacao = (id_unidade) ? jmespath.search(arrayConfigAtividades.unidades, "[?dependencia==`"+id_unidade+"`]") : null;

    _parent.find('#ativ_id_user').find('optgroup').each(function(){
        if (config && $(this).attr('label') != config.sigla_unidade && (checkSubordinacao !== null && ($.inArray($(this).attr('label'), jmespath.search(checkSubordinacao,"[*].sigla_unidade")) == -1)) && (checkDependencia === null || checkDependencia.length != 0)) {
            $(this).prop('disabled', true);
        } else {
            $(this).prop('disabled', false);
        }
    });
}
function checkUserListInAtividade(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var select_user = _parent.find('#ativ_id_user');
    var select_ativ = _parent.find('#ativ_id_atividade');
    var data_ativ = select_ativ.find('option:selected').data('config');
    var is_disabled = false;
    var is_lista_atividade = false;
    var is_homologado = false;
    var nome_modalidade = '';

        select_user.find('option').prop('disabled', false);
        select_user.find('option').each(function(){
            var config = $(this).data('config');
            var id_user = select_user.val();
            var id_atividade = select_ativ.val();
            var plano = jmespath.search(arrayConfigAtividades.planos, "[?id_user==`"+id_user+"`] | [0]");
            var modalidade = (plano && plano !== null) ? jmespath.search(arrayConfigAtividades.tipos_modalidades,"[?id_tipo_modalidade==`"+plano.id_tipo_modalidade+"`] | [0]") : null;
            var atividades_homologadas = (modalidade && modalidade !== null && modalidade.hasOwnProperty('config') && modalidade.config !== null && modalidade.config.hasOwnProperty('atividades_homologadas') && modalidade.config.atividades_homologadas !== null && modalidade.config.atividades_homologadas == true ) ? true : false;

            if ((config && config.lista_integral === false) || atividades_homologadas) {
                var check_lista_atividades =    (plano && plano !== null  && plano.config !== null && 
                                                plano.config.hasOwnProperty('lista_atividades') && plano.config.lista_atividades !== null && plano.config.lista_atividades.length > 0 &&
                                                select_ativ.length > 0 && $.inArray(id_atividade.toString(), plano.config.lista_atividades) === -1 
                                                ) ? true: false;
                if ((check_lista_atividades && id_atividade != '') || (atividades_homologadas && typeof data_ativ !== 'undefined' && data_ativ.hasOwnProperty('homologado') && !data_ativ.homologado)) {
                    $(this).prop('disabled', true);
                    is_disabled = true;
                    is_lista_atividade = (check_lista_atividades) ? true : false;
                    is_homologado = (atividades_homologadas && typeof data_ativ !== 'undefined' && data_ativ.hasOwnProperty('homologado') && !data_ativ.homologado) ? true : false;
                    nome_modalidade = plano.nome_modalidade;
                } else {
                    $(this).prop('disabled', false);
                }

                // console.log({id_user: id_user, id_atividade: id_atividade, check_lista_atividades: check_lista_atividades, plano: plano, modalidade: modalidade, atividades_homologadas: atividades_homologadas, homologado: data_ativ.homologado});
            }
        });
        setTimeout(function(){ 
            if (select_user.find('option:selected').is(':disabled') && !checkValue(select_user)) {
                var text_is_lista_atividade = (is_lista_atividade) ? '<br><br>- Somente '+__.atividades+' '+getNameGenre('atividade', 'espec\u00EDficos', 'espec\u00EDficas')+' do plano de trabalho do usu\u00E1rio s\u00E3o '+getNameGenre('atividade', 'permitidos', 'permitidas')+' para distribui\u00E7\u00E3o' : '';
                var text_is_homologado = (is_homologado) ? '<br><br>- Somente '+__.atividades+' '+getNameGenre('atividade', 'homologados', 'homologadas')+' s\u00E3o '+getNameGenre('atividade', 'permitidos', 'permitidas')+' para o tipo de modalidade de plano de trabalho do usu\u00E1rio ('+nome_modalidade+')' : '';
                var htmlAlert = '<span class="alertChartUser" style="background: #f9efad;font-size: 9pt;padding: 5px;border-radius: 5px;display: flex;color: #666;">'+
                                '<i class="fas fa-exclamation-triangle vermelhoColor" style="margin: 0 5px;"></i>'+
                                '   '+__.Atividade+' n\u00E3o dispon\u00EDvel para o usu\u00E1rio selecionado ('+select_user.find('option:selected').text().trim()+')'+
                                '   '+text_is_lista_atividade+text_is_homologado+
                                '</span>';

                select_user.val('').trigger('change');
                _parent.find('#chartUser').html(htmlAlert);
                _parent.find('#ativ_tempo_pactuado').val('');
            }
        }, 100);
}
function updateAtivTempoPactuado(this_) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var ativ = _parent.find('#ativ_id_atividade');
    var inputUnidade = _parent.find('#ativ_id_unidade');
    var ativ_config = ativ.find('option:selected').data('config');
    var user = _parent.find('#ativ_id_user');
    var user_config = user.find('option:selected').data('config');
    var complex = _parent.find('#ativ_fator_complexidade');
    var multiplica = _parent.find('#ativ_fator_multiplicacao');
    var recorrencia = (_parent.find('#ativ_recorrencia').length > 0 && $('.modoDistribuicao_recorrente:visible').length > 0 && JSON.parse(_parent.find('#ativ_recorrencia').val()).length > 0) ? JSON.parse(_parent.find('#ativ_recorrencia').val()).length : 1;
    var multiprocesso = (_parent.find('#ativ_id_procedimentos').length > 0 && $('.listMultProcessos:visible').length > 0 && JSON.parse(_parent.find('#ativ_id_procedimentos').val()).length > 0) ? JSON.parse(_parent.find('#ativ_id_procedimentos').val()).length : 1;
    var id_demanda = parseInt(_parent.find('#ativ_id_demanda').val());
    var tempo_pactuado = _parent.find('#ativ_tempo_pactuado');
    var config_unidade = getBoxConfigDadosUnidade(_parent);
    var htmlInfoChart = '';
    
    if (typeof ativ_config === 'undefined') return false;

    if (!checkValue(user)) {
        inputUnidade.val(ativ_config ? ativ_config.id_unidade : '');
    } else {
        inputUnidade.val(user_config ? user_config.id_unidade : '');
    }

    if (!checkValue(multiplica)) { multiplica.val(1) }
    if (checkValue(user) && checkValue(complex)) {
        // var tempo = (user_config.tempo_atividade == 'presencial') ? ativ_config.dias_planejado : ativ_config.tempo_pactuado;
        var tempo = ativ_config.tempo_pactuado;
        var fator = parseFloat(complex.val());
        var arrayModalidades = (ativ_config.hasOwnProperty('modalidades_atividade') && ativ_config.modalidades_atividade && ativ_config.modalidades_atividade.length > 0) ? ativ_config.modalidades_atividade : config_unidade.modalidades;
        var modalidade = (typeof user_config !== 'undefined' && user_config.hasOwnProperty('id_tipo_modalidade')) ? jmespath.search(arrayModalidades,"[?id_tipo_modalidade=='"+user_config.id_tipo_modalidade+"'] | [0]") : null;
        var ganho = (modalidade && modalidade !== null && modalidade.hasOwnProperty('fator')) ? parseFloat(modalidade.fator) : 1;
        var ganho_label = (ganho != 1) ? ' (Ganho: '+ganho+')' : '';
        var tipo_modalidade = (modalidade && modalidade !== null && modalidade.hasOwnProperty('tipo_modalidade')) ? modalidade.tipo_modalidade : false;
            // console.log(user_config, user_config.id_tipo_modalidade, config_unidade, ganho);
        var fator_multiplica = (typeof multiplica !== 'undefined' && multiplica.length > 0 && checkValue(multiplica)) ? parseInt(multiplica.val()) : 1;
        // console.log(tempo, fator, ganho, fator_multiplica, multiplica, recorrencia, multiprocesso);
        var tempo_user = parseFloat((tempo*fator*ganho*fator_multiplica*recorrencia*multiprocesso).toFixed(1));
            htmlInfoChart = (tipo_modalidade) 
                            ? '<span style="color: #777;float: right;font-size: 9pt;margin-top: 10px;"><i class="fas fa-info-circle laranjaColor" style="float: initial;font-size: 10pt;"></i> Modalidade: '+tipo_modalidade+ganho_label+'</span>'
                            : '';
        // console.log((tempo*fator*fator_multiplica).toFixed(), (tempo*fator*fator_multiplica), (tempo*fator*fator_multiplica).toFixed(1));
        tempo_pactuado.data('tempo-pactuado', tempo*fator*ganho).val(tempo_user);
    }
    if (!checkValue(user) && !checkValue(complex)) { 
        tempo_pactuado.data('tempo-pactuado', 0).val('');
        if (_parent.find('#chartTempoPlano').length > 0) { new Chart(_parent.find('#chartTempoPlano')).destroy() }
        _parent.find('#chartUser').html('');
    }
    if (checkValue(user) && checkValue(complex)) { 
        var plano = jmespath.search(arrayConfigAtividades.planos, "[?id_user==`"+user.val()+"`].{tempo_despendido: tempo_despendido, tempo_homologado: tempo_homologado, tempo_pactuado: tempo_pactuado, tempo_total: tempo_total, tempo_proporcional: tempo_proporcional, tempo_entregue: tempo_entregue, data_inicio_vigencia: data_inicio_vigencia, data_fim_vigencia: data_fim_vigencia} | [0]");
        if (plano !== null) {
            plano.tempo_pactuado = (id_demanda == 0) ? plano.tempo_pactuado : plano.tempo_pactuado-parseFloat(tempo_pactuado.data('tempo-pactuado'));
            if (typeof tempo_user !== 'undefined') { plano.tempo_projetado = plano.tempo_pactuado+parseFloat(tempo_user) }
            if (_parent.find('#chartUser').length) {
                _parent.find('#chartUser').html('<canvas id="chartTempoPlano" width="380" height="120"></canvas>'+htmlInfoChart);
                getSingleChartTempoPlano(_parent.find('#chartTempoPlano'), plano);
            }
        }
    }
    checkThisAtivRequiredFields(this_);
    getListAtivPrioridades(this_, user.val(), id_demanda);
    updateTempoPlanejado(this_, ativ_config);
    recordParamDemanda(this_);
    
    if ($('.modoDistribuicao_recorrente:visible').length > 0) {
        var updateAtiv = _parent.find('#ativ_id_atividade');
        if (typeof updateAtiv.data('update_recorrencia') === 'undefined' || updateAtiv.data('update_recorrencia') == false) {
            calculoRecorrenciaAtiv(this_);
        }
    }
}
function getListAtivVinculacao() {
        var value = (arrayAtividadesPro) ? jmespath.search(arrayAtividadesPro, "sort_by([?data_inicio=='0000-00-00 00:00:00'], &prioridade)") : false;
        htmlSelect = (value && value !== null) 
                        ? $.map(value, function(v, i){ return '<option value="'+v.id_demanda+'" title="'+getTitleDialogBox(v, true)+'">'+getTitleDialogBox(v)+'</option>' }).join('')
                        : '<option value="0">'+getNameGenre('demanda', 'Nenhum', 'Nenhuma')+' '+__.demanda+' n\u00E3o '+getNameGenre('demanda', 'iniciado', 'iniciada')+' dispon\u00EDvel...</option>';
        return htmlSelect;
}
function getListAtivPrioridades(this_, id_user, id_demanda) {
    var _this = $(this_);
    var _parent = _this.closest('.atividadeWork');
    var htmlSelect = '<option value="0">&nbsp;</option>';
        _parent.find('#trAtivPrioridade').hide();
    if (id_user != '' && id_user != 0) {
        var value = jmespath.search(arrayAtividadesPro, "sort_by([?data_inicio=='0000-00-00 00:00:00'] | [?id_demanda!=`"+id_demanda+"`] | [?id_user==`"+id_user+"`], &prioridade)");
        htmlSelect = (value && value !== null) 
                        ? $.map(value, function(v, i){ return '<option value="'+v.prioridade+'" data-index="'+i+'" data-demanda="'+v.id_demanda+'" title="'+getTitleDialogBox(v, true)+'">Antes de: '+getTitleDialogBox(v)+'</option>' }).join('')
                        : '<option value="0">'+getNameGenre('demanda', 'Nenhum', 'Nenhuma')+' '+__.demanda+' n\u00E3o '+getNameGenre('demanda', 'iniciado', 'iniciada')+' dispon\u00EDvel...</option>';
        _parent.find('#trAtivPrioridade').show();
        if (value.length == 0 && _parent.find('#ativ_prioridades').is(':checked')) {
            _parent.find('#ativ_prioridades').trigger('click');
        }
    }
    _parent.find('#ativ_lista_prioridades').html(htmlSelect);
}

// BOX DE AVALIACAO
function rateAtividade(id_demanda = 0, omissaoAtividade = false) {
    var value = getAtividadeData(id_demanda);

    if (value.id_atividade == 0 || value.tempo_pactuado == 0 || value.fator_complexidade == 0) {
        variationAtividade(id_demanda, true);
    } else {
        var rateDisable = (value.avaliacao && value.avaliacao != 0 && value.avaliacao.nota_atribuida === false) || (value.id_user == arrayConfigAtividades.perfil.id_user && !checkOptionUnidade('planos','permite_autoavaliacao')) ? true : false;
        var htmlBox =   '<div id="ratingAtividade" class="ratingWork" data-demanda="'+value.id_demanda+'" data-tempo-decorrido="'+(omissaoAtividade ? getTempoDecorridoAtiv(value, true) : 0)+'">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        (omissaoAtividade 
                            ?   '<tr>'+
                                '   <td>'+
                                '       <div style="padding: 8px 0;text-align: center;">Qualifique a omiss\u00E3o da demanda de <strong>'+value.apelido+'</strong></div>'+
                                '   </td>'+
                                '</tr>'+
                                '<tr>'+
                                '   <td>'+
                                '       <table style="font-size: 10pt;width: 100%;">'+
                                '           <tbody>'+
                                '               <tr>'+
                                '                   <td style="text-align: center;">'+
                                '                       <div style="padding: 8px 0;">'+value.assunto+'</div>'+
                                '                       <div class="txt_cinza" style="padding: 8px 0;">'+value.nome_atividade+'</div>'+
                                '                   </td>'+
                                '                   <td style="width: 200px;text-align: left;">'+
                                '                       <div>'+
                                '                           '+getTagTempoPactuadoAtiv(value)+
                                '                       </div>'+
                                (!checkOptionEntidade('desativa_produtividade_geral') ? 
                                '                       <div style="margin: 5px 0 0 5px;">'+
                                '                           '+getTagTempoDecorridoAtiv(value, false, true)+
                                '                       </div>'+
                                '' : '')+
                                '                   </td>'+
                                '               </tr>'+
                                '           </tbody>'+
                                '       </table>'+
                                '   </td>'+
                                '</tr>'
                            : rateAtividadeList(value))+
                        rateAtividadeBoxStars(value)+
                        '      <tr style="height: 60px;">'+
                        '           <td>'+
                        '               <a class="newLink" onclick="moreInfoBox(this)" style="font-size: 10pt; cursor: pointer; margin: 5px 0 0 0; float: right;"><i class="fas fa-info-circle cinzaColor"></i> Informa\u00E7\u00F5es '+__.da_demanda+'</a>'+
                        '           </td>'+
                        '      </tr>'+
                        '   </table>'+
                        '   <div id="boxAtividade">'+
                        '       <table style="font-size: 10pt; width: 100%; display: none" class="seiProForm moreInfoBox tableLine tableInfo">'+
                        '          <tr style="height: 10px;"><td colspan="2" style="border-bottom: 1px solid #ccc; height: 0px !important;"></td></tr>'+
                        '          '+getInfoAtividade(value)+
                        '       </table>'+
                        '   </div>'+
                        rateAtividadeVinculadasBox(value)+
                        '</div>';

        var btnDialogBoxPro = (rateDisable) 
                ? []
                : [{
                    text: (value.data_avaliacao == '0000-00-00 00:00:00') ? 'Avaliar' : 'Editar',
                    class: 'confirm',
                    click: function(event) {
                        saveRatingWork(this, omissaoAtividade);
                    }
                }];
        if (checkCapacidade('complete_cancel_atividade') && value.data_avaliacao == '0000-00-00 00:00:00' && !omissaoAtividade) {
            btnDialogBoxPro.unshift({
                text: 'Editar Conclus\u00E3o',
                icon: 'ui-icon-check',
                click: function(event) { 
                    completeAtividade(id_demanda);
                }
            });
        } else if (checkCapacidade('rate_cancel_atividade') && value.data_avaliacao != '0000-00-00 00:00:00') {
            btnDialogBoxPro.unshift({
                text: (rateDisable ? 'Cancelar Dispensa' : 'Cancelar Avalia\u00E7\u00E3o'),
                icon: 'ui-icon-close',
                click: function(event) { 
                    rateCancelAtividade(id_demanda);
                }
            });
        }
        if (checkCapacidade('rate_atividade')) {
            resetDialogBoxPro('dialogBoxPro');
            dialogBoxPro = $('#dialogBoxPro')
                .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
                .dialog({
                    title: (value.id_avaliacao == 0) ? 'Avaliar '+(omissaoAtividade ? 'Omiss\u00E3o da ' : '')+__.Demanda+': '+getTitleDialogBox(value) : 'Editar Avalia\u00E7\u00E3o: '+getTitleDialogBox(value),
                    width: 650,
                    open: function() { 
                        if (checkCapacidade('rate_edit_atividade') && value.data_avaliacao != '0000-00-00 00:00:00' && value.id_avaliacao != 0) { 
                            $('#ratingAtividade').find('.ratingStars .iconStarAtiv[data-nota="'+value.avaliacao.nota_atribuida+'"]').trigger('click');
                            $.each(value.avaliacao.justificativas,function(i, v){
                                $('#ratingAtividade .ratingReason').find('.ratingWhy .answer[data-index="'+v.id_tipo_justificativa+'"]').trigger('click');
                            });
                            if (value.avaliacao.comentarios != '') {
                                $('#ratingAtividade .moreCommentBoxDiv').find('.moreCommentBox').trigger('click');
                                $('#ratingAtividade .moreCommentBoxDiv').find('.moreCommentBoxText textarea').val(value.avaliacao.comentarios);
                            }
                        }
                        if (checkOptionEntidade('limitar_avaliacao_maxima') && !checkOptionEntidade('desativa_produtividade_geral') && (getInfoAtividadeProdutividade_calc(value, 'num', 'despendido') < 1 || getInfoAtividadeProdutividade_calc(value, 'num', 'executado') < 1)) {
                            var notaMaxima = jmespath.search(arrayConfigAtividades.avaliacao,"[*].nota_atribuida");
                                notaMaxima = notaMaxima !== null ? arrayMax(notaMaxima) : 10;
                            $('#ratingAtividade')
                                .find('.ratingStars')
                                .after('<span style="background: #f9efad;font-size: 9pt;padding: 5px;border-radius: 5px;color: #666;"><i class="fas fa-info-circle laranjaColor" style="float: initial;font-size: 10pt;margin: 0 5px;"></i> Nota '+notaMaxima+' indispon\u00EDvel para produtividades abaixo de 100%</span>')
                                .find('.iconStarAtiv[data-nota="'+notaMaxima+'"]').css({'pointer-events': 'none', 'opacity': '0.5'})
                                .removeAttr('onclick')
                                .removeAttr('onmouseover')
                                .removeAttr('onmouseout')
                                .find('i').attr('class','far fa-star cinzaColor');
                        }
                        if (omissaoAtividade) {
                            $('#ratingAtividade').find('.ratingStars .iconStarAtiv[data-nota="0"]').trigger('click');
                            $('#ratingAtividade').find('.ratingWhy .answer[data-index="4"]').trigger('click');
                            $('#ratingAtividade').find('.ratingReason, .ratingStars').css({'pointer-events': 'none', 'opacity': '0.5'});
                            $('#ratingAtividade .moreCommentBoxDiv').find('.moreCommentBox').trigger('click');
                            $('#ratingAtividade .moreCommentBoxText textarea').focus();
                            centralizeDialogBox(dialogBoxPro);
                        }
                        getAtividadeTagsPro();
                        updateServerTemposDemanda('set', 'tempo_executado', value);
                        updateServerTemposDemanda('set', 'tempo_planejado', value);
                    },
                    close: function() { 
                        $('#ratingAtividade').remove();
                        cancelMoveKanbanItens();
                        cancelSelectedItensAtiv(id_demanda);
                        resetDialogBoxPro('dialogBoxPro');
                    },
                    buttons: btnDialogBoxPro
            });
        }
    }
}
function arrayRateAtividadeLote(list, rateMax = true) {
    var arrayRateAtiv = [];
    var ativList = '';
    var boxStars = '';
    if (typeof list !== 'undefined' && list !== null && list.length > 0) {
        $.each(list, function(i,v){
            var value = getAtividadeData(v.id);
            var rateDisable = (value.avaliacao && value.avaliacao != 0 && value.avaliacao.nota_atribuida === false) || (value.id_user == arrayConfigAtividades.perfil.id_user) ? true : false;
            if (value.data_avaliacao == '0000-00-00 00:00:00' && value.id_atividade != 0 && value.tempo_pactuado != 0 && value.fator_complexidade != 0 && !rateDisable) {
                if (
                        !rateMax ||
                        (rateMax && checkOptionEntidade('limitar_avaliacao_maxima') && !checkOptionEntidade('desativa_produtividade_geral')
                            (getInfoAtividadeProdutividade_calc(value, 'num', 'despendido') >= 1 && getInfoAtividadeProdutividade_calc(value, 'num', 'executado') >= 1)
                        )
                    ) {
                    ativList += rateAtividadeList(value);
                    boxStars = rateAtividadeBoxStars(value);
                    arrayRateAtiv.push(value);
                }
            }
        });
    }
    return {array: arrayRateAtiv, list: ativList, box: boxStars};
}
function rateAtividadeLote(list, rateMax = true) {
    var flist = arrayRateAtividadeLote(list, rateMax);
    var arrayRateAtiv = flist.array;
    var ativList = flist.list;
    var boxStars = flist.box;
    if (arrayRateAtiv.length > 0) {
        var htmlBox =   '<div id="ratingAtividade" class="ratingWork" data-demanda="0">'+
                        '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        '      <tr style="text-align: center;">'+
                        '           <td>'+
                        '               <div style="height: 300px;overflow-y: scroll;">'+
                        '                   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                        ativList+
                        '                   </table>'+
                        '               </div>'+
                        '           </td>'+
                        '      </tr>'+
                        boxStars+
                        '   </table>'+
                        '</div>';

        if (checkCapacidade('rate_atividades')) {

            var btnDialogBoxPro = [{
                text: 'Avaliar',
                class: 'confirm',
                click: function(event) {
                    saveRatingWorkLote(this, arrayRateAtiv);
                }
            }];

            if (checkCapacidade('complete_cancel_atividades')) {
                btnDialogBoxPro.unshift({
                    text: 'Cancelar Conclus\u00E3o',
                    icon: 'ui-icon-close',
                    click: function(event) {
                        $('#ratingAtividade').remove();
                        resetDialogBoxPro('dialogBoxPro');
                        completeCancelAtividadeLote(arrayRateAtiv);
                    }
                });
            }

            resetDialogBoxPro('dialogBoxPro');
            dialogBoxPro = $('#dialogBoxPro')
                .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
                .dialog({
                    title: 'Avaliar '+__.Demandas+' em Lote ('+arrayRateAtiv.length+')',
                    width: 650,
                    open: function() { 
                        if (!rateMax && checkOptionEntidade('limitar_avaliacao_maxima')) {
                            var notaMaxima = jmespath.search(arrayConfigAtividades.avaliacao,"[*].nota_atribuida");
                                notaMaxima = notaMaxima !== null ? arrayMax(notaMaxima) : 10;
                            $('#ratingAtividade')
                                .find('.ratingStars')
                                .after('<span style="background: #f9efad;font-size: 9pt;padding: 5px;border-radius: 5px;color: #666;"><i class="fas fa-info-circle laranjaColor" style="float: initial;font-size: 10pt;margin: 0 5px;"></i> Nota '+notaMaxima+' indispon\u00EDvel para produtividades abaixo de 100%</span>')
                                .find('.iconStarAtiv[data-nota="'+notaMaxima+'"]').css({'pointer-events': 'none', 'opacity': '0.5'})
                                .removeAttr('onclick')
                                .removeAttr('onmouseover')
                                .removeAttr('onmouseout')
                                .find('i').attr('class','far fa-star cinzaColor');
                        }
                    },
                    close: function() { 
                        $('#ratingAtividade').remove();
                        resetDialogBoxPro('dialogBoxPro');
                    },
                    buttons: btnDialogBoxPro
            });
        }
    } else {
        rateAtividadeLote(list, false);
    }
}
function rateAtividadeVinculadasBox(value) {
    var listAtividadesVinculadas = getAtividadesVinculadas(value, 'avaliadas');
    var html = (listAtividadesVinculadas.length_check > 0 ? 
                '   <table style="font-size: 10pt; width: 100%; margin: 10px 0;" class="seiProForm">'+
                '      <tr style="height: 40px;">'+
                '          <td style="vertical-align: bottom; text-align: left;" class="label">'+
                '               '+listAtividadesVinculadas.input+
                '               <label for="rate_others"><i class="iconPopup iconSwitch fas fa-star cinzaColor"></i> '+(listAtividadesVinculadas.length_check > 1 ? 'Avaliar '+getNameGenre('demanda', 'os outros', 'as outras')+' '+listAtividadesVinculadas.length_check+' '+__.demandas+' '+getNameGenre('demanda', 'vinculados', 'vinculadas') : 'Avaliar '+__.a_outra_demanda_vinculada)+'?</label>'+
                '          </td>'+
                '          <td style="width: 50px;">'+
                '              <div class="onoffswitch" style="float: right;">'+
                '                  <input type="checkbox" name="onoffswitch" data-target="#listRateOtherAtiv" onchange="changeOthersAtiv(this)" class="onoffswitch-checkbox singleOptionConfig" id="rate_others" data-key="rate_others" tabindex="0" checked>'+
                '                  <label class="onoffswitch-label" for="rate_others"></label>'+
                '              </div>'+
                '          </td>'+
                '      </tr>'+
                '      <tr style="height: auto;">'+
                '          <td colspan="2">'+
                '               '+listAtividadesVinculadas.html+
                '          </td>'+
                '      </tr>'+
                '   </table>'+
                '' : '');
    return html;
}
function rateAtividadeBoxStars(value) {
    var starsArray = (arrayConfigAtividades['avaliacao'].length > 0) ? jmespath.search(arrayConfigAtividades['avaliacao'], "[*].{nota_atribuida: nota_atribuida, id_tipo_avaliacao: id_tipo_avaliacao, nome_avaliacao: nome_avaliacao, aceita_entrega: aceita_entrega, pergunta: pergunta, color: config.color, icon: config.icon}") : [];
    var starsHtml = ''; 
    if (value.avaliacao && value.avaliacao != 0 && value.avaliacao.nota_atribuida === false) {
        starsHtml +='<a class="newLink iconStarAtiv" style="font-size: 12pt; cursor: pointer;"><i class="fas fa-star-half-alt cinzaColor"></i> <span style="font-size: 11pt;">Avalia\u00E7\u00E3o Dispensada</span></a>';
    } else if (value.id_user == arrayConfigAtividades.perfil.id_user && !checkOptionUnidade('planos','permite_autoavaliacao')) {
        starsHtml +='<a class="newLink iconStarAtiv" style="font-size: 12pt; cursor: pointer;"><i class="fas fa-star-half-alt cinzaColor"></i> <span style="font-size: 11pt;">Auto Avalia\u00E7\u00E3o Indispon\u00EDvel</span></a>';
    } else {
        $.each(removeDuplicatesArray(starsArray, 'nota_atribuida'), function(index, value){
            starsHtml +='<a class="newLink iconStarAtiv" data-index="'+value.id_tipo_avaliacao+'" data-nota="'+value.nota_atribuida+'" data-pergunta="'+value.pergunta+'" data-nome="'+value.nome_avaliacao+'" data-aceita-entrega="'+value.aceita_entrega+'" data-color="'+value.color+'" data-icon="'+value.icon+'" onclick="onStarAtiv(this,\'click\')" onmouseover="onStarAtiv(this,\'over\')" onmouseout="onStarAtiv(this,\'out\')" style="font-size: 12pt; cursor: pointer;"><i data-nota="'+value.nota_atribuida+'"  class="fas fa-star cinzaColor"></i></a>';
        });
    }
    var html =  '      <tr style="height: 40px; text-align: center;">'+
                '           <td>'+
                '               <div class="ratingStars">'+
                '                   '+starsHtml+
                '               </div>'+
                '           </td>'+
                '      </tr>'+
                '      <tr style="text-align: center;">'+
                '           <td>'+
                '               <div class="ratingReason"></div>'+
                '           </td>'+
                '      </tr>'+
                '      <tr style="text-align: center;">'+
                '           <td>'+
                '               <div class="moreCommentBoxDiv" style="display:none; text-align: center;">'+
                '                   <a class="newLink moreCommentBox" onclick="moreCommentBox(this)" style="font-size: 10pt; cursor: pointer; margin: 5px 0 0 0;"><i class="far fa-comment-alt cinzaColor"></i> Coment\u00E1rios adicionais?</a>'+
                '                   <div class="moreCommentBoxText" style="display:none;">'+
                '                       <textarea maxlength="500" oninput="checkLimitText(this);updateButtonTextarea(this);"></textarea>'+
                '                       <span class="countLimit"></span>'+
                '                   </div>'+
                '               </div>'+
                '           </td>'+
                '      </tr>';
    return html;
}
function rateAtividadeList(value) {
    var documento = (typeof value.documento_sei !== 'undefined' && value.documento_sei !== null && parseInt(value.documento_sei) != 0) ? value.nome_documento+' ('+value.documento_sei+')' : value.nome_documento;
        documento = (documento === null) ? false : documento;
    var obs_tecnica = (value.observacao_tecnica !== null && value.observacao_tecnica != '') 
                    ? '<div class="fa-border" style="padding: 10px; margin: 15px; font-style: italic; color: #505050;"><i class="fas fa-quote-left fa-2x fa-pull-left cinzaColor" style="margin-right: 10px;"></i> '+replaceTextToProcessoSEI(replaceTextToUrl(value.observacao_tecnica))+'</div>' 
                    : '';
    var modalDocEntrega = (documento) ? "openDialogDoc({title: '"+documento+"', id_procedimento: '"+value.id_procedimento+"', id_documento: '"+value.id_documento_entregue+"'})" : '';

    var html =  '      <tr style="height: 40px; text-align: center;">'+
                '          <td colspan="2">Como foi a entrega '+__.da_demanda+' de <strong>'+value.apelido+'</strong>?</td>'+
                '      </tr>'+
                '      <tr style="height: 40px; text-align: center;">'+
                '          <td>'+
                '               <table style="font-size: 10pt;width: 100%;">'+
                '                   <tr>'+
                '                       <td style="text-align: center;">'+
                (value.id_procedimento == 0 || value.id_documento == 0 ?
                '                           <a class="newLink bLink" style="text-decoration: none;">'+
                '                               <i class="fas fa-file-signature azulColor" style="padding-right: 5px;"></i>'+(documento ? documento : '-')+
                '                           </a>' : 
                '                           <a class="newLink bLink" style="text-decoration: underline; cursor: pointer;" onclick="'+modalDocEntrega+'" onmouseover="return infraTooltipMostrar(\'Visualiza\u00E7\u00E3o r\u00E1pida\');" onmouseout="return infraTooltipOcultar();">'+
                '                               <i class="fas fa-file-signature azulColor" style="padding-right: 5px;"></i>'+(documento ? documento : '-')+
                '                               <i class="fas fa-eye bLink" style="font-size: 80%;vertical-align: top;margin-left: 5px;"></i>'+
                '                           </a>'+
                '')+    
                '                       </td>'+
                '                       <td style="width: 220px;text-align: left;">'+
                (!checkOptionEntidade('desativa_produtividade_geral') ? 
                '                           <div id="ativ_produtividade" style="margin: 5px 0;">'+getInfoAtividadeProdutividade(value, true, 'despendido')+'</div>'+
                '                           <div id="ativ_produtividade_executada" style="margin: 5px 0;">'+getInfoAtividadeProdutividade(value, true, 'executado')+'</div>'+
                '' : '')+
                '                           <div style="margin: 15px 0 0 0;">'+getTagTempoPactuadoAtiv(value)+'</div>'+
                (!checkOptionEntidade('desativa_produtividade_geral') ? 
                '                           <div style="margin: 5px 0 0 5px;">'+getTagTempoDespendidoAtiv(value, false)+'</div>'+
                '' : '')+
                (checkCapacidade('variation_atividade') ? 
                '                           <span class="info_dates_extend" style="margin-top: 10px;display: block;">'+
                '                               <a class="newLink dateExtend" onclick="variationAtividade('+value.id_demanda+')" style="font-size: 9pt;cursor: pointer;">'+
                '                                  <i class="fas fa-'+(value.tempo_pactuado == 0 ? 'clipboard-list' : 'graduation-cap')+' azulColor" style="padding-right: 3px;"></i>'+
                '                                  Alterar '+__.Complexidade+(checkCapacidade('type_atividade') ? ' e '+__.atividade : '')+
                '                               </a>'+
                '                           </span>'+
                '' : '')+
                '                       </td>'+
                '                   <tr>'+
                '                       <td colspan="2">'+
                '                       '+obs_tecnica+
                '                       </td>'+
                '                   </tr>'+
                '               </table>'+
                '          </td>'+
                '      </tr>';
    return html;
}
function completeCancelAtividadeLote(list) {
    if (checkCapacidade('complete_cancel_atividades')) {
        setTimeout(() => {
            confirmaFraseBoxPro( __.As_demandas+' j\u00E1 foram entregues. Tem certeza que deseja cancelar?', 'CANCELAR', function(){
                var action = 'complete_cancel_atividades';
                if (typeof list !== 'undefined' && list !== null && list.length > 0) {
                    var ids = list.map(function(v){ return {id_demanda: v.id_demanda, id_unidade: v.id_unidade} });
                    var param = {action: action, ids: ids };
                    getServerAtividades(param, action);
                }
            }, function(){
                $.each(list, function(i, value){
                    cancelSelectedItensAtiv(value.id_demanda);
                });
            });
        }, 500);
    }
}
function rateCancelAtividadeLote(list) {
    if (checkCapacidade('rate_cancel_atividades')) {
        setTimeout(() => {
            confirmaFraseBoxPro( __.As_demandas+' j\u00E1 foram '+getNameGenre('demandas', 'avaliados', 'avaliadas')+'. Tem certeza que deseja cancelar?', 'CANCELAR', function(){
                var action = 'rate_cancel_atividades';
                var ids = [];
                if (typeof list !== 'undefined' && list !== null && list.length > 0) {
                    $.each(list, function(i, v){
                        var value = getAtividadeData(v.id);
                        ids.push({
                            id_avaliacao: value.id_avaliacao,
                            id_demanda: value.id_demanda
                        });
                    });
                    var param = {action: action, ids: ids };
                    getServerAtividades(param, action);
                }
            }, function(){
                $.each(list, function(i, value){
                    cancelSelectedItensAtiv(value.id_demanda);
                });
            });
        }, 500);
    }
}
function rateCancelAtividade(id_demanda) {
    var value = getAtividadeData(id_demanda);
    if (checkCapacidade('rate_cancel_atividade')) {
        confirmaFraseBoxPro( __.A_demanda+' j\u00E1 foi '+getNameGenre('demanda', 'avaliado', 'avaliada')+'. Tem certeza que deseja cancelar?', 'CANCELAR', function(){
            var action = 'rate_cancel_atividade';
            var param = {
                action: action, 
                id_demanda: id_demanda,
                id_avaliacao: value.id_avaliacao
            };
            getServerAtividades(param, action);
        }, function(){
            cancelMoveKanbanItens();
            cancelSelectedItensAtiv(id_demanda);
        });
    }
}
// SALVA AVALIACAO
function saveRatingWork(this_, omissaoAtividade = false) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    var data = _this.find('.ratingWork').data();
    var value = getAtividadeData(data.demanda);
    var listAtividadesVinculadas = getAtividadesVinculadas(value, 'avaliadas');
    var comentarios = _this.find('.moreCommentBoxText textarea').val();
    var id_demandas_rate = (listAtividadesVinculadas.length_check > 0 && _parent.find('#rate_others').is(':checked')) 
                            ? JSON.parse(_parent.find('#lista_rate_others').val())
                            : [];
    var action = (value.id_avaliacao > 0) ? 'rate_edit_atividade' : 'rate_atividade';
    var id_plano = jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+value.id_user+"`] | [0].id_plano");
        id_plano = (id_plano === null) ? 0 : id_plano;
        
    var param = {
                    action: action,
                    id_user: value.id_user,
                    id_plano: id_plano, 
                    id_demandas_rate: id_demandas_rate,
                    id_avaliacao: value.id_avaliacao,
                    tempo_despendido: (data.notaSelected == 0 && data.tempoDecorrido > 0) ? data.tempoDecorrido : value.tempo_despendido,
                    tempo_pactuado: value.tempo_pactuado,
                    id_demanda: data.demanda,
                    id_tipo_avaliacao: data.indexSelected,
                    nota_atribuida: data.notaSelected,
                    aceita_entrega: data.aceitaEntrega,
                    comentarios: comentarios,
                    avaliacao_justificativa: data.whySelected,
                    omissao_atividade: omissaoAtividade,
                    data_avaliacao: moment().format('YYYY-MM-DD HH:mm:ss')
                }
    if (typeof data.notaSelected !== 'undefined' && ((typeof data.whySelected !== 'undefined' && data.whySelected.length > 0) || comentarios != '')) {
        getServerAtividades(param, action);
    } else if (typeof data.notaSelected === 'undefined') {
        alertaBoxPro('Error', 'exclamation-triangle', 'Selecione uma nota de avalia\u00E7\u00E3o.');
    } else {
        if (_this.find('.moreCommentBoxText textarea').is(':hidden')) { _this.find('.moreCommentBox').trigger('click') }
        alertaBoxPro('Error', 'exclamation-triangle', 'Selecione ao menos uma motiva\u00E7\u00E3o ou adicione um coment\u00E1rio \u00E0 avalia\u00E7\u00E3o.');
    }
}
function saveRatingWorkLote(this_, arrayRateAtiv) {
    var _this = $(this_);
    var _parent = _this.closest('.ui-dialog');
    var data = _this.find('.ratingWork').data();
    var comentarios = _this.find('.moreCommentBoxText textarea').val();
    var action = 'rate_atividades';
    var ids = [];
        $.each(arrayRateAtiv, function(index, value){
            var id_plano = jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+value.id_user+"`] | [0].id_plano");
                id_plano = (id_plano === null) ? 0 : id_plano;
                ids.push({
                    id_user: value.id_user,
                    id_plano: id_plano, 
                    id_avaliacao: value.id_avaliacao,
                    tempo_despendido: (data.notaSelected == 0 && data.tempoDecorrido > 0) ? data.tempoDecorrido : value.tempo_despendido,
                    tempo_pactuado: value.tempo_pactuado,
                    id_demanda: value.id_demanda,
                    id_tipo_avaliacao: data.indexSelected,
                    nota_atribuida: data.notaSelected,
                    aceita_entrega: data.aceitaEntrega,
                    comentarios: comentarios,
                    avaliacao_justificativa: data.whySelected,
                    data_avaliacao: moment().format('YYYY-MM-DD HH:mm:ss')
                });
        });
        
    var param = {
                    action: action,
                    ids: ids
                }
    if (typeof data.notaSelected !== 'undefined' && ((typeof data.whySelected !== 'undefined' && data.whySelected.length > 0) || comentarios != '')) {
        getServerAtividades(param, action);
    } else if (typeof data.notaSelected === 'undefined') {
        alertaBoxPro('Error', 'exclamation-triangle', 'Selecione uma nota de avalia\u00E7\u00E3o.');
    } else {
        if (_this.find('.moreCommentBoxText textarea').is(':hidden')) { _this.find('.moreCommentBox').trigger('click') }
        alertaBoxPro('Error', 'exclamation-triangle', 'Selecione ao menos uma motiva\u00E7\u00E3o ou adicione um coment\u00E1rio \u00E0 avalia\u00E7\u00E3o.');
    }
}
// ACAO AO SELECIONAR UMA NOTA DE AVALIACAO
function onStarAtiv(this_, mode) {
    var this_ = $(this_);
    var data = this_.data();
    //console.log(this_, data, mode);
    if (mode == 'over' || mode == 'click') {
        this_.closest('td').find('.iconStarAtiv').each(function(){
            if (parseInt($(this).data('nota')) <= parseInt(data.nota)) {
                $(this).find('i').addClass('starGold');
                if (mode == 'click') { 
                    $(this).data('select', true); 
                }
            } else {
                if (!$(this).data('select')) {
                    $(this).find('i').removeClass('starGold');
                }
                if (mode == 'click') { 
                    $(this)
                        .data('select', false)
                        .find('i')
                        .removeClass('starGold');
                }
            }
        });
        if (mode == 'click') {
            this_.closest('td').find('.iconStarAtiv i').removeClass('starSelected');
            this_.find('i').addClass('starSelected');
            this_.closest('.ratingWork')
                .data('nota-selected', data.nota)
                .data('index-selected', data.index)
                .data('aceita-entrega', data.aceitaEntrega)
                .data('why-selected', []);
            
            var color = (typeof data.color !== 'undefined' && data.color !== null) 
                            ? 'color: '+data.color
                            : '';
            var colorBackground = (typeof data.color !== 'undefined' && data.color !== null) 
                            ? 'background-color: rgb('+$.map(hexToRgb(data.color),function(e){ return e }).join(" ")+' / 20%)'
                            : ''
            var htmlReason =        '<div class="ratingQuestion">'+
                                    '   <strong class="emoticon" style="'+colorBackground+'">'+
                                    '       <i class="fas '+data.icon+'" style="padding: 0 5px;font-size: 1.5em; '+color+'"></i>'+
                                    '       '+data.nome+
                                    '   </strong> '+
                                    '   <span>'+data.pergunta+'</span>'+
                                    '   <span class="ratingVisibility" style="float: right;" onmouseover="return infraTooltipMostrar(\'Motiva\u00E7\u00E3o vis\u00EDvel apenas para os gestores e para o avaliado\');" onmouseout="return infraTooltipOcultar();"><i class="fas fa-eye cinzaColor"></i></span>'+
                                    '</div>'+
                                    '<div class="ratingWhy">';
            
            var arrayJustificativas = (arrayConfigAtividades['avaliacao'].length > 0) ? jmespath.search(arrayConfigAtividades['avaliacao'], "[?nota_atribuida==`"+data.nota+"`].{id_tipo_justificativa: id_tipo_justificativa, nome_justificativa: nome_justificativa}") : [];
                $.each(arrayJustificativas, function(index, value){
                    htmlReason +=   '   <span class="answer" onclick="onWhyAtiv(this)" data-selected="false" data-index="'+value.id_tipo_justificativa+'">'+value.nome_justificativa+'</span>';    
                });
                    htmlReason +=   '</div>';    
                this_.closest('table').find('.moreCommentBoxDiv').show();
                this_.closest('table').find('.ratingReason').html(htmlReason);
        }
    } else if (mode == 'out') {
        if (!data.select) {
            this_.closest('td').find('.iconStarAtiv').each(function(){ 
                if(!$(this).data('select')) { 
                    $(this).find('i').removeClass('starGold'); 
                }
            });
        }
    }
    centralizeDialogBox(dialogBoxPro);
}
// ACAO AO SELECIONAR UM MOTIVO DE AVALIACAO
function onWhyAtiv(this_) {
    var _this = $(this_);
    var data = _this.data();
    if (data.selected == false) {
        _this.addClass('selected').data('selected', true);
    } else {
        _this.removeClass('selected').data('selected', false);
    }
    var arraySelected = []
    _this.closest('.ratingWhy').find('.answer').each(function(){ if ($(this).data('selected')) { arraySelected.push($(this).data('index')) } });
    _this.closest('.ratingWork').data('why-selected', arraySelected);
    
    if (arraySelected.length > 0) { updateButtonConfirm(this_, true) } else { updateButtonConfirm(this_, false) }
}

// INICIA PAINEL
function initPanelAtividades(ativData, TimeOut = 9000) {
    if (TimeOut <= 0 || !ativData) { return; }
    if (typeof $().tabs !== 'undefined' && typeof localStorageRestorePro !== 'undefined' && typeof setPanelAtividades !== 'undefined' && typeof orderDivPanel !== 'undefined' && typeof moment().isoWeekdayCalc !== 'undefined' && !loadRowsPanelAtiv) { 
        if ($('#ifrArvore').length > 0 && ativData['demandas_processo'].length > 0) {
            $('#ifrArvore')[0].contentWindow.initAtividadesProcesso(ativData['demandas_processo']);
        } else {
            setPanelAtividades(ativData['demandas']);
            setAtividadesUser();
        }
        loadingButtonConfirm(false);
    } else {
        setTimeout(function(){ 
            initPanelAtividades(ativData, TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initPanelAtividades'); 
        }, 500);
    }
}
function getAtividadesProcesso(id_procedimento) {
    var dadosProcesso = getIfrArvoreDadosProcesso();
    var stateAtivData = getOptionsPro('panelAtividadesViewSend') ? 'ativas' : 'nao_enviadas';
    var selfAtivData = getOptionsPro('panelAtividadesViewSelf') ? 'only_mine' : '';
    var param = {
            action: 'demandas_processo', 
            id_procedimento: id_procedimento, 
            processo_sei: dadosProcesso.processo_sei,
            status: stateAtivData,
            self: selfAtivData
        };
    getServerAtividades(param, 'panel');
}
function getPanelAtividades(callback) {
    var stateAtivData = getOptionsPro('panelAtividadesViewSend') ? 'ativas' : 'nao_enviadas';
    var selfAtivData = getOptionsPro('panelAtividadesViewSelf') ? 'only_mine' : '';
    var stateAtivDataSub = getOptionsPro('panelAtividadesViewSubordinada') ? '' : 'self';
    // var stateAtivDataSub = ( getOptionsPro('panelAtividadesViewSubordinada') || !verifyOptionsPro('panelAtividadesViewSubordinada')) ? '' : 'self';
    var param = {
            action: 'demandas', 
            status: stateAtivData,
            lista: stateAtivDataSub,
            callback: callback,
            self: selfAtivData
        };
    getServerAtividades(param, 'panel');
}
function getPanelAtividades_() {
    if (typeof arrayConfigAtividades == 'undefined' || arrayConfigAtividades.length == 0) {
        getPanelAtividades();
    }
}
function getAtividades(callback) {
    var ifrArvore = $('#ifrArvore');
    if (ifrArvore.length > 0) {
        var id_procedimento = getParamsUrlPro(ifrArvore.attr('src')).id_procedimento;
            id_procedimento = (typeof id_procedimento !== 'undefined') ? parseInt(id_procedimento) : 0;
        getAtividadesProcesso(id_procedimento, callback);
    } else {
        if ($('#atividadesProDiv').is(':visible') || $('#projetosGanttDiv').is(':visible')) {
            getPanelAtividades(callback);
        }
    }
}
function getTitleDialogBox(v, full = false) {
    var nome_atividade = (v.nome_atividade && v.nome_atividade.length > 50) 
                            ? v.nome_atividade.replace(/^(.{50}[^\s]*).*/, "$1")+'...' 
                            : (v.nome_atividade ? v.nome_atividade : '');
    var assunto = (v.assunto && v.assunto.length > 50) 
                            ? v.assunto.replace(/^(.{50}[^\s]*).*/, "$1")+'...' 
                            : (v.assunto ? v.assunto : '');
    var nameAtiv = (full) 
                    ? (v.assunto ? v.assunto +' / ': '')+v.nome_atividade
                    : (assunto ? assunto : '')+(nome_atividade != '' ? ' / '+nome_atividade : '');
    var displayTitle =  (v.nome_requisicao ? v.nome_requisicao+' - ' : '')+(v.requisicao_sei ? '('+v.requisicao_sei+') - ' : '')+(v.apelido ? v.apelido+' ' : '');
        displayTitle = (displayTitle != '') ? displayTitle+'/ '+nameAtiv : nameAtiv;
    return displayTitle;
}
function selectAtividadeBox(mode) {   
    var iconDelete = $('#atividadesProActions .iconAtividade_delete');
    var iconSend = $('#atividadesProActions .iconAtividade_send');
    var iconRate = $('#atividadesProActions .iconAtividade_rate');
    
    if (mode == 'send' && iconSend.length > 0 && iconSend.data('list').length > 0) {
        archiveAtividade(iconSend.data('list'));
    } else if (mode == 'rate' && iconRate.length > 0 && iconRate.data('list').length > 0) {
        rateAtividadeLote(iconRate.data('list'));
    } else if (mode == 'delete' && iconDelete.length > 0 && iconDelete.data('list').length > 0) {
        var id_demandas = iconDelete.data('list');
        confirmaFraseBoxPro('Tem certeza que deseja excluir '+(id_demandas.length > 1 ? __.as_demandas_selecionadas : __.a_demanda_selecionada)+'?', 'EXCLUIR', function(){
            var action = (checkCapacidade('delete_atividade_all')) ? 'delete_atividade_all' : 'delete_atividade';
            var param = {
                id_demandas: id_demandas, 
                id_demanda: -1, 
                id_unidade: arrayConfigAtivUnidade.id_unidade, 
                action: action
            };
            getServerAtividades(param, action);
        });
    } else {
        var arrayAtividadesList = ($('#ifrVisualizacao').length > 0) ? arrayAtividadesProcPro : arrayAtividadesPro; 
        var listaAtividades = (mode == 'start')
                            ? ( !checkCapacidade('only_self_atividades') ) 
                                ? jmespath.search(arrayAtividadesList, "[?data_inicio=='0000-00-00 00:00:00']")
                                : jmespath.search(arrayAtividadesList, "[?data_inicio=='0000-00-00 00:00:00'] | [?id_user==`"+arrayConfigAtividades.perfil.id_user+"`]")
                            : 0;
            listaAtividades = (mode == 'complete')
                            ? ( !checkCapacidade('only_self_atividades') ) 
                                ? jmespath.search(arrayAtividadesList, "[?data_entrega=='0000-00-00 00:00:00'] | [?data_inicio!='0000-00-00 00:00:00']")
                                : jmespath.search(arrayAtividadesList, "[?data_entrega=='0000-00-00 00:00:00'] | [?data_inicio!='0000-00-00 00:00:00'] | [?id_user==`"+arrayConfigAtividades.perfil.id_user+"`]")
                            : listaAtividades;
            listaAtividades = (mode == 'edit' && checkCapacidade('edit_atividade')) 
                            ? jmespath.search(arrayAtividadesList, "[?data_entrega=='0000-00-00 00:00:00']")
                            : listaAtividades;
            listaAtividades = (mode == 'rate' && checkCapacidade('rate_atividade')) 
                            ? jmespath.search(arrayAtividadesList, "[?data_entrega!='0000-00-00 00:00:00'] | [?data_avaliacao=='0000-00-00 00:00:00']")
                            : listaAtividades;
            listaAtividades = (mode == 'rate_edit' && checkCapacidade('rate_edit_atividade')) 
                            ? jmespath.search(arrayAtividadesList, "[?data_entrega!='0000-00-00 00:00:00'] | [?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00']")
                            : listaAtividades;
            listaAtividades = (mode == 'rate_cancel' && checkCapacidade('rate_cancel_atividade')) 
                            ? jmespath.search(arrayAtividadesList, "[?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00']")
                            : listaAtividades;
            listaAtividades = (mode == 'send' && checkCapacidade('send_atividade')) 
                            ? jmespath.search(arrayAtividadesList, "[?data_entrega!='0000-00-00 00:00:00'] | [?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00']")
                            : listaAtividades;
            listaAtividades = (mode == 'delete' && checkCapacidade('delete_atividade')) 
                            ? jmespath.search(arrayAtividadesList, "[?data_entrega=='0000-00-00 00:00:00']")
                            : listaAtividades;
            listaAtividades = (mode == 'delete' && checkCapacidade('delete_atividade_all')) 
                            ? jmespath.search(arrayAtividadesList, "[*]")
                            : listaAtividades;

        if (listaAtividades.length == 1) {
            if (mode == 'start') {
                startAtividade(listaAtividades[0].id_demanda);
            } else if (mode == 'complete') {
                completeAtividade(listaAtividades[0].id_demanda);
            } else if (mode == 'edit') {
                saveAtividade(listaAtividades[0].id_demanda);
            } else if (mode == 'rate' || mode == 'rate_edit') {
                rateAtividade(listaAtividades[0].id_demanda);
            } else if (mode == 'rate_cancel') {
                rateCancelAtividade(listaAtividades[0].id_demanda);
            } else if (mode == 'send') {
                archiveAtividade(listaAtividades[0].id_demanda);
            } else if (mode == 'delete') {
                confirmaBoxPro('Tem certeza que deseja excluir '+__.esta_demanda+'?', function() { deleteAtividade(listaAtividades[0].id_demanda) }, 'Excluir');
            
            }

        } else if (listaAtividades.length > 1) {
            var nameMode = (mode == 'start') ? 'Iniciar' : '';
                nameMode = (mode == 'complete') ? 'Concluir' : nameMode;
                nameMode = (mode == 'edit') ? 'Editar' : nameMode;
                nameMode = (mode == 'rate') ? 'Avaliar' : nameMode;
                nameMode = (mode == 'rate_edit') ? 'Editar Avaliar' : nameMode;
                nameMode = (mode == 'rate_cancel') ? 'Cancelar Avalia\u00E7\u00E3o' : nameMode;
                nameMode = (mode == 'send') ? __.Arquivar : nameMode;
                nameMode = (mode == 'delete') ? 'Deletar' : nameMode;
            var optionSelectAtividade = $.map(listaAtividades, function(v,k){ 
                                            return '<option value="'+v.id_demanda+'" title="'+getTitleDialogBox(v, true)+'">'+getTitleDialogBox(v)+'</option>'
                                        }).join('');
            var htmlBox =   '<div id="boxAtividade" class="atividadeWork '+mode+'AtividadeBox">'+
                            '   <table style="font-size: 10pt;width: 100%;" class="seiProForm">'+
                            '      <tr>'+
                            '          <td style="vertical-align: bottom; text-align: left; width: 160px;" class="label">'+
                            '               <label for="ativ_data_inicio"><i class="iconPopup iconSwitch fas fa-check cinzaColor" style="min-height: 45px;"></i>Selecione '+__.a_Demanda+' para '+nameMode+':</label>'+
                            '           </td>'+
                            '           <td>'+
                            '               <select id="ativ_id_demanda" onchange="getSelectedItemBox(this)" data-key="id_demanda">'+optionSelectAtividade+'</select>'+
                            '           </td>'+
                            '      </tr>'+
                            '      <tr id="previewItemAtividade" style="display:none;">'+
                            '           <td colspan="2">'+
                            '               <div class="preview_atividade" style="padding: 20px;background-color: #f4f5f5;border-radius: 5px;margin-top: 10px;"></div>'+
                            '           </td>'+
                            '      </tr>'+
                            '   </table>'+
                            '</div>';

            
            var btnDialogBoxPro = [{
                text: 'Selecionar',
                class: 'confirm',
                click: function(event) { 
                    var selectIdDemanda = $('.'+mode+'AtividadeBox').find('#ativ_id_demanda').val();
                    // console.log(selectIdDemanda);
                    if (mode == 'start') {
                        startAtividade(selectIdDemanda);
                    } else if (mode == 'complete') {
                        completeAtividade(selectIdDemanda);
                    } else if (mode == 'edit') {
                        saveAtividade(selectIdDemanda);
                    } else if (mode == 'rate' || mode == 'rate_edit') {
                        rateAtividade(selectIdDemanda);
                    } else if (mode == 'rate_cancel') {
                        rateCancelAtividade(selectIdDemanda); 
                    } else if (mode == 'send') {
                        archiveAtividade(selectIdDemanda); 
                    } else if (mode == 'delete') {
                        deleteAtividade(selectIdDemanda); 
                    }
                }
            }];

            if (checkCapacidade('start_cancel_atividades') && mode == 'complete') {
                btnDialogBoxPro.unshift({
                    text: 'Cancelar In\u00EDcio',
                    icon: 'ui-icon-close',
                    click: function(event) {
                        $('#boxAtividade').remove(); 
                        resetDialogBoxPro('dialogBoxPro'); 
                        var list = $('#atividadesProActions .iconAtividade_complete').data('list');
                        startCancelAtividadeLote(list);
                    }
                });
            }

            resetDialogBoxPro('dialogBoxPro');
            dialogBoxPro = $('#dialogBoxPro')
                .html('<div class="dialogBoxDiv">'+htmlBox+'</div>')
                .dialog({
                    title: nameMode+' '+__.Demanda+': Selecionar',
                    width: 770,
                    open: function() { 
                        updateButtonConfirm(this, true);
                        initChosenReplace('box_init', this, true);
                    },
                    close: function() { 
                        $('#boxAtividade').remove(); 
                        resetDialogBoxPro('dialogBoxPro'); 
                    },
                    buttons: btnDialogBoxPro
                });
        }
    }
}
function getSelectedItemBox(this_) {
    var _this = $(this_);
    var _parent = _this.closest('table');
    var id_demanda = _this.prop('multiple') && _this.val().length ? _this.val()[_this.val().length-1] : false;
        id_demanda = (!_this.prop('multiple') && checkValue(_this)) ? _this.val() : id_demanda;
    var value = (id_demanda) ? getAtividadeData(id_demanda) : null;
        value = (id_demanda && value !== null) ? value : false;
    var htmlItem = (value) 
        ?   '<div class="kanban-container">'+
            '   <div class="kanban-item" data-eid="_id_'+id_demanda+'">'+
            getKanbanItem(value).title+
            '   </div>'+
            '</div>'
        : '';

    if (value) {
        _parent.find('#previewItemAtividade').show().find('.preview_atividade').html(htmlItem);
    } else {
        _parent.find('#previewItemAtividade').hide().find('.preview_atividade').html('');
    }
    dialogBoxPro.dialog('option', 'height', 'auto');
}
function insertIconAtividade() {
    waitLoadPro($('#ifrVisualizacao').contents(), '#divInfraAreaTelaD', "#divArvoreAcoes", getInsertIconAtividade);
}
function getInsertIconAtividade(loop = true) {
    var arrayAtividadesList = [];
        if ($('#ifrVisualizacao').length > 0) {
            $('#ifrVisualizacao').contents().find('.iconBoxAtividade').remove();
            arrayAtividadesList = arrayAtividadesProcPro;
        } else {
            $('#atividadesProActions').find('.iconBoxAtividade').remove();
            arrayAtividadesList = arrayAtividadesPro;
        }
        if (checkCapacidade('save_atividade')) {
            appendIconAtividade('save');
        }
        if (arrayAtividadesList.length > 0) {
            if (checkCapacidade('start_atividade') && 
                (
                    ( !checkCapacidade('only_self_atividades') ) 
                        ? (jmespath.search(arrayAtividadesList, "[?data_inicio=='0000-00-00 00:00:00'] | length(@)") > 0)
                        : (jmespath.search(arrayAtividadesList, "[?data_inicio=='0000-00-00 00:00:00'] | [?id_user==`"+arrayConfigAtividades.perfil.id_user+"`] | length(@)") > 0)
                )
            ) {
                appendIconAtividade('start');
            }
            if ((checkCapacidade('complete_atividade') || checkCapacidade('start_cancel_atividade')) && 
                (
                    ( !checkCapacidade('only_self_atividades') ) 
                        ? (jmespath.search(arrayAtividadesList, "[?data_entrega=='0000-00-00 00:00:00'] | [?data_inicio!='0000-00-00 00:00:00'] | length(@)") > 0)
                        : (jmespath.search(arrayAtividadesList, "[?data_entrega=='0000-00-00 00:00:00'] | [?data_inicio!='0000-00-00 00:00:00'] | [?id_user==`"+arrayConfigAtividades.perfil.id_user+"`] | length(@)") > 0)
                )
            ) {
                appendIconAtividade('complete');
            }
            if (checkCapacidade('rate_atividade') && jmespath.search(arrayAtividadesList, "[?data_entrega!='0000-00-00 00:00:00'] | [?data_avaliacao=='0000-00-00 00:00:00'] | length(@)") > 0) {
                appendIconAtividade('rate');
            }
            if (checkCapacidade('send_atividade') && jmespath.search(arrayAtividadesList, "[?data_avaliacao!='0000-00-00 00:00:00'] | [?data_envio=='0000-00-00 00:00:00'] | length(@)") > 0) {
                appendIconAtividade('send');
            }
            if (checkCapacidade('delete_atividade') && jmespath.search(arrayAtividadesList, "[?data_inicio=='0000-00-00 00:00:00'] | length(@)") > 0) {
                appendIconAtividade('delete');
            }
            if (checkCapacidade('delete_atividade_all') && jmespath.search(arrayAtividadesList, "[*] | length(@)") > 0) {
                appendIconAtividade('delete');
            }
        }
        appendModulesIcons();
        setAtividadesProcessoHome();
        if (loop) {
            setTimeout(function () {
                getInsertIconAtividade(false);
            },1500);
        }
}
function appendModulesIcons() {
    var elementActions = $('#atividadesProActions');
    if ($('#ifrVisualizacao').length == 0) {
        var i = 0;
        var iconLabel = localStorage.getItem('iconLabel');
        var iconBoxSlim = localStorage.getItem('seiSlim');
        var htmlModules =   '<span class="modulesActions">';
        if (elementActions.length > 0) {
            if (checkCapacidade('view_afastamento')) {
                htmlModules +=  '<a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconAfastamento_view" onmouseover="return infraTooltipMostrar(\'Afastamentos\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Afastamento">'+
                                '   <i class="fas fa-luggage-cart cinzaColor"></i>'+
                                '   <span class="newIconTitle">Afastamentos</span>'+
                                '</a>';
                i = i+1;
            }
            if (checkCapacidade('view_contato')) {
                htmlModules +=  '<a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconContato_view" onmouseover="return infraTooltipMostrar(\'Contatos\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Contato">'+
                                '   <i class="fas fa-id-card cinzaColor"></i>'+
                                '   <span class="newIconTitle">Contatos</span>'+
                                '</a>';
                i = i+1;
            }
            if (checkCapacidade('view_relatorio')) {
                htmlModules +=  '<a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconRelatorio_view" onmouseover="return infraTooltipMostrar(\'Relat\u00F3rios\');" onmouseout="return infraTooltipOcultar();" onclick="changePanelHome(this)" style="font-size: 14pt;" data-value="Relatorio">'+
                                '   <i class="fas fa-chart-pie cinzaColor"></i>'+
                                '   <span class="newIconTitle">Relat\u00F3rios</span>'+
                                '</a>';
                i = i+1;
            }
        }

            htmlModules +=  '<a class="newLink iconBoxModules '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconConfiguracao_view" onmouseover="return infraTooltipMostrar(\'Configura\u00E7\u00F5es\');" onmouseout="return infraTooltipOcultar();" onclick="'+(checkOptionEntidade('modal_configuracoes') ? 'openModalConfigPanel()' : 'changePanelHome(this)')+'" style="font-size: 14pt;" data-value="Configuracao">'+
                            '   <i class="fas fa-cog cinzaColor"></i>'+
                            '   <span class="newIconTitle">Configura\u00E7\u00F5es</span>'+
                            '</a>'+
                            '</span>';

            elementActions.find('.modulesActions').remove();
            elementActions.append(htmlModules);
    }
}
function appendIconAtividade(name = false) {
    var elementActions = ($('#ifrVisualizacao').length > 0) ? $('#ifrVisualizacao').contents() : $('#atividadesProActions');
        
    if (name && typeof __ !== 'undefined') {
        var htmlIconAtividade = '';
        if (name == 'save') {
            elementActions.find('.iconAtividade_'+name).remove();
            htmlIconAtividade = getHtmlIconAtividade({name: name, title: __.Nova_Demanda, icon: 'fas fa-user-check', action: 'saveAtividade()'});
        } else if (name == 'start') {
            elementActions.find('.iconAtividade_'+name).remove();
            htmlIconAtividade = getHtmlIconAtividade({name: name, title: 'Iniciar '+__.Demanda+'', icon: 'fas fa-play-circle', action: 'selectAtividadeBox(\'start\')'});
        } else if (name == 'complete') {
            elementActions.find('.iconAtividade_'+name).remove();
            htmlIconAtividade = getHtmlIconAtividade({name: name, title: 'Concluir '+__.Demanda+'', icon: 'fas fa-check-circle', action: 'selectAtividadeBox(\'complete\')'});
        } else if (name == 'rate') {
            elementActions.find('.iconAtividade_'+name).remove();
            htmlIconAtividade = getHtmlIconAtividade({name: name, title: 'Avaliar '+__.Demanda+'', icon: 'fas fa-star', action: 'selectAtividadeBox(\'rate\')'});
        } else if (name == 'send') {
            elementActions.find('.iconAtividade_'+name).remove();
            htmlIconAtividade = getHtmlIconAtividade({name: name, title: __.Arquivar+' '+__.Demandas+' do Processo', icon: 'fas fa-archive', action: 'selectAtividadeBox(\'send\')'});
        } else if (name == 'delete') {
            elementActions.find('.iconAtividade_'+name).remove();
            htmlIconAtividade = getHtmlIconAtividade({name: name, title: 'Excluir '+__.Demanda+'', icon: 'fas fa-trash-alt', action: 'selectAtividadeBox(\'delete\')'});
        }
        if (htmlIconAtividade != '') { 
            if ($('#ifrVisualizacao').length > 0) {
                elementActions.find('#divArvoreAcoes').append(htmlIconAtividade);
            } else {
                elementActions.append(htmlIconAtividade);
            }
        }
    }
}
function getHtmlIconAtividade(value) {
    var htmlBtn = '';
    var iconLabel = localStorage.getItem('iconLabel');
    var iconBoxSlim = localStorage.getItem('seiSlim');
    if ($('#ifrVisualizacao').length > 0) {
        htmlBtn =   '<a tabindex="451" class="botaoSEI iconBoxAtividade '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconAtividade_'+value.name+'" '+(iconLabel ? '' : 'onmouseout="return infraTooltipOcultar();" onmouseover="return infraTooltipMostrar(\''+value.title+'\')"')+' onclick="parent.'+value.action+'" style="position: relative;display: inline-block;">'+
                    '    <img class="infraCorBarraSistema" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" title="'+value.title+'">'+
                    '    <span class="botaoSEI_iconBox">'+
                    '       <i class="'+value.icon+' fa-brancoColor" style="font-size: 17pt;"></i>'+
                    '    </span>'+
                    (iconLabel ?
                    '    <span class="newIconTitle">'+value.title+'</span>'+
                    '' : '')+
                    '</a>';
    } else {
        htmlBtn =   '<a class="newLink iconBoxAtividade '+(iconLabel ? 'iconLabel' : '')+' '+(iconBoxSlim ? 'iconBoxSlim' : '')+' iconAtividade_'+value.name+'" onclick="'+value.action+'" title="'+value.title+'" '+(iconLabel ? '' : 'onmouseover="return infraTooltipMostrar(\''+value.title+'\');"')+' onmouseout="return infraTooltipOcultar();" style="margin: 0; font-size: 14pt;">'+
                    '       <span class="fa-layers fa-fw">'+
                    '           <i class="'+value.icon+'"></i>'+
                    '           <span class="fa-layers-counter" style="display: none;"></span>'+
                    '       </span>'+
                    (iconLabel ?
                    '    <span class="newIconTitle">'+value.title+'</span>'+
                    '' : '')+
                    '</a>';
    }
    return htmlBtn;
}
function initEmptyAtividades(reloadProfile = false) {
    // arrayAtividadesPro = [];
    initNameConst('get');
    setPanelAtividades();
    if (reloadProfile) {
        initPerfilLoginAtiv();
    } else {
        $('#tabelaAtivPanel, #ganttAtivPanel').find('.dataFallback').addClass('dataLoading');
        $('.iconAtividade_update i').addClass('fa-spin');
    }
}
function initAtividades(TimeOut = 9000) {
    if (TimeOut <= 0) { return; }
    if (typeof localStorageRestorePro !== 'undefined' && typeof checkLoadingButtonConfirm !== 'undefined' && typeof $().tabs !== 'undefined' ) { 
        urlServerAtiv = perfilLoginAtiv.URL_API;
        userHashAtiv = perfilLoginAtiv.KEY_USER;
        if (typeof initPanelFavorites !== 'undefined') initPanelFavorites();
        initEmptyAtividades();
        getAtividades();
        if (typeof $.mask === 'undefined') {
            $.getScript(URL_SPRO+"js/lib/jquery.maskedinput.min.js"); 
        }
        if (typeof $().chosen === 'undefined') {
            $.getScript(URL_SPRO+"js/lib/chosen.jquery.min.js"); 
        }
        if (typeof moment().isoWeekdayCalc === 'undefined') {
            $.getScript(URL_SPRO+"js/lib/moment-weekday-calc.js");
        }
    } else {
        setTimeout(function(){ 
            initAtividades(TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initAtividades'); 
        }, 500);
    }
}
function initPerfilLoginAtiv(TimeOut = 9000) {
    if (TimeOut <= 0) { return; }
    if (typeof checkConfigValue !== 'undefined' && typeof localStorageRestorePro !== 'undefined' ) { 
        if (checkConfigValue('gerenciaratividades')) {
            setTimeout(function(){ 
                perfilLoginAtiv = localStorageRestorePro('configBasePro_atividades');
                perfilLoginAtiv = (typeof perfilLoginAtiv !== 'undefined' && perfilLoginAtiv !== null) ? perfilLoginAtiv : false;
                if (perfilLoginAtiv) {
                    initAtividades();
                } else {
                    getServersPro();
                }
            }, 500);
        }
    } else {
        setTimeout(function(){ 
            initPerfilLogin(TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initPerfilLogin', typeof localStorageRestorePro,  typeof localStorageRestorePro('configBasePro_atividades')); 
        }, 500);
    }
}

// Verifica dominios permitidos
function getServersPro() {
    $.ajax({
        url: 'https://seipro.app/servers/',
        type: 'GET',
        dataType: 'json',
        success: function(result) {
            var host = jmespath.search(result, "[?domain=='"+window.location.host+"'] | [0]");
                host = (host !== null && host.enabled) ? host : false;
            if (host) {
                if (host.login_default == 'key') {
                    urlServerAtiv = host.remote_host;
                    arrayConfigAtividades = false;
                    arrayConfigAtivUnidade = false;
                    removeLocalDataAtiv();
                    removeOptionsPro('perfilAtividadesSelected');
                    removeOptionsPro('panelAtividadesView');
                    removeOptionsPro('panelAfastamentosView');
                    initEmptyAtividades();
                    $('.panelHome').find('.iconAtividade_update i').removeClass('fa-spin');
                    $('.atividadesBtnPanel button[data-value="Tabela"]').trigger('click');
                    $('#tabelaAtivPanel').attr('class','').css('text-align','center').html('<a class="newLink" onclick="getResendKey(this)" style="transform: scale(1.4);margin: 10px 0;"><i class="fas fa-key laranjaColor"></i> Solicitar chave de acesso</a>');
                } 
                /* else {
                    var hostConfig = url_host.replace('controlador.php','');
                    var urlConfigAtiv = (host) 
                        ? hostConfig+'?#&acao_pro=set_database&mode=insert&base=atividades&token=&client_id='+encodeURIComponent(host.client_id)+'&url='+encodeURIComponent(host.remote_host)
                        : hostConfig+'?#&acao_pro=set_option&option_key=gerenciaratividades&option_value=false';
                    if ( $('#frmCheckerProcessoPro').length == 0 ) { getCheckerProcessoPro(); }
                    $('#frmCheckerProcessoPro').attr('src', urlConfigAtiv).unbind().on('load', function(){
                        if (host) {
                            perfilLoginAtiv = {URL_API: host.remote_host, KEY_USER: '', CLIENT_ID: host.client_id};
                            urlServerAtiv = perfilLoginAtiv.URL_API;
                            userHashAtiv = perfilLoginAtiv.KEY_USER;
                            localStorageStorePro('configBasePro_atividades', perfilLoginAtiv);
                            initAtividades();
                            // console.log('INITI');
                        } else {
                            // cleanAtivParams(true, true);
                        }
                    });
                } */
            }
        }
    });
}
/* 
function getTokenGoogle(response = false) {
    var credential = (typeof window.googleUser !== 'undefined') 
                    ? (googleOneTap) 
                        ? window.googleUser.response.credential 
                        : window.googleUser
                    : false;
        credential = (sessionStorageRestorePro('googleUser') !== null) ? sessionStorageRestorePro('googleUser').response.credential : credential;
        credential = (response) ? response.credential : credential;
        credential = (typeof gapi !== 'undefined' && typeof gapi.auth2 !== 'undefined') ? gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token : false;
        credential = (typeof credential !== 'undefined') ? credential : false;
    return credential;
}
function onLoad(TimeOut = 9000) {
    if (TimeOut <= 0 || parent.window.name != '') { return; }
    if (googleOneTap) {
        if (typeof google !== 'undefined' && typeof perfilLoginAtiv.CLIENT_ID !== 'undefined' && perfilLoginAtiv.CLIENT_ID !== '') {
            google.accounts.id.initialize({
                client_id: perfilLoginAtiv.CLIENT_ID,
                callback: onSignIn
            });
            google.accounts.id.prompt();
        } else {
            setTimeout(function(){ 
                onLoad(TimeOut - 100); 
                if(verifyConfigValue('debugpage')) console.log('Reload onLoad => '+TimeOut); 
            }, 500);
        }
    } else {
        if (typeof gapi !== 'undefined') {
            gapi.load('auth2', function() {
                gapi.auth2.init();
                setTimeout(function () {
                    onSignIn();
                },500);
            });
        } else {
            setTimeout(function(){ 
                onLoad(TimeOut - 100); 
                if(verifyConfigValue('debugpage')) console.log('Reload onLoad => '+TimeOut); 
            }, 500);
        }
    }
} */
function getResumeAtiv() {
    var planoTrabalho = (typeof arrayConfigAtividades.planos !== 'undefined' && arrayConfigAtividades.planos !== null && arrayConfigAtividades.planos != 0 && arrayConfigAtividades.planos.length > 0 ) ? arrayConfigAtividades.planos : false;
    if (planoTrabalho) {
        var planoTrabalho = (checkCapacidade('only_self_atividades')) 
                            ? jmespath.search(arrayConfigAtividades.planos,"[?id_user==`"+arrayConfigAtividades.perfil.id_user+"`] | [0]")
                            : jmespath.search(arrayConfigAtividades.planos,"{tempo_homologado: sum([*].tempo_homologado), tempo_proporcional: sum([*].tempo_proporcional)}");
            planoTrabalho = (planoTrabalho !== null) ? planoTrabalho : false;
        var execucaoPlano = (planoTrabalho) 
                            ? (planoTrabalho.tempo_homologado == 0) 
                                ? '0%' 
                                : ((planoTrabalho.tempo_homologado/planoTrabalho.tempo_proporcional)*100).toFixed(2)+'%' 
                            : '-';
    } else {
        var execucaoPlano = '-';
    }
    var demandaResumo = (checkCapacidade('only_self_atividades')) 
                        ? jmespath.search(arrayAtividadesPro,"[?data_entrega=='0000-00-00 00:00:00'] | [?id_user==`"+arrayConfigAtividades.perfil.id_user+"`]")
                        : arrayAtividadesPro;
    var demandasTotais = (typeof arrayAtividadesPro !== 'undefined' && arrayAtividadesPro !== null && arrayAtividadesPro.length > 0) ? demandaResumo.length : 0;
    var demandasIniciadas = (checkCapacidade('only_self_atividades')) 
                        ? jmespath.search(arrayAtividadesPro,"[?data_entrega=='0000-00-00 00:00:00'] | [?id_user==`"+arrayConfigAtividades.perfil.id_user+"`] | [?data_inicio!='0000-00-00 00:00:00'] | length(@)")
                        : jmespath.search(arrayAtividadesPro,"[?data_entrega=='0000-00-00 00:00:00'] | [?data_inicio!='0000-00-00 00:00:00'] | length(@)");
    var demandasAtrasadas = 0;
    var demandasProdutividade = 0;
    if (demandasTotais > 0) { 
        $.each(demandaResumo,function(i, v){
            if (v.data_entrega == '0000-00-00 00:00:00' && moment(v.prazo_entrega,'YYYY-MM-DD HH:mm:ss') < moment() && (typeof v.data_pausa === 'undefined' || v.data_pausa === null || v.data_pausa == '0000-00-00 00:00:00')) {
                demandasAtrasadas = demandasAtrasadas+1;
            }
        });
        var demandasProdutividade = $.map(arrayAtividadesPro, function(v, i){
            if (v.produtividade !== null) {
                return v.produtividade;
            }
        });
        demandasProdutividade = (demandasProdutividade.length > 0) ? avgArray(demandasProdutividade).toFixed(2) : 0;
    }
    return {
        totais: demandasTotais, 
        iniciadas: demandasIniciadas, 
        atrasadas: demandasAtrasadas, 
        executado: execucaoPlano,
        produtividade: demandasProdutividade
    };
}
/* function getProfileAtiv(response = false) {
    var profile = (typeof window.googleUser !== 'undefined') 
                ? (googleOneTap) 
                    ? window.googleUser.decode 
                    : window.googleUser.getBasicProfile()
                : (googleOneTap) 
                    ? false
                    : (response) ? googleUser.getBasicProfile() : false;
        profile = (googleOneTap && sessionStorageRestorePro('googleUser') !== null) ? sessionStorageRestorePro('googleUser').decode : profile;
        profile = (response) 
                ? (googleOneTap) 
                    ? response.decode 
                    : googleUser.getBasicProfile()
                : profile;

    if (getTokenGoogle() && profile) {
            profile = (googleOneTap) ? profile : {name: profile.getName(), picture: profile.getImageUrl(), email: profile.getEmail()};
        var backgroundSEI = $('.infraCorBarraSistema').css('background-color');
            backgroundSEI = (typeof backgroundSEI !== 'undefined') ? rgbToHexString(backgroundSEI) : '#01a5da';
        var resumeAtiv = (typeof arrayAtividadesPro !== 'undefined' && arrayAtividadesPro !== null && arrayAtividadesPro.length > 0) ? getResumeAtiv() : false;
        var greetings = generateGreetings();
        var htmlProfile =   '<div id="profileProDiv">'+
                            '   <div id="profileProDiv_full" style="margin-top:20px;'+(getOptionsPro('profileProDiv') == 'hide' ? 'display:none;' : '')+'">'+
                            '      <div class="perfilWidgets" style="float: left;width: 30%;">'+
                            '          <img style="border-radius: 0% 50% 50% 50%;width: 96px;float: left;border: 6px solid '+backgroundSEI+';" src="'+profile.picture+'">'+
                            '          <div class="cardProfile" style="margin: 10px;display: inline-block;width: calc(100% - 130px);position:relative;">'+
                            '              <h2 style="margin: 10px 0;font-size: 2em;font-weight: bold;color: #363636;">'+
                            '                  '+greetings+', '+profile.name+
                            '                  <a class="newLink" id="profileProDiv_hideIcon" onclick="togglePainelPro(\'profileProDiv\',\'hide\')" onmouseover="return infraTooltipMostrar(\'Recolher Painel\');" onmouseout="return infraTooltipOcultar();" style="font-size: 11pt;"><i class="fas fa-minus-square cinzaColor"></i></a>'+
                            '              </h2>'+
                            '              <h2 style="margin: 10px 0;font-size: 1.5em;color: #363636;">'+moment().format('LL')+'</h2>'+
                            '              <a class="newLink" onclick="signOutProfile()" id="ssoLoginConfig" style="position: absolute;right: 0;font-size: 12pt;'+(getTokenGoogle() ? '' : 'display:none;')+'" onmouseover="return infraTooltipMostrar(\'Desconectar\');" onmouseout="return infraTooltipOcultar();">'+
                            '                  <i class="iconPopup fas fa-sign-out-alt cinzaColor" style="height: auto;"></i>'+
                            '              </a>'+
                            '          </div>'+
                            (resumeAtiv ? 
                            '          <div class="boardDemandas" style="clear: both;width: 100%;font-size: 9pt;color: #878787;">'+
                            '              <div style="width: 40%;float: left;padding: 10px;margin: 10px 5px;text-align: center;">'+
                            '                  <span class="count" style="font-size: 20pt;display: block;"><i class="fas fa-clipboard-list cinzaColor" style="color: #878787;margin-right: 10px;"></i>'+resumeAtiv.iniciadas+'/'+resumeAtiv.totais+'</span> demandas em andamento '+(!checkCapacidade('only_self_atividades') ? '<br>na unidade' : '')+
                            '              </div>'+
                            '              <div style="width: 40%;float: left;padding: 10px;margin: 10px 5px;text-align: center;">'+
                            '                  <span class="count" style="font-size: 20pt;display: block;"><i class="fas fa-exclamation-triangle '+(resumeAtiv.atrasadas == 0 ? 'cinzaColor' : 'vermelhoColor')+'" style="color: #878787;margin-right: 10px;"></i>'+resumeAtiv.atrasadas+'</span> demandas em atraso '+(!checkCapacidade('only_self_atividades') ? '<br>na unidade' : '')+
                            '              </div>'+
                            '              <div style="width: 40%;float: left;padding: 10px;margin: 10px 5px;text-align: center;">'+
                            '                  <span class="count" style="font-size: 20pt;display: block;"><i class="fas fa-handshake cinzaColor" style="color: #878787;margin-right: 10px;"></i>'+resumeAtiv.executado+'</span> de execu\u00E7\u00E3o '+(!checkCapacidade('only_self_atividades') ? 'dos planos <br>da unidade' : 'do plano')+
                            '              </div>'+
                            '              <div style="width: 40%;float: left;padding: 10px;margin: 10px 5px;text-align: center;">'+
                            '                  <span class="count" style="font-size: 20pt;display: block;"><i class="fas fa-chart-line cinzaColor" style="color: #878787;margin-right: 10px;"></i>'+resumeAtiv.produtividade+'%</span> de produtividade m\u00E9dia '+(!checkCapacidade('only_self_atividades') ? '<br>na unidade' : '')+
                            '              </div>'+
                            '          </div>'+
                            '' : '')+
                            '      </div>'+
                            '      <div class="calendarWidgets" style="float: right;width: 70%;margin-bottom: 20px;">'+
                            '          <iframe id="googleCalendar" src="https://calendar.google.com/calendar/embed?src='+decodeURIComponent(profile.email)+'&ctz=America%2FSao_Paulo&showTitle=0" style="border: 0" width="98%" height="300" frameborder="0" scrolling="no"></iframe>'+
                            '      </div>'+
                            '   </div>'+
                            '   <div id="profileProDiv_min" style="'+(getOptionsPro('profileProDiv') == 'hide' ? '' : 'display:none;')+'">'+
                            '      <h2 style="margin: 10px 0;font-size: 2em;font-weight: bold;color: #363636;">'+
                            '          <i class="profileProcPro fas fa-user-circle cinzaColor" style="margin: 0 10px 0 0; font-size: 1.1em;"></i>'+
                            '          '+greetings+', '+profile.name+
                            '          <a class="newLink" id="profileProDiv_showIcon" onclick="togglePainelPro(\'profileProDiv\',\'show\')" onmouseover="return infraTooltipMostrar(\'Mostrar Painel\');" onmouseout="return infraTooltipOcultar();" style="font-size: 11pt;"><i class="fas fa-plus-square cinzaColor"></i></a>'+
                            '      </h2>'+
                            '   </div>'+
                            '</div>';

        $('#profileProDiv').remove();
        $('#divInfraAreaTelaD').prepend(htmlProfile);
    }
}
function parseJwt(token) {
    var base64Url = token.split('.')[1];
    var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));

    return JSON.parse(jsonPayload);
};
function onSignIn(response) {
    if (googleOneTap) {
        const responsePayload = parseJwt(response.credential);
        var googleUser = {response: response, decode: responsePayload};
            window.googleUser = googleUser;
            sessionStorageStorePro('googleUser', googleUser);
    } else {
        window.googleUser = response;
    }
    if (getTokenGoogle(response)) {
        getAtividades();
        // initProfileAtiv(googleUser);
        $('#tabelaAtivPanel').html('<div class="dataFallback dataLoading" data-text="Nenhum dado dispon\u00EDvel"></div>');
    }
    // $('#ssoLoginConfig').show();
}
function initProfileAtiv(googleUser, TimeOut = 9000) {
    if (TimeOut <= 0) { return; }
    if (typeof arrayConfigAtividades.perfil !== 'undefined' && typeof arrayConfigAtividades.perfil.id_user !== 'undefined' ) { 
        getProfileAtiv(googleUser);
    } else {
        setTimeout(function(){ 
            initProfileAtiv(googleUser, TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload getProfileAtiv'); 
        }, 500);
    }
} */
function cleanAtivParams(initAtiv = true, reloadProfile = false) {
    localStorageRemovePro('configDataAtividadesPro');
    localStorageRemovePro('configDataAtividadesProcPro');
    localStorageRemovePro('configDataAtividadesPadraoPro');
    // sessionStorageRemovePro('googleUser');
    removeOptionsPro('panelHomeView');
    removeOptionsPro('panelAtividadesView');
    removeOptionsPro('selectReport_planos');
    removeOptionsPro('selectReport_demandas');
    perfilLoginAtiv = false;
    urlServerAtiv = false;
    userHashAtiv = '';
    arrayAtividadesPro = [];
    arrayAtividadesProcPro = [];
    arrayConfigAtividades = [];
    // window.googleUser = undefined;
    infraTooltipOcultar();
    $('#atividadesPro').remove();
    $('#profileProDiv').remove();
    if (initAtiv) {
        initEmptyAtividades(reloadProfile);
    }
}
/* function signOutProfile() {
    if (googleOneTap) {
        if (typeof google !== 'undefined') {
            google.accounts.id.revoke(window.googleUser.decode.sub, done => {
                console.log('User signed out.');
                cleanAtivParams(true, true);
            });
        } else {
            cleanAtivParams(true, true);
        }
    } else {
        var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
                console.log('User signed out.');
                cleanAtivParams(true, true);
            });
    }
    resetDialogBoxPro('configBoxPro');
} */
function getUpdateReports(url) {
    if (typeof url !== 'undefined') {
        $.get(url, function(data){
            if (data.status == 1) {
                getUpdateReports(data.redirect);
                $('#progressLoopReports').progressbar({value: data.pg, max: data.total_pg});
                $('#countLoopReports').text(nameReportsUpdate[indexReportUpdate]+' ('+data.pg+'/'+data.total_pg+')');
            } else if (data.status == 2) {
                indexReportUpdate++;
                if (indexReportUpdate <= listReportsUpdate.length-1) {
                    $('#progressLoopReports').progressbar({value: 0, max: 1000});
                    $('#countLoopReports').text(nameReportsUpdate[indexReportUpdate]);
                    getUpdateReports(urlServerAtiv+'report.php?action='+listReportsUpdate[indexReportUpdate]+'&output=save');
                } else {
                    if (checkOptionEntidade('sincronizar_dados_externos') && typeof arrayConfigAtividades.perfil.nivel !== 'undefined' && arrayConfigAtividades.perfil.nivel !== null && arrayConfigAtividades.perfil.nivel == 1) {
                        setSyncDadoExterno();
                    } else {
                        loadingButtonConfirm(false);
                        resetDialogBoxPro('alertBoxPro');
                        indexReportUpdate = 0;
                        sessionStorage.setItem('checkedUpdateData', true);
                        $(window).unbind('beforeunload');    
                    }
                }
            }
        });
    }
}
function checkUpdateReports() {
    if (!sessionStorage.getItem('checkedUpdateData') || sessionStorage.getItem('checkedUpdateData') != 'true') {
        var url = urlServerAtiv+'report.php?action='+listReportsUpdate[indexReportUpdate]+'&output=check';
            $.get(url, function(data){
                if ((data.status == 1 || data.status == 2) && $('#countLoopReports').length == 0) {
                    initUpdateReports();
                    sessionStorage.setItem('checkedUpdateData', true);
                    $(window).bind("beforeunload", function() { 
                        return confirm("Tem certeza que deseja fechar a janela?"); 
                    });
                } else if (data.status == 0) {
                    indexReportUpdate++;
                    if (indexReportUpdate <= listReportsUpdate.length-1) {
                        checkUpdateReports();
                    } else {
                        indexReportUpdate = 0;
                        sessionStorage.setItem('checkedUpdateData', true);
                    }
                }
            });
    }
}
function checkSyncDadoExterno() {
    if (!sessionStorage.getItem('checkedUpdateData') || sessionStorage.getItem('checkedUpdateData') != 'true') {
        var url = urlServerAtiv+'report.php?action=sync_data&output=sync_data';
            $.get(url, function(data){
                if (data.status == 1) {
                    if (moment(data.last_datetime,'YYYY-MM-DD HH:mm:ss').add(1,'day') < moment()) {
                        setSyncDadoExterno();
                        sessionStorage.setItem('checkedUpdateData', true);
                        $(window).bind("beforeunload", function() { 
                            return confirm("Tem certeza que deseja fechar a janela?"); 
                        });
                    }
                } else if (data.status == 0) {
                        indexReportUpdate = 0;
                        sessionStorage.setItem('checkedUpdateData', true);
                }
            });
    }
}
function setSyncDadoExterno(this_ = false) {
    if (getOptionEntidade('sincronizar_dados_externos')) {

        if (this_) {
            $(this_).find('i').addClass('fa-spinner').toggleClass('fa-cogs fa-spin');
        } else {
            $('#progressLoopReports').progressbar({ value: 0, max: 1000});
            alertaBoxPro('Sucess', 'check-circle','Aguarde... Sincronizando dados externos de <span id="countLoopReports"></span> <div class="info_checklist" style="height:20px"><div id="progressLoopReports" class="checklist_progress" style="float:none; width:95%"></div></div>');
            loadingButtonConfirm(true);
        }

        var actions = getOptionEntidade('acoes_dados_externos').split(',');

        function getAjaxRotinas(index) {
            var act = typeof actions[index] !== 'undefined' ? actions[index].trim() : false;
            if (this_) $(this_).find('.info').text(' ('+act+')');
            
            if (index <= actions.length-1) {
                if (!this_) {
                    var i_value = (index+1);
                    $('#progressLoopReports').progressbar({value: i_value, max: actions.length});
                    $('#countLoopReports').text('('+i_value+'/'+actions.length+'): '+act);
                }
                $.ajax({
                    type: "POST",
                    url: urlServerAtiv+'sync/',
                    dataType: "json",
                    data: {action: act},
                    success: function(data){
                        getAjaxRotinas(index+1);
                    }
                });
            } else {
                indexReportUpdate = 0;
                sessionStorage.setItem('checkedUpdateData', true);
                if (this_) {
                    $(this_).find('i').removeClass('fa-spinner').toggleClass('fa-cogs fa-spin');
                    $(this_).find('.info').text('');
                } else {
                    loadingButtonConfirm(false);
                    resetDialogBoxPro('alertBoxPro');
                    $(window).unbind('beforeunload');
                }
            }
        }
        getAjaxRotinas(0);
    }
}
function initUpdateReports() {
    getUpdateReports(urlServerAtiv+'report.php?action='+listReportsUpdate[indexReportUpdate]+'&output=save');
    $('#progressLoopReports').progressbar({
        value: 0,
        max: 1000
    });

    alertaBoxPro('Sucess', 'check-circle','Aguarde... Atualizando relat\u00F3rios de <span id="countLoopReports"></span> <div class="info_checklist" style="height:20px"><div id="progressLoopReports" class="checklist_progress" style="float:none; width:95%"></div></div>');
    loadingButtonConfirm(true);
}
function setTipoPrescricaoProcesso() {
    var listPresc = checkTipoPrescricaoProcesso();
    if (listPresc) {
        appendIconCtrPrescricao();
    }
}

// INICIA PAINEL DE PRESCRICAO
function initPanelPrescricaoProc(TimeOut = 9000) {
    if (TimeOut <= 0 || !arrayPrescricoesProcPro) { return; }
    if (typeof localStorageRestorePro !== 'undefined') { 
        if ($('#ifrArvore').length > 0 && arrayPrescricoesProcPro.length > 0) {
            $('#ifrArvore')[0].contentWindow.initPanelPrescricaoProcesso();
        }
    } else {
        setTimeout(function(){ 
            initPanelPrescricaoProc(TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload initPanelPrescricaoProc'); 
        }, 500);
    }
}
function checkUnidadeFuncBeta() {
    var checkUnidades = (getOptionEntidade('unidades')) ? jmespath.search(getOptionEntidade('unidades'), "[?id_unidade==`"+arrayConfigAtivUnidade.id_unidade+"`]") : null;
        checkUnidades = (checkUnidades !== null && checkUnidades.length) ? true : false;
    return checkUnidades;
}
function checkHostPermission(TimeOut = 9000) {
    if (TimeOut <= 0 || parent.window.name != '') { return; }
    if (typeof getConfigHost === 'function') {
        if (sessionStorage.getItem('configHost_Pro') !== null) {
            setConfigHost(JSON.parse(sessionStorage.getItem('configHost_Pro')), initPerfilLoginAtiv, false);
        } else {
            getConfigHost(initPerfilLoginAtiv, false);
        }
    } else {
        setTimeout(function(){ 
            checkHostPermission(TimeOut - 100); 
            if(verifyConfigValue('debugpage')) console.log('Reload checkHostPermission => '+TimeOut); 
        }, 500);
    }
}
if (NAMESPACE_SPRO == 'ANTAQ Pro' || NAMESPACE_SPRO == 'ANTT Pro') {
    checkHostPermission();
} else {
    initPerfilLoginAtiv(); 
}